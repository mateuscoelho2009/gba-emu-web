{"version":3,"sources":["logo.svg","libs/resources/crash.png","libs/resources/bg.png","libs/resources/bios.bin","App.js","pages/Page404.js","serviceWorker.js","reducers/index.js","store/index.js","libs/js/arm.js","libs/js/thumb.js","libs/js/core.js","libs/js/util.js","libs/js/savedata.js","libs/js/gpio.js","libs/js/mmu.js","libs/js/irq.js","libs/js/io.js","libs/js/audio.js","libs/js/video/software.js","libs/js/video.js","libs/js/keypad.js","libs/js/sio.js","libs/js/gba.js","components/GBAControlsHelper.js","components/GBAMobileController.js","components/GBAScreen.js","libs/resources/xhr.js","index.js"],"names":["module","exports","App","className","src","logo","alt","href","target","to","useNonExistingPageStyle","makeStyles","theme","background","height","width","backgroundColor","overflow","textAlign","alertIcon","marginTop","color","link","textDecorationColor","withTheme","classes","Typography","variant","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","Reducers","combineReducers","Store","createStore","ARMCoreArm","cpu","this","addressingMode23Immediate","rn","offset","condOp","gprs","address","addr","writesPC","PC","addressingMode23Register","rm","addressingMode2RegisterShifted","shiftOp","shifterOperand","writePC","prototype","constructAddressingMode1ASR","rs","cycles","shift","shiftVal","shifterCarryOut","cpsrC","constructAddressingMode1Immediate","immediate","constructAddressingMode1ImmediateRotate","rotate","constructAddressingMode1LSL","constructAddressingMode1LSR","constructAddressingMode1ROR","constructAddressingMode23Immediate","instruction","constructAddressingMode23Register","constructAddressingMode2RegisterShifted","constructAddressingMode4","constructAddressingMode4Writeback","overlap","writeInitial","mmu","store32","constructADC","rd","waitPrefetch32","constructADCS","d","hasSPSR","unpackCPSR","spsr","cpsrN","cpsrZ","cpsrV","constructADD","constructADDS","constructAND","constructANDS","constructB","constructBIC","constructBICS","constructBL","LR","constructBX","switchExecMode","constructCMN","aluOut","constructCMP","constructEOR","constructEORS","constructLDM","m","i","total","load32","waitMulti32","constructLDMS","mode","switchMode","MODE_SYSTEM","constructLDR","wait32","constructLDRB","loadU8","wait","constructLDRH","loadU16","constructLDRSB","load8","constructLDRSH","load16","constructMLA","waitMul","hi","lo","constructMLAS","constructMOV","constructMOVS","constructMRS","r","packCPSR","constructMSR","c","f","operand","mask","USER_MASK","PRIV_MASK","STATE_MASK","MODE_USER","cpsrI","cpsrF","constructMUL","constructMULS","constructMVN","constructMVNS","constructORR","constructORRS","constructRSB","constructRSBS","constructRSC","n","constructRSCS","constructSBC","constructSBCS","constructSMLAL","carry","Math","floor","constructSMLALS","constructSMULL","constructSMULLS","constructSTM","constructSTMS","constructSTR","constructSTRB","store8","constructSTRH","store16","constructSUB","constructSUBS","constructSWI","irq","swi32","constructSWP","constructSWPB","constructTEQ","constructTST","constructUMLAL","constructUMLALS","constructUMULL","constructUMULLS","ARMCoreThumb","waitPrefetch","oldD","oldDn","dn","mn","constructADD1","constructADD2","constructADD3","constructADD4","constructADD5","constructADD6","SP","constructADD7","constructASR1","constructASR2","constructB1","constructB2","constructBL1","constructBL2","pc","misalign","constructCMP1","constructCMP2","an","constructCMP3","constructLDMIA","constructLDR1","constructLDR2","constructLDR3","constructLDR4","constructLDRB1","constructLDRB2","constructLDRH1","constructLDRH2","constructLSL1","constructLSL2","constructLSR1","constructLSR2","constructMOV1","constructMOV2","constructMOV3","constructNEG","constructPOP","waitSeq32","constructPUSH","constructROR","r4","constructSTMIA","constructSTR1","constructSTR2","constructSTR3","constructSTRB1","constructSTRB2","constructSTRH1","constructSTRH2","constructSUB1","constructSUB2","constructSUB3","swi","ARMCore","inherit","MODE_ARM","MODE_THUMB","MODE_FIQ","MODE_IRQ","MODE_SUPERVISOR","MODE_ABORT","MODE_UNDEFINED","BANK_NONE","BANK_FIQ","BANK_IRQ","BANK_SUPERVISOR","BANK_ABORT","BANK_UNDEFINED","UNALLOC_MASK","WORD_SIZE_ARM","WORD_SIZE_THUMB","BASE_RESET","BASE_UNDEF","BASE_SWI","BASE_PABT","BASE_DABT","BASE_IRQ","BASE_FIQ","armCompiler","thumbCompiler","generateConds","Int32Array","resetCPU","startOffset","loadInstruction","loadInstructionArm","execMode","instructionWidth","bankedRegisters","bankedSPSRs","page","pageId","pageRegion","clear","step","conditionPassed","fixedJump","next","invalid","updateTimers","freeze","defrost","frost","fetchPage","region","BASE_OFFSET","addressToPage","OFFSET_MASK","pageMask","memory","PAGE_MASK","accessPage","arm","compileArm","opcode","loadInstructionThumb","thumb","compileThumb","selectBank","newMode","newBank","oldBank","oldFiqBank","newFiqBank","testIRQ","raiseIRQ","cpsr","raiseTrap","badOp","func","toString","conds","barrelShiftImmediate","shiftType","op","load","loOffset","h","w","s","b","shiftImmediate","user","p","rotateImm","cond","WARN","Serializer","TAG_INT","TAG_STRING","TAG_STRUCT","TAG_BLOB","TAG_BOOLEAN","TYPE","pointer","index","top","stack","pack","value","object","DataView","ArrayBuffer","setUint32","buffer","pack8","setUint8","prefix","Blob","size","length","byteLength","type","serialize","stream","parts","hasOwnProperty","tag","body","head","push","unshift","deserialize","blob","callback","reader","FileReader","onload","data","deserealizeStream","result","readAsArrayBuffer","view","remaining","getUint32","advance","mark","getUint8","readString","slice","pop","serializePNG","base","canvas","document","createElement","context","getContext","pixels","getImageData","transparent","y","x","bytesInCanvas","multiplier","edges","padding","ceil","setAttribute","Uint8Array","pixelPointer","newPixels","createImageData","oldY","oldX","byte","putImageData","toDataURL","deserializePNG","image","drawImage","newBlob","map","array","readAsDataURL","amount","bytes","String","fromCharCode","join","SRAMSavedata","MemoryView","call","writePending","FlashSavedata","COMMAND_WIPE","COMMAND_ERASE_SECTOR","COMMAND_ERASE","COMMAND_ID","COMMAND_WRITE","COMMAND_SWITCH_BANK","COMMAND_TERMINATE_ID","ID_PANASONIC","ID_SANYO","bank0","id","bank1","bank","idMode","first","second","command","pendingCommand","EEPROMSavedata","writeAddress","readBitsRemaining","readAddress","commandBitsRemaining","realSize","addressBits","dma","core","COMMAND_NULL","COMMAND_PENDING","COMMAND_READ_PENDING","COMMAND_READ","GameBoyAdvanceGPIO","rom","readWrite","direction","device","GameBoyAdvanceRTC","gpio","pins","totalBytes","bytesRemaining","transferStep","reading","bitsRead","bits","control","time","Object","create","setInt8","setInt16","setInt32","getInt8","Error","replaceData","enable","count","current","setPins","setDirection","old","getUint16","setUint16","outputPins","nybble","read","processByte","sioOutputPin","updateClock","outputByte","date","Date","bcd","getFullYear","getMonth","getDate","getDay","getHours","getMinutes","getSeconds","binary","counter","resetMask","MemoryBlock","cacheBits","ICACHE_PAGE_BITS","icache","Array","ROMView","BIOSView","BadMemory","GameBoyAdvanceMMU","REGION_BIOS","REGION_WORKING_RAM","REGION_WORKING_IRAM","REGION_IO","REGION_PALETTE_RAM","REGION_VRAM","REGION_OAM","REGION_CART0","REGION_CART1","REGION_CART2","REGION_CART_SRAM","BASE_BIOS","BASE_WORKING_RAM","BASE_WORKING_IRAM","BASE_IO","BASE_PALETTE_RAM","BASE_VRAM","BASE_OAM","BASE_CART0","BASE_CART1","BASE_CART2","BASE_CART_SRAM","BASE_MASK","SIZE_BIOS","SIZE_WORKING_RAM","SIZE_WORKING_IRAM","SIZE_IO","SIZE_PALETTE_RAM","SIZE_VRAM","SIZE_OAM","SIZE_CART0","SIZE_CART1","SIZE_CART2","SIZE_CART_SRAM","SIZE_CART_FLASH512","SIZE_CART_FLASH1M","SIZE_CART_EEPROM","DMA_TIMING_NOW","DMA_TIMING_VBLANK","DMA_TIMING_HBLANK","DMA_TIMING_CUSTOM","DMA_INCREMENT","DMA_DECREMENT","DMA_FIXED","DMA_INCREMENT_RELOAD","DMA_OFFSET","WAITSTATES","WAITSTATES_32","WAITSTATES_SEQ","WAITSTATES_SEQ_32","NULLWAIT","ROM_WS","ROM_WS_SEQ","bios","mask8","mask16","mask32","getInt16","mem","getInt32","invalidatePage","allocGPIO","halfword","mmap","badMemory","waitstates","waitstatesSeq","waitstates32","waitstatesSeq32","waitstatesPrefetch","waitstatesPrefetch32","cart","save","DMA_REGISTER","io","DMA0CNT_HI","DMA1CNT_HI","DMA2CNT_HI","DMA3CNT_HI","ram","iram","loadBios","real","loadRom","process","title","code","maker","saveType","name","terminal","loadSavedata","maskedOffset","waitSeq","seq","scheduleDma","number","info","timing","serviceDma","audio","scheduleFIFODma","video","scheduleVCaptureDma","runHblankDmas","runVblankDmas","word","sourceOffset","srcControl","destOffset","dstControl","wordsRemaining","nextCount","source","nextSource","dest","nextDest","sourceRegion","destRegion","sourceBlock","destBlock","sourceView","destView","sourceMask","destMask","endPage","doIrq","nextIRQ","repeat","registers","adjustTimings","sram","ws0","ws0seq","ws1","ws1seq","ws2","ws2seq","prefetch","saveNeedsFlush","flushSave","GameBoyAdvanceInterruptHandler","FREQUENCY","IRQ_VBLANK","IRQ_HBLANK","IRQ_VCOUNTER","IRQ_TIMER0","IRQ_TIMER1","IRQ_TIMER2","IRQ_TIMER3","IRQ_SIO","IRQ_DMA0","IRQ_DMA1","IRQ_DMA2","IRQ_DMA3","IRQ_KEYPAD","IRQ_GAMEPAK","MASK_VBLANK","MASK_HBLANK","MASK_VCOUNTER","MASK_TIMER0","MASK_TIMER1","MASK_TIMER2","MASK_TIMER3","MASK_SIO","MASK_DMA0","MASK_DMA1","MASK_DMA2","MASK_DMA3","MASK_KEYPAD","MASK_GAMEPAK","enabledIRQs","interruptFlags","drq","timersEnabled","timers","reload","oldReload","prescaleBits","countUp","lastEvent","nextEvent","overflowInterval","springIRQ","resetSP","timer","TM0CNT_LO","enabled","enableChannelA","soundTimerA","dmaA","sampleFifoA","enableChannelB","soundTimerB","dmaB","sampleFifoB","TM1CNT_LO","TM2CNT_LO","TM3CNT_LO","pollNextEvent","flag","regions","renderPath","clearSubsets","STUB","halt","IME","dismissIRQs","mod","abs","root","sqrt","atan2","PI","wordsize","ox","oy","cx","cy","rx","ry","destination","sx","sy","theta","a","cos","sin","diff","lz77","huffman","rl","key","pow","masterEnable","setInterruptsEnabled","test","ASSERT","waitForIRQ","irqPending","hblankIRQ","vblankIRQ","vcounterIRQ","irqType","IF","irqMask","dmaSetSourceAddress","dmaSetDestAddress","dmaSetWordCount","dmaWriteControl","currentDma","wasEnabled","timerSetReload","timerWriteControl","currentTimer","oldPrescale","timerRead","unitsize","blockheader","block","disp","loaded","sPointer","dPointer","blocksRemaining","header","node","tree","treesize","bitsRemaining","readBits","bitsSeen","bitstream","l","lTerm","rTerm","GameBoyAdvanceIO","DISPCNT","GREENSWP","DISPSTAT","VCOUNT","BG0CNT","BG1CNT","BG2CNT","BG3CNT","BG0HOFS","BG0VOFS","BG1HOFS","BG1VOFS","BG2HOFS","BG2VOFS","BG3HOFS","BG3VOFS","BG2PA","BG2PB","BG2PC","BG2PD","BG2X_LO","BG2X_HI","BG2Y_LO","BG2Y_HI","BG3PA","BG3PB","BG3PC","BG3PD","BG3X_LO","BG3X_HI","BG3Y_LO","BG3Y_HI","WIN0H","WIN1H","WIN0V","WIN1V","WININ","WINOUT","MOSAIC","BLDCNT","BLDALPHA","BLDY","SOUND1CNT_LO","SOUND1CNT_HI","SOUND1CNT_X","SOUND2CNT_LO","SOUND2CNT_HI","SOUND3CNT_LO","SOUND3CNT_HI","SOUND3CNT_X","SOUND4CNT_LO","SOUND4CNT_HI","SOUNDCNT_LO","SOUNDCNT_HI","SOUNDCNT_X","SOUNDBIAS","WAVE_RAM0_LO","WAVE_RAM0_HI","WAVE_RAM1_LO","WAVE_RAM1_HI","WAVE_RAM2_LO","WAVE_RAM2_HI","WAVE_RAM3_LO","WAVE_RAM3_HI","FIFO_A_LO","FIFO_A_HI","FIFO_B_LO","FIFO_B_HI","DMA0SAD_LO","DMA0SAD_HI","DMA0DAD_LO","DMA0DAD_HI","DMA0CNT_LO","DMA1SAD_LO","DMA1SAD_HI","DMA1DAD_LO","DMA1DAD_HI","DMA1CNT_LO","DMA2SAD_LO","DMA2SAD_HI","DMA2DAD_LO","DMA2DAD_HI","DMA2CNT_LO","DMA3SAD_LO","DMA3SAD_HI","DMA3DAD_LO","DMA3DAD_HI","DMA3CNT_LO","TM0CNT_HI","TM1CNT_HI","TM2CNT_HI","TM3CNT_HI","SIODATA32_LO","SIOMULTI0","SIODATA32_HI","SIOMULTI1","SIOMULTI2","SIOMULTI3","SIOCNT","SIOMLT_SEND","SIODATA8","RCNT","JOYCNT","JOY_RECV","JOY_TRANS","JOYSTAT","KEYINPUT","KEYCNT","IE","WAITCNT","POSTFLG","HALTCNT","DEFAULT_DISPCNT","DEFAULT_SOUNDBIAS","DEFAULT_BGPA","DEFAULT_BGPD","DEFAULT_RCNT","Uint16Array","odd","readDisplayStat","vcount","sio","readSIOCNT","keypad","pollGamepads","currentDown","STUB_REG","writeDisplayControl","DISPSTAT_MASK","writeDisplayStat","writeBackgroundControl","writeBackgroundHOffset","writeBackgroundVOffset","writeBackgroundRefX","writeBackgroundRefY","writeBackgroundParamA","writeBackgroundParamB","writeBackgroundParamC","writeBackgroundParamD","writeWin0H","writeWin1H","writeWin0V","writeWin1V","writeWinIn","writeWinOut","writeBlendControl","writeBlendAlpha","writeBlendY","writeMosaic","writeSquareChannelSweep","writeSquareChannelDLE","writeSquareChannelFC","writeChannel3Lo","writeChannel3Hi","writeChannel3X","writeChannel4LE","writeChannel4FC","writeSoundControlLo","writeSoundControlHi","writeEnable","writeWaveData","setMode","writeRCNT","writeSIOCNT","appendToFifoA","appendToFifoB","GameBoyAdvanceAudio","masterVolume","SOUND_MAX","FIFO_MAX","PSG_MAX","AudioContext","webkitAudioContext","bufferSize","maxSamples","buffers","Float32Array","sampleMask","createScriptProcessor","jsAudio","createJavaScriptNode","audioProcess","audioProcessingEvent","left","outputBuffer","getChannelData","right","o","outputPointer","resampleRatio","samplePointer","backup","totalSamples","onaudioprocess","e","fifoA","fifoB","fifoASample","fifoBSample","disconnect","enableChannel3","enableChannel4","enableRightChannelA","enableLeftChannelA","enableRightChannelB","enableLeftChannelB","playingChannel3","playingChannel4","volumeLeft","volumeRight","ratioChannelA","ratioChannelB","enabledLeft","enabledRight","soundRatio","soundBias","squareChannels","playing","sample","duty","increment","initialVolume","volume","frequency","interval","sweepSteps","sweepIncrement","sweepInterval","doSweep","raise","lower","nextStep","timed","end","waveData","channel3Dimension","channel3Bank","channel3Volume","channel3Interval","channel3Next","channel3Length","channel3Timed","channel3End","channel3Pointer","channel3Sample","cpuFrequency","channel4","lfsr","nextSample","sampleRate","sampleInterval","pause","paused","connect","channel","Infinity","updateSquareChannel","channel3Write","updateEnvelope","masterVolumeLeft","masterVolumeRight","setSquareChannelEnabled","setChannel4Enabled","resetSquareChannel","channelId","nextSweep","writeChannelLE","resetChannel3","resetChannel4","sampleLeft","sampleRight","max","min","MemoryAligned16","GameBoyAdvanceVRAM","vram","GameBoyAdvanceOAM","oam","objs","GameBoyAdvanceOBJ","scalerot","GameBoyAdvancePalette","colors","adjustedColors","passthroughColors","blendY","TILE_OFFSET","doublesize","disable","mosaic","multipalette","shape","scalerotParam","hflip","vflip","tileBase","priority","palette","drawScanline","drawScanlineNormal","pushPixel","GameBoyAdvanceSoftwareRenderer","cachedWidth","cachedHeight","GameBoyAdvanceOBJLayer","bg","LAYER_OBJ","objwin","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BACKDROP","HORIZONTAL_PIXELS","VERTICAL_PIXELS","LAYER_MASK","BACKGROUND_MASK","TARGET2_MASK","TARGET1_MASK","OBJWIN_MASK","WRITTEN_MASK","PRIORITY_MASK","drawBackdrop","backing","layer","start","stencil","mix","blendB","accessColor","blendA","insert","set","overwrite","obj","wasScalerot","scalerotOam","recalcSize","drawScanlineAffine","adjustColor","convert16To32","input","g","aWeight","aColor","bWeight","bColor","ar","ag","ab","br","bb","makeDarkPalettes","layers","adjustColorDark","resetPalettes","resetPaletteLayers","makeBrightPalettes","adjustColorBright","makeNormalPalettes","makeSpecialPalette","makeNormalPalette","outPalette","inPalette","setBlendY","yOff","underflow","target2","blendMode","alphaEnabled","target1","localX","localY","totalWidth","mosaicX","tileOffset","localYLo","paletteShift","objCharacterMapping","objMosaicX","tileRow","accessTile","yDiff","totalHeight","drawWidth","objMosaicY","wrappedY","mosaicY","objComparator","objLayers","objwinLayer","backgroundMode","displayFrameSelect","hblankIntervalFree","forcedBlank","win0","win1","win0Left","win0Right","win1Left","win1Right","win0Top","win0Bottom","win1Top","win1Bottom","windows","special","bgMosaicX","bgMosaicY","lastHblank","nextHblank","HDRAW_LENGTH","nextHblankIRQ","nextVblankIRQ","nextVcounterIRQ","charBase","screenBase","refx","refy","dx","dmx","dy","dmy","drawScanlineBGMode0","bgModes","drawScanlineBGMode2","drawScanlineBGMode3","drawScanlineBGMode4","drawScanlineBGMode5","drawLayers","objwinActive","scanline","sharedColor","sharedMap","tile","SIZE_PALETTE","setBacking","pixelData","resetLayers","bgData","sort","layerComparator","writeWindow","setBlendEnabled","override","accessMapMode0","yBase","out","accessMapMode1","row","raw","oldStencil","blend","pixel","highPriority","identity","drawScanlineBlank","prepareScanline","localXLo","xOff","xMask","sizeAdjusted","firstStart","firstEnd","lastStart","lastEnd","finishScanline","bd","xx","isTarget2","startDraw","finishDraw","caller","GameBoyAdvanceVideo","CYCLES_PER_PIXEL","HBLANK_PIXELS","HBLANK_LENGTH","HORIZONTAL_LENGTH","VBLANK_PIXELS","VERTICAL_TOTAL_PIXELS","TOTAL_LENGTH","drawCallback","vblankCallback","inHblank","inVblank","vcounter","vcountSetting","encodeBase64","decodeBase64","GameBoyAdvanceKeypad","KEYCODE_LEFT","KEYCODE_UP","KEYCODE_RIGHT","KEYCODE_DOWN","KEYCODE_START","KEYCODE_SELECT","KEYCODE_A","KEYCODE_B","KEYCODE_L","KEYCODE_R","GAMEPAD_LEFT","GAMEPAD_UP","GAMEPAD_RIGHT","GAMEPAD_DOWN","GAMEPAD_START","GAMEPAD_SELECT","GAMEPAD_A","GAMEPAD_B","GAMEPAD_L","GAMEPAD_R","GAMEPAD_THRESHOLD","A","B","SELECT","START","RIGHT","LEFT","UP","DOWN","R","L","eatInput","gamepads","clickHandlerStart","toggle","clickedButton","clickHandlerEnd","keyboardHandler","keyCode","preventDefault","gamepadHandler","gamepad","buttons","gamepadConnectHandler","gamepadDisconnectHandler","self","filter","other","navigatorList","webkitGetGamepads","getGamepads","registerHandlers","addEventListener","bind","GameBoyAdvanceSIO","SIO_NORMAL_8","SIO_NORMAL_32","SIO_MULTI","SIO_UART","SIO_GPIO","SIO_JOYBUS","BAUD","sd","multiplayer","baud","si","busy","states","linkLayer","INFO","leading","usePrefix","string","toUpperCase","hex","setBaud","startMultiplayerTransfer","slot","GameBoyAdvance","LOG_ERROR","LOG_WARN","LOG_STUB","LOG_INFO","LOG_DEBUG","SYS_ID","logLevel","v","doStep","waitFrame","seenFrame","seenSave","lastVblank","queue","reportFPS","throttle","queueFrame","setTimeout","URL","webkitURL","setCanvas","offsetWidth","offsetHeight","indirectCanvas","targetCanvas","setCanvasDirect","targetContext","setBios","setRom","reset","retrieveSavedata","hasRom","loadRomFromFile","romFile","seen","clearTimeout","advanceFrame","storeSavedata","runStable","runFunc","frames","now","resume","exception","ERROR","logStackTrace","split","setSavedata","loadSavedataFromFile","saveFile","decodeSavedata","atob","charCodeAt","triplet","wordstring","splice","btoa","downloadSavedata","url","createObjectURL","open","localStorage","level","message","setLogger","logger","warn","DEBUG","ASSERT_UNREACHED","err","useStyle","container","maxWidth","margin","textShadow","paper","borderRadius","fontWeight","topPaper","GBAControlsHelper","props","Table","TableRow","TableCell","Paper","commandToStr","parseInt","withStyles","screen","position","border","bottom","fullscreen","goFull","toogleSpeed","commands","Button","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen","onClick","16","12","8","gba","WhiteCheckbox","checked","Checkbox","GBAScreen","isFull","initGBA","doc","docEl","documentElement","requestFullScreen","cancelFullScreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","setState","installPrompt","matchMedia","matches","standalone","installButton","prompt","userChoice","outcome","runCommands","fadeOut","nextId","kill","getElementById","e2","removeSelf","parentElement","removeChild","dead","removeEventListener","hidden","removeAttribute","textContent","crash","screenWidth","clearRect","drawInterval","setInterval","xDiff","xFactor","yFactor","clearInterval","lcdFade","onclick","click","getAttribute","CrashImage","insertBefore","onblur","onfocus","xhr","XMLHttpRequest","responseType","response","send","Bios","soundbox","querySelector","file","run","files","SAVEGAME","togglePause","forEach","ontouchstart","ontouchend","installApp","controls","noselect","button","accept","Grid","spacing","item","xs","Slider","style","onChange","newValue","aria-labelledby","inputProps","React","Component","minHeight","fontFamily","BackgroundImage","marginBottom","imageRendering","borderTop","boxShadow","content","display","borderWidth","transform","transformOrigin","transition","fontSize","ReactDOM","render","store","path","exact","component","Page404","origin","fetch","contentType","headers","get","status","indexOf","ready","unregister","checkValidServiceWorker"],"mappings":"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","file":"static/js/main.356531df.chunk.js","sourcesContent":["module.exports = __webpack_public_path__ + \"static/media/logo.25bf045c.svg\";","module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/bg.d96f92c9.png\";","module.exports = __webpack_public_path__ + \"static/media/bios.3465b6bf.bin\";","import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <p>\r\n        Inspired by the project <a href=\"https://github.com/endrift/gbajs\" target=\"_blank\">gbajs</a> which was descontinued.\r\n\r\n        This project intends to:\r\n          <ul>\r\n            <li>\r\n            Create a react component that can be used for playing GameBoy Advanced games in browser;\r\n            </li>\r\n            <li>\r\n            Refactor code from <a href=\"https://github.com/endrift/gbajs\" target=\"_blank\">gbajs</a>;\r\n            </li>\r\n            <li>\r\n            Include mobile gameplay support;\r\n            </li>\r\n            <li>\r\n            Develop a platform for playing GBA online.\r\n            </li>\r\n          </ul>\r\n        </p>\r\n        <p>\r\n          <Link\r\n            to=\"/emulator\"\r\n            className=\"App-link\"\r\n          >\r\n            Run Emulator\r\n          </Link>\r\n        </p>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { makeStyles, withTheme } from '@material-ui/styles';\r\nimport { Link } from 'react-router-dom';\r\nimport AlertIcon from '@material-ui/icons/ErrorOutline';\r\n\r\nconst useNonExistingPageStyle = makeStyles((theme) => ({\r\n  background: {\r\n    height: '100vh',\r\n    width: '100vw',\r\n    backgroundColor: '#aaf',\r\n    overflow: 'hidden',\r\n    textAlign: 'center',\r\n  },\r\n  alertIcon: {\r\n    width: '40vh',\r\n    height: '40vh',\r\n    marginTop: '5vh',\r\n    color: '#77f',\r\n  },\r\n  link: {\r\n    color: '#77f',\r\n    textDecorationColor: '#77f',\r\n    '&:visited, &:hover, &:active': {\r\n      color: '#55f',\r\n      textDecorationColor: '#55f',\r\n    },\r\n  },\r\n}));\r\n\r\nfunction Page404() {\r\n  const classes = useNonExistingPageStyle();\r\n\r\n  return (\r\n    <div className={classes.background}>\r\n      <AlertIcon className={classes.alertIcon} />\r\n      <Typography\r\n        variant=\"h2\"\r\n        color=\"primary\"\r\n      >\r\n        This page does not exist.\r\n      </Typography>\r\n      <br />\r\n      <Link to=\"/\" className={classes.link}>\r\n        Please follow to the main page.\r\n      </Link>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withTheme(Page404);\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux';\r\n\r\nexport const Reducers = combineReducers({\r\n});\r\n","import { createStore } from 'redux';\r\nimport { Reducers } from '../reducers';\r\n\r\nexport const Store = createStore(Reducers);","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nconst ARMCoreArm = function (cpu) {\r\n\tthis.cpu = cpu;\r\n\r\n\tthis.addressingMode23Immediate = [\r\n\t\t// 000x0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] -= offset;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 000xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 00Ux0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] += offset;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 00UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 0P0x0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] - offset;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 0P0xW\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] - offset;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 0PUx0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] + offset;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 0PUxW\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + offset;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\t];\r\n\r\n\tthis.addressingMode23Register = [\r\n\t\t// I00x0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] -= gprs[rm];\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I00xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// I0Ux0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] += gprs[rm];\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I0UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IP0x0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] - gprs[rm];\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IP0xW\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] - gprs[rm];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IPUx0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + gprs[rm];\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IPUxW\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + gprs[rm];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull\r\n\t];\r\n\r\n\tthis.addressingMode2RegisterShifted = [\r\n\t\t// I00x0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tshiftOp();\r\n\t\t\t\t\tgprs[rn] -= cpu.shifterOperand;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I00xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// I0Ux0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tshiftOp();\r\n\t\t\t\t\tgprs[rn] += cpu.shifterOperand;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\t\t// I0UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IP0x0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\treturn gprs[rn] - cpu.shifterOperand;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IP0xW\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\tvar addr = gprs[rn] - cpu.shifterOperand;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IPUx0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\treturn gprs[rn] + cpu.shifterOperand;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IPUxW\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\tvar addr = gprs[rn] + cpu.shifterOperand;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writePC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\t];\r\n}\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ASR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal >> shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (shift - 1));\r\n\t\t} else if (gprs[rm] >> 31) {\r\n\t\t\tcpu.shifterOperand = 0xFFFFFFFF;\r\n\t\t\tcpu.shifterCarryOut = 0x80000000;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1Immediate = function(immediate) {\r\n\tvar cpu = this.cpu;\r\n\treturn function() {\r\n\t\tcpu.shifterOperand = immediate;\r\n\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ImmediateRotate = function(immediate, rotate) {\r\n\tvar cpu = this.cpu;\r\n\treturn function() {\r\n\t\tcpu.shifterOperand = (immediate >>> rotate) | (immediate << (32 - rotate));\r\n\t\tcpu.shifterCarryOut = cpu.shifterOperand >> 31;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1LSL = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal << shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (32 - shift));\r\n\t\t} else if (shift == 32) {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & 1;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1LSR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal >>> shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (shift - 1));\r\n\t\t} else if (shift == 32) {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = shiftVal >> 31;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ROR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tvar rotate = shift & 0x1F;\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (rotate) {\r\n\t\t\tcpu.shifterOperand = (gprs[rm] >>> rotate) | (gprs[rm] << (32 - rotate));\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (rotate - 1));\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = shiftVal >> 31;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode23Immediate = function(instruction, immediate, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode23Immediate[(instruction & 0x01A00000) >> 21](rn, immediate, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode23Register = function(instruction, rm, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode23Register[(instruction & 0x01A00000) >> 21](rn, rm, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode2RegisterShifted = function(instruction, shiftOp, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode2RegisterShifted[(instruction & 0x01A00000) >> 21](rn, shiftOp, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode4 = function(immediate, rn) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tvar addr = gprs[rn] + immediate;\r\n\t\treturn addr;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode4Writeback = function(immediate, offset, rn, overlap) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function(writeInitial) {\r\n\t\tvar addr = gprs[rn] + immediate;\r\n\t\tif (writeInitial && overlap) {\r\n\t\t\tcpu.mmu.store32(gprs[rn] + immediate - 4, gprs[rn]);\r\n\t\t}\r\n\t\tgprs[rn] += offset;\r\n\t\treturn addr;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructADC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !!cpu.cpsrC;\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) + shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !!cpu.cpsrC;\r\n\t\tvar d = (gprs[rn] >>> 0) + shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = d > 0xFFFFFFFF;\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) == (shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31) &&\r\n\t\t\t\t\t\t(shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADD = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADDS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = d > 0xFFFFFFFF;\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) == (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAND = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructANDS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructB = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tgprs[cpu.PC] += immediate;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBIC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & ~cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBICS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & ~cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBL = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tgprs[cpu.LR] = gprs[cpu.PC] - 4;\r\n\t\tgprs[cpu.PC] += immediate;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBX = function(rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tcpu.switchExecMode(gprs[rm] & 0x00000001);\r\n\t\tgprs[cpu.PC] = gprs[rm] & 0xFFFFFFFE;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructCMN = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = aluOut > 0xFFFFFFFF;\r\n\t\tcpu.cpsrV = (gprs[rn] >> 31) == (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t(gprs[rn] >> 31) != (aluOut >> 31) &&\r\n\t\t\t\t\t(cpu.shifterOperand >> 31) != (aluOut >> 31);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructCMP = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] - cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (cpu.shifterOperand >>> 0);\r\n\t\tcpu.cpsrV = (gprs[rn] >> 31) != (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t(gprs[rn] >> 31) != (aluOut >> 31);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructEOR = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] ^ cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructEORS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] ^ cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDM = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address(false);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tgprs[i] = mmu.load32(addr & 0xFFFFFFFC);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDMS = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address(false);\r\n\t\tvar total = 0;\r\n\t\tvar mode = cpu.mode;\r\n\t\tcpu.switchMode(cpu.MODE_SYSTEM);\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tgprs[i] = mmu.load32(addr & 0xFFFFFFFC);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcpu.switchMode(mode);\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDR = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load32(addr);\r\n\t\tcpu.mmu.wait32(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.loadU8(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.loadU16(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRSB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load8(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRSH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load16(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMLA = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tgprs[rd] = (hi + lo + gprs[rn]) & 0xFFFFFFFF;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs] + gprs[rn];\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMLAS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tgprs[rd] = (hi + lo + gprs[rn]) & 0xFFFFFFFF;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs] + gprs[rn];\r\n\t\t}\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMOV = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMOVS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMRS = function(rd, r, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (r) {\r\n\t\t\tgprs[rd] = cpu.spsr;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = cpu.packCPSR();\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMSR = function(rm, r, instruction, immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar c = instruction & 0x00010000;\r\n\t//var x = instruction & 0x00020000;\r\n\t//var s = instruction & 0x00040000;\r\n\tvar f = instruction & 0x00080000;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar operand;\r\n\t\tif (instruction & 0x02000000) {\r\n\t\t\toperand = immediate;\r\n\t\t} else {\r\n\t\t\toperand = gprs[rm];\r\n\t\t}\r\n\t\tvar mask = (c ? 0x000000FF : 0x00000000) |\r\n\t\t\t\t   //(x ? 0x0000FF00 : 0x00000000) | // Irrelevant on ARMv4T\r\n\t\t\t\t   //(s ? 0x00FF0000 : 0x00000000) | // Irrelevant on ARMv4T\r\n\t\t\t\t   (f ? 0xFF000000 : 0x00000000);\r\n\r\n\t\tif (r) {\r\n\t\t\tmask &= cpu.USER_MASK | cpu.PRIV_MASK | cpu.STATE_MASK;\r\n\t\t\tcpu.spsr = (cpu.spsr & ~mask) | (operand & mask);\r\n\t\t} else {\r\n\t\t\tif (mask & cpu.USER_MASK) {\r\n\t\t\t\tcpu.cpsrN = operand >> 31;\r\n\t\t\t\tcpu.cpsrZ = operand & 0x40000000;\r\n\t\t\t\tcpu.cpsrC = operand & 0x20000000;\r\n\t\t\t\tcpu.cpsrV = operand & 0x10000000;\r\n\t\t\t}\r\n\t\t\tif (cpu.mode != cpu.MODE_USER && (mask & cpu.PRIV_MASK)) {\r\n\t\t\t\tcpu.switchMode((operand & 0x0000000F) | 0x00000010);\r\n\t\t\t\tcpu.cpsrI = operand & 0x00000080;\r\n\t\t\t\tcpu.cpsrF = operand & 0x00000040;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMUL = function(rd, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) | 0;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) | 0;\r\n\t\t\tgprs[rd] = hi + lo;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs];\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMULS = function(rd, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) | 0;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) | 0;\r\n\t\t\tgprs[rd] = hi + lo;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs];\r\n\t\t}\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMVN = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = ~cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMVNS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = ~cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructORR = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] | cpu.shifterOperand;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructORRS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] | cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSB = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand - gprs[rn];\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSBS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = cpu.shifterOperand - gprs[rn];\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (cpu.shifterOperand >>> 0) >= (gprs[rn] >>> 0);\r\n\t\t\tcpu.cpsrV = (cpu.shifterOperand >> 31) != (gprs[rn] >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar n = (gprs[rn] >>> 0) + !cpu.cpsrC;\r\n\t\tgprs[rd] = (cpu.shifterOperand >>> 0) - n;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar n = (gprs[rn] >>> 0) + !cpu.cpsrC;\r\n\t\tvar d = (cpu.shifterOperand >>> 0) - n;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (cpu.shifterOperand >>> 0) >= (d >>> 0);\r\n\t\t\tcpu.cpsrV = (cpu.shifterOperand >> 31) != (n >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSBC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !cpu.cpsrC;\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) - shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSBCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !cpu.cpsrC;\r\n\t\tvar d = (gprs[rn] >>> 0) - shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (d >>> 0);\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) != (shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMLAL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = (gprs[rm] & 0xFFFF0000) * gprs[rs];\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * gprs[rs];\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += Math.floor(carry * SHIFT_32);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMLALS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = (gprs[rm] & 0xFFFF0000) * gprs[rs];\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * gprs[rs];\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += Math.floor(carry * SHIFT_32);\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMULL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >> 0) * (gprs[rs] >> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >> 0) * (gprs[rs] >> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = Math.floor(hi * SHIFT_32 + lo * SHIFT_32);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMULLS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >> 0) * (gprs[rs] >> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >> 0) * (gprs[rs] >> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = Math.floor(hi * SHIFT_32 + lo * SHIFT_32);\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTM = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmmu.wait32(gprs[cpu.PC]);\r\n\t\tvar addr = address(true);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tmmu.store32(addr, gprs[i]);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTMS = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmmu.wait32(gprs[cpu.PC]);\r\n\t\tvar mode = cpu.mode;\r\n\t\tvar addr = address(true);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tcpu.switchMode(cpu.MODE_SYSTEM);\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tmmu.store32(addr, gprs[i]);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcpu.switchMode(mode);\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTR = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store32(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait32(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTRB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store8(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTRH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store16(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSUB = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] - cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSUBS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = gprs[rn] - cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (cpu.shifterOperand >>> 0);\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) != (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSWI = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.irq.swi32(immediate);\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSWP = function(rd, rn, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.wait32(gprs[rn]);\r\n\t\tcpu.mmu.wait32(gprs[rn]);\r\n\t\tvar d = cpu.mmu.load32(gprs[rn]);\r\n\t\tcpu.mmu.store32(gprs[rn], gprs[rm]);\r\n\t\tgprs[rd] = d;\r\n\t\t++cpu.cycles;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructSWPB = function(rd, rn, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.wait(gprs[rn]);\r\n\t\tcpu.mmu.wait(gprs[rn]);\r\n\t\tvar d = cpu.mmu.load8(gprs[rn]);\r\n\t\tcpu.mmu.store8(gprs[rn], gprs[rm]);\r\n\t\tgprs[rd] = d;\r\n\t\t++cpu.cycles;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructTEQ = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] ^ cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructTST = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] & cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMLAL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * (gprs[rs] >>> 0);\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += carry * SHIFT_32;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMLALS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * (gprs[rs] >>> 0);\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += carry * SHIFT_32;\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMULL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = (hi * SHIFT_32 + lo * SHIFT_32) >>> 0;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMULLS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = (hi * SHIFT_32 + lo * SHIFT_32) >>> 0;\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nexport default ARMCoreArm;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nconst ARMCoreThumb = function (cpu) {\n\tthis.cpu = cpu;\n};\n\nARMCoreThumb.prototype.constructADC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar m = (gprs[rm] >>> 0) + !!cpu.cpsrC;\n\t\tvar oldD = gprs[rd];\n\t\tvar d = (oldD >>> 0) + m;\n\t\tvar oldDn = oldD >> 31;\n\t\tvar dn = d >> 31;\n\t\tvar mn = m >> 31;\n\t\tcpu.cpsrN = dn;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = oldDn == mn && oldDn != dn && mn != dn;\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !(gprs[rn] >> 31) && ((gprs[rn] >> 31 ^ d) >> 31) && (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD2 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !(gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31) && ((immediate ^ d) >> 31);\n\t\tgprs[rn] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD3 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + (gprs[rm] >>> 0);\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !((gprs[rn] ^ gprs[rm]) >> 31) && ((gprs[rn] ^ d) >> 31) && ((gprs[rm] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD4 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] += gprs[rm];\n\t};\n};\n\nARMCoreThumb.prototype.constructADD5 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = (gprs[cpu.PC] & 0xFFFFFFFC) + immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD6 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[cpu.SP] + immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD7 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.SP] += immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructAND = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] & gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructASR1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tcpu.cpsrC = gprs[rm] >> 31;\n\t\t\tif (cpu.cpsrC) {\n\t\t\t\tgprs[rd] = 0xFFFFFFFF;\n\t\t\t} else {\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (immediate - 1));\n\t\t\tgprs[rd] = gprs[rm] >> immediate;\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructASR2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (rs - 1));\n\t\t\t\tgprs[rd] >>= rs;\n\t\t\t} else {\n\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t\tif (cpu.cpsrC) {\n\t\t\t\t\tgprs[rd] = 0xFFFFFFFF;\n\t\t\t\t} else {\n\t\t\t\t\tgprs[rd] = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructB1 = function(immediate, condOp) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (condOp()) {\n\t\t\tgprs[cpu.PC] += immediate;\n\t\t}\n\t};\n};\n\nARMCoreThumb.prototype.constructB2 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.PC] += immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructBIC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] & ~gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructBL1 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.LR] = gprs[cpu.PC] + immediate;\n\t}\n};\n\nARMCoreThumb.prototype.constructBL2 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar pc = gprs[cpu.PC];\n\t\tgprs[cpu.PC] = gprs[cpu.LR] + (immediate << 1);\n\t\tgprs[cpu.LR] = pc - 1;\n\t}\n};\n\nARMCoreThumb.prototype.constructBX = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tcpu.switchExecMode(gprs[rm] & 0x00000001);\n\t\tvar misalign = 0;\n\t\tif (rm == 15) {\n\t\t\tmisalign = gprs[rm] & 0x00000002;\n\t\t}\n\t\tgprs[cpu.PC] = gprs[rm] & 0xFFFFFFFE - misalign;\n\t};\n};\n\nARMCoreThumb.prototype.constructCMN = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = (gprs[rd] >>> 0) + (gprs[rm] >>> 0);\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = aluOut > 0xFFFFFFFF;\n\t\tcpu.cpsrV = (gprs[rd] >> 31) == (gprs[rm] >> 31) &&\n\t\t\t\t\t(gprs[rd] >> 31) != (aluOut >> 31) &&\n\t\t\t\t\t(gprs[rm] >> 31) != (aluOut >> 31);\n\t};\n};\n\nARMCoreThumb.prototype.constructCMP1 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rn] - immediate;\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ aluOut) >> 31);\n\t};\n}\n\nARMCoreThumb.prototype.constructCMP2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rd];\n\t\tvar m = gprs[rm];\n\t\tvar aluOut = d - m;\n\t\tvar an = aluOut >> 31;\n\t\tvar dn = d >> 31;\n\t\tcpu.cpsrN = an;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (d >>> 0) >= (m >>> 0);\n\t\tcpu.cpsrV = dn != (m >> 31) && dn != an;\n\t};\n};\n\nARMCoreThumb.prototype.constructCMP3 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rd] - gprs[rm];\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rd] >>> 0) >= (gprs[rm] >>> 0);\n\t\tcpu.cpsrV = ((gprs[rd] ^ gprs[rm]) >> 31) && ((gprs[rd] ^ aluOut) >> 31);\n\t};\n};\n\nARMCoreThumb.prototype.constructEOR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] ^ gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLDMIA = function(rn, rs) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar address = gprs[rn];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tgprs[i] = cpu.mmu.load32(address);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tif (!((1 << rn) & rs)) {\n\t\t\tgprs[rn] = address;\n\t\t}\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar n = gprs[rn] + immediate;\n\t\tgprs[rd] = cpu.mmu.load32(n);\n\t\tcpu.mmu.wait32(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait32(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t}\n};\n\nARMCoreThumb.prototype.constructLDR3 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32((gprs[cpu.PC] & 0xFFFFFFFC) + immediate);\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR4 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32(gprs[cpu.SP] + immediate);\n\t\tcpu.mmu.wait32(gprs[cpu.SP] + immediate);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU8(n);\n\t\tcpu.mmu.wait(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRB2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU8(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRH1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU16(n);\n\t\tcpu.mmu.wait(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRH2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU16(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRSB = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load8(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRSH = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load16(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLSL1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tgprs[rd] = gprs[rm];\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (32 - immediate));\n\t\t\tgprs[rd] = gprs[rm] << immediate;\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLSL2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (32 - rs));\n\t\t\t\tgprs[rd] <<= rs;\n\t\t\t} else {\n\t\t\t\tif (rs > 32) {\n\t\t\t\t\tcpu.cpsrC = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.cpsrC = gprs[rd] & 0x00000001;\n\t\t\t\t}\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLSR1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tcpu.cpsrC = gprs[rm] >> 31;\n\t\t\tgprs[rd] = 0;\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (immediate - 1));\n\t\t\tgprs[rd] = gprs[rm] >>> immediate;\n\t\t}\n\t\tcpu.cpsrN = 0;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n}\n\nARMCoreThumb.prototype.constructLSR2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (rs - 1));\n\t\t\t\tgprs[rd] >>>= rs;\n\t\t\t} else {\n\t\t\t\tif (rs > 32) {\n\t\t\t\t\tcpu.cpsrC = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t\t}\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV1 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rn] = immediate;\n\t\tcpu.cpsrN = immediate >> 31;\n\t\tcpu.cpsrZ = !(immediate & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = 0;\n\t\tcpu.cpsrV = 0;\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV3 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rm];\n\t};\n};\n\nARMCoreThumb.prototype.constructMUL = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tcpu.mmu.waitMul(gprs[rm]);\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rd] & 0xFFFF0000)) {\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\n\t\t\tvar hi = ((gprs[rd] & 0xFFFF0000) * gprs[rm]) & 0xFFFFFFFF;\n\t\t\tvar lo = ((gprs[rd] & 0x0000FFFF) * gprs[rm]) & 0xFFFFFFFF;\n\t\t\tgprs[rd] = (hi + lo) & 0xFFFFFFFF;\n\t\t} else {\n\t\t\tgprs[rd] *= gprs[rm];\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMVN = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = ~gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructNEG = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = -gprs[rm];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = 0 >= (d >>> 0);\n\t\tcpu.cpsrV = (gprs[rm] >> 31) && (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructORR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] | gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructPOP = function(rs, r) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\t++cpu.cycles;\n\t\tvar address = gprs[cpu.SP];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.waitSeq32(address);\n\t\t\t\tgprs[i] = cpu.mmu.load32(address);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tif (r) {\n\t\t\tgprs[cpu.PC] = cpu.mmu.load32(address) & 0xFFFFFFFE;\n\t\t\taddress += 4;\n\t\t\t++total;\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[cpu.SP] = address;\n\t};\n};\n\nARMCoreThumb.prototype.constructPUSH = function(rs, r) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar address = gprs[cpu.SP] - 4;\n\t\tvar total = 0;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (r) {\n\t\t\tcpu.mmu.store32(address, gprs[cpu.LR]);\n\t\t\taddress -= 4;\n\t\t\t++total;\n\t\t}\n\t\tvar m, i;\n\t\tfor (m = 0x80, i = 7; m; m >>= 1, --i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress -= 4;\n\t\t\t\t++total;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (m >>= 1, --i; m; m >>= 1, --i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress -= 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[cpu.SP] = address + 4;\n\t};\n};\n\nARMCoreThumb.prototype.constructROR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tvar r4 = rs & 0x1F;\n\t\t\tif (r4 > 0) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (r4 - 1));\n\t\t\t\tgprs[rd] = (gprs[rd] >>> r4) | (gprs[rd] << (32 - r4));\n\t\t\t} else {\n\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructSBC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar m = (gprs[rm] >>> 0) + !cpu.cpsrC;\n\t\tvar d = (gprs[rd] >>> 0) - m;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rd] >>> 0) >= (d >>> 0);\n\t\tcpu.cpsrV = ((gprs[rd] ^ m) >> 31) && ((gprs[rd] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSTMIA = function(rn, rs) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tvar address = gprs[rn];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (m <<= 1, ++i; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[rn] = address;\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store32(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store32(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(gprs[rn] + gprs[rm]);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR3 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store32(gprs[cpu.SP] + immediate, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(gprs[cpu.SP] + immediate);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store8(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRB2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store8(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t}\n};\n\nARMCoreThumb.prototype.constructSTRH1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store16(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRH2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store16(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t}\n};\n\nARMCoreThumb.prototype.constructSUB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n}\n\nARMCoreThumb.prototype.constructSUB2 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31);\n\t\tgprs[rn] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSUB3 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - gprs[rm];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (gprs[rm] >>> 0);\n\t\tcpu.cpsrV = (gprs[rn] >> 31) != (gprs[rm] >> 31) &&\n\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSWI = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.irq.swi(immediate);\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t}\n};\n\nARMCoreThumb.prototype.constructTST = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rd] & gprs[rm];\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t};\n};\n\nexport default ARMCoreThumb;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport ARMCoreArm from './arm';\nimport ARMCoreThumb from './thumb';\n\nfunction ARMCore() {\n\tthis.inherit();\n\tthis.SP = 13;\n\tthis.LR = 14;\n\tthis.PC = 15;\n\n\tthis.MODE_ARM = 0;\n\tthis.MODE_THUMB = 1;\n\n\tthis.MODE_USER = 0x10;\n\tthis.MODE_FIQ = 0x11;\n\tthis.MODE_IRQ = 0x12;\n\tthis.MODE_SUPERVISOR = 0x13;\n\tthis.MODE_ABORT = 0x17;\n\tthis.MODE_UNDEFINED = 0x1B;\n\tthis.MODE_SYSTEM = 0x1F;\n\n\tthis.BANK_NONE = 0\n\tthis.BANK_FIQ = 1;\n\tthis.BANK_IRQ = 2;\n\tthis.BANK_SUPERVISOR = 3;\n\tthis.BANK_ABORT = 4;\n\tthis.BANK_UNDEFINED = 5;\n\n\tthis.UNALLOC_MASK = 0x0FFFFF00;\n\tthis.USER_MASK = 0xF0000000;\n\tthis.PRIV_MASK = 0x000000CF; // This is out of spec, but it seems to be what's done in other implementations\n\tthis.STATE_MASK = 0x00000020;\n\n\tthis.WORD_SIZE_ARM = 4;\n\tthis.WORD_SIZE_THUMB = 2;\n\n\tthis.BASE_RESET = 0x00000000;\n\tthis.BASE_UNDEF = 0x00000004;\n\tthis.BASE_SWI = 0x00000008;\n\tthis.BASE_PABT = 0x0000000C;\n\tthis.BASE_DABT = 0x00000010;\n\tthis.BASE_IRQ = 0x00000018;\n\tthis.BASE_FIQ = 0x0000001C;\n\n\tthis.armCompiler = new ARMCoreArm(this);\n\tthis.thumbCompiler = new ARMCoreThumb(this);\n\tthis.generateConds();\n\n\tthis.gprs = new Int32Array(16);\n};\n\nARMCore.prototype.resetCPU = function(startOffset) {\n\tfor (var i = 0; i < this.PC; ++i) {\n\t\tthis.gprs[i] = 0;\n\t}\n\tthis.gprs[this.PC] = startOffset + this.WORD_SIZE_ARM;\n\n\tthis.loadInstruction = this.loadInstructionArm;\n\tthis.execMode = this.MODE_ARM;\n\tthis.instructionWidth = this.WORD_SIZE_ARM;\n\n\tthis.mode = this.MODE_SYSTEM;\n\n\tthis.cpsrI = false;\n\tthis.cpsrF = false;\n\n\tthis.cpsrV = false;\n\tthis.cpsrC = false;\n\tthis.cpsrZ = false;\n\tthis.cpsrN = false;\n\n\tthis.bankedRegisters = [\n\t\tnew Int32Array(7),\n\t\tnew Int32Array(7),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2)\n\t];\n\tthis.spsr = 0;\n\tthis.bankedSPSRs = new Int32Array(6);\n\n\tthis.cycles = 0;\n\n\tthis.shifterOperand = 0;\n\tthis.shifterCarryOut = 0;\n\n\tthis.page = null;\n\tthis.pageId = 0;\n\tthis.pageRegion = -1;\n\n\tthis.instruction = null;\n\n\tthis.irq.clear();\n\n\tvar gprs = this.gprs;\n\tvar mmu = this.mmu;\n\tthis.step = function() {\n\t\tvar instruction = this.instruction || (this.instruction = this.loadInstruction(gprs[this.PC] - this.instructionWidth));\n\t\tgprs[this.PC] += this.instructionWidth;\n\t\tthis.conditionPassed = true;\n\t\tinstruction();\n\n\t\tif (!instruction.writesPC) {\n\t\t\tif (this.instruction != null) { // We might have gotten an interrupt from the instruction\n\t\t\t\tif (instruction.next == null || instruction.next.page.invalid) {\n\t\t\t\t\tinstruction.next = this.loadInstruction(gprs[this.PC] - this.instructionWidth);\n\t\t\t\t}\n\t\t\t\tthis.instruction = instruction.next;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.conditionPassed) {\n\t\t\t\tvar pc = gprs[this.PC] &= 0xFFFFFFFE;\n\t\t\t\tif (this.execMode == this.MODE_ARM) {\n\t\t\t\t\tmmu.wait32(pc);\n\t\t\t\t\tmmu.waitPrefetch32(pc);\n\t\t\t\t} else {\n\t\t\t\t\tmmu.wait(pc);\n\t\t\t\t\tmmu.waitPrefetch(pc);\n\t\t\t\t}\n\t\t\t\tgprs[this.PC] += this.instructionWidth;\n\t\t\t\tif (!instruction.fixedJump) {\n\t\t\t\t\tthis.instruction = null;\n\t\t\t\t} else if  (this.instruction != null) {\n\t\t\t\t\tif (instruction.next == null || instruction.next.page.invalid) {\n\t\t\t\t\t\tinstruction.next = this.loadInstruction(gprs[this.PC] - this.instructionWidth);\n\t\t\t\t\t}\n\t\t\t\t\tthis.instruction = instruction.next;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.instruction = null;\n\t\t\t}\n\t\t}\n\t\tthis.irq.updateTimers();\n\t};\n};\n\nARMCore.prototype.freeze = function() {\n\treturn {\n\t\t'gprs': [\n\t\t\tthis.gprs[0],\n\t\t\tthis.gprs[1],\n\t\t\tthis.gprs[2],\n\t\t\tthis.gprs[3],\n\t\t\tthis.gprs[4],\n\t\t\tthis.gprs[5],\n\t\t\tthis.gprs[6],\n\t\t\tthis.gprs[7],\n\t\t\tthis.gprs[8],\n\t\t\tthis.gprs[9],\n\t\t\tthis.gprs[10],\n\t\t\tthis.gprs[11],\n\t\t\tthis.gprs[12],\n\t\t\tthis.gprs[13],\n\t\t\tthis.gprs[14],\n\t\t\tthis.gprs[15],\n\t\t],\n\t\t'mode': this.mode,\n\t\t'cpsrI': this.cpsrI,\n\t\t'cpsrF': this.cpsrF,\n\t\t'cpsrV': this.cpsrV,\n\t\t'cpsrC': this.cpsrC,\n\t\t'cpsrZ': this.cpsrZ,\n\t\t'cpsrN': this.cpsrN,\n\t\t'bankedRegisters': [\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[0][0],\n\t\t\t\tthis.bankedRegisters[0][1],\n\t\t\t\tthis.bankedRegisters[0][2],\n\t\t\t\tthis.bankedRegisters[0][3],\n\t\t\t\tthis.bankedRegisters[0][4],\n\t\t\t\tthis.bankedRegisters[0][5],\n\t\t\t\tthis.bankedRegisters[0][6]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[1][0],\n\t\t\t\tthis.bankedRegisters[1][1],\n\t\t\t\tthis.bankedRegisters[1][2],\n\t\t\t\tthis.bankedRegisters[1][3],\n\t\t\t\tthis.bankedRegisters[1][4],\n\t\t\t\tthis.bankedRegisters[1][5],\n\t\t\t\tthis.bankedRegisters[1][6]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[2][0],\n\t\t\t\tthis.bankedRegisters[2][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[3][0],\n\t\t\t\tthis.bankedRegisters[3][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[4][0],\n\t\t\t\tthis.bankedRegisters[4][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[5][0],\n\t\t\t\tthis.bankedRegisters[5][1]\n\t\t\t]\n\t\t],\n\t\t'spsr': this.spsr,\n\t\t'bankedSPSRs': [\n\t\t\tthis.bankedSPSRs[0],\n\t\t\tthis.bankedSPSRs[1],\n\t\t\tthis.bankedSPSRs[2],\n\t\t\tthis.bankedSPSRs[3],\n\t\t\tthis.bankedSPSRs[4],\n\t\t\tthis.bankedSPSRs[5]\n\t\t],\n\t\t'cycles': this.cycles\n\t};\n};\n\nARMCore.prototype.defrost = function(frost) {\n\tthis.instruction = null;\n\n\tthis.page = null;\n\tthis.pageId = 0;\n\tthis.pageRegion = -1;\n\n\tthis.gprs[0] = frost.gprs[0];\n\tthis.gprs[1] = frost.gprs[1];\n\tthis.gprs[2] = frost.gprs[2];\n\tthis.gprs[3] = frost.gprs[3];\n\tthis.gprs[4] = frost.gprs[4];\n\tthis.gprs[5] = frost.gprs[5];\n\tthis.gprs[6] = frost.gprs[6];\n\tthis.gprs[7] = frost.gprs[7];\n\tthis.gprs[8] = frost.gprs[8];\n\tthis.gprs[9] = frost.gprs[9];\n\tthis.gprs[10] = frost.gprs[10];\n\tthis.gprs[11] = frost.gprs[11];\n\tthis.gprs[12] = frost.gprs[12];\n\tthis.gprs[13] = frost.gprs[13];\n\tthis.gprs[14] = frost.gprs[14];\n\tthis.gprs[15] = frost.gprs[15];\n\n\tthis.mode = frost.mode;\n\tthis.cpsrI = frost.cpsrI;\n\tthis.cpsrF = frost.cpsrF;\n\tthis.cpsrV = frost.cpsrV;\n\tthis.cpsrC = frost.cpsrC;\n\tthis.cpsrZ = frost.cpsrZ;\n\tthis.cpsrN = frost.cpsrN;\n\n\tthis.bankedRegisters[0][0] = frost.bankedRegisters[0][0];\n\tthis.bankedRegisters[0][1] = frost.bankedRegisters[0][1];\n\tthis.bankedRegisters[0][2] = frost.bankedRegisters[0][2];\n\tthis.bankedRegisters[0][3] = frost.bankedRegisters[0][3];\n\tthis.bankedRegisters[0][4] = frost.bankedRegisters[0][4];\n\tthis.bankedRegisters[0][5] = frost.bankedRegisters[0][5];\n\tthis.bankedRegisters[0][6] = frost.bankedRegisters[0][6];\n\n\tthis.bankedRegisters[1][0] = frost.bankedRegisters[1][0];\n\tthis.bankedRegisters[1][1] = frost.bankedRegisters[1][1];\n\tthis.bankedRegisters[1][2] = frost.bankedRegisters[1][2];\n\tthis.bankedRegisters[1][3] = frost.bankedRegisters[1][3];\n\tthis.bankedRegisters[1][4] = frost.bankedRegisters[1][4];\n\tthis.bankedRegisters[1][5] = frost.bankedRegisters[1][5];\n\tthis.bankedRegisters[1][6] = frost.bankedRegisters[1][6];\n\n\tthis.bankedRegisters[2][0] = frost.bankedRegisters[2][0];\n\tthis.bankedRegisters[2][1] = frost.bankedRegisters[2][1];\n\n\tthis.bankedRegisters[3][0] = frost.bankedRegisters[3][0];\n\tthis.bankedRegisters[3][1] = frost.bankedRegisters[3][1];\n\n\tthis.bankedRegisters[4][0] = frost.bankedRegisters[4][0];\n\tthis.bankedRegisters[4][1] = frost.bankedRegisters[4][1];\n\n\tthis.bankedRegisters[5][0] = frost.bankedRegisters[5][0];\n\tthis.bankedRegisters[5][1] = frost.bankedRegisters[5][1];\n\n\tthis.spsr = frost.spsr;\n\tthis.bankedSPSRs[0] = frost.bankedSPSRs[0];\n\tthis.bankedSPSRs[1] = frost.bankedSPSRs[1];\n\tthis.bankedSPSRs[2] = frost.bankedSPSRs[2];\n\tthis.bankedSPSRs[3] = frost.bankedSPSRs[3];\n\tthis.bankedSPSRs[4] = frost.bankedSPSRs[4];\n\tthis.bankedSPSRs[5] = frost.bankedSPSRs[5];\n\n\tthis.cycles = frost.cycles;\n};\n\nARMCore.prototype.fetchPage = function(address) {\n\tvar region = address >> this.mmu.BASE_OFFSET;\n\tvar pageId = this.mmu.addressToPage(region, address & this.mmu.OFFSET_MASK);\n\tif (region == this.pageRegion) {\n\t\tif (pageId == this.pageId && !this.page.invalid) {\n\t\t\treturn;\n\t\t}\n\t\tthis.pageId = pageId;\n\t} else {\n\t\tthis.pageMask = this.mmu.memory[region].PAGE_MASK;\n\t\tthis.pageRegion = region;\n\t\tthis.pageId = pageId;\n\t}\n\n\tthis.page = this.mmu.accessPage(region, pageId);\n};\n\nARMCore.prototype.loadInstructionArm = function(address) {\n\tvar next = null;\n\tthis.fetchPage(address);\n\tvar offset = (address & this.pageMask) >> 2;\n\tnext = this.page.arm[offset];\n\tif (next) {\n\t\treturn next;\n\t}\n\tvar instruction = this.mmu.load32(address) >>> 0;\n\tnext = this.compileArm(instruction);\n\tnext.next = null;\n\tnext.page = this.page;\n\tnext.address = address;\n\tnext.opcode = instruction;\n\tthis.page.arm[offset] = next;\n\treturn next;\n};\n\nARMCore.prototype.loadInstructionThumb = function(address) {\n\tvar next = null;\n\tthis.fetchPage(address);\n\tvar offset = (address & this.pageMask) >> 1;\n\tnext = this.page.thumb[offset];\n\tif (next) {\n\t\treturn next;\n\t}\n\tvar instruction = this.mmu.load16(address);\n\tnext = this.compileThumb(instruction);\n\tnext.next = null;\n\tnext.page = this.page;\n\tnext.address = address;\n\tnext.opcode = instruction;\n\tthis.page.thumb[offset] = next;\n\treturn next;\n};\n\nARMCore.prototype.selectBank = function(mode) {\n\tswitch (mode) {\n\tcase this.MODE_USER:\n\tcase this.MODE_SYSTEM:\n\t\t// No banked registers\n\t\treturn this.BANK_NONE;\n\tcase this.MODE_FIQ:\n\t\treturn this.BANK_FIQ;\n\tcase this.MODE_IRQ:\n\t\treturn this.BANK_IRQ;\n\tcase this.MODE_SUPERVISOR:\n\t\treturn this.BANK_SUPERVISOR;\n\tcase this.MODE_ABORT:\n\t\treturn this.BANK_ABORT;\n\tcase this.MODE_UNDEFINED:\n\t\treturn this.BANK_UNDEFINED;\n\tdefault:\n\t\tthrow \"Invalid user mode passed to selectBank\";\n\t}\n};\n\nARMCore.prototype.switchExecMode = function(newMode) {\n\tif (this.execMode != newMode) {\n\t\tthis.execMode = newMode;\n\t\tif (newMode == this.MODE_ARM) {\n\t\t\tthis.instructionWidth = this.WORD_SIZE_ARM;\n\t\t\tthis.loadInstruction = this.loadInstructionArm;\n\t\t} else {\n\t\t\tthis.instructionWidth = this.WORD_SIZE_THUMB;\n\t\t\tthis.loadInstruction = this.loadInstructionThumb;\n\t\t}\n\t}\n\t\n};\n\nARMCore.prototype.switchMode = function(newMode) {\n\tif (newMode == this.mode) {\n\t\t// Not switching modes after all\n\t\treturn;\n\t}\n\tif (newMode != this.MODE_USER || newMode != this.MODE_SYSTEM) {\n\t\t// Switch banked registers\n\t\tvar newBank = this.selectBank(newMode);\n\t\tvar oldBank = this.selectBank(this.mode);\n\t\tif (newBank != oldBank) {\n\t\t\t// TODO: support FIQ\n\t\t\tif (newMode == this.MODE_FIQ || this.mode == this.MODE_FIQ) {\n\t\t\t\tvar oldFiqBank = (oldBank == this.BANK_FIQ) + 0;\n\t\t\t\tvar newFiqBank = (newBank == this.BANK_FIQ) + 0;\n\t\t\t\tthis.bankedRegisters[oldFiqBank][2] = this.gprs[8];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][3] = this.gprs[9];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][4] = this.gprs[10];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][5] = this.gprs[11];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][6] = this.gprs[12];\n\t\t\t\tthis.gprs[8] = this.bankedRegisters[newFiqBank][2];\n\t\t\t\tthis.gprs[9] = this.bankedRegisters[newFiqBank][3];\n\t\t\t\tthis.gprs[10] = this.bankedRegisters[newFiqBank][4];\n\t\t\t\tthis.gprs[11] = this.bankedRegisters[newFiqBank][5];\n\t\t\t\tthis.gprs[12] = this.bankedRegisters[newFiqBank][6];\n\t\t\t}\n\t\t\tthis.bankedRegisters[oldBank][0] = this.gprs[this.SP];\n\t\t\tthis.bankedRegisters[oldBank][1] = this.gprs[this.LR];\n\t\t\tthis.gprs[this.SP] = this.bankedRegisters[newBank][0];\n\t\t\tthis.gprs[this.LR] = this.bankedRegisters[newBank][1];\n\n\t\t\tthis.bankedSPSRs[oldBank] = this.spsr;\n\t\t\tthis.spsr = this.bankedSPSRs[newBank];\n\t\t}\n\t}\n\tthis.mode = newMode;\n};\n\nARMCore.prototype.packCPSR = function() {\n\treturn this.mode | (!!this.execMode << 5) | (!!this.cpsrF << 6) | (!!this.cpsrI << 7) |\n\t       (!!this.cpsrN << 31) | (!!this.cpsrZ << 30) | (!!this.cpsrC << 29) | (!!this.cpsrV << 28);\n};\n\nARMCore.prototype.unpackCPSR = function(spsr) {\n\tthis.switchMode(spsr & 0x0000001F);\n\tthis.switchExecMode(!!(spsr & 0x00000020));\n\tthis.cpsrF = spsr & 0x00000040;\n\tthis.cpsrI = spsr & 0x00000080;\n\tthis.cpsrN = spsr & 0x80000000;\n\tthis.cpsrZ = spsr & 0x40000000;\n\tthis.cpsrC = spsr & 0x20000000;\n\tthis.cpsrV = spsr & 0x10000000;\n\n\tthis.irq.testIRQ();\n};\n\nARMCore.prototype.hasSPSR = function() {\n\treturn this.mode != this.MODE_SYSTEM && this.mode != this.MODE_USER;\n};\n\nARMCore.prototype.raiseIRQ = function() {\n\tif (this.cpsrI) {\n\t\treturn;\n\t}\n\tvar cpsr = this.packCPSR();\n\tvar instructionWidth = this.instructionWidth;\n\tthis.switchMode(this.MODE_IRQ);\n\tthis.spsr = cpsr;\n\tthis.gprs[this.LR] = this.gprs[this.PC] - instructionWidth + 4;\n\tthis.gprs[this.PC] = this.BASE_IRQ + this.WORD_SIZE_ARM;\n\tthis.instruction = null;\n\tthis.switchExecMode(this.MODE_ARM);\n\tthis.cpsrI = true;\n};\n\nARMCore.prototype.raiseTrap = function() {\n\tvar cpsr = this.packCPSR();\n\tvar instructionWidth = this.instructionWidth;\n\tthis.switchMode(this.MODE_SUPERVISOR);\n\tthis.spsr = cpsr;\n\tthis.gprs[this.LR] = this.gprs[this.PC] - instructionWidth;\n\tthis.gprs[this.PC] = this.BASE_SWI + this.WORD_SIZE_ARM;\n\tthis.instruction = null;\n\tthis.switchExecMode(this.MODE_ARM);\n\tthis.cpsrI = true;\n};\n\nARMCore.prototype.badOp = function(instruction) {\n\tvar func = function() {\n\t\tthrow \"Illegal instruction: 0x\" + instruction.toString(16);\n\t};\n\tfunc.writesPC = true;\n\tfunc.fixedJump = false;\n\treturn func;\n};\n\nARMCore.prototype.generateConds = function() {\n\tvar cpu = this;\n\tthis.conds = [\n\t\t// EQ\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrZ;\n\t\t},\n\t\t// NE\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrZ;\n\t\t},\n\t\t// CS\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrC;\n\t\t},\n\t\t// CC\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrC;\n\t\t},\n\t\t// MI\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrN;\n\t\t},\n\t\t// PL\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN;\n\t\t},\n\t\t// VS\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrV;\n\t\t},\n\t\t// VC\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrV;\n\t\t},\n\t\t// HI\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrC && !cpu.cpsrZ;\n\t\t},\n\t\t// LS\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrC || cpu.cpsrZ;\n\t\t},\n\t\t// GE\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN == !cpu.cpsrV;\n\t\t},\n\t\t// LT\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN != !cpu.cpsrV;\n\t\t},\n\t\t// GT\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrZ && !cpu.cpsrN == !cpu.cpsrV;\n\t\t},\n\t\t// LE\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrZ || !cpu.cpsrN != !cpu.cpsrV;\n\t\t},\n\t\t// AL\n\t\tnull,\n\t\tnull\n\t]\n}\n\nARMCore.prototype.barrelShiftImmediate = function(shiftType, immediate, rm) {\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\tvar shiftOp = this.badOp;\n\tswitch (shiftType) {\n\tcase 0x00000000:\n\t\t// LSL\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] << immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (32 - immediate));\n\t\t\t};\n\t\t} else {\n\t\t\t// This boils down to no shift\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm];\n\t\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000020:\n\t\t// LSR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] >>> immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = 0;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & 0x80000000;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000040:\n\t\t// ASR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] >> immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & 0x80000000;\n\t\t\t\tif (cpu.shifterCarryOut) {\n\t\t\t\t\tcpu.shifterOperand = 0xFFFFFFFF;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.shifterOperand = 0;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000060:\n\t\t// ROR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = (gprs[rm] >>> immediate) | (gprs[rm] << (32 - immediate));\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\t// RRX\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = (!!cpu.cpsrC << 31) | (gprs[rm] >>> 1);\n\t\t\t\tcpu.shifterCarryOut =  gprs[rm] & 0x00000001;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\t}\n\treturn shiftOp;\n}\n\nARMCore.prototype.compileArm = function(instruction) {\n\tvar op = this.badOp(instruction);\n\tvar i = instruction & 0x0E000000;\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\n\tvar condOp = this.conds[(instruction & 0xF0000000) >>> 28];\n\tif ((instruction & 0x0FFFFFF0) == 0x012FFF10) {\n\t\t// BX\n\t\tvar rm = instruction & 0xF;\n\t\top = this.armCompiler.constructBX(rm, condOp);\n\t\top.writesPC = true;\n\t\top.fixedJump = false;\n\t} else if (!(instruction & 0x0C000000) && (i == 0x02000000 || (instruction & 0x00000090) != 0x00000090)) {\n\t\tvar opcode = instruction & 0x01E00000;\n\t\tvar s = instruction & 0x00100000;\n\t\tvar shiftsRs = false;\n\t\tif ((opcode & 0x01800000) == 0x01000000 && !s) {\n\t\t\tvar r = instruction & 0x00400000;\n\t\t\tif ((instruction & 0x00B0F000) == 0x0020F000) {\n\t\t\t\t// MSR\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tvar immediate = instruction & 0x000000FF;\n\t\t\t\tvar rotateImm = (instruction & 0x00000F00) >> 7;\n\t\t\t\timmediate = (immediate >>> rotateImm) | (immediate << (32 - rotateImm));\n\t\t\t\top = this.armCompiler.constructMSR(rm, r, instruction, immediate, condOp);\n\t\t\t\top.writesPC = false;\n\t\t\t} else if ((instruction & 0x00BF0000) == 0x000F0000) {\n\t\t\t\t// MRS\n\t\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\t\top = this.armCompiler.constructMRS(rd, r, condOp);\n\t\t\t\top.writesPC = rd == this.PC;\n\t\t\t}\n\t\t} else {\n\t\t\t// Data processing/FSR transfer\n\t\t\tvar rn = (instruction & 0x000F0000) >> 16;\n\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\n\t\t\t// Parse shifter operand\n\t\t\tvar shiftType = instruction & 0x00000060;\n\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\tvar shiftOp = function() {\n\t\t\t\tthrow 'BUG: invalid barrel shifter';\n\t\t\t};\n\t\t\tif (instruction & 0x02000000) {\n\t\t\t\tvar immediate = instruction & 0x000000FF;\n\t\t\t\tvar rotate = (instruction & 0x00000F00) >> 7;\n\t\t\t\tif (!rotate) {\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1Immediate(immediate);\n\t\t\t\t} else {\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ImmediateRotate(immediate, rotate);\n\t\t\t\t}\n\t\t\t} else if (instruction & 0x00000010) {\n\t\t\t\tvar rs = (instruction & 0x00000F00) >> 8;\n\t\t\t\tshiftsRs = true;\n\t\t\t\tswitch (shiftType) {\n\t\t\t\tcase 0x00000000:\n\t\t\t\t\t// LSL\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1LSL(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000020:\n\t\t\t\t\t// LSR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1LSR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000040:\n\t\t\t\t\t// ASR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ASR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000060:\n\t\t\t\t\t// ROR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ROR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar immediate = (instruction & 0x00000F80) >> 7;\n\t\t\t\tshiftOp = this.barrelShiftImmediate(shiftType, immediate, rm);\n\t\t\t}\n\n\t\t\tswitch (opcode) {\n\t\t\tcase 0x00000000:\n\t\t\t\t// AND\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructANDS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructAND(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00200000:\n\t\t\t\t// EOR\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructEORS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructEOR(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00400000:\n\t\t\t\t// SUB\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructSUBS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSUB(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00600000:\n\t\t\t\t// RSB\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructRSBS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructRSB(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00800000:\n\t\t\t\t// ADD\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructADDS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructADD(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00A00000:\n\t\t\t\t// ADC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructADCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructADC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00C00000:\n\t\t\t\t// SBC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructSBCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSBC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00E00000:\n\t\t\t\t// RSC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructRSCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructRSC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01000000:\n\t\t\t\t// TST\n\t\t\t\top = this.armCompiler.constructTST(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01200000:\n\t\t\t\t// TEQ\n\t\t\t\top = this.armCompiler.constructTEQ(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01400000:\n\t\t\t\t// CMP\n\t\t\t\top = this.armCompiler.constructCMP(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01600000:\n\t\t\t\t// CMN\n\t\t\t\top = this.armCompiler.constructCMN(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01800000:\n\t\t\t\t// ORR\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructORRS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructORR(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01A00000:\n\t\t\t\t// MOV\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructMOVS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructMOV(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01C00000:\n\t\t\t\t// BIC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructBICS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructBIC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01E00000:\n\t\t\t\t// MVN\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructMVNS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructMVN(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\top.writesPC = rd == this.PC;\n\t\t}\n\t} else if ((instruction & 0x0FB00FF0) == 0x01000090) {\n\t\t// Single data swap\n\t\tvar rm = instruction & 0x0000000F;\n\t\tvar rd = (instruction >> 12) & 0x0000000F;\n\t\tvar rn = (instruction >> 16) & 0x0000000F;\n\t\tif (instruction & 0x00400000) {\n\t\t\top = this.armCompiler.constructSWPB(rd, rn, rm, condOp);\n\t\t} else {\n\t\t\top = this.armCompiler.constructSWP(rd, rn, rm, condOp);\n\t\t}\n\t\top.writesPC = rd == this.PC;\n\t} else {\n\t\tswitch (i) {\n\t\tcase 0x00000000:\n\t\t\tif ((instruction & 0x010000F0) == 0x00000090) {\n\t\t\t\t// Multiplies\n\t\t\t\tvar rd = (instruction & 0x000F0000) >> 16;\n\t\t\t\tvar rn = (instruction & 0x0000F000) >> 12;\n\t\t\t\tvar rs = (instruction & 0x00000F00) >> 8;\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tswitch (instruction & 0x00F00000) {\n\t\t\t\tcase 0x00000000:\n\t\t\t\t\t// MUL\n\t\t\t\t\top = this.armCompiler.constructMUL(rd, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00100000:\n\t\t\t\t\t// MULS\n\t\t\t\t\top = this.armCompiler.constructMULS(rd, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00200000:\n\t\t\t\t\t// MLA\n\t\t\t\t\top = this.armCompiler.constructMLA(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x00300000:\n\t\t\t\t\t// MLAS\n\t\t\t\t\top = this.armCompiler.constructMLAS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00800000:\n\t\t\t\t\t// UMULL\n\t\t\t\t\top = this.armCompiler.constructUMULL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00900000:\n\t\t\t\t\t// UMULLS\n\t\t\t\t\top = this.armCompiler.constructUMULLS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00A00000:\n\t\t\t\t\t// UMLAL\n\t\t\t\t\top = this.armCompiler.constructUMLAL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00B00000:\n\t\t\t\t\t// UMLALS\n\t\t\t\t\top = this.armCompiler.constructUMLALS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00C00000:\n\t\t\t\t\t// SMULL\n\t\t\t\t\top = this.armCompiler.constructSMULL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00D00000:\n\t\t\t\t\t// SMULLS\n\t\t\t\t\top = this.armCompiler.constructSMULLS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00E00000:\n\t\t\t\t\t// SMLAL\n\t\t\t\t\top = this.armCompiler.constructSMLAL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00F00000:\n\t\t\t\t\t// SMLALS\n\t\t\t\t\top = this.armCompiler.constructSMLALS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\top.writesPC = rd == this.PC;\n\t\t\t} else {\n\t\t\t\t// Halfword and signed byte data transfer\n\t\t\t\tvar load = instruction & 0x00100000;\n\t\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\t\tvar hiOffset = (instruction & 0x00000F00) >> 4;\n\t\t\t\tvar loOffset = rm = instruction & 0x0000000F;\n\t\t\t\tvar h = instruction & 0x00000020;\n\t\t\t\tvar s = instruction & 0x00000040;\n\t\t\t\tvar w = instruction & 0x00200000;\n\t\t\t\tvar i = instruction & 0x00400000;\n\n\t\t\t\tvar address;\n\t\t\t\tif (i) {\n\t\t\t\t\tvar immediate = loOffset | hiOffset;\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Immediate(instruction, immediate, condOp);\n\t\t\t\t} else {\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Register(instruction, rm, condOp);\n\t\t\t\t}\n\t\t\t\taddress.writesPC = !!w && rn == this.PC;\n\n\t\t\t\tif ((instruction & 0x00000090) == 0x00000090) {\n\t\t\t\t\tif (load) {\n\t\t\t\t\t\t// Load [signed] halfword/byte\n\t\t\t\t\t\tif (h) {\n\t\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\t\t// LDRSH\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRSH(rd, address, condOp);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// LDRH\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRH(rd, address, condOp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\t\t// LDRSB\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRSB(rd, address, condOp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!s && h) {\n\t\t\t\t\t\t// STRH\n\t\t\t\t\t\top = this.armCompiler.constructSTRH(rd, address, condOp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\top.writesPC = rd == this.PC || address.writesPC;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x04000000:\n\t\tcase 0x06000000:\n\t\t\t// LDR/STR\n\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\tvar load = instruction & 0x00100000;\n\t\t\tvar b = instruction & 0x00400000;\n\t\t\tvar i = instruction & 0x02000000;\n\n\t\t\tvar address = function() {\n\t\t\t\tthrow \"Unimplemented memory access: 0x\" + instruction.toString(16);\n\t\t\t};\n\t\t\tif (~instruction & 0x01000000) {\n\t\t\t\t// Clear the W bit if the P bit is clear--we don't support memory translation, so these turn into regular accesses\n\t\t\t\tinstruction &= 0xFFDFFFFF;\n\t\t\t}\n\t\t\tif (i) {\n\t\t\t\t// Register offset\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tvar shiftType = instruction & 0x00000060;\n\t\t\t\tvar shiftImmediate = (instruction & 0x00000F80) >> 7;\n\t\t\t\t\n\t\t\t\tif (shiftType || shiftImmediate) {\n\t\t\t\t\tvar shiftOp = this.barrelShiftImmediate(shiftType, shiftImmediate, rm);\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode2RegisterShifted(instruction, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Register(instruction, rm, condOp);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Immediate\n\t\t\t\tvar offset = instruction & 0x00000FFF;\n\t\t\t\taddress = this.armCompiler.constructAddressingMode23Immediate(instruction, offset, condOp);\n\t\t\t}\n\t\t\tif (load) {\n\t\t\t\tif (b) {\n\t\t\t\t\t// LDRB\n\t\t\t\t\top = this.armCompiler.constructLDRB(rd, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\t// LDR\n\t\t\t\t\top = this.armCompiler.constructLDR(rd, address, condOp);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (b) {\n\t\t\t\t\t// STRB\n\t\t\t\t\top = this.armCompiler.constructSTRB(rd, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\t// STR\n\t\t\t\t\top = this.armCompiler.constructSTR(rd, address, condOp);\n\t\t\t\t}\n\t\t\t}\n\t\t\top.writesPC = rd == this.PC || address.writesPC;\n\t\t\tbreak;\n\t\tcase 0x08000000:\n\t\t\t// Block data transfer\n\t\t\tvar load = instruction & 0x00100000;\n\t\t\tvar w = instruction & 0x00200000;\n\t\t\tvar user = instruction & 0x00400000;\n\t\t\tvar u = instruction & 0x00800000;\n\t\t\tvar p = instruction & 0x01000000;\n\t\t\tvar rs = instruction & 0x0000FFFF;\n\t\t\tvar rn = (instruction & 0x000F0000) >> 16;\n\n\t\t\tvar address;\n\t\t\tvar immediate = 0;\n\t\t\tvar offset = 0;\n\t\t\tvar overlap = false;\n\t\t\tif (u) {\n\t\t\t\tif (p) {\n\t\t\t\t\timmediate = 4;\n\t\t\t\t}\n\t\t\t\tfor (var m = 0x01, i = 0; i < 16; m <<= 1, ++i) {\n\t\t\t\t\tif (rs & m) {\n\t\t\t\t\t\tif (w && i == rn && !offset) {\n\t\t\t\t\t\t\trs &= ~m;\n\t\t\t\t\t\t\timmediate += 4;\n\t\t\t\t\t\t\toverlap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\toffset += 4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!p) {\n\t\t\t\t\timmediate = 4;\n\t\t\t\t}\n\t\t\t\tfor (var m = 0x01, i = 0; i < 16; m <<= 1, ++i) {\n\t\t\t\t\tif (rs & m) {\n\t\t\t\t\t\tif (w && i == rn && !offset) {\n\t\t\t\t\t\t\trs &= ~m;\n\t\t\t\t\t\t\timmediate += 4;\n\t\t\t\t\t\t\toverlap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timmediate -= 4;\n\t\t\t\t\t\toffset -= 4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (w) {\n\t\t\t\taddress = this.armCompiler.constructAddressingMode4Writeback(immediate, offset, rn, overlap);\n\t\t\t} else {\n\t\t\t\taddress = this.armCompiler.constructAddressingMode4(immediate, rn);\n\t\t\t}\n\t\t\tif (load) {\n\t\t\t\t// LDM\n\t\t\t\tif (user) {\n\t\t\t\t\top = this.armCompiler.constructLDMS(rs, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructLDM(rs, address, condOp);\n\t\t\t\t}\n\t\t\t\top.writesPC = !!(rs & (1 << 15));\n\t\t\t} else {\n\t\t\t\t// STM\n\t\t\t\tif (user) {\n\t\t\t\t\top = this.armCompiler.constructSTMS(rs, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSTM(rs, address, condOp);\n\t\t\t\t}\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x0A000000:\n\t\t\t// Branch\n\t\t\tvar immediate = instruction & 0x00FFFFFF;\n\t\t\tif (immediate & 0x00800000) {\n\t\t\t\timmediate |= 0xFF000000;\n\t\t\t}\n\t\t\timmediate <<= 2;\n\t\t\tvar link = instruction & 0x01000000;\n\t\t\tif (link) {\n\t\t\t\top = this.armCompiler.constructBL(immediate, condOp);\n\t\t\t} else {\n\t\t\t\top = this.armCompiler.constructB(immediate, condOp);\n\t\t\t}\n\t\t\top.writesPC = true;\n\t\t\top.fixedJump = true;\n\t\t\tbreak;\n\t\tcase 0x0C000000:\n\t\t\t// Coprocessor data transfer\n\t\t\tbreak;\n\t\tcase 0x0E000000:\n\t\t\t// Coprocessor data operation/SWI\n\t\t\tif ((instruction & 0x0F000000) == 0x0F000000) {\n\t\t\t\t// SWI\n\t\t\t\tvar immediate = (instruction & 0x00FFFFFF);\n\t\t\t\top = this.armCompiler.constructSWI(immediate, condOp);\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow 'Bad opcode: 0x' + instruction.toString(16);\n\t\t}\n\t}\n\n\top.execMode = this.MODE_ARM;\n\top.fixedJump = op.fixedJump || false;\n\treturn op;\n};\n\nARMCore.prototype.compileThumb = function(instruction) {\n\tvar op = this.badOp(instruction & 0xFFFF);\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\tif ((instruction & 0xFC00) == 0x4000) {\n\t\t// Data-processing register\n\t\tvar rm = (instruction & 0x0038) >> 3;\n\t\tvar rd = instruction & 0x0007;\n\t\tswitch (instruction & 0x03C0) {\n\t\tcase 0x0000:\n\t\t\t// AND\n\t\t\top = this.thumbCompiler.constructAND(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0040:\n\t\t\t// EOR\n\t\t\top = this.thumbCompiler.constructEOR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0080:\n\t\t\t// LSL(2)\n\t\t\top = this.thumbCompiler.constructLSL2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x00C0:\n\t\t\t// LSR(2)\n\t\t\top = this.thumbCompiler.constructLSR2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0100:\n\t\t\t// ASR(2)\n\t\t\top = this.thumbCompiler.constructASR2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0140:\n\t\t\t// ADC\n\t\t\top = this.thumbCompiler.constructADC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0180:\n\t\t\t// SBC\n\t\t\top = this.thumbCompiler.constructSBC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x01C0:\n\t\t\t// ROR\n\t\t\top = this.thumbCompiler.constructROR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// TST\n\t\t\top = this.thumbCompiler.constructTST(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0240:\n\t\t\t// NEG\n\t\t\top = this.thumbCompiler.constructNEG(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0280:\n\t\t\t// CMP(2)\n\t\t\top = this.thumbCompiler.constructCMP2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x02C0:\n\t\t\t// CMN\n\t\t\top = this.thumbCompiler.constructCMN(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0300:\n\t\t\t// ORR\n\t\t\top = this.thumbCompiler.constructORR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0340:\n\t\t\t// MUL\n\t\t\top = this.thumbCompiler.constructMUL(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0380:\n\t\t\t// BIC\n\t\t\top = this.thumbCompiler.constructBIC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x03C0:\n\t\t\t// MVN\n\t\t\top = this.thumbCompiler.constructMVN(rd, rm);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xFC00) == 0x4400) {\n\t\t// Special data processing / branch/exchange instruction set\n\t\tvar rm = (instruction & 0x0078) >> 3;\n\t\tvar rn = instruction & 0x0007;\n\t\tvar h1 = instruction & 0x0080;\n\t\tvar rd = rn | (h1 >> 4);\n\t\tswitch (instruction & 0x0300) {\n\t\tcase 0x0000:\n\t\t\t// ADD(4)\n\t\t\top = this.thumbCompiler.constructADD4(rd, rm)\n\t\t\top.writesPC = rd == this.PC;\n\t\t\tbreak;\n\t\tcase 0x0100:\n\t\t\t// CMP(3)\n\t\t\top = this.thumbCompiler.constructCMP3(rd, rm);\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// MOV(3)\n\t\t\top = this.thumbCompiler.constructMOV3(rd, rm);\n\t\t\top.writesPC = rd == this.PC;\n\t\t\tbreak;\n\t\tcase 0x0300:\n\t\t\t// BX\n\t\t\top = this.thumbCompiler.constructBX(rd, rm);\n\t\t\top.writesPC = true;\n\t\t\top.fixedJump = false;\n\t\t\tbreak;\n\t\t}\n\t} else if ((instruction & 0xF800) == 0x1800) {\n\t\t// Add/subtract\n\t\tvar rm = (instruction & 0x01C0) >> 6;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar rd = instruction & 0x0007;\n\t\tswitch (instruction & 0x0600) {\n\t\tcase 0x0000:\n\t\t\t// ADD(3)\n\t\t\top = this.thumbCompiler.constructADD3(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// SUB(3)\n\t\t\top = this.thumbCompiler.constructSUB3(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0400:\n\t\t\tvar immediate = (instruction & 0x01C0) >> 6;\n\t\t\tif (immediate) {\n\t\t\t\t// ADD(1)\n\t\t\t\top = this.thumbCompiler.constructADD1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// MOV(2)\n\t\t\t\top = this.thumbCompiler.constructMOV2(rd, rn, rm);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x0600:\n\t\t\t// SUB(1)\n\t\t\tvar immediate = (instruction & 0x01C0) >> 6;\n\t\t\top = this.thumbCompiler.constructSUB1(rd, rn, immediate);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if (!(instruction & 0xE000)) {\n\t\t// Shift by immediate\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rm = (instruction & 0x0038) >> 3;\n\t\tvar immediate = (instruction & 0x07C0) >> 6;\n\t\tswitch (instruction & 0x1800) {\n\t\tcase 0x0000:\n\t\t\t// LSL(1)\n\t\t\top = this.thumbCompiler.constructLSL1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// LSR(1)\n\t\t\top = this.thumbCompiler.constructLSR1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// ASR(1)\n\t\t\top = this.thumbCompiler.constructASR1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x1800:\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xE000) == 0x2000) {\n\t\t// Add/subtract/compare/move immediate\n\t\tvar immediate = instruction & 0x00FF;\n\t\tvar rn = (instruction & 0x0700) >> 8;\n\t\tswitch (instruction & 0x1800) {\n\t\tcase 0x0000:\n\t\t\t// MOV(1)\n\t\t\top = this.thumbCompiler.constructMOV1(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// CMP(1)\n\t\t\top = this.thumbCompiler.constructCMP1(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// ADD(2)\n\t\t\top = this.thumbCompiler.constructADD2(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x1800:\n\t\t\t// SUB(2)\n\t\t\top = this.thumbCompiler.constructSUB2(rn, immediate);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF800) == 0x4800) {\n\t\t// LDR(3)\n\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\top = this.thumbCompiler.constructLDR3(rd, immediate);\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF000) == 0x5000) {\n\t\t// Load and store with relative offset\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar rm = (instruction & 0x01C0) >> 6;\n\t\tvar opcode = instruction & 0x0E00;\n\t\tswitch (opcode) {\n\t\tcase 0x0000:\n\t\t\t// STR(2)\n\t\t\top = this.thumbCompiler.constructSTR2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// STRH(2)\n\t\t\top = this.thumbCompiler.constructSTRH2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0400:\n\t\t\t// STRB(2)\n\t\t\top = this.thumbCompiler.constructSTRB2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0600:\n\t\t\t// LDRSB\n\t\t\top = this.thumbCompiler.constructLDRSB(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// LDR(2)\n\t\t\top = this.thumbCompiler.constructLDR2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0A00:\n\t\t\t// LDRH(2)\n\t\t\top = this.thumbCompiler.constructLDRH2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0C00:\n\t\t\t// LDRB(2)\n\t\t\top = this.thumbCompiler.constructLDRB2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0E00:\n\t\t\t// LDRSH\n\t\t\top = this.thumbCompiler.constructLDRSH(rd, rn, rm);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xE000) == 0x6000) {\n\t\t// Load and store with immediate offset\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar immediate = (instruction & 0x07C0) >> 4;\n\t\tvar b = instruction & 0x1000;\n\t\tif (b) {\n\t\t\timmediate >>= 2;\n\t\t}\n\t\tvar load = instruction & 0x0800;\n\t\tif (load) {\n\t\t\tif (b) {\n\t\t\t\t// LDRB(1)\n\t\t\t\top = this.thumbCompiler.constructLDRB1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// LDR(1)\n\t\t\t\top = this.thumbCompiler.constructLDR1(rd, rn, immediate);\n\t\t\t}\n\t\t} else {\n\t\t\tif (b) {\n\t\t\t\t// STRB(1)\n\t\t\t\top = this.thumbCompiler.constructSTRB1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// STR(1)\n\t\t\t\top = this.thumbCompiler.constructSTR1(rd, rn, immediate);\n\t\t\t}\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF600) == 0xB400) {\n\t\t// Push and pop registers\n\t\tvar r = !!(instruction & 0x0100);\n\t\tvar rs = instruction & 0x00FF;\n\t\tif (instruction & 0x0800) {\n\t\t\t// POP\n\t\t\top = this.thumbCompiler.constructPOP(rs, r);\n\t\t\top.writesPC = r;\n\t\t\top.fixedJump = false;\n\t\t} else {\n\t\t\t// PUSH\n\t\t\top = this.thumbCompiler.constructPUSH(rs, r);\n\t\t\top.writesPC = false;\n\t\t}\n\t} else if (instruction & 0x8000) {\n\t\tswitch (instruction & 0x7000) {\n\t\tcase 0x0000:\n\t\t\t// Load and store halfword\n\t\t\tvar rd = instruction & 0x0007;\n\t\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\t\tvar immediate = (instruction & 0x07C0) >> 5;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// LDRH(1)\n\t\t\t\top = this.thumbCompiler.constructLDRH1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// STRH(1)\n\t\t\t\top = this.thumbCompiler.constructSTRH1(rd, rn, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// SP-relative load and store\n\t\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\t\tvar load = instruction & 0x0800;\n\t\t\tif (load) {\n\t\t\t\t// LDR(4)\n\t\t\t\top = this.thumbCompiler.constructLDR4(rd, immediate);\n\t\t\t} else {\n\t\t\t\t// STR(3)\n\t\t\t\top = this.thumbCompiler.constructSTR3(rd, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x2000:\n\t\t\t// Load address\n\t\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// ADD(6)\n\t\t\t\top = this.thumbCompiler.constructADD6(rd, immediate);\n\t\t\t} else {\n\t\t\t\t// ADD(5)\n\t\t\t\top = this.thumbCompiler.constructADD5(rd, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x3000:\n\t\t\t// Miscellaneous\n\t\t\tif (!(instruction & 0x0F00)) {\n\t\t\t\t// Adjust stack pointer\n\t\t\t\t// ADD(7)/SUB(4)\n\t\t\t\tvar b = instruction & 0x0080;\n\t\t\t\tvar immediate = (instruction & 0x7F) << 2;\n\t\t\t\tif (b) {\n\t\t\t\t\timmediate = -immediate;\n\t\t\t\t}\n\t\t\t\top = this.thumbCompiler.constructADD7(immediate)\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x4000:\n\t\t\t// Multiple load and store\n\t\t\tvar rn = (instruction & 0x0700) >> 8;\n\t\t\tvar rs = instruction & 0x00FF;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// LDMIA\n\t\t\t\top = this.thumbCompiler.constructLDMIA(rn, rs);\n\t\t\t} else {\n\t\t\t\t// STMIA\n\t\t\t\top = this.thumbCompiler.constructSTMIA(rn, rs);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x5000:\n\t\t\t// Conditional branch\n\t\t\tvar cond = (instruction & 0x0F00) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF);\n\t\t\tif (cond == 0xF) {\n\t\t\t\t// SWI\n\t\t\t\top = this.thumbCompiler.constructSWI(immediate);\n\t\t\t\top.writesPC = false;\n\t\t\t} else {\n\t\t\t\t// B(1)\n\t\t\t\tif (instruction & 0x0080) {\n\t\t\t\t\timmediate |= 0xFFFFFF00;\n\t\t\t\t}\n\t\t\t\timmediate <<= 1;\n\t\t\t\tvar condOp = this.conds[cond];\n\t\t\t\top = this.thumbCompiler.constructB1(immediate, condOp);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = true;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x6000:\n\t\tcase 0x7000:\n\t\t\t// BL(X)\n\t\t\tvar immediate = instruction & 0x07FF;\n\t\t\tvar h = instruction & 0x1800;\n\t\t\tswitch (h) {\n\t\t\tcase 0x0000:\n\t\t\t\t// B(2)\n\t\t\t\tif (immediate & 0x0400) {\n\t\t\t\t\timmediate |= 0xFFFFF800;\n\t\t\t\t}\n\t\t\t\timmediate <<= 1;\n\t\t\t\top = this.thumbCompiler.constructB2(immediate);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = true;\n\t\t\t\tbreak;\n\t\t\tcase 0x0800:\n\t\t\t\t// BLX (ARMv5T)\n\t\t\t\t/*op = function() {\n\t\t\t\t\tvar pc = gprs[cpu.PC];\n\t\t\t\t\tgprs[cpu.PC] = (gprs[cpu.LR] + (immediate << 1)) & 0xFFFFFFFC;\n\t\t\t\t\tgprs[cpu.LR] = pc - 1;\n\t\t\t\t\tcpu.switchExecMode(cpu.MODE_ARM);\n\t\t\t\t}*/\n\t\t\t\tbreak;\n\t\t\tcase 0x1000:\n\t\t\t\t// BL(1)\n\t\t\t\tif (immediate & 0x0400) {\n\t\t\t\t\timmediate |= 0xFFFFFC00;\n\t\t\t\t}\n\t\t\t\timmediate <<= 12;\n\t\t\t\top = this.thumbCompiler.constructBL1(immediate);\n\t\t\t\top.writesPC = false;\n\t\t\t\tbreak;\n\t\t\tcase 0x1800:\n\t\t\t\t// BL(2)\n\t\t\t\top = this.thumbCompiler.constructBL2(immediate);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthis.WARN(\"Undefined instruction: 0x\" + instruction.toString(16));\n\t\t}\n\t} else {\n\t\tthrow 'Bad opcode: 0x' + instruction.toString(16);\n\t}\n\n\top.execMode = this.MODE_THUMB;\n\top.fixedJump = op.fixedJump || false;\n\treturn op;\n};\n\nexport default ARMCore;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nexport function hex(number, leading, usePrefix) {\n\tif (typeof(usePrefix) === 'undefined') {\n\t\tusePrefix = true;\n\t}\n\tif (typeof(leading) === 'undefined') {\n\t\tleading = 8;\n\t}\n\tvar string = (number >>> 0).toString(16).toUpperCase();\n\tleading -= string.length;\n\tif (leading < 0)\n\t\treturn string;\n\treturn (usePrefix ? '0x' : '') + new Array(leading + 1).join('0') + string;\n}\n\nconst Serializer = {\n\tTAG_INT: 1,\n\tTAG_STRING: 2,\n\tTAG_STRUCT: 3,\n\tTAG_BLOB: 4,\n\tTAG_BOOLEAN: 5,\n\tTYPE: 'application/octet-stream',\n\n\tpointer: function() {\n\t\tthis.index = 0;\n\t\tthis.top = 0;\n\t\tthis.stack = [];\n\t},\n\n\tpack: function(value) {\n\t\tvar object = new DataView(new ArrayBuffer(4));\n\t\tobject.setUint32(0, value, true);\n\t\treturn object.buffer;\n\t},\n\n\tpack8: function(value) {\n\t\tvar object = new DataView(new ArrayBuffer(1));\n\t\tobject.setUint8(0, value, true);\n\t\treturn object.buffer;\n\t},\n\n\tprefix: function(value) {\n\t\treturn new Blob([Serializer.pack(value.size || value.length || value.byteLength), value], { type: Serializer.TYPE });\n\t},\n\n\tserialize: function(stream) {\n\t\tvar parts = [];\n\t\tvar size = 4;\n\t\tfor (let i in stream) {\n\t\t\tif (stream.hasOwnProperty(i)) {\n\t\t\t\tvar tag;\n\t\t\t\tvar head = Serializer.prefix(i);\n\t\t\t\tvar body;\n\t\t\t\tswitch (typeof(stream[i])) {\n\t\t\t\tcase 'number':\n\t\t\t\t\ttag = Serializer.TAG_INT;\n\t\t\t\t\tbody = Serializer.pack(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'string':\n\t\t\t\t\ttag = Serializer.TAG_STRING;\n\t\t\t\t\tbody = Serializer.prefix(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (stream[i].type == Serializer.TYPE) {\n\t\t\t\t\t\ttag = Serializer.TAG_BLOB;\n\t\t\t\t\t\tbody = stream[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttag = Serializer.TAG_STRUCT;\n\t\t\t\t\t\tbody = Serializer.serialize(stream[i]);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\ttag = Serializer.TAG_BOOLEAN;\n\t\t\t\t\tbody = Serializer.pack8(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsize += 1 + head.size + (body.size || body.byteLength || body.length);\n\t\t\t\tparts.push(Serializer.pack8(tag));\n\t\t\t\tparts.push(head);\n\t\t\t\tparts.push(body);\n\t\t\t}\n\t\t}\n\t\tparts.unshift(Serializer.pack(size));\n\t\treturn new Blob(parts);\n\t},\n\n\tdeserialize: function(blob, callback) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tcallback(Serializer.deserealizeStream(new DataView(data.target.result), new Serializer.pointer));\n\t\t}\n\t\treader.readAsArrayBuffer(blob);\n\t},\n\n\tdeserealizeStream: function(view, pointer) {\n\t\tpointer.push();\n\t\tvar object = {};\n\t\tvar remaining = view.getUint32(pointer.advance(4), true);\n\t\twhile (pointer.mark() < remaining) {\n\t\t\tvar tag = view.getUint8(pointer.advance(1));\n\t\t\tvar head = pointer.readString(view);\n\t\t\tvar body;\n\t\t\tswitch (tag) {\n\t\t\tcase Serializer.TAG_INT:\n\t\t\t\tbody = view.getUint32(pointer.advance(4), true);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_STRING:\n\t\t\t\tbody = pointer.readString(view);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_STRUCT:\n\t\t\t\tbody = Serializer.deserealizeStream(view, pointer);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_BLOB:\n\t\t\t\tvar size = view.getUint32(pointer.advance(4), true);\n\t\t\t\tbody = view.buffer.slice(pointer.advance(size), pointer.advance(0));\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_BOOLEAN:\n\t\t\t\tbody = !!view.getUint8(pointer.advance(1));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tobject[head] = body;\n\t\t}\n\t\tif (pointer.mark() > remaining) {\n\t\t\tthrow \"Size of serialized data exceeded\";\n\t\t}\n\t\tpointer.pop();\n\t\treturn object;\n\t},\n\n\tserializePNG: function(blob, base, callback) {\n\t\tvar canvas = document.createElement('canvas');\n\t\tvar context = canvas.getContext('2d');\n\t\tvar pixels = base.getContext('2d').getImageData(0, 0, base.width, base.height);\n\t\tvar transparent = 0;\n\t\tfor (var y = 0; y < base.height; ++y) {\n\t\t\tfor (var x = 0; x < base.width; ++x) {\n\t\t\t\tif (!pixels.data[(x + y * base.width) * 4 + 3]) {\n\t\t\t\t\t++transparent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar bytesInCanvas = transparent * 3 + (base.width * base.height - transparent);\n\t\tfor (var multiplier = 1; (bytesInCanvas * multiplier * multiplier) < blob.size; ++multiplier);\n\t\tvar edges = bytesInCanvas * multiplier * multiplier - blob.size;\n\t\tvar padding = Math.ceil(edges / (base.width * multiplier));\n\t\tcanvas.setAttribute('width', base.width * multiplier);\n\t\tcanvas.setAttribute('height', base.height * multiplier + padding);\n\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tvar view = new Uint8Array(data.target.result);\n\t\t\tvar pointer = 0;\n\t\t\tvar pixelPointer = 0;\n\t\t\tvar newPixels = context.createImageData(canvas.width, canvas.height + padding);\n\t\t\tfor (var y = 0; y < canvas.height; ++y) {\n\t\t\t\tfor (var x = 0; x < canvas.width; ++x) {\n\t\t\t\t\tvar oldY = (y / multiplier) | 0;\n\t\t\t\t\tvar oldX = (x / multiplier) | 0;\n\t\t\t\t\tif (oldY > base.height || !pixels.data[(oldX + oldY * base.width) * 4 + 3]) {\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar byte = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 0] | (byte & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 1] | ((byte >> 3) & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 2] | ((byte >> 6) & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 3];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcontext.putImageData(newPixels, 0, 0);\n\t\t\tcallback(canvas.toDataURL('image/png'));\n\t\t}\n\t\treader.readAsArrayBuffer(blob);\n\t\treturn canvas;\n\t},\n\n\tdeserializePNG: function(blob, callback) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tvar image = document.createElement('img');\n\t\t\timage.setAttribute('src', data.target.result);\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tcanvas.setAttribute('height', image.height);\n\t\t\tcanvas.setAttribute('width', image.width);\n\t\t\tvar context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(image, 0, 0);\n\t\t\tvar pixels = context.getImageData(0, 0, canvas.width, canvas.height);\n\t\t\tvar data = [];\n\t\t\tfor (var y = 0; y < canvas.height; ++y) {\n\t\t\t\tfor (var x = 0; x < canvas.width; ++x) {\n\t\t\t\t\tif (!pixels.data[(x + y * canvas.width) * 4 + 3]) {\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 0]);\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 1]);\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 2]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar byte = 0;\n\t\t\t\t\t\tbyte |= pixels.data[(x + y * canvas.width) * 4 + 0] & 7;\n\t\t\t\t\t\tbyte |= (pixels.data[(x + y * canvas.width) * 4 + 1] & 7) << 3;\n\t\t\t\t\t\tbyte |= (pixels.data[(x + y * canvas.width) * 4 + 2] & 7) << 6;\n\t\t\t\t\t\tdata.push(byte);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst newBlob = new Blob(data.map(function (byte) {\n\t\t\t\tvar array = new Uint8Array(1);\n\t\t\t\tarray[0] = byte;\n\t\t\t\treturn array;\n\t\t\t}), { type: Serializer.TYPE});\n\t\t\tSerializer.deserialize(newBlob, callback);\n\t\t}\n\t\treader.readAsDataURL(blob);\n\t}\n};\n\nSerializer.pointer.prototype.advance = function(amount) {\n\tvar index = this.index;\n\tthis.index += amount;\n\treturn index;\n};\n\nSerializer.pointer.prototype.mark = function() {\n\treturn this.index - this.top;\n};\n\nSerializer.pointer.prototype.push = function() {\n\tthis.stack.push(this.top);\n\tthis.top = this.index;\n};\n\nSerializer.pointer.prototype.pop = function() {\n\tthis.top = this.stack.pop();\n};\n\nSerializer.pointer.prototype.readString = function(view) {\n\tvar length = view.getUint32(this.advance(4), true);\n\tvar bytes = [];\n\tfor (var i = 0; i < length; ++i) {\n\t\tbytes.push(String.fromCharCode(view.getUint8(this.advance(1))));\n\t}\n\treturn bytes.join('');\n};\n\nexport default Serializer;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { MemoryView } from './mmu';\n\nfunction SRAMSavedata(size) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.writePending = false;\n};\n\nSRAMSavedata.prototype = Object.create(MemoryView.prototype);\n\nSRAMSavedata.prototype.store8 = function(offset, value) {\n\tthis.view.setInt8(offset, value);\n\tthis.writePending = true;\n};\n\nSRAMSavedata.prototype.store16 = function(offset, value) {\n\tthis.view.setInt16(offset, value, true);\n\tthis.writePending = true;\n};\n\nSRAMSavedata.prototype.store32 = function(offset, value) {\n\tthis.view.setInt32(offset, value, true);\n\tthis.writePending = true;\n};\n\nfunction FlashSavedata(size) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.COMMAND_WIPE = 0x10;\n\tthis.COMMAND_ERASE_SECTOR = 0x30;\n\tthis.COMMAND_ERASE = 0x80;\n\tthis.COMMAND_ID = 0x90;\n\tthis.COMMAND_WRITE = 0xA0;\n\tthis.COMMAND_SWITCH_BANK = 0xB0;\n\tthis.COMMAND_TERMINATE_ID = 0xF0;\n\n\tthis.ID_PANASONIC = 0x1B32;\n\tthis.ID_SANYO = 0x1362;\n\n\tthis.bank0 = new DataView(this.buffer, 0, 0x00010000);\n\tif (size > 0x00010000) {\n\t\tthis.id = this.ID_SANYO;\n\t\tthis.bank1 = new DataView(this.buffer, 0x00010000);\n\t} else {\n\t\tthis.id = this.ID_PANASONIC;\n\t\tthis.bank1 = null;\n\t}\n\tthis.bank = this.bank0;\n\n\tthis.idMode = false;\n\tthis.writePending = false;\n\n\tthis.first = 0;\n\tthis.second = 0;\n\tthis.command = 0;\n\tthis.pendingCommand = 0;\n};\n\nFlashSavedata.prototype = Object.create(MemoryView.prototype);\n\nFlashSavedata.prototype.load8 = function(offset) {\n\tif (this.idMode && offset < 2) {\n\t\treturn (this.id >> (offset << 3)) & 0xFF;\n\t} else if (offset < 0x10000) {\n\t\treturn this.bank.getInt8(offset);\n\t} else {\n\t\treturn 0;\n\t}\n};\n\nFlashSavedata.prototype.load16 = function(offset) {\n\treturn (this.load8(offset) & 0xFF) | (this.load8(offset + 1) << 8);\n};\n\nFlashSavedata.prototype.load32 = function(offset) {\n\treturn (this.load8(offset) & 0xFF) | (this.load8(offset + 1) << 8) | (this.load8(offset + 2) << 16) | (this.load8(offset + 3) << 24);\n};\n\nFlashSavedata.prototype.loadU8 = function(offset) {\n\treturn this.load8(offset) & 0xFF;\n};\n\nFlashSavedata.prototype.loadU16 = function(offset) {\n\treturn (this.loadU8(offset) & 0xFF) | (this.loadU8(offset + 1) << 8);\n};\n\nFlashSavedata.prototype.store8 = function(offset, value) {\n\tswitch (this.command) {\n\tcase 0:\n\t\tif (offset == 0x5555) {\n\t\t\tif (this.second == 0x55) {\n\t\t\t\tswitch (value) {\n\t\t\t\tcase this.COMMAND_ERASE:\n\t\t\t\t\tthis.pendingCommand = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.COMMAND_ID:\n\t\t\t\t\tthis.idMode = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.COMMAND_TERMINATE_ID:\n\t\t\t\t\tthis.idMode = false;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.command = value;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.second = 0;\n\t\t\t\tthis.first = 0;\n\t\t\t} else {\n\t\t\t\tthis.command = 0;\n\t\t\t\tthis.first = value;\n\t\t\t\tthis.idMode = false;\n\t\t\t}\n\t\t} else if (offset == 0x2AAA && this.first == 0xAA) {\n\t\t\tthis.first = 0;\n\t\t\tif (this.pendingCommand) {\n\t\t\t\tthis.command = this.pendingCommand;\n\t\t\t} else {\n\t\t\t\tthis.second = value;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase this.COMMAND_ERASE:\n\t\tswitch (value) {\n\t\tcase this.COMMAND_WIPE:\n\t\t\tif (offset == 0x5555) {\n\t\t\t\tfor (var i = 0; i < this.view.byteLength; i += 4) {\n\t\t\t\t\tthis.view.setInt32(i, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase this.COMMAND_ERASE_SECTOR:\n\t\t\tif ((offset & 0x0FFF) == 0) {\n\t\t\t\tfor (var i = offset; i < offset + 0x1000; i += 4) {\n\t\t\t\t\tthis.bank.setInt32(i, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tthis.pendingCommand = 0;\n\t\tthis.command = 0;\n\t\tbreak;\n\tcase this.COMMAND_WRITE:\n\t\tthis.bank.setInt8(offset, value);\n\t\tthis.command = 0;\n\n\t\tthis.writePending = true;\n\t\tbreak;\n\tcase this.COMMAND_SWITCH_BANK:\n\t\tif (this.bank1 && offset == 0) {\n\t\t\tif (value == 1) {\n\t\t\t\tthis.bank = this.bank1;\n\t\t\t} else {\n\t\t\t\tthis.bank = this.bank0;\n\t\t\t}\n\t\t}\n\t\tthis.command = 0;\n\t\tbreak;\n\t}\n};\n\nFlashSavedata.prototype.store16 = function(offset, value) {\n\tthrow new Error(\"Unaligned save to flash!\");\n};\n\nFlashSavedata.prototype.store32 = function(offset, value) {\n\tthrow new Error(\"Unaligned save to flash!\");\n};\n\nFlashSavedata.prototype.replaceData = function(memory) {\n\tvar bank = this.view === this.bank1;\n\tMemoryView.prototype.replaceData.call(this, memory, 0);\n\n\tthis.bank0 = new DataView(this.buffer, 0, 0x00010000);\n\tif (memory.byteLength > 0x00010000) {\n\t\tthis.bank1 = new DataView(this.buffer, 0x00010000);\n\t} else {\n\t\tthis.bank1 = null;\n\t}\n\tthis.bank = bank ? this.bank1 : this.bank0;\n};\n\nfunction EEPROMSavedata(size, mmu) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.writeAddress = 0;\n\tthis.readBitsRemaining = 0;\n\tthis.readAddress = 0;\n\n\tthis.command = 0;\n\tthis.commandBitsRemaining = 0;\n\n\tthis.realSize = 0;\n\tthis.addressBits = 0;\n\tthis.writePending = false;\n\n\tthis.dma = mmu.core.irq.dma[3];\n\n\tthis.COMMAND_NULL = 0;\n\tthis.COMMAND_PENDING = 1;\n\tthis.COMMAND_WRITE = 2;\n\tthis.COMMAND_READ_PENDING = 3;\n\tthis.COMMAND_READ = 4;\n};\n\nEEPROMSavedata.prototype = Object.create(MemoryView.prototype);\n\nEEPROMSavedata.prototype.load8 = function(offset) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.load16 = function(offset) {\n\treturn this.loadU16(offset);\n};\n\nEEPROMSavedata.prototype.loadU8 = function(offset) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.loadU16 = function(offset) {\n\tif (this.command != this.COMMAND_READ || !this.dma.enable) {\n\t\treturn 1;\n\t}\n\t--this.readBitsRemaining;\n\tif (this.readBitsRemaining < 64) {\n\t\tvar step = 63 - this.readBitsRemaining;\n\t\tvar data = this.view.getUint8((this.readAddress + step) >> 3, false) >> (0x7 - (step & 0x7));\n\t\tif (!this.readBitsRemaining) {\n\t\t\tthis.command = this.COMMAND_NULL;\n\t\t}\n\t\treturn data & 0x1;\n\t}\n\treturn 0;\n};\n\nEEPROMSavedata.prototype.load32 = function(offset) {\n\tthrow new Error(\"Unsupported 32-bit access!\");\n};\n\nEEPROMSavedata.prototype.store8 = function(offset, value) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.store16 = function(offset, value) {\n\tswitch (this.command) {\n\t// Read header\n\tcase this.COMMAND_NULL:\n\tdefault:\n\t\tthis.command = value & 0x1;\n\t\tbreak;\n\tcase this.COMMAND_PENDING:\n\t\tthis.command <<= 1;\n\t\tthis.command |= value & 0x1;\n\t\tif (this.command == this.COMMAND_WRITE) {\n\t\t\tif (!this.realSize) {\n\t\t\t\tvar bits = this.dma.count - 67;\n\t\t\t\tthis.realSize = 8 << bits;\n\t\t\t\tthis.addressBits = bits;\n\t\t\t}\n\t\t\tthis.commandBitsRemaining = this.addressBits + 64 + 1;\n\t\t\tthis.writeAddress = 0;\n\t\t} else {\n\t\t\tif (!this.realSize) {\n\t\t\t\tvar bits = this.dma.count - 3;\n\t\t\t\tthis.realSize = 8 << bits;\n\t\t\t\tthis.addressBits = bits;\n\t\t\t}\n\t\t\tthis.commandBitsRemaining = this.addressBits + 1;\n\t\t\tthis.readAddress = 0;\n\t\t}\n\t\tbreak;\n\t// Do commands\n\tcase this.COMMAND_WRITE:\n\t\t// Write\n\t\tif (--this.commandBitsRemaining > 64) {\n\t\t\tthis.writeAddress <<= 1;\n\t\t\tthis.writeAddress |= (value & 0x1) << 6;\n\t\t} else if (this.commandBitsRemaining <= 0) {\n\t\t\tthis.command = this.COMMAND_NULL;\n\t\t\tthis.writePending = true;\n\t\t} else {\n\t\t\tvar current = this.view.getUint8(this.writeAddress >> 3);\n\t\t\tcurrent &= ~(1 << (0x7 - (this.writeAddress & 0x7)));\n\t\t\tcurrent |= (value & 0x1) << (0x7 - (this.writeAddress & 0x7));\n\t\t\tthis.view.setUint8(this.writeAddress >> 3, current);\n\t\t\t++this.writeAddress;\n\t\t}\n\t\tbreak;\n\tcase this.COMMAND_READ_PENDING:\n\t\t// Read\n\t\tif (--this.commandBitsRemaining > 0) {\n\t\t\tthis.readAddress <<= 1;\n\t\t\tif (value & 0x1) {\n\t\t\t\tthis.readAddress |= 0x40;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.readBitsRemaining = 68;\n\t\t\tthis.command = this.COMMAND_READ;\n\t\t}\n\t\tbreak;\n\t}\n};\n\nEEPROMSavedata.prototype.store32 = function(offset, value) {\n\tthrow new Error(\"Unsupported 32-bit access!\");\n};\n\nEEPROMSavedata.prototype.replaceData = function(memory) {\n\tMemoryView.prototype.replaceData.call(this, memory, 0);\n};\n\nexport {\n\tEEPROMSavedata,\n\tFlashSavedata,\n\tSRAMSavedata,\n};\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nfunction GameBoyAdvanceGPIO(core, rom) {\r\n\tthis.core = core;\r\n\tthis.rom = rom;\r\n\r\n\tthis.readWrite = 0;\r\n\tthis.direction = 0;\r\n\r\n\tthis.device = new GameBoyAdvanceRTC(this); // TODO: Support more devices\r\n};\r\n\r\nGameBoyAdvanceGPIO.prototype.store16 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase 0xC4:\r\n\t\tthis.device.setPins(value & 0xF);\r\n\t\tbreak;\r\n\tcase 0xC6:\r\n\t\tthis.direction = value & 0xF;\r\n\t\tthis.device.setDirection(this.direction);\r\n\t\tbreak;\r\n\tcase 0xC8:\r\n\t\tthis.readWrite = value & 1;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthrow new Error('BUG: Bad offset passed to GPIO: ' + offset.toString(16));\r\n\t}\r\n\tif (this.readWrite) {\r\n\t\tvar old = this.rom.view.getUint16(offset, true);\r\n\t\told &= ~this.direction;\r\n\t\tthis.rom.view.setUint16(offset, old | (value & this.direction), true);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceGPIO.prototype.outputPins = function(nybble) {\r\n\tif (this.readWrite) {\r\n\t\tvar old = this.rom.view.getUint16(0xC4, true);\r\n\t\told &= this.direction;\r\n\t\tthis.rom.view.setUint16(0xC4, old | (nybble & ~this.direction & 0xF), true);\r\n\t}\r\n};\r\n\r\nfunction GameBoyAdvanceRTC(gpio) {\r\n\tthis.gpio = gpio;\r\n\r\n\t// PINOUT: SCK | SIO | CS | -\r\n\tthis.pins = 0;\r\n\tthis.direction = 0;\r\n\r\n\tthis.totalBytes = [\r\n\t\t0, // Force reset\r\n\t\t0, // Empty\r\n\t\t7, // Date/Time\r\n\t\t0, // Force IRQ\r\n\t\t1, // Control register\r\n\t\t0, // Empty\r\n\t\t3, // Time\r\n\t\t0 // Empty\r\n\t];\r\n\tthis.bytesRemaining = 0;\r\n\r\n\t// Transfer sequence:\r\n\t// == Initiate\r\n\t// > HI | - | LO | -\r\n\t// > HI | - | HI | -\r\n\t// == Transfer bit (x8)\r\n\t// > LO | x | HI | -\r\n\t// > HI | - | HI | -\r\n\t// < ?? | x | ?? | -\r\n\t// == Terminate\r\n\t// >  - | - | LO | -\r\n\tthis.transferStep = 0;\r\n\r\n\tthis.reading = 0;\r\n\tthis.bitsRead = 0;\r\n\tthis.bits = 0;\r\n\tthis.command = -1;\r\n\r\n\tthis.control = 0x40;\r\n\tthis.time = [\r\n\t\t0, // Year\r\n\t\t0, // Month\r\n\t\t0, // Day\r\n\t\t0, // Day of week\r\n\t\t0, // Hour\r\n\t\t0, // Minute\r\n\t\t0 // Second\r\n\t];\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.setPins = function(nybble) {\r\n\tswitch (this.transferStep) {\r\n\tcase 0:\r\n\t\tif ((nybble & 5) == 1) {\r\n\t\t\tthis.transferStep = 1;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tif (nybble & 4) {\r\n\t\t\tthis.transferStep = 2;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tif (!(nybble & 1)) {\r\n\t\t\tthis.bits &= ~(1 << this.bitsRead);\r\n\t\t\tthis.bits |= ((nybble & 2) >> 1) << this.bitsRead;\r\n\t\t} else {\r\n\t\t\tif (nybble & 4) {\r\n\t\t\t\t// SIO direction should always != this.read\r\n\t\t\t\tif ((this.direction & 2) && !this.read) {\r\n\t\t\t\t\t++this.bitsRead;\r\n\t\t\t\t\tif (this.bitsRead == 8) {\r\n\t\t\t\t\t\tthis.processByte();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.gpio.outputPins(5 | (this.sioOutputPin() << 1));\r\n\t\t\t\t\t++this.bitsRead;\r\n\t\t\t\t\tif (this.bitsRead == 8) {\r\n\t\t\t\t\t\t--this.bytesRemaining;\r\n\t\t\t\t\t\tif (this.bytesRemaining <= 0) {\r\n\t\t\t\t\t\t\tthis.command = -1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.bitsRead = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.bitsRead = 0;\r\n\t\t\t\tthis.bytesRemaining = 0;\r\n\t\t\t\tthis.command = -1;\r\n\t\t\t\tthis.transferStep = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\r\n\tthis.pins = nybble & 7;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.setDirection = function(direction) {\r\n\tthis.direction = direction;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.processByte = function() {\r\n\t--this.bytesRemaining;\r\n\tswitch (this.command) {\r\n\tcase -1:\r\n\t\tif ((this.bits & 0x0F) == 0x06) {\r\n\t\t\tthis.command = (this.bits >> 4) & 7;\r\n\t\t\tthis.reading = this.bits & 0x80;\r\n\r\n\t\t\tthis.bytesRemaining = this.totalBytes[this.command];\r\n\t\t\tswitch (this.command) {\r\n\t\t\tcase 0:\r\n\t\t\t\tthis.control = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\tcase 6:\r\n\t\t\t\tthis.updateClock();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.gpio.core.WARN('Invalid RTC command byte: ' + this.bits.toString(16));\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 4:\r\n\t\t// Control\r\n\t\tthis.control = this.bits & 0x40;\r\n\t\tbreak;\r\n\t}\t\r\n\tthis.bits = 0;\r\n\tthis.bitsRead = 0;\r\n\tif (!this.bytesRemaining) {\r\n\t\tthis.command = -1;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.sioOutputPin = function() {\r\n\tvar outputByte = 0;\r\n\tswitch (this.command) {\r\n\tcase 4:\r\n\t\toutputByte = this.control;\r\n\t\tbreak;\r\n\tcase 2:\r\n\tcase 6:\r\n\t\toutputByte = this.time[7 - this.bytesRemaining];\r\n\t\tbreak;\r\n\t}\r\n\tvar output = (outputByte >> this.bitsRead) & 1;\r\n\treturn output;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.updateClock = function() {\r\n\tvar date = new Date();\r\n\tthis.time[0] = this.bcd(date.getFullYear());\r\n\tthis.time[1] = this.bcd(date.getMonth() + 1);\r\n\tthis.time[2] = this.bcd(date.getDate());\r\n\tthis.time[3] = date.getDay() - 1;\r\n\tif (this.time[3] < 0) {\r\n\t\tthis.time[3] = 6;\r\n\t}\r\n\tif (this.control & 0x40) {\r\n\t\t// 24 hour\r\n\t\tthis.time[4] = this.bcd(date.getHours());\r\n\t} else {\r\n\t\tthis.time[4] = this.bcd(date.getHours() % 2);\r\n\t\tif (date.getHours() >= 12) {\r\n\t\t\tthis.time[4] |= 0x80;\r\n\t\t}\r\n\t}\r\n\tthis.time[5] = this.bcd(date.getMinutes());\r\n\tthis.time[6] = this.bcd(date.getSeconds());\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.bcd = function(binary) {\r\n\tvar counter = binary % 10;\r\n\tbinary /= 10;\r\n\tcounter += (binary % 10) << 4;\r\n\treturn counter;\r\n};\r\n\r\nexport default GameBoyAdvanceGPIO;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport Serializer from './util';\nimport {\n\tFlashSavedata,\n\tEEPROMSavedata,\n\tSRAMSavedata,\n} from './savedata';\nimport GameBoyAdvanceGPIO from './gpio';\n\nfunction MemoryView(memory, offset) {\n\tthis.inherit();\n\tthis.buffer = memory;\n\tthis.view = new DataView(this.buffer, typeof(offset) === \"number\" ? offset : 0);\n\tthis.mask = memory.byteLength - 1;\n\tthis.resetMask();\n};\n\nMemoryView.prototype.resetMask = function() {\n\tthis.mask8 = this.mask & 0xFFFFFFFF;\n\tthis.mask16 = this.mask & 0xFFFFFFFE;\n\tthis.mask32 = this.mask & 0xFFFFFFFC;\n};\n\nMemoryView.prototype.load8 = function(offset) {\n\treturn this.view.getInt8(offset & this.mask8);\n};\n\nMemoryView.prototype.load16 = function(offset) {\n\t// Unaligned 16-bit loads are unpredictable...let's just pretend they work\n\treturn this.view.getInt16(offset & this.mask, true);\n};\n\nMemoryView.prototype.loadU8 = function(offset) {\n\treturn this.view.getUint8(offset & this.mask8);\n};\n\nMemoryView.prototype.loadU16 = function(offset) {\n\t// Unaligned 16-bit loads are unpredictable...let's just pretend they work\n\treturn this.view.getUint16(offset & this.mask, true);\n};\n\nMemoryView.prototype.load32 = function(offset) {\n\t// Unaligned 32-bit loads are \"rotated\" so they make some semblance of sense\n\tvar rotate = (offset & 3) << 3;\n\tvar mem = this.view.getInt32(offset & this.mask32, true);\n\treturn (mem >>> rotate) | (mem << (32 - rotate));\n};\n\nMemoryView.prototype.store8 = function(offset, value) {\n\tthis.view.setInt8(offset & this.mask8, value);\n};\n\nMemoryView.prototype.store16 = function(offset, value) {\n\tthis.view.setInt16(offset & this.mask16, value, true);\n};\n\nMemoryView.prototype.store32 = function(offset, value) {\n\tthis.view.setInt32(offset & this.mask32, value, true);\n};\n\nMemoryView.prototype.invalidatePage = function(address) {};\n\nMemoryView.prototype.replaceData = function(memory, offset) {\n\tthis.buffer = memory;\n\tthis.view = new DataView(this.buffer, typeof(offset) === \"number\" ? offset : 0);\n\tif (this.icache) {\n\t\tthis.icache = new Array(this.icache.length);\n\t}\n};\n\nfunction MemoryBlock(size, cacheBits) {\n\tMemoryView.call(this, new ArrayBuffer(size));\n\tthis.ICACHE_PAGE_BITS = cacheBits;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(size >> (this.ICACHE_PAGE_BITS + 1));\n};\n\nMemoryBlock.prototype = Object.create(MemoryView.prototype);\n\nMemoryBlock.prototype.invalidatePage = function(address) {\n\tvar page = this.icache[(address & this.mask) >> this.ICACHE_PAGE_BITS];\n\tif (page) {\n\t\tpage.invalid = true;\n\t}\n};\n\nfunction ROMView(rom, offset) {\n\tMemoryView.call(this, rom, offset);\n\tthis.ICACHE_PAGE_BITS = 10;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(rom.byteLength >> (this.ICACHE_PAGE_BITS + 1));\n\tthis.mask = 0x01FFFFFF;\n\tthis.resetMask();\n};\n\nROMView.prototype = Object.create(MemoryView.prototype);\n\nROMView.prototype.store8 = function(offset, value) {};\n\nROMView.prototype.store16 = function(offset, value) {\n\tif (offset < 0xCA && offset >= 0xC4) {\n\t\tif (!this.gpio) {\n\t\t\tthis.gpio = this.mmu.allocGPIO(this);\n\t\t}\n\t\tthis.gpio.store16(offset, value);\n\t}\n};\n\nROMView.prototype.store32 = function(offset, value) {\n\tif (offset < 0xCA && offset >= 0xC4) {\n\t\tif (!this.gpio) {\n\t\t\tthis.gpio = this.mmu.allocGPIO(this);\n\t\t}\n\t\tthis.gpio.store32(offset, value);\n\t}\n};\n\nfunction BIOSView(rom, offset) {\n\tMemoryView.call(this, rom, offset);\n\tthis.ICACHE_PAGE_BITS = 16;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(1);\n};\n\nBIOSView.prototype = Object.create(MemoryView.prototype);\n\nBIOSView.prototype.load8 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt8(offset);\n};\n\nBIOSView.prototype.load16 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt16(offset, true);\n};\n\nBIOSView.prototype.loadU8 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getUint8(offset);\n};\n\nBIOSView.prototype.loadU16 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getUint16(offset, true);\n};\n\nBIOSView.prototype.load32 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt32(offset, true);\n};\n\nBIOSView.prototype.store8 = function(offset, value) {};\n\nBIOSView.prototype.store16 = function(offset, value) {};\n\nBIOSView.prototype.store32 = function(offset, value) {};\n\nfunction BadMemory(mmu, cpu) {\n\tthis.inherit();\n\tthis.cpu = cpu;\n\tthis.mmu = mmu\n};\n\nBadMemory.prototype.load8 = function(offset) {\n\treturn this.mmu.load8(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x3));\n};\n\nBadMemory.prototype.load16 = function(offset) {\n\treturn this.mmu.load16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x2));\n};\n\nBadMemory.prototype.loadU8 = function(offset) {\n\treturn this.mmu.loadU8(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x3));\n};\n\nBadMemory.prototype.loadU16 = function(offset) {\n\treturn this.mmu.loadU16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x2));\n};\n\nBadMemory.prototype.load32 = function(offset) {\n\tif (this.cpu.execMode == this.cpu.MODE_ARM) {\n\t\treturn this.mmu.load32(this.cpu.gprs[this.cpu.gprs.PC] - this.cpu.instructionWidth);\n\t} else {\n\t\tvar halfword = this.mmu.loadU16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth);\n\t\treturn halfword | (halfword << 16);\n\t}\n};\n\nBadMemory.prototype.store8 = function(offset, value) {};\n\nBadMemory.prototype.store16 = function(offset, value) {};\n\nBadMemory.prototype.store32 = function(offset, value) {};\n\nBadMemory.prototype.invalidatePage = function(address) {};\n\nfunction GameBoyAdvanceMMU() {\n\tthis.inherit();\n\tthis.REGION_BIOS = 0x0;\n\tthis.REGION_WORKING_RAM = 0x2;\n\tthis.REGION_WORKING_IRAM = 0x3;\n\tthis.REGION_IO = 0x4;\n\tthis.REGION_PALETTE_RAM = 0x5;\n\tthis.REGION_VRAM = 0x6;\n\tthis.REGION_OAM = 0x7;\n\tthis.REGION_CART0 = 0x8;\n\tthis.REGION_CART1 = 0xA;\n\tthis.REGION_CART2 = 0xC;\n\tthis.REGION_CART_SRAM = 0xE;\n\n\tthis.BASE_BIOS = 0x00000000;\n\tthis.BASE_WORKING_RAM = 0x02000000;\n\tthis.BASE_WORKING_IRAM = 0x03000000;\n\tthis.BASE_IO = 0x04000000;\n\tthis.BASE_PALETTE_RAM = 0x05000000;\n\tthis.BASE_VRAM = 0x06000000;\n\tthis.BASE_OAM = 0x07000000;\n\tthis.BASE_CART0 = 0x08000000;\n\tthis.BASE_CART1 = 0x0A000000;\n\tthis.BASE_CART2 = 0x0C000000;\n\tthis.BASE_CART_SRAM = 0x0E000000;\n\n\tthis.BASE_MASK = 0x0F000000;\n\tthis.BASE_OFFSET = 24;\n\tthis.OFFSET_MASK = 0x00FFFFFF;\n\n\tthis.SIZE_BIOS = 0x00004000;\n\tthis.SIZE_WORKING_RAM = 0x00040000;\n\tthis.SIZE_WORKING_IRAM = 0x00008000;\n\tthis.SIZE_IO = 0x00000400;\n\tthis.SIZE_PALETTE_RAM = 0x00000400;\n\tthis.SIZE_VRAM = 0x00018000;\n\tthis.SIZE_OAM = 0x00000400;\n\tthis.SIZE_CART0 = 0x02000000;\n\tthis.SIZE_CART1 = 0x02000000;\n\tthis.SIZE_CART2 = 0x02000000;\n\tthis.SIZE_CART_SRAM = 0x00008000;\n\tthis.SIZE_CART_FLASH512 = 0x00010000;\n\tthis.SIZE_CART_FLASH1M = 0x00020000;\n\tthis.SIZE_CART_EEPROM = 0x00002000;\n\n\tthis.DMA_TIMING_NOW = 0;\n\tthis.DMA_TIMING_VBLANK = 1;\n\tthis.DMA_TIMING_HBLANK = 2;\n\tthis.DMA_TIMING_CUSTOM = 3;\n\n\tthis.DMA_INCREMENT = 0;\n\tthis.DMA_DECREMENT = 1;\n\tthis.DMA_FIXED = 2;\n\tthis.DMA_INCREMENT_RELOAD = 3;\n\n\tthis.DMA_OFFSET = [ 1, -1, 0, 1 ];\n\n\tthis.WAITSTATES = [ 0, 0, 2, 0, 0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4 ];\n\tthis.WAITSTATES_32 = [ 0, 0, 5, 0, 0, 1, 0, 1, 7, 7, 9, 9, 13, 13, 8 ];\n\tthis.WAITSTATES_SEQ = [ 0, 0, 2, 0, 0, 0, 0, 0, 2, 2, 4, 4, 8, 8, 4 ];\n\tthis.WAITSTATES_SEQ_32 = [ 0, 0, 5, 0, 0, 1, 0, 1, 5, 5, 9, 9, 17, 17, 8 ];\n\tthis.NULLWAIT = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];\n\n\tfor (var i = 15; i < 256; ++i) {\n\t\tthis.WAITSTATES[i] = 0;\n\t\tthis.WAITSTATES_32[i] = 0;\n\t\tthis.WAITSTATES_SEQ[i] = 0;\n\t\tthis.WAITSTATES_SEQ_32[i] = 0;\n\t\tthis.NULLWAIT[i] = 0;\n\t}\n\n\tthis.ROM_WS = [ 4, 3, 2, 8 ];\n\tthis.ROM_WS_SEQ = [\n\t\t[ 2, 1 ],\n\t\t[ 4, 1 ],\n\t\t[ 8, 1 ]\n\t];\n\n\tthis.ICACHE_PAGE_BITS = 8;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\n\tthis.bios = null;\n};\n\nGameBoyAdvanceMMU.prototype.mmap = function(region, object) {\n\tthis.memory[region] = object;\n}\n\nGameBoyAdvanceMMU.prototype.clear = function() {\n\tthis.badMemory = new BadMemory(this, this.cpu);\n\tthis.memory = [\n\t\tthis.bios,\n\t\tthis.badMemory, // Unused\n\t\tnew MemoryBlock(this.SIZE_WORKING_RAM, 9),\n\t\tnew MemoryBlock(this.SIZE_WORKING_IRAM, 7),\n\t\tnull, // This is owned by GameBoyAdvanceIO\n\t\tnull, // This is owned by GameBoyAdvancePalette\n\t\tnull, // This is owned by GameBoyAdvanceVRAM\n\t\tnull, // This is owned by GameBoyAdvanceOAM\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory // Unused\n\t];\n\tfor (var i = 16; i < 256; ++i) {\n\t\tthis.memory[i] = this.badMemory;\n\t}\n\n\tthis.waitstates = this.WAITSTATES.slice(0);\n\tthis.waitstatesSeq = this.WAITSTATES_SEQ.slice(0);\n\tthis.waitstates32 = this.WAITSTATES_32.slice(0);\n\tthis.waitstatesSeq32 = this.WAITSTATES_SEQ_32.slice(0);\n\tthis.waitstatesPrefetch = this.WAITSTATES_SEQ.slice(0);\n\tthis.waitstatesPrefetch32 = this.WAITSTATES_SEQ_32.slice(0);\n\n\tthis.cart = null;\n\tthis.save = null;\n\n\tthis.DMA_REGISTER = [\n\t\tthis.core.io.DMA0CNT_HI >> 1,\n\t\tthis.core.io.DMA1CNT_HI >> 1,\n\t\tthis.core.io.DMA2CNT_HI >> 1,\n\t\tthis.core.io.DMA3CNT_HI >> 1\n\t];\n};\n\nGameBoyAdvanceMMU.prototype.freeze = function() {\n\treturn {\n\t\t'ram': Serializer.prefix(this.memory[this.REGION_WORKING_RAM].buffer),\n\t\t'iram': Serializer.prefix(this.memory[this.REGION_WORKING_IRAM].buffer),\n\t};\n};\n\nGameBoyAdvanceMMU.prototype.defrost = function(frost) {\n\tthis.memory[this.REGION_WORKING_RAM].replaceData(frost.ram);\n\tthis.memory[this.REGION_WORKING_IRAM].replaceData(frost.iram);\n};\n\nGameBoyAdvanceMMU.prototype.loadBios = function(bios, real) {\n\tthis.bios = new BIOSView(bios);\n\tthis.bios.real = !!real;\n};\n\nGameBoyAdvanceMMU.prototype.loadRom = function(rom, process) {\n\tvar cart = {\n\t\ttitle: null,\n\t\tcode: null,\n\t\tmaker: null,\n\t\tmemory: rom,\n\t\tsaveType: null,\n\t};\n\n\tvar lo = new ROMView(rom);\n\tif (lo.view.getUint8(0xB2) != 0x96) {\n\t\t// Not a valid ROM\n\t\treturn null;\n\t}\n\tlo.mmu = this; // Needed for GPIO\n\tthis.memory[this.REGION_CART0] = lo;\n\tthis.memory[this.REGION_CART1] = lo;\n\tthis.memory[this.REGION_CART2] = lo;\n\n\tif (rom.byteLength > 0x01000000) {\n\t\tvar hi = new ROMView(rom, 0x01000000);\n\t\tthis.memory[this.REGION_CART0 + 1] = hi;\n\t\tthis.memory[this.REGION_CART1 + 1] = hi;\n\t\tthis.memory[this.REGION_CART2 + 1] = hi;\n\t}\n\n\tif (process) {\n\t\tvar name = '';\n\t\tfor (var i = 0; i < 12; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xA0);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tname += String.fromCharCode(c);\n\t\t}\n\t\tcart.title = name;\n\n\t\tvar code = '';\n\t\tfor (var i = 0; i < 4; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xAC);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcode += String.fromCharCode(c);\n\t\t}\n\t\tcart.code = code;\n\n\t\tvar maker = '';\n\t\tfor (var i = 0; i < 2; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xB0);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmaker += String.fromCharCode(c);\n\t\t}\n\t\tcart.maker = maker;\n\n\t\t// Find savedata type\n\t\tvar state = '';\n\t\tvar next;\n\t\tvar terminal = false;\n\t\tfor (var i = 0xE4; i < rom.byteLength && !terminal; ++i) {\n\t\t\tnext = String.fromCharCode(lo.loadU8(i));\n\t\t\tstate += next;\n\t\t\tswitch (state) {\n\t\t\tcase 'F':\n\t\t\tcase 'FL':\n\t\t\tcase 'FLA':\n\t\t\tcase 'FLAS':\n\t\t\tcase 'FLASH':\n\t\t\tcase 'FLASH_':\n\t\t\tcase 'FLASH5':\n\t\t\tcase 'FLASH51':\n\t\t\tcase 'FLASH512':\n\t\t\tcase 'FLASH512_':\n\t\t\tcase 'FLASH1':\n\t\t\tcase 'FLASH1M':\n\t\t\tcase 'FLASH1M_':\n\t\t\tcase 'S':\n\t\t\tcase 'SR':\n\t\t\tcase 'SRA':\n\t\t\tcase 'SRAM':\n\t\t\tcase 'SRAM_':\n\t\t\tcase 'E':\n\t\t\tcase 'EE':\n\t\t\tcase 'EEP':\n\t\t\tcase 'EEPR':\n\t\t\tcase 'EEPRO':\n\t\t\tcase 'EEPROM':\n\t\t\tcase 'EEPROM_':\n\t\t\t\tbreak;\n\t\t\tcase 'FLASH_V':\n\t\t\tcase 'FLASH512_V':\n\t\t\tcase 'FLASH1M_V':\n\t\t\tcase 'SRAM_V':\n\t\t\tcase 'EEPROM_V':\n\t\t\t\tterminal = true;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tstate = next;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (terminal) {\n\t\t\tcart.saveType = state;\n\t\t\tswitch (state) {\n\t\t\tcase 'FLASH_V':\n\t\t\tcase 'FLASH512_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new FlashSavedata(this.SIZE_CART_FLASH512);\n\t\t\t\tbreak;\n\t\t\tcase 'FLASH1M_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new FlashSavedata(this.SIZE_CART_FLASH1M);\n\t\t\t\tbreak;\n\t\t\tcase 'SRAM_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new SRAMSavedata(this.SIZE_CART_SRAM);\n\t\t\t\tbreak;\n\t\t\tcase 'EEPROM_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART2 + 1] = new EEPROMSavedata(this.SIZE_CART_EEPROM, this);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!this.save) {\n\t\t\t// Assume we have SRAM\n\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new SRAMSavedata(this.SIZE_CART_SRAM);\n\t\t}\n\t}\n\n\tthis.cart = cart;\n\treturn cart;\n};\n\nGameBoyAdvanceMMU.prototype.loadSavedata = function(save) {\n\tthis.save.replaceData(save);\n};\n\nGameBoyAdvanceMMU.prototype.load8 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load8(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.load16 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load16(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.load32 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load32(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.loadU8 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].loadU8(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.loadU16 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].loadU16(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.store8 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFF;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store8(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n};\n\nGameBoyAdvanceMMU.prototype.store16 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFE;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store16(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n};\n\nGameBoyAdvanceMMU.prototype.store32 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFC;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store32(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n\tmemory.invalidatePage(maskedOffset + 2);\n};\n\nGameBoyAdvanceMMU.prototype.waitPrefetch = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesPrefetch[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitPrefetch32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesPrefetch32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.wait = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstates[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.wait32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstates32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitSeq = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesSeq[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitSeq32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesSeq32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitMul = function(rs) {\n\tif ((rs & 0xFFFFFF00 == 0xFFFFFF00) || !(rs & 0xFFFFFF00)) {\n\t\tthis.cpu.cycles += 1;\n\t} else if ((rs & 0xFFFF0000 == 0xFFFF0000) || !(rs & 0xFFFF0000)) {\n\t\tthis.cpu.cycles += 2;\n\t} else if ((rs & 0xFF000000 == 0xFF000000) || !(rs & 0xFF000000)) {\n\t\tthis.cpu.cycles += 3;\n\t} else {\n\t\tthis.cpu.cycles += 4;\n\t}\n}\n\nGameBoyAdvanceMMU.prototype.waitMulti32 = function(memory, seq) {\n\tthis.cpu.cycles += 1 + this.waitstates32[memory >>> this.BASE_OFFSET];\n\tthis.cpu.cycles += (1 + this.waitstatesSeq32[memory >>> this.BASE_OFFSET]) * (seq - 1);\n};\n\nGameBoyAdvanceMMU.prototype.addressToPage = function(region, address) {\n\treturn address >> this.memory[region].ICACHE_PAGE_BITS;\n};\n\nGameBoyAdvanceMMU.prototype.accessPage = function(region, pageId) {\n\tvar memory = this.memory[region];\n\tvar page = memory.icache[pageId];\n\tif (!page || page.invalid) {\n\t\tpage = {\n\t\t\tthumb: new Array(1 << (memory.ICACHE_PAGE_BITS)),\n\t\t\tarm: new Array(1 << memory.ICACHE_PAGE_BITS - 1),\n\t\t\tinvalid: false\n\t\t}\n\t\tmemory.icache[pageId] = page;\n\t}\n\treturn page;\n};\n\nGameBoyAdvanceMMU.prototype.scheduleDma = function(number, info) {\n\tswitch (info.timing) {\n\tcase this.DMA_TIMING_NOW:\n\t\tthis.serviceDma(number, info);\n\t\tbreak;\n\tcase this.DMA_TIMING_HBLANK:\n\t\t// Handled implicitly\n\t\tbreak;\n\tcase this.DMA_TIMING_VBLANK:\n\t\t// Handled implicitly\n\t\tbreak;\n\tcase this.DMA_TIMING_CUSTOM:\n\t\tswitch (number) {\n\t\tcase 0:\n\t\t\tthis.core.WARN('Discarding invalid DMA0 scheduling');\n\t\t\tbreak;\n\t\tcase 1:\n\t\tcase 2:\n\t\t\tthis.cpu.irq.audio.scheduleFIFODma(number, info);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\t// Check if something happens\n\t\t\tthis.cpu.irq.video.scheduleVCaptureDma(number, info);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.runHblankDmas = function() {\n\tvar dma;\n\tfor (var i = 0; i < this.cpu.irq.dma.length; ++i) {\n\t\tdma = this.cpu.irq.dma[i];\n\t\tif (dma.enable && dma.timing == this.DMA_TIMING_HBLANK) {\n\t\t\tthis.serviceDma(i, dma);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.runVblankDmas = function() {\n\tvar dma;\n\tfor (var i = 0; i < this.cpu.irq.dma.length; ++i) {\n\t\tdma = this.cpu.irq.dma[i];\n\t\tif (dma.enable && dma.timing == this.DMA_TIMING_VBLANK) {\n\t\t\tthis.serviceDma(i, dma);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.serviceDma = function(number, info) {\n\tif (!info.enable) {\n\t\t// There was a DMA scheduled that got canceled\n\t\treturn;\n\t}\n\n\tvar width = info.width;\n\tvar sourceOffset = this.DMA_OFFSET[info.srcControl] * width;\n\tvar destOffset = this.DMA_OFFSET[info.dstControl] * width;\n\tvar wordsRemaining = info.nextCount;\n\tvar source = info.nextSource & this.OFFSET_MASK;\n\tvar dest = info.nextDest & this.OFFSET_MASK;\n\tvar sourceRegion = info.nextSource >>> this.BASE_OFFSET;\n\tvar destRegion = info.nextDest >>> this.BASE_OFFSET;\n\tvar sourceBlock = this.memory[sourceRegion];\n\tvar destBlock = this.memory[destRegion];\n\tvar sourceView = null;\n\tvar destView = null;\n\tvar sourceMask = 0xFFFFFFFF;\n\tvar destMask = 0xFFFFFFFF;\n\tvar word;\n\n\tif (destBlock.ICACHE_PAGE_BITS) {\n\t\tvar endPage = (dest + wordsRemaining * width) >> destBlock.ICACHE_PAGE_BITS;\n\t\tfor (var i = dest >> destBlock.ICACHE_PAGE_BITS; i <= endPage; ++i) {\n\t\t\tdestBlock.invalidatePage(i << destBlock.ICACHE_PAGE_BITS);\n\t\t}\n\t}\n\n\tif (destRegion == this.REGION_WORKING_RAM || destRegion == this.REGION_WORKING_IRAM) {\n\t\tdestView = destBlock.view;\n\t\tdestMask = destBlock.mask;\n\t}\n\n\tif (sourceRegion == this.REGION_WORKING_RAM || sourceRegion == this.REGION_WORKING_IRAM || sourceRegion == this.REGION_CART0 || sourceRegion == this.REGION_CART1) {\n\t\tsourceView = sourceBlock.view;\n\t\tsourceMask = sourceBlock.mask;\n\t}\n\n\tif (sourceBlock && destBlock) {\n\t\tif (sourceView && destView) {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getInt32(source & sourceMask);\n\t\t\t\t\tdestView.setInt32(dest & destMask, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getUint16(source & sourceMask);\n\t\t\t\t\tdestView.setUint16(dest & destMask, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (sourceView) {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getInt32(source & sourceMask, true);\n\t\t\t\t\tdestBlock.store32(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getUint16(source & sourceMask, true);\n\t\t\t\t\tdestBlock.store16(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceBlock.load32(source);\n\t\t\t\t\tdestBlock.store32(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceBlock.loadU16(source);\n\t\t\t\t\tdestBlock.store16(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.core.WARN('Invalid DMA');\n\t}\n\n\tif (info.doIrq) {\n\t\tinfo.nextIRQ = this.cpu.cycles + 2;\n\t\tinfo.nextIRQ += (width == 4 ? this.waitstates32[sourceRegion] + this.waitstates32[destRegion]\n\t\t                            : this.waitstates[sourceRegion] + this.waitstates[destRegion]);\n\t\tinfo.nextIRQ += (info.count - 1) * (width == 4 ? this.waitstatesSeq32[sourceRegion] + this.waitstatesSeq32[destRegion]\n\t\t                                               : this.waitstatesSeq[sourceRegion] + this.waitstatesSeq[destRegion]);\n\t}\n\n\tinfo.nextSource = source | (sourceRegion << this.BASE_OFFSET);\n\tinfo.nextDest = dest | (destRegion << this.BASE_OFFSET);\n\tinfo.nextCount = wordsRemaining;\n\n\tif (!info.repeat) {\n\t\tinfo.enable = false;\n\n\t\t// Clear the enable bit in memory\n\t\tvar io = this.memory[this.REGION_IO];\n\t\tio.registers[this.DMA_REGISTER[number]] &= 0x7FE0;\n\t} else {\n\t\tinfo.nextCount = info.count;\n\t\tif (info.dstControl == this.DMA_INCREMENT_RELOAD) {\n\t\t\tinfo.nextDest = info.dest;\n\t\t}\n\t\tthis.scheduleDma(number, info);\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.adjustTimings = function(word) {\n\tvar sram = word & 0x0003;\n\tvar ws0 = (word & 0x000C) >> 2;\n\tvar ws0seq = (word & 0x0010) >> 4;\n\tvar ws1 = (word & 0x0060) >> 5;\n\tvar ws1seq = (word & 0x0080) >> 7;\n\tvar ws2 = (word & 0x0300) >> 8;\n\tvar ws2seq = (word & 0x0400) >> 10;\n\tvar prefetch = word & 0x4000;\n\n\tthis.waitstates[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstatesSeq[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstates32[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstatesSeq32[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\n\tthis.waitstates[this.REGION_CART0] = this.waitstates[this.REGION_CART0 + 1] = this.ROM_WS[ws0];\n\tthis.waitstates[this.REGION_CART1] = this.waitstates[this.REGION_CART1 + 1] = this.ROM_WS[ws1];\n\tthis.waitstates[this.REGION_CART2] = this.waitstates[this.REGION_CART2 + 1] = this.ROM_WS[ws2];\n\n\tthis.waitstatesSeq[this.REGION_CART0] = this.waitstatesSeq[this.REGION_CART0 + 1] = this.ROM_WS_SEQ[0][ws0seq];\n\tthis.waitstatesSeq[this.REGION_CART1] = this.waitstatesSeq[this.REGION_CART1 + 1] = this.ROM_WS_SEQ[1][ws1seq];\n\tthis.waitstatesSeq[this.REGION_CART2] = this.waitstatesSeq[this.REGION_CART2 + 1] = this.ROM_WS_SEQ[2][ws2seq];\n\n\tthis.waitstates32[this.REGION_CART0] = this.waitstates32[this.REGION_CART0 + 1] = this.waitstates[this.REGION_CART0] + 1 + this.waitstatesSeq[this.REGION_CART0];\n\tthis.waitstates32[this.REGION_CART1] = this.waitstates32[this.REGION_CART1 + 1] = this.waitstates[this.REGION_CART1] + 1 + this.waitstatesSeq[this.REGION_CART1];\n\tthis.waitstates32[this.REGION_CART2] = this.waitstates32[this.REGION_CART2 + 1] = this.waitstates[this.REGION_CART2] + 1 + this.waitstatesSeq[this.REGION_CART2];\n\n\tthis.waitstatesSeq32[this.REGION_CART0] = this.waitstatesSeq32[this.REGION_CART0 + 1] = 2 * this.waitstatesSeq[this.REGION_CART0] + 1;\n\tthis.waitstatesSeq32[this.REGION_CART1] = this.waitstatesSeq32[this.REGION_CART1 + 1] = 2 * this.waitstatesSeq[this.REGION_CART1] + 1;\n\tthis.waitstatesSeq32[this.REGION_CART2] = this.waitstatesSeq32[this.REGION_CART2 + 1] = 2 * this.waitstatesSeq[this.REGION_CART2] + 1;\n\n\tif (prefetch) {\n\t\tthis.waitstatesPrefetch[this.REGION_CART0] = this.waitstatesPrefetch[this.REGION_CART0 + 1] = 0;\n\t\tthis.waitstatesPrefetch[this.REGION_CART1] = this.waitstatesPrefetch[this.REGION_CART1 + 1] = 0;\n\t\tthis.waitstatesPrefetch[this.REGION_CART2] = this.waitstatesPrefetch[this.REGION_CART2 + 1] = 0;\n\n\t\tthis.waitstatesPrefetch32[this.REGION_CART0] = this.waitstatesPrefetch32[this.REGION_CART0 + 1] = 0;\n\t\tthis.waitstatesPrefetch32[this.REGION_CART1] = this.waitstatesPrefetch32[this.REGION_CART1 + 1] = 0;\n\t\tthis.waitstatesPrefetch32[this.REGION_CART2] = this.waitstatesPrefetch32[this.REGION_CART2 + 1] = 0;\n\t} else {\n\t\tthis.waitstatesPrefetch[this.REGION_CART0] = this.waitstatesPrefetch[this.REGION_CART0 + 1] = this.waitstatesSeq[this.REGION_CART0];\n\t\tthis.waitstatesPrefetch[this.REGION_CART1] = this.waitstatesPrefetch[this.REGION_CART1 + 1] = this.waitstatesSeq[this.REGION_CART1];\n\t\tthis.waitstatesPrefetch[this.REGION_CART2] = this.waitstatesPrefetch[this.REGION_CART2 + 1] = this.waitstatesSeq[this.REGION_CART2];\n\n\t\tthis.waitstatesPrefetch32[this.REGION_CART0] = this.waitstatesPrefetch32[this.REGION_CART0 + 1] = this.waitstatesSeq32[this.REGION_CART0];\n\t\tthis.waitstatesPrefetch32[this.REGION_CART1] = this.waitstatesPrefetch32[this.REGION_CART1 + 1] = this.waitstatesSeq32[this.REGION_CART1];\n\t\tthis.waitstatesPrefetch32[this.REGION_CART2] = this.waitstatesPrefetch32[this.REGION_CART2 + 1] = this.waitstatesSeq32[this.REGION_CART2];\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.saveNeedsFlush = function() {\n\treturn this.save.writePending;\n};\n\nGameBoyAdvanceMMU.prototype.flushSave = function() {\n\tthis.save.writePending = false;\n};\n\nGameBoyAdvanceMMU.prototype.allocGPIO = function(rom) {\n\treturn new GameBoyAdvanceGPIO(this.core, rom);\n};\n\nexport {\n\tGameBoyAdvanceMMU,\n\tMemoryView,\n\tMemoryBlock,\n\tBadMemory,\n\tROMView,\n\tBIOSView,\n};\nexport default GameBoyAdvanceMMU;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { MemoryBlock } from './mmu';\n\nfunction GameBoyAdvanceInterruptHandler() {\n\tthis.inherit();\n\tthis.FREQUENCY = 0x1000000;\n\n\tthis.cpu = null;\n\tthis.enable = false;\n\n\tthis.IRQ_VBLANK = 0x0;\n\tthis.IRQ_HBLANK = 0x1;\n\tthis.IRQ_VCOUNTER = 0x2;\n\tthis.IRQ_TIMER0 = 0x3;\n\tthis.IRQ_TIMER1 = 0x4;\n\tthis.IRQ_TIMER2 = 0x5;\n\tthis.IRQ_TIMER3 = 0x6;\n\tthis.IRQ_SIO = 0x7;\n\tthis.IRQ_DMA0 = 0x8;\n\tthis.IRQ_DMA1 = 0x9;\n\tthis.IRQ_DMA2 = 0xA;\n\tthis.IRQ_DMA3 = 0xB;\n\tthis.IRQ_KEYPAD = 0xC;\n\tthis.IRQ_GAMEPAK = 0xD;\n\n\tthis.MASK_VBLANK = 0x0001;\n\tthis.MASK_HBLANK = 0x0002;\n\tthis.MASK_VCOUNTER = 0x0004;\n\tthis.MASK_TIMER0 = 0x0008;\n\tthis.MASK_TIMER1 = 0x0010;\n\tthis.MASK_TIMER2 = 0x0020;\n\tthis.MASK_TIMER3 = 0x0040;\n\tthis.MASK_SIO = 0x0080;\n\tthis.MASK_DMA0 = 0x0100;\n\tthis.MASK_DMA1 = 0x0200;\n\tthis.MASK_DMA2 = 0x0400;\n\tthis.MASK_DMA3 = 0x0800;\n\tthis.MASK_KEYPAD = 0x1000;\n\tthis.MASK_GAMEPAK = 0x2000;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.clear = function() {\n\tthis.enable = false;\n\tthis.enabledIRQs = 0;\n\tthis.interruptFlags = 0;\n\n\tthis.dma = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.dma.push({\n\t\t\tsource: 0,\n\t\t\tdest: 0,\n\t\t\tcount: 0,\n\t\t\tnextSource: 0,\n\t\t\tnextDest: 0,\n\t\t\tnextCount: 0,\n\t\t\tsrcControl: 0,\n\t\t\tdstControl: 0,\n\t\t\trepeat: false,\n\t\t\twidth: 0,\n\t\t\tdrq: false,\n\t\t\ttiming: 0,\n\t\t\tdoIrq: false,\n\t\t\tenable: false,\n\t\t\tnextIRQ: 0\n\t\t});\n\t}\n\n\tthis.timersEnabled = 0;\n\tthis.timers = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.timers.push({\n\t\t\treload: 0,\n\t\t\toldReload: 0,\n\t\t\tprescaleBits: 0,\n\t\t\tcountUp: false,\n\t\t\tdoIrq: false,\n\t\t\tenable: false,\n\t\t\tlastEvent: 0,\n\t\t\tnextEvent: 0,\n\t\t\toverflowInterval: 1\n\t\t});\n\t}\n\n\tthis.nextEvent = 0;\n\tthis.springIRQ = false;\n\tthis.resetSP();\n};\n\nGameBoyAdvanceInterruptHandler.prototype.freeze = function() {\n\treturn {\n\t\t'enable': this.enable,\n\t\t'enabledIRQs': this.enabledIRQs,\n\t\t'interruptFlags': this.interruptFlags,\n\t\t'dma': this.dma,\n\t\t'timers': this.timers,\n\t\t'nextEvent': this.nextEvent,\n\t\t'springIRQ': this.springIRQ\n\t};\n};\n\nGameBoyAdvanceInterruptHandler.prototype.defrost = function(frost) {\n\tthis.enable = frost.enable;\n\tthis.enabledIRQs = frost.enabledIRQs;\n\tthis.interruptFlags = frost.interruptFlags;\n\tthis.dma = frost.dma;\n\tthis.timers = frost.timers;\n\tthis.timersEnabled = 0;\n\tif (this.timers[0].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[1].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[2].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[3].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tthis.nextEvent = frost.nextEvent;\n\tthis.springIRQ = frost.springIRQ;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.updateTimers = function() {\n\tif (this.nextEvent > this.cpu.cycles) {\n\t\treturn;\n\t}\n\n\tif (this.springIRQ) {\n\t\tthis.cpu.raiseIRQ();\n\t\tthis.springIRQ = false;\n\t}\n\n\tthis.video.updateTimers(this.cpu);\n\tthis.audio.updateTimers();\n\tif (this.timersEnabled) {\n\t\tvar timer = this.timers[0];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tthis.io.registers[this.io.TM0CNT_LO >> 1] = timer.reload;\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER0);\n\t\t\t\t}\n\n\t\t\t\tif (this.audio.enabled) {\n\t\t\t\t\tif (this.audio.enableChannelA && !this.audio.soundTimerA && this.audio.dmaA >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoA();\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (this.audio.enableChannelB && !this.audio.soundTimerB && this.audio.dmaB >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoB();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[1];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM1CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[1];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM1CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM1CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER1);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\n\t\t\t\tif (this.audio.enabled) {\n\t\t\t\t\tif (this.audio.enableChannelA && this.audio.soundTimerA && this.audio.dmaA >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoA();\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (this.audio.enableChannelB && this.audio.soundTimerB && this.audio.dmaB >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoB();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[2];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM2CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[2];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM2CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM2CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER2);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[3];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM3CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[3];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM3CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM3CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER3);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tvar dma = this.dma[0];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA0);\n\t}\n\n\tdma = this.dma[1];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA1);\n\t}\n\n\tdma = this.dma[2];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA2);\n\t}\n\n\tdma = this.dma[3];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA3);\n\t}\n\n\tthis.pollNextEvent();\n}\n\nGameBoyAdvanceInterruptHandler.prototype.resetSP = function() {\n\tthis.cpu.switchMode(this.cpu.MODE_SUPERVISOR);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007FE0;\n\tthis.cpu.switchMode(this.cpu.MODE_IRQ);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007FA0;\n\tthis.cpu.switchMode(this.cpu.MODE_SYSTEM);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007F00;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.swi32 = function(opcode) {\n\tthis.swi(opcode >> 16);\n};\n\nGameBoyAdvanceInterruptHandler.prototype.swi = function(opcode) {\n\tif (this.core.mmu.bios.real) {\n\t\tthis.cpu.raiseTrap();\n\t\treturn;\n\t}\n\n\tswitch (opcode) {\n\tcase 0x00:\n\t\t// SoftReset\n\t\tvar mem = this.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM];\n\t\tvar flag = mem.loadU8(0x7FFA);\n\t\tfor (var i = 0x7E00; i < 0x8000; i += 4) {\n\t\t\tmem.store32(i, 0);\n\t\t}\n\t\tthis.resetSP();\n\t\tif (!flag) {\n\t\t\tthis.cpu.gprs[this.cpu.LR] = 0x08000000;\n\t\t} else {\n\t\t\tthis.cpu.gprs[this.cpu.LR] = 0x02000000;\n\t\t}\n\t\tthis.cpu.switchExecMode(this.cpu.MODE_ARM);\n\t\tthis.cpu.instruction.writesPC = true;\n\t\tthis.cpu.gprs[this.cpu.PC] = this.cpu.gprs[this.cpu.LR];\n\t\tbreak;\n\tcase 0x01:\n\t\t// RegisterRamReset\n\t\tvar regions = this.cpu.gprs[0];\n\t\tif (regions & 0x01) {\n\t\t\tthis.core.mmu.memory[this.core.mmu.REGION_WORKING_RAM] = new MemoryBlock(this.core.mmu.SIZE_WORKING_RAM, 9);\n\t\t}\n\t\tif (regions & 0x02) {\n\t\t\tfor (var i = 0; i < this.core.mmu.SIZE_WORKING_IRAM - 0x200; i += 4) {\n\t\t\t\tthis.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM].store32(i, 0);\n\t\t\t}\n\t\t}\n\t\tif (regions & 0x1C) {\n\t\t\tthis.video.renderPath.clearSubsets(this.core.mmu, regions);\n\t\t}\n\t\tif (regions & 0xE0) {\n\t\t\tthis.core.STUB('Unimplemented RegisterRamReset');\n\t\t}\n\t\tbreak;\n\tcase 0x02:\n\t\t// Halt\n\t\tthis.halt();\n\t\tbreak;\n\tcase 0x05:\n\t\t// VBlankIntrWait\n\t\tthis.cpu.gprs[0] = 1;\n\t\tthis.cpu.gprs[1] = 1;\n\t\t// Fall through:\n\tcase 0x04:\n\t\t// IntrWait\n\t\tif (!this.enable) {\n\t\t\tthis.io.store16(this.io.IME, 1);\n\t\t}\n\t\tif (!this.cpu.gprs[0] && this.interruptFlags & this.cpu.gprs[1]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dismissIRQs(0xFFFFFFFF);\n\t\tthis.cpu.raiseTrap();\n\t\tbreak;\n\tcase 0x06:\n\t\t// Div\n\t\tvar result = (this.cpu.gprs[0] | 0) / (this.cpu.gprs[1] | 0);\n\t\tvar mod = (this.cpu.gprs[0] | 0) % (this.cpu.gprs[1] | 0);\n\t\tthis.cpu.gprs[0] = result | 0;\n\t\tthis.cpu.gprs[1] = mod | 0;\n\t\tthis.cpu.gprs[3] = Math.abs(result | 0);\n\t\tbreak;\n\tcase 0x07:\n\t\t// DivArm\n\t\tvar result = (this.cpu.gprs[1] | 0) / (this.cpu.gprs[0] | 0);\n\t\tvar mod = (this.cpu.gprs[1] | 0) % (this.cpu.gprs[0] | 0);\n\t\tthis.cpu.gprs[0] = result | 0;\n\t\tthis.cpu.gprs[1] = mod | 0;\n\t\tthis.cpu.gprs[3] = Math.abs(result | 0);\n\t\tbreak;\n\tcase 0x08:\n\t\t// Sqrt\n\t\tvar root = Math.sqrt(this.cpu.gprs[0]);\n\t\tthis.cpu.gprs[0] = root | 0; // Coerce down to int\n\t\tbreak;\n\tcase 0x0A:\n\t\t// ArcTan2\n\t\tvar x = this.cpu.gprs[0] / 16384;\n\t\tvar y = this.cpu.gprs[1] / 16384;\n\t\tthis.cpu.gprs[0] = (Math.atan2(y, x) / (2 * Math.PI)) * 0x10000;\n\t\tbreak;\n\tcase 0x0B:\n\t\t// CpuSet\n\t\tvar source = this.cpu.gprs[0];\n\t\tvar dest = this.cpu.gprs[1];\n\t\tvar mode = this.cpu.gprs[2];\n\t\tvar count = mode & 0x000FFFFF;\n\t\tvar fill = mode & 0x01000000;\n\t\tvar wordsize = (mode & 0x04000000) ? 4 : 2;\n\t\tif (fill) {\n\t\t\tif (wordsize == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\tvar word = this.cpu.mmu.load32(source);\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsource &= 0xFFFFFFFE;\n\t\t\t\tdest &= 0xFFFFFFFE;\n\t\t\t\tvar word = this.cpu.mmu.load16(source);\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tthis.cpu.mmu.store16(dest + (i << 1), word);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (wordsize == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tvar word = this.cpu.mmu.load32(source + (i << 2));\n\t\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsource &= 0xFFFFFFFE;\n\t\t\t\tdest &= 0xFFFFFFFE;\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tvar word = this.cpu.mmu.load16(source + (i << 1));\n\t\t\t\t\tthis.cpu.mmu.store16(dest + (i << 1), word);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\tcase 0x0C:\n\t\t// FastCpuSet\n\t\tvar source = this.cpu.gprs[0] & 0xFFFFFFFC;\n\t\tvar dest = this.cpu.gprs[1] & 0xFFFFFFFC;\n\t\tvar mode = this.cpu.gprs[2];\n\t\tvar count = mode & 0x000FFFFF;\n\t\tcount = ((count + 7) >> 3) << 3;\n\t\tvar fill = mode & 0x01000000;\n\t\tif (fill) {\n\t\t\tvar word = this.cpu.mmu.load32(source);\n\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\tvar word = this.cpu.mmu.load32(source + (i << 2));\n\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t}\n\t\t}\n\t\treturn;\n\tcase 0x0E:\n\t\t// BgAffineSet\n\t\tvar i = this.cpu.gprs[2];\n\t\tvar ox, oy;\n\t\tvar cx, cy;\n\t\tvar sx, sy;\n\t\tvar theta;\n\t\tvar offset = this.cpu.gprs[0];\n\t\tvar destination = this.cpu.gprs[1];\n\t\tvar a, b, c, d;\n\t\tvar rx, ry;\n\t\twhile (i--) {\n\t\t\t// [ sx   0  0 ]   [ cos(theta)  -sin(theta)  0 ]   [ 1  0  cx - ox ]   [ A B rx ]\n\t\t\t// [  0  sy  0 ] * [ sin(theta)   cos(theta)  0 ] * [ 0  1  cy - oy ] = [ C D ry ]\n\t\t\t// [  0   0  1 ]   [     0            0       1 ]   [ 0  0     1    ]   [ 0 0  1 ]\n\t\t\tox = this.core.mmu.load32(offset) / 256;\n\t\t\toy = this.core.mmu.load32(offset + 4) / 256;\n\t\t\tcx = this.core.mmu.load16(offset + 8);\n\t\t\tcy = this.core.mmu.load16(offset + 10);\n\t\t\tsx = this.core.mmu.load16(offset + 12) / 256;\n\t\t\tsy = this.core.mmu.load16(offset + 14) / 256;\n\t\t\ttheta = (this.core.mmu.loadU16(offset + 16) >> 8) / 128 * Math.PI;\n\t\t\toffset += 20;\n\t\t\t// Rotation\n\t\t\ta = d = Math.cos(theta);\n\t\t\tb = c = Math.sin(theta);\n\t\t\t// Scale\n\t\t\ta *= sx;\n\t\t\tb *= -sx;\n\t\t\tc *= sy;\n\t\t\td *= sy;\n\t\t\t// Translate\n\t\t\trx = ox - (a * cx + b * cy);\n\t\t\try = oy - (c * cx + d * cy);\n\t\t\tthis.core.mmu.store16(destination, (a * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 2, (b * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 4, (c * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 6, (d * 256) | 0);\n\t\t\tthis.core.mmu.store32(destination + 8, (rx * 256) | 0);\n\t\t\tthis.core.mmu.store32(destination + 12, (ry * 256) | 0);\n\t\t\tdestination += 16;\n\t\t}\n\t\tbreak;\n\tcase 0x0F:\n\t\t// ObjAffineSet\n\t\tvar i = this.cpu.gprs[2];\n\t\tvar sx, sy;\n\t\tvar theta;\n\t\tvar offset = this.cpu.gprs[0];\n\t\tvar destination = this.cpu.gprs[1]\n\t\tvar diff = this.cpu.gprs[3];\n\t\tvar a, b, c, d;\n\t\twhile (i--) {\n\t\t\t// [ sx   0 ]   [ cos(theta)  -sin(theta) ]   [ A B ]\n\t\t\t// [  0  sy ] * [ sin(theta)   cos(theta) ] = [ C D ]\n\t\t\tsx = this.core.mmu.load16(offset) / 256;\n\t\t\tsy = this.core.mmu.load16(offset + 2) / 256;\n\t\t\ttheta = (this.core.mmu.loadU16(offset + 4) >> 8) / 128 * Math.PI;\n\t\t\toffset += 6;\n\t\t\t// Rotation\n\t\t\ta = d = Math.cos(theta);\n\t\t\tb = c = Math.sin(theta);\n\t\t\t// Scale\n\t\t\ta *= sx;\n\t\t\tb *= -sx;\n\t\t\tc *= sy;\n\t\t\td *= sy;\n\t\t\tthis.core.mmu.store16(destination, (a * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff, (b * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff * 2, (c * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff * 3, (d * 256) | 0);\n\t\t\tdestination += diff * 4;\n\t\t}\n\t\tbreak;\n\tcase 0x11:\n\t\t// LZ77UnCompWram\n\t\tthis.lz77(this.cpu.gprs[0], this.cpu.gprs[1], 1);\n\t\tbreak;\n\tcase 0x12:\n\t\t// LZ77UnCompVram\n\t\tthis.lz77(this.cpu.gprs[0], this.cpu.gprs[1], 2);\n\t\tbreak;\n\tcase 0x13:\n\t\t// HuffUnComp\n\t\tthis.huffman(this.cpu.gprs[0], this.cpu.gprs[1]);\n\t\tbreak;\n\tcase 0x14:\n\t\t// RlUnCompWram\n\t\tthis.rl(this.cpu.gprs[0], this.cpu.gprs[1], 1);\n\t\tbreak;\n\tcase 0x15:\n\t\t// RlUnCompVram\n\t\tthis.rl(this.cpu.gprs[0], this.cpu.gprs[1], 2);\n\t\tbreak;\n\tcase 0x1F:\n\t\t// MidiKey2Freq\n\t\tvar key = this.cpu.mmu.load32(this.cpu.gprs[0] + 4);\n\t\tthis.cpu.gprs[0] = key / Math.pow(2, (180 - this.cpu.gprs[1] - this.cpu.gprs[2] / 256) / 12) >>> 0;\n\t\tbreak;\n\tdefault:\n\t\tthrow \"Unimplemented software interrupt: 0x\" + opcode.toString(16);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.masterEnable = function(value) {\n\tthis.enable = value;\n\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.setInterruptsEnabled = function(value) {\n\tthis.enabledIRQs = value;\n\n\tif (this.enabledIRQs & this.MASK_SIO) {\n\t\tthis.core.STUB('Serial I/O interrupts not implemented');\n\t}\n\n\tif (this.enabledIRQs & this.MASK_KEYPAD) {\n\t\tthis.core.STUB('Keypad interrupts not implemented');\n\t}\n\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.pollNextEvent = function() {\n\tvar nextEvent = this.video.nextEvent;\n\tvar test;\n\n\tif (this.audio.enabled) {\n\t\ttest = this.audio.nextEvent;\n\t\tif (!nextEvent || test < nextEvent) {\n\t\t\tnextEvent = test;\n\t\t}\n\t}\n\n\tif (this.timersEnabled) {\n\t\tvar timer = this.timers[0];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\n\t\ttimer = this.timers[1];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t\ttimer = this.timers[2];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t\ttimer = this.timers[3];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t}\n\n\tvar dma = this.dma[0];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[1];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[2];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[3];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tthis.core.ASSERT(nextEvent >= this.cpu.cycles, \"Next event is before present\");\n\tthis.nextEvent = nextEvent;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.waitForIRQ = function() {\n\tvar timer;\n\tvar irqPending = this.testIRQ() || this.video.hblankIRQ || this.video.vblankIRQ || this.video.vcounterIRQ;\n\tif (this.timersEnabled) {\n\t\ttimer = this.timers[0];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[1];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[2];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[3];\n\t\tirqPending = irqPending || timer.doIrq;\n\t}\n\tif (!irqPending) {\n\t\treturn false;\n\t}\n\n\tfor (;;) {\n\t\tthis.pollNextEvent();\n\n\t\tif (!this.nextEvent) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.cpu.cycles = this.nextEvent;\n\t\t\tthis.updateTimers();\n\t\t\tif (this.interruptFlags) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.testIRQ = function() {\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.springIRQ = true;\n\t\tthis.nextEvent = this.cpu.cycles;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.raiseIRQ = function(irqType) {\n\tthis.interruptFlags |= 1 << irqType;\n\tthis.io.registers[this.io.IF >> 1] = this.interruptFlags;\n\n\tif (this.enable && (this.enabledIRQs & 1 << irqType)) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dismissIRQs = function(irqMask) {\n\tthis.interruptFlags &= ~irqMask;\n\tthis.io.registers[this.io.IF >> 1] = this.interruptFlags;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetSourceAddress = function(dma, address) {\n\tthis.dma[dma].source = address & 0xFFFFFFFE;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetDestAddress = function(dma, address) {\n\tthis.dma[dma].dest = address & 0xFFFFFFFE;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetWordCount = function(dma, count) {\n\tthis.dma[dma].count = count ? count : (dma == 3 ? 0x10000 : 0x4000);\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaWriteControl = function(dma, control) {\n\tvar currentDma = this.dma[dma];\n\tvar wasEnabled = currentDma.enable;\n\tcurrentDma.dstControl = (control & 0x0060) >> 5;\n\tcurrentDma.srcControl = (control & 0x0180) >> 7;\n\tcurrentDma.repeat = !!(control & 0x0200);\n\tcurrentDma.width = (control & 0x0400) ? 4 : 2;\n\tcurrentDma.drq = !!(control & 0x0800);\n\tcurrentDma.timing = (control & 0x3000) >> 12;\n\tcurrentDma.doIrq = !!(control & 0x4000);\n\tcurrentDma.enable = !!(control & 0x8000);\n\tcurrentDma.nextIRQ = 0;\n\n\tif (currentDma.drq) {\n\t\tthis.core.WARN('DRQ not implemented');\n\t}\n\n\tif (!wasEnabled && currentDma.enable) {\n\t\tcurrentDma.nextSource = currentDma.source;\n\t\tcurrentDma.nextDest = currentDma.dest;\n\t\tcurrentDma.nextCount = currentDma.count;\n\t\tthis.cpu.mmu.scheduleDma(dma, currentDma);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerSetReload = function(timer, reload) {\n\tthis.timers[timer].reload = reload & 0xFFFF;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerWriteControl = function(timer, control) {\n\tvar currentTimer = this.timers[timer];\n\tvar oldPrescale = currentTimer.prescaleBits;\n\tswitch (control & 0x0003) {\n\tcase 0x0000:\n\t\tcurrentTimer.prescaleBits = 0;\n\t\tbreak;\n\tcase 0x0001:\n\t\tcurrentTimer.prescaleBits = 6;\n\t\tbreak;\n\tcase 0x0002:\n\t\tcurrentTimer.prescaleBits = 8;\n\t\tbreak;\n\tcase 0x0003:\n\t\tcurrentTimer.prescaleBits = 10;\n\t\tbreak;\n\t}\n\tcurrentTimer.countUp = !!(control & 0x0004);\n\tcurrentTimer.doIrq = !!(control & 0x0040);\n\tcurrentTimer.overflowInterval = (0x10000 - currentTimer.reload) << currentTimer.prescaleBits;\n\tvar wasEnabled = currentTimer.enable;\n\tcurrentTimer.enable = !!(((control & 0x0080) >> 7) << timer);\n\tif (!wasEnabled && currentTimer.enable) {\n\t\tif (!currentTimer.countUp) {\n\t\t\tcurrentTimer.lastEvent = this.cpu.cycles;\n\t\t\tcurrentTimer.nextEvent = this.cpu.cycles + currentTimer.overflowInterval;\n\t\t} else {\n\t\t\tcurrentTimer.nextEvent = 0;\n\t\t}\n\t\tthis.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1] = currentTimer.reload;\n\t\tcurrentTimer.oldReload = currentTimer.reload;\n\t\t++this.timersEnabled;\n\t} else if (wasEnabled && !currentTimer.enable) {\n\t\tif (!currentTimer.countUp) {\n\t\t\tthis.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1] = currentTimer.oldReload + (this.cpu.cycles - currentTimer.lastEvent) >> oldPrescale;\n\t\t}\n\t\t--this.timersEnabled;\n\t} else if (currentTimer.prescaleBits != oldPrescale && !currentTimer.countUp) {\n\t\t// FIXME: this might be before present\n\t\tcurrentTimer.nextEvent = currentTimer.lastEvent + currentTimer.overflowInterval;\n\t}\n\n\t// We've changed the timers somehow...we need to reset the next event\n\tthis.pollNextEvent();\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerRead = function(timer) {\n\tvar currentTimer = this.timers[timer];\n\tif (currentTimer.enable && !currentTimer.countUp) {\n\t\treturn currentTimer.oldReload + (this.cpu.cycles - currentTimer.lastEvent) >> currentTimer.prescaleBits;\n\t} else {\n\t\treturn this.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1];\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.halt = function() {\n\tif (!this.enable) {\n\t\tthrow \"Requested HALT when interrupts were disabled!\";\n\t}\n\tif (!this.waitForIRQ()) {\n\t\tthrow \"Waiting on interrupt forever.\";\n\t}\n}\n\nGameBoyAdvanceInterruptHandler.prototype.lz77 = function(source, dest, unitsize) {\n\t// TODO: move to a different file\n\tvar remaining = (this.cpu.mmu.load32(source) & 0xFFFFFF00) >> 8;\n\t// We assume the signature byte (0x10) is correct\n\tvar blockheader;\n\tvar sPointer = source + 4;\n\tvar dPointer = dest;\n\tvar blocksRemaining = 0;\n\tvar block;\n\tvar disp;\n\tvar bytes;\n\tvar buffer = 0;\n\tvar loaded;\n\twhile (remaining > 0) {\n\t\tif (blocksRemaining) {\n\t\t\tif (blockheader & 0x80) {\n\t\t\t\t// Compressed\n\t\t\t\tblock = this.cpu.mmu.loadU8(sPointer) | (this.cpu.mmu.loadU8(sPointer + 1) << 8);\n\t\t\t\tsPointer += 2;\n\t\t\t\tdisp = dPointer - (((block & 0x000F) << 8) | ((block & 0xFF00) >> 8)) - 1;\n\t\t\t\tbytes = ((block & 0x00F0) >> 4) + 3;\n\t\t\t\twhile (bytes-- && remaining) {\n\t\t\t\t\tloaded = this.cpu.mmu.loadU8(disp++);\n\t\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\t\tbuffer |= loaded << 8;\n\t\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cpu.mmu.store8(dPointer, loaded);\n\t\t\t\t\t}\n\t\t\t\t\t--remaining;\n\t\t\t\t\t++dPointer;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Uncompressed\n\t\t\t\tloaded = this.cpu.mmu.loadU8(sPointer++);\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= loaded << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, loaded);\n\t\t\t\t}\n\t\t\t\t--remaining;\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t\tblockheader <<= 1;\n\t\t\t--blocksRemaining;\n\t\t} else {\n\t\t\tblockheader = this.cpu.mmu.loadU8(sPointer++);\n\t\t\tblocksRemaining = 8;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.huffman = function(source, dest) {\n\tsource = source & 0xFFFFFFFC;\n\tvar header = this.cpu.mmu.load32(source);\n\tvar remaining = header >> 8;\n\tvar bits = header & 0xF;\n\tif (32 % bits) {\n\t\tthrow 'Unimplemented unaligned Huffman';\n\t}\n\tvar padding = (4 - remaining) & 0x3;\n\tremaining &= 0xFFFFFFFC;\n\t// We assume the signature byte (0x20) is correct\n\tvar tree = [];\n\tvar treesize = (this.cpu.mmu.loadU8(source + 4) << 1) + 1;\n\tvar block;\n\tvar sPointer = source + 5 + treesize;\n\tvar dPointer = dest & 0xFFFFFFFC;\n\tvar i;\n\tfor (i = 0; i < treesize; ++i) {\n\t\ttree.push(this.cpu.mmu.loadU8(source + 5 + i));\n\t}\n\tvar node;\n\tvar offset = 0;\n\tvar bitsRemaining;\n\tvar readBits;\n\tvar bitsSeen = 0;\n\tnode = tree[0];\n\twhile (remaining > 0) {\n\t\tvar bitstream = this.cpu.mmu.load32(sPointer);\n\t\tsPointer += 4;\n\t\tfor (bitsRemaining = 32; bitsRemaining > 0; --bitsRemaining, bitstream <<= 1) {\n\t\t\tif (typeof (node) === 'number') {\n\t\t\t\t// Lazily construct tree\n\t\t\t\tvar next = (offset - 1 | 1) + ((node & 0x3F) << 1) + 2;\n\t\t\t\tnode = {\n\t\t\t\t\tl: next,\n\t\t\t\t\tr: next + 1,\n\t\t\t\t\tlTerm: node & 0x80,\n\t\t\t\t\trTerm: node & 0x40\n\t\t\t\t};\n\t\t\t\ttree[offset] = node;\n\t\t\t}\n\n\t\t\tif (bitstream & 0x80000000) {\n\t\t\t\t// Go right\n\t\t\t\tif (node.rTerm) {\n\t\t\t\t\treadBits = tree[node.r];\n\t\t\t\t} else {\n\t\t\t\t\toffset = node.r;\n\t\t\t\t\tnode = tree[node.r];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Go left\n\t\t\t\tif (node.lTerm) {\n\t\t\t\t\treadBits = tree[node.l];\n\t\t\t\t} else {\n\t\t\t\t\toffset = node.l;\n\t\t\t\t\tnode = tree[offset];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tblock |= (readBits & ((1 << bits) - 1)) << bitsSeen;\n\t\t\tbitsSeen += bits;\n\t\t\toffset = 0;\n\t\t\tnode = tree[0];\n\t\t\tif (bitsSeen == 32) {\n\t\t\t\tbitsSeen = 0;\n\t\t\t\tthis.cpu.mmu.store32(dPointer, block);\n\t\t\t\tdPointer += 4;\n\t\t\t\tremaining -= 4;\n\t\t\t\tblock = 0;\n\t\t\t}\n\t\t}\n\n\t}\n\tif (padding) {\n\t\tthis.cpu.mmu.store32(dPointer, block);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.rl = function(source, dest, unitsize) {\n\tsource = source & 0xFFFFFFFC;\n\tvar remaining = (this.cpu.mmu.load32(source) & 0xFFFFFF00) >> 8;\n\tvar padding = (4 - remaining) & 0x3;\n\t// We assume the signature byte (0x30) is correct\n\tvar blockheader;\n\tvar block;\n\tvar sPointer = source + 4;\n\tvar dPointer = dest;\n\tvar buffer = 0;\n\twhile (remaining > 0) {\n\t\tblockheader = this.cpu.mmu.loadU8(sPointer++);\n\t\tif (blockheader & 0x80) {\n\t\t\t// Compressed\n\t\t\tblockheader &= 0x7F;\n\t\t\tblockheader += 3;\n\t\t\tblock = this.cpu.mmu.loadU8(sPointer++);\n\t\t\twhile (blockheader-- && remaining) {\n\t\t\t\t--remaining;\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= block << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, block);\n\t\t\t\t}\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t} else {\n\t\t\t// Uncompressed\n\t\t\tblockheader++;\n\t\t\twhile (blockheader-- && remaining) {\n\t\t\t\t--remaining;\n\t\t\t\tblock = this.cpu.mmu.loadU8(sPointer++);\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= block << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, block);\n\t\t\t\t}\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t}\n\t}\n\twhile (padding--) {\n\t\tthis.cpu.mmu.store8(dPointer++, 0);\n\t}\n};\n\nexport default GameBoyAdvanceInterruptHandler;\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nimport Serializer from './util';\r\n\r\nfunction GameBoyAdvanceIO() {\r\n\t// Video\r\n\tthis.DISPCNT = 0x000;\r\n\tthis.GREENSWP = 0x002;\r\n\tthis.DISPSTAT = 0x004;\r\n\tthis.VCOUNT = 0x006;\r\n\tthis.BG0CNT = 0x008;\r\n\tthis.BG1CNT = 0x00A;\r\n\tthis.BG2CNT = 0x00C;\r\n\tthis.BG3CNT = 0x00E;\r\n\tthis.BG0HOFS = 0x010;\r\n\tthis.BG0VOFS = 0x012;\r\n\tthis.BG1HOFS = 0x014;\r\n\tthis.BG1VOFS = 0x016;\r\n\tthis.BG2HOFS = 0x018;\r\n\tthis.BG2VOFS = 0x01A;\r\n\tthis.BG3HOFS = 0x01C;\r\n\tthis.BG3VOFS = 0x01E;\r\n\tthis.BG2PA = 0x020;\r\n\tthis.BG2PB = 0x022;\r\n\tthis.BG2PC = 0x024;\r\n\tthis.BG2PD = 0x026;\r\n\tthis.BG2X_LO = 0x028;\r\n\tthis.BG2X_HI = 0x02A;\r\n\tthis.BG2Y_LO = 0x02C;\r\n\tthis.BG2Y_HI = 0x02E;\r\n\tthis.BG3PA = 0x030;\r\n\tthis.BG3PB = 0x032;\r\n\tthis.BG3PC = 0x034;\r\n\tthis.BG3PD = 0x036;\r\n\tthis.BG3X_LO = 0x038;\r\n\tthis.BG3X_HI = 0x03A;\r\n\tthis.BG3Y_LO = 0x03C;\r\n\tthis.BG3Y_HI = 0x03E;\r\n\tthis.WIN0H = 0x040;\r\n\tthis.WIN1H = 0x042;\r\n\tthis.WIN0V = 0x044;\r\n\tthis.WIN1V = 0x046;\r\n\tthis.WININ = 0x048;\r\n\tthis.WINOUT = 0x04A;\r\n\tthis.MOSAIC = 0x04C;\r\n\tthis.BLDCNT = 0x050;\r\n\tthis.BLDALPHA = 0x052;\r\n\tthis.BLDY = 0x054;\r\n\r\n\t// Sound\r\n\tthis.SOUND1CNT_LO = 0x060;\r\n\tthis.SOUND1CNT_HI = 0x062;\r\n\tthis.SOUND1CNT_X = 0x064;\r\n\tthis.SOUND2CNT_LO = 0x068;\r\n\tthis.SOUND2CNT_HI = 0x06C;\r\n\tthis.SOUND3CNT_LO = 0x070;\r\n\tthis.SOUND3CNT_HI = 0x072;\r\n\tthis.SOUND3CNT_X = 0x074;\r\n\tthis.SOUND4CNT_LO = 0x078;\r\n\tthis.SOUND4CNT_HI = 0x07C;\r\n\tthis.SOUNDCNT_LO = 0x080;\r\n\tthis.SOUNDCNT_HI = 0x082;\r\n\tthis.SOUNDCNT_X = 0x084;\r\n\tthis.SOUNDBIAS = 0x088;\r\n\tthis.WAVE_RAM0_LO = 0x090;\r\n\tthis.WAVE_RAM0_HI = 0x092;\r\n\tthis.WAVE_RAM1_LO = 0x094;\r\n\tthis.WAVE_RAM1_HI = 0x096;\r\n\tthis.WAVE_RAM2_LO = 0x098;\r\n\tthis.WAVE_RAM2_HI = 0x09A;\r\n\tthis.WAVE_RAM3_LO = 0x09C;\r\n\tthis.WAVE_RAM3_HI = 0x09E;\r\n\tthis.FIFO_A_LO = 0x0A0;\r\n\tthis.FIFO_A_HI = 0x0A2;\r\n\tthis.FIFO_B_LO = 0x0A4;\r\n\tthis.FIFO_B_HI = 0x0A6;\r\n\r\n\t// DMA\r\n\tthis.DMA0SAD_LO = 0x0B0;\r\n\tthis.DMA0SAD_HI = 0x0B2;\r\n\tthis.DMA0DAD_LO = 0x0B4;\r\n\tthis.DMA0DAD_HI = 0x0B6;\r\n\tthis.DMA0CNT_LO = 0x0B8;\r\n\tthis.DMA0CNT_HI = 0x0BA;\r\n\tthis.DMA1SAD_LO = 0x0BC;\r\n\tthis.DMA1SAD_HI = 0x0BE;\r\n\tthis.DMA1DAD_LO = 0x0C0;\r\n\tthis.DMA1DAD_HI = 0x0C2;\r\n\tthis.DMA1CNT_LO = 0x0C4;\r\n\tthis.DMA1CNT_HI = 0x0C6;\r\n\tthis.DMA2SAD_LO = 0x0C8;\r\n\tthis.DMA2SAD_HI = 0x0CA;\r\n\tthis.DMA2DAD_LO = 0x0CC;\r\n\tthis.DMA2DAD_HI = 0x0CE;\r\n\tthis.DMA2CNT_LO = 0x0D0;\r\n\tthis.DMA2CNT_HI = 0x0D2;\r\n\tthis.DMA3SAD_LO = 0x0D4;\r\n\tthis.DMA3SAD_HI = 0x0D6;\r\n\tthis.DMA3DAD_LO = 0x0D8;\r\n\tthis.DMA3DAD_HI = 0x0DA;\r\n\tthis.DMA3CNT_LO = 0x0DC;\r\n\tthis.DMA3CNT_HI = 0x0DE;\r\n\r\n\t// Timers\r\n\tthis.TM0CNT_LO = 0x100;\r\n\tthis.TM0CNT_HI = 0x102;\r\n\tthis.TM1CNT_LO = 0x104;\r\n\tthis.TM1CNT_HI = 0x106;\r\n\tthis.TM2CNT_LO = 0x108;\r\n\tthis.TM2CNT_HI = 0x10A;\r\n\tthis.TM3CNT_LO = 0x10C;\r\n\tthis.TM3CNT_HI = 0x10E;\r\n\r\n\t// SIO (note: some of these are repeated)\r\n\tthis.SIODATA32_LO = 0x120;\r\n\tthis.SIOMULTI0 = 0x120;\r\n\tthis.SIODATA32_HI = 0x122;\r\n\tthis.SIOMULTI1 = 0x122;\r\n\tthis.SIOMULTI2 = 0x124;\r\n\tthis.SIOMULTI3 = 0x126;\r\n\tthis.SIOCNT = 0x128;\r\n\tthis.SIOMLT_SEND = 0x12A;\r\n\tthis.SIODATA8 = 0x12A;\r\n\tthis.RCNT = 0x134;\r\n\tthis.JOYCNT = 0x140;\r\n\tthis.JOY_RECV = 0x150;\r\n\tthis.JOY_TRANS = 0x154;\r\n\tthis.JOYSTAT = 0x158;\r\n\r\n\t// Keypad\r\n\tthis.KEYINPUT = 0x130;\r\n\tthis.KEYCNT = 0x132;\r\n\r\n\t// Interrupts, etc\r\n\tthis.IE = 0x200;\r\n\tthis.IF = 0x202;\r\n\tthis.WAITCNT = 0x204;\r\n\tthis.IME = 0x208;\r\n\r\n\tthis.POSTFLG = 0x300;\r\n\tthis.HALTCNT = 0x301;\r\n\r\n\tthis.DEFAULT_DISPCNT = 0x0080;\r\n\tthis.DEFAULT_SOUNDBIAS = 0x200;\r\n\tthis.DEFAULT_BGPA = 1;\r\n\tthis.DEFAULT_BGPD = 1;\r\n\tthis.DEFAULT_RCNT = 0x8000;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.clear = function() {\r\n\tthis.registers = new Uint16Array(this.cpu.mmu.SIZE_IO);\r\n\r\n\tthis.registers[this.DISPCNT >> 1] = this.DEFAULT_DISPCNT;\r\n\tthis.registers[this.SOUNDBIAS >> 1] = this.DEFAULT_SOUNDBIAS;\r\n\tthis.registers[this.BG2PA >> 1] = this.DEFAULT_BGPA;\r\n\tthis.registers[this.BG2PD >> 1] = this.DEFAULT_BGPD;\r\n\tthis.registers[this.BG3PA >> 1] = this.DEFAULT_BGPA;\r\n\tthis.registers[this.BG3PD >> 1] = this.DEFAULT_BGPD;\r\n\tthis.registers[this.RCNT >> 1] = this.DEFAULT_RCNT;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.freeze = function() {\r\n\treturn {\r\n\t\t'registers': Serializer.prefix(this.registers.buffer)\r\n\t};\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.defrost = function(frost) {\r\n\tthis.registers = new Uint16Array(frost.registers);\r\n\t// Video registers don't serialize themselves\r\n\tfor (var i = 0; i <= this.BLDY; i += 2) {\r\n\t\tthis.store16(this.registers[i >> 1]);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.load8 = function(offset) {\r\n\tthrow 'Unimplmeneted unaligned I/O access';\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.load16 = function(offset) {\r\n\treturn (this.loadU16(offset) << 16) >> 16;\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.load32 = function(offset) {\r\n\toffset &= 0xFFFFFFFC;\r\n\tswitch (offset) {\r\n\tcase this.DMA0CNT_LO:\r\n\tcase this.DMA1CNT_LO:\r\n\tcase this.DMA2CNT_LO:\r\n\tcase this.DMA3CNT_LO:\r\n\t\treturn this.loadU16(offset | 2) << 16;\r\n\tcase this.IME:\r\n\t\treturn this.loadU16(offset) & 0xFFFF;\r\n\tcase this.JOY_RECV:\r\n\tcase this.JOY_TRANS:\r\n \t\tthis.core.STUB('Unimplemented JOY register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\t}\r\n\r\n\treturn this.loadU16(offset) | (this.loadU16(offset | 2) << 16);\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.loadU8 = function(offset) {\r\n\tvar odd = offset & 0x0001;\r\n\tvar value = this.loadU16(offset & 0xFFFE);\r\n\treturn (value >>> (odd << 3)) & 0xFF;\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.loadU16 = function(offset) {\r\n\tswitch (offset) {\r\n\tcase this.DISPCNT:\r\n\tcase this.BG0CNT:\r\n\tcase this.BG1CNT:\r\n\tcase this.BG2CNT:\r\n\tcase this.BG3CNT:\r\n\tcase this.WININ:\r\n\tcase this.WINOUT:\r\n\tcase this.SOUND1CNT_LO:\r\n\tcase this.SOUND3CNT_LO:\r\n\tcase this.SOUNDCNT_LO:\r\n\tcase this.SOUNDCNT_HI:\r\n\tcase this.SOUNDBIAS:\r\n\tcase this.BLDCNT:\r\n\tcase this.BLDALPHA:\r\n\r\n\tcase this.TM0CNT_HI:\r\n\tcase this.TM1CNT_HI:\r\n\tcase this.TM2CNT_HI:\r\n\tcase this.TM3CNT_HI:\r\n\tcase this.DMA0CNT_HI:\r\n\tcase this.DMA1CNT_HI:\r\n\tcase this.DMA2CNT_HI:\r\n\tcase this.DMA3CNT_HI:\r\n\tcase this.RCNT:\r\n\tcase this.WAITCNT:\r\n\tcase this.IE:\r\n\tcase this.IF:\r\n\tcase this.IME:\r\n\tcase this.POSTFLG:\r\n\t\t// Handled transparently by the written registers\r\n\t\tbreak;\r\n\r\n\t// Video\r\n\tcase this.DISPSTAT:\r\n\t\treturn this.registers[offset >> 1] | this.video.readDisplayStat();\r\n\tcase this.VCOUNT:\r\n\t\treturn this.video.vcount;\r\n\r\n\t// Sound\r\n\tcase this.SOUND1CNT_HI:\r\n\tcase this.SOUND2CNT_LO:\r\n\t\treturn this.registers[offset >> 1] & 0xFFC0;\r\n\tcase this.SOUND1CNT_X:\r\n\tcase this.SOUND2CNT_HI:\r\n\tcase this.SOUND3CNT_X:\r\n\t\treturn this.registers[offset >> 1] & 0x4000;\r\n\tcase this.SOUND3CNT_HI:\r\n\t\treturn this.registers[offset >> 1] & 0xE000;\r\n\tcase this.SOUND4CNT_LO:\r\n\t\treturn this.registers[offset >> 1] & 0xFF00;\r\n\tcase this.SOUND4CNT_HI:\r\n\t\treturn this.registers[offset >> 1] & 0x40FF;\r\n\tcase this.SOUNDCNT_X:\r\n\t\tthis.core.STUB('Unimplemented sound register read: SOUNDCNT_X');\r\n\t\treturn this.registers[offset >> 1] | 0x0000;\r\n\r\n\t// Timers\r\n\tcase this.TM0CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(0);\r\n\tcase this.TM1CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(1);\r\n\tcase this.TM2CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(2);\r\n\tcase this.TM3CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(3);\r\n\r\n\t// SIO\r\n\tcase this.SIOCNT:\r\n\t\treturn this.sio.readSIOCNT();\r\n\r\n\tcase this.KEYINPUT:\r\n\t\tthis.keypad.pollGamepads();\r\n\t\treturn this.keypad.currentDown;\r\n\tcase this.KEYCNT:\r\n\t\tthis.core.STUB('Unimplemented I/O register read: KEYCNT');\r\n\t\treturn 0;\r\n\r\n\tcase this.BG0HOFS:\r\n\tcase this.BG0VOFS:\r\n\tcase this.BG1HOFS:\r\n\tcase this.BG1VOFS:\r\n\tcase this.BG2HOFS:\r\n\tcase this.BG2VOFS:\r\n\tcase this.BG3HOFS:\r\n\tcase this.BG3VOFS:\r\n\tcase this.BG2PA:\r\n\tcase this.BG2PB:\r\n\tcase this.BG2PC:\r\n\tcase this.BG2PD:\r\n\tcase this.BG3PA:\r\n\tcase this.BG3PB:\r\n\tcase this.BG3PC:\r\n\tcase this.BG3PD:\r\n\tcase this.BG2X_LO:\r\n\tcase this.BG2X_HI:\r\n\tcase this.BG2Y_LO:\r\n\tcase this.BG2Y_HI:\r\n\tcase this.BG3X_LO:\r\n\tcase this.BG3X_HI:\r\n\tcase this.BG3Y_LO:\r\n\tcase this.BG3Y_HI:\r\n\tcase this.WIN0H:\r\n\tcase this.WIN1H:\r\n\tcase this.WIN0V:\r\n\tcase this.WIN1V:\r\n\tcase this.BLDY:\r\n\tcase this.DMA0SAD_LO:\r\n\tcase this.DMA0SAD_HI:\r\n\tcase this.DMA0DAD_LO:\r\n\tcase this.DMA0DAD_HI:\r\n\tcase this.DMA0CNT_LO:\r\n\tcase this.DMA1SAD_LO:\r\n\tcase this.DMA1SAD_HI:\r\n\tcase this.DMA1DAD_LO:\r\n\tcase this.DMA1DAD_HI:\r\n\tcase this.DMA1CNT_LO:\r\n\tcase this.DMA2SAD_LO:\r\n\tcase this.DMA2SAD_HI:\r\n\tcase this.DMA2DAD_LO:\r\n\tcase this.DMA2DAD_HI:\r\n\tcase this.DMA2CNT_LO:\r\n\tcase this.DMA3SAD_LO:\r\n\tcase this.DMA3SAD_HI:\r\n\tcase this.DMA3DAD_LO:\r\n\tcase this.DMA3DAD_HI:\r\n\tcase this.DMA3CNT_LO:\r\n\tcase this.FIFO_A_LO:\r\n\tcase this.FIFO_A_HI:\r\n\tcase this.FIFO_B_LO:\r\n\tcase this.FIFO_B_HI:\r\n\t\tthis.core.WARN('Read for write-only register: 0x' + offset.toString(16));\r\n\t\treturn this.core.mmu.badMemory.loadU16(0);\r\n\r\n\tcase this.MOSAIC:\r\n\t\tthis.core.WARN('Read for write-only register: 0x' + offset.toString(16));\r\n\t\treturn 0;\r\n\r\n\tcase this.SIOMULTI0:\r\n \tcase this.SIOMULTI1:\r\n \tcase this.SIOMULTI2:\r\n \tcase this.SIOMULTI3:\r\n \t\treturn this.sio.read((offset - this.SIOMULTI0) >> 1);\r\n\r\n \tcase this.SIODATA8:\r\n \t\tthis.core.STUB('Unimplemented SIO register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\tcase this.JOYCNT:\r\n\tcase this.JOYSTAT:\r\n \t\tthis.core.STUB('Unimplemented JOY register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\r\n\tdefault:\r\n\t\tthis.core.WARN('Bad I/O register read: 0x' + offset.toString(16));\r\n\t\treturn this.core.mmu.badMemory.loadU16(0);\r\n\t}\r\n\treturn this.registers[offset >> 1];\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store8 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase this.WININ:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WININ | 1:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WINOUT:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WINOUT | 1:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_LO:\r\n\tcase this.SOUND1CNT_LO | 1:\r\n\tcase this.SOUND1CNT_HI:\r\n\tcase this.SOUND1CNT_HI | 1:\r\n\tcase this.SOUND1CNT_X:\r\n\tcase this.SOUND1CNT_X | 1:\r\n\tcase this.SOUND2CNT_LO:\r\n\tcase this.SOUND2CNT_LO | 1:\r\n\tcase this.SOUND2CNT_HI:\r\n\tcase this.SOUND2CNT_HI | 1:\r\n\tcase this.SOUND3CNT_LO:\r\n\tcase this.SOUND3CNT_LO | 1:\r\n\tcase this.SOUND3CNT_HI:\r\n\tcase this.SOUND3CNT_HI | 1:\r\n\tcase this.SOUND3CNT_X:\r\n\tcase this.SOUND3CNT_X | 1:\r\n\tcase this.SOUND4CNT_LO:\r\n\tcase this.SOUND4CNT_LO | 1:\r\n\tcase this.SOUND4CNT_HI:\r\n\tcase this.SOUND4CNT_HI | 1:\r\n\tcase this.SOUNDCNT_LO:\r\n\tcase this.SOUNDCNT_LO | 1:\r\n\tcase this.SOUNDCNT_X:\r\n\tcase this.IF:\r\n\tcase this.IME:\r\n\t\tbreak;\r\n\tcase this.SOUNDBIAS | 1:\r\n\t\tthis.STUB_REG('sound', offset);\r\n\t\tbreak;\r\n\tcase this.HALTCNT:\r\n\t\tvalue &= 0x80;\r\n\t\tif (!value) {\r\n\t\t\tthis.core.irq.halt();\r\n\t\t} else {\r\n\t\t\tthis.core.STUB('Stop');\r\n\t\t}\r\n\t\treturn;\r\n\tdefault:\r\n\t\tthis.STUB_REG('8-bit I/O', offset);\r\n\t\tbreak;\r\n\t}\r\n\r\n\tif (offset & 1) {\r\n\t\tvalue <<= 8;\r\n\t\tvalue |= (this.registers[offset >> 1] & 0x00FF);\r\n\t} else {\r\n\t\tvalue &= 0x00FF;\r\n\t\tvalue |= (this.registers[offset >> 1] & 0xFF00);\r\n\t}\r\n\tthis.store16(offset & 0xFFFFFFE, value);\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store16 = function(offset, value) {\r\n\tswitch (offset) {\r\n\t// Video\r\n\tcase this.DISPCNT:\r\n\t\tthis.video.renderPath.writeDisplayControl(value);\r\n\t\tbreak;\r\n\tcase this.DISPSTAT:\r\n\t\tvalue &= this.video.DISPSTAT_MASK;\r\n\t\tthis.video.writeDisplayStat(value);\r\n\t\tbreak;\r\n\tcase this.BG0CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(0, value);\r\n\t\tbreak;\r\n\tcase this.BG1CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(1, value);\r\n\t\tbreak;\r\n\tcase this.BG2CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(3, value);\r\n\t\tbreak;\r\n\tcase this.BG0HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(0, value);\r\n\t\tbreak;\r\n\tcase this.BG0VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(0, value);\r\n\t\tbreak;\r\n\tcase this.BG1HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(1, value);\r\n\t\tbreak;\r\n\tcase this.BG1VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(1, value);\r\n\t\tbreak;\r\n\tcase this.BG2HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(3, value);\r\n\t\tbreak;\r\n\tcase this.BG2X_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG2X_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG2Y_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG2Y_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG2PA:\r\n\t\tthis.video.renderPath.writeBackgroundParamA(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PB:\r\n\t\tthis.video.renderPath.writeBackgroundParamB(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PC:\r\n\t\tthis.video.renderPath.writeBackgroundParamC(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PD:\r\n\t\tthis.video.renderPath.writeBackgroundParamD(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3X_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG3X_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG3Y_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG3Y_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG3PA:\r\n\t\tthis.video.renderPath.writeBackgroundParamA(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PB:\r\n\t\tthis.video.renderPath.writeBackgroundParamB(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PC:\r\n\t\tthis.video.renderPath.writeBackgroundParamC(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PD:\r\n\t\tthis.video.renderPath.writeBackgroundParamD(3, value);\r\n\t\tbreak;\r\n\tcase this.WIN0H:\r\n\t\tthis.video.renderPath.writeWin0H(value);\r\n\t\tbreak;\r\n\tcase this.WIN1H:\r\n\t\tthis.video.renderPath.writeWin1H(value);\r\n\t\tbreak;\r\n\tcase this.WIN0V:\r\n\t\tthis.video.renderPath.writeWin0V(value);\r\n\t\tbreak;\r\n\tcase this.WIN1V:\r\n\t\tthis.video.renderPath.writeWin1V(value);\r\n\t\tbreak;\r\n\tcase this.WININ:\r\n\t\tvalue &= 0x3F3F;\r\n\t\tthis.video.renderPath.writeWinIn(value);\r\n\t\tbreak;\r\n\tcase this.WINOUT:\r\n\t\tvalue &= 0x3F3F;\r\n\t\tthis.video.renderPath.writeWinOut(value);\r\n\t\tbreak;\r\n\tcase this.BLDCNT:\r\n\t\tvalue &= 0x7FFF;\r\n\t\tthis.video.renderPath.writeBlendControl(value);\r\n\t\tbreak;\r\n\tcase this.BLDALPHA:\r\n\t\tvalue &= 0x1F1F;\r\n\t\tthis.video.renderPath.writeBlendAlpha(value);\r\n\t\tbreak;\r\n\tcase this.BLDY:\r\n\t\tvalue &= 0x001F;\r\n\t\tthis.video.renderPath.writeBlendY(value);\r\n\t\tbreak;\r\n\tcase this.MOSAIC:\r\n\t\tthis.video.renderPath.writeMosaic(value);\r\n\t\tbreak;\r\n\r\n\t// Sound\r\n\tcase this.SOUND1CNT_LO:\r\n\t\tvalue &= 0x007F;\r\n\t\tthis.audio.writeSquareChannelSweep(0, value);\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_HI:\r\n\t\tthis.audio.writeSquareChannelDLE(0, value);\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_X:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeSquareChannelFC(0, value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND2CNT_LO:\r\n\t\tthis.audio.writeSquareChannelDLE(1, value);\r\n\t\tbreak;\r\n\tcase this.SOUND2CNT_HI:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeSquareChannelFC(1, value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_LO:\r\n\t\tvalue &= 0x00E0;\r\n\t\tthis.audio.writeChannel3Lo(value);\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_HI:\r\n\t\tvalue &= 0xE0FF;\r\n\t\tthis.audio.writeChannel3Hi(value);\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_X:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeChannel3X(value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND4CNT_LO:\r\n\t\tvalue &= 0xFF3F;\r\n\t\tthis.audio.writeChannel4LE(value);\r\n\t\tbreak;\r\n\tcase this.SOUND4CNT_HI:\r\n\t\tvalue &= 0xC0FF;\r\n\t\tthis.audio.writeChannel4FC(value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_LO:\r\n\t\tvalue &= 0xFF77;\r\n\t\tthis.audio.writeSoundControlLo(value);\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_HI:\r\n\t\tvalue &= 0xFF0F;\r\n\t\tthis.audio.writeSoundControlHi(value);\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_X:\r\n\t\tvalue &= 0x0080;\r\n\t\tthis.audio.writeEnable(value);\r\n\t\tbreak;\r\n\tcase this.WAVE_RAM0_LO:\r\n\tcase this.WAVE_RAM0_HI:\r\n\tcase this.WAVE_RAM1_LO:\r\n\tcase this.WAVE_RAM1_HI:\r\n\tcase this.WAVE_RAM2_LO:\r\n\tcase this.WAVE_RAM2_HI:\r\n\tcase this.WAVE_RAM3_LO:\r\n\tcase this.WAVE_RAM3_HI:\r\n\t\tthis.audio.writeWaveData(offset - this.WAVE_RAM0_LO, value, 2);\r\n\t\tbreak;\r\n\r\n\t// DMA\r\n\tcase this.DMA0SAD_LO:\r\n\tcase this.DMA0DAD_LO:\r\n\tcase this.DMA1SAD_LO:\r\n\tcase this.DMA1DAD_LO:\r\n\tcase this.DMA2SAD_LO:\r\n\tcase this.DMA2DAD_LO:\r\n\tcase this.DMA3SAD_LO:\r\n\tcase this.DMA3DAD_LO:\r\n\t\tthis.store32(offset, (this.registers[(offset >> 1) + 1] << 16) | value);\r\n\t\treturn;\r\n\r\n\tcase this.DMA0SAD_HI:\r\n\tcase this.DMA0DAD_HI:\r\n\tcase this.DMA1SAD_HI:\r\n\tcase this.DMA1DAD_HI:\r\n\tcase this.DMA2SAD_HI:\r\n\tcase this.DMA2DAD_HI:\r\n\tcase this.DMA3SAD_HI:\r\n\tcase this.DMA3DAD_HI:\r\n\t\tthis.store32(offset - 2, this.registers[(offset >> 1) - 1] | (value << 16));\r\n\t\treturn;\r\n\r\n\tcase this.DMA0CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA0CNT_HI:\r\n\t\t// The DMA registers need to set the values before writing the control, as writing the\r\n\t\t// control can synchronously trigger a DMA transfer\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(0, value);\r\n\t\treturn;\r\n\tcase this.DMA1CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA1CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(1, value);\r\n\t\treturn;\r\n\tcase this.DMA2CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA2CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(2, value);\r\n\t\treturn;\r\n\tcase this.DMA3CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA3CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(3, value);\r\n\t\treturn;\r\n\r\n\t// Timers\r\n\tcase this.TM0CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(0, value);\r\n\t\treturn;\r\n\tcase this.TM1CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(1, value);\r\n\t\treturn;\r\n\tcase this.TM2CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(2, value);\r\n\t\treturn;\r\n\tcase this.TM3CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(3, value);\r\n\t\treturn;\r\n\r\n\tcase this.TM0CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(0, value);\r\n\t\tbreak;\r\n\tcase this.TM1CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(1, value);\r\n\t\tbreak;\r\n\tcase this.TM2CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(2, value);\r\n\t\tbreak;\r\n\tcase this.TM3CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(3, value);\r\n\t\tbreak;\r\n\r\n\t// SIO\r\n\tcase this.SIOMULTI0:\r\n \tcase this.SIOMULTI1:\r\n \tcase this.SIOMULTI2:\r\n \tcase this.SIOMULTI3:\r\n \tcase this.SIODATA8:\r\n \t\tthis.STUB_REG('SIO', offset);\r\n \t\tbreak;\r\n\tcase this.RCNT:\r\n\t\tthis.sio.setMode(((value >> 12) & 0xC) | ((this.registers[this.SIOCNT >> 1] >> 12) & 0x3));\r\n\t\tthis.sio.writeRCNT(value);\r\n\t\tbreak;\r\n\tcase this.SIOCNT:\r\n\t\tthis.sio.setMode(((value >> 12) & 0x3) | ((this.registers[this.RCNT >> 1] >> 12) & 0xC));\r\n\t\tthis.sio.writeSIOCNT(value);\r\n\t\treturn;\r\n\tcase this.JOYCNT:\r\n\tcase this.JOYSTAT:\r\n\t\tthis.STUB_REG('JOY', offset);\r\n\t\tbreak;\r\n\r\n\t// Misc\r\n\tcase this.IE:\r\n\t\tvalue &= 0x3FFF;\r\n\t\tthis.cpu.irq.setInterruptsEnabled(value);\r\n\t\tbreak;\r\n\tcase this.IF:\r\n\t\tthis.cpu.irq.dismissIRQs(value);\r\n\t\treturn;\r\n\tcase this.WAITCNT:\r\n\t\tvalue &= 0xDFFF;\r\n\t\tthis.cpu.mmu.adjustTimings(value);\r\n\t\tbreak;\r\n\tcase this.IME:\r\n\t\tvalue &= 0x0001;\r\n\t\tthis.cpu.irq.masterEnable(value);\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.STUB_REG('I/O', offset);\r\n\t}\r\n\tthis.registers[offset >> 1] = value;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store32 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase this.BG2X_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2Y_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3X_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3Y_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA0SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA0DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA1SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA1DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA2SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA2DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA3SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA3DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(3, value);\r\n\t\tbreak;\r\n\tcase this.FIFO_A_LO:\r\n\t\tthis.audio.appendToFifoA(value);\r\n\t\treturn;\r\n\tcase this.FIFO_B_LO:\r\n\t\tthis.audio.appendToFifoB(value);\r\n\t\treturn;\r\n\r\n\t// High bits of this write should be ignored\r\n\tcase this.IME:\r\n\t\tthis.store16(offset, value & 0xFFFF);\r\n\t\treturn;\r\n\tcase this.JOY_RECV:\r\n\tcase this.JOY_TRANS:\r\n\t\tthis.STUB_REG('JOY', offset);\r\n\t\treturn;\r\n\tdefault:\r\n\t\tthis.store16(offset, value & 0xFFFF);\r\n\t\tthis.store16(offset | 2, value >>> 16);\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.registers[offset >> 1] = value & 0xFFFF;\r\n\tthis.registers[(offset >> 1) + 1] = value >>> 16;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.invalidatePage = function(address) {};\r\n\r\nGameBoyAdvanceIO.prototype.STUB_REG = function(type, offset) {\r\n\tthis.core.STUB('Unimplemented ' + type + ' register write: ' + offset.toString(16));\r\n};\r\n\r\nexport default GameBoyAdvanceIO;\r\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nfunction GameBoyAdvanceAudio() {\r\n\tthis.masterEnable = false;\r\n\tthis.masterVolume = 0;\r\n\r\n\tthis.SOUND_MAX = 0x400;\r\n\tthis.FIFO_MAX = 0x200;\r\n\tthis.PSG_MAX = 0x080;\r\n\r\n\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\tif (window.AudioContext) {\r\n\t\tthis.context = new AudioContext();\r\n\t\tthis.bufferSize = 0;\r\n\t\tthis.bufferSize = 4096;\r\n\t\tthis.maxSamples = this.bufferSize << 2;\r\n\t\tthis.buffers = [new Float32Array(this.maxSamples), new Float32Array(this.maxSamples)];\r\n\t\tthis.sampleMask = this.maxSamples - 1;\r\n\t\tif (this.context.createScriptProcessor) {\r\n\t\t\tthis.jsAudio = this.context.createScriptProcessor(this.bufferSize);\r\n\t\t} else {\r\n\t\t\tthis.jsAudio = this.context.createJavaScriptNode(this.bufferSize);\r\n\t\t}\r\n\r\n\t\tthis.audioProcess = function(audioProcessingEvent) {\r\n\t\t\tvar left = audioProcessingEvent.outputBuffer.getChannelData(0);\r\n\t\t\tvar right = audioProcessingEvent.outputBuffer.getChannelData(1);\r\n\t\t\tif (this.masterEnable) {\r\n\t\t\t\tvar i;\r\n\t\t\t\tvar o = this.outputPointer;\r\n\t\t\t\tfor (i = 0; i < this.bufferSize; ++i, o += this.resampleRatio) {\r\n\t\t\t\t\tif (o >= this.maxSamples) {\r\n\t\t\t\t\t\to -= this.maxSamples;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((o | 0) == this.samplePointer) {\r\n\t\t\t\t\t\t++this.backup;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tleft[i] = this.buffers[0][o | 0];\r\n\t\t\t\t\tright[i] = this.buffers[1][o | 0];\r\n\t\t\t\t}\r\n\t\t\t\tfor (; i < this.bufferSize; ++i) {\r\n\t\t\t\t\tleft[i] = 0;\r\n\t\t\t\t\tright[i] = 0;\r\n\t\t\t\t}\r\n\t\t\t\tthis.outputPointer = o;\r\n\t\t\t\t++this.totalSamples;\r\n\t\t\t} else {\r\n\t\t\t\tfor (i = 0; i < this.bufferSize; ++i) {\r\n\t\t\t\t\tleft[i] = 0;\r\n\t\t\t\t\tright[i] = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.jsAudio.onaudioprocess = (e) => {\r\n\t\t\tthis.audioProcess(e);\r\n\t\t};\r\n\t} else {\r\n\t\tthis.context = null;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.clear = function() {\r\n\tthis.fifoA = [];\r\n\tthis.fifoB = [];\r\n\tthis.fifoASample = 0;\r\n\tthis.fifoBSample = 0;\r\n\r\n\tthis.enabled = false;\r\n\tif (this.context) {\r\n\t\ttry {\r\n\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t} catch (e) {\r\n\t\t}\r\n\t}\r\n\r\n\tthis.enableChannel3 = false;\r\n\tthis.enableChannel4 = false;\r\n\tthis.enableChannelA = false;\r\n\tthis.enableChannelB = false;\r\n\tthis.enableRightChannelA = false;\r\n\tthis.enableLeftChannelA = false;\r\n\tthis.enableRightChannelB = false;\r\n\tthis.enableLeftChannelB = false;\r\n\r\n\tthis.playingChannel3 = false;\r\n\tthis.playingChannel4 = false;\r\n\r\n\tthis.volumeLeft = 0;\r\n\tthis.volumeRight = 0;\r\n\tthis.ratioChannelA = 1;\r\n\tthis.ratioChannelB = 1;\r\n\tthis.enabledLeft = 0;\r\n\tthis.enabledRight = 0;\r\n\r\n\tthis.dmaA = -1;\r\n\tthis.dmaB = -1;\r\n\tthis.soundTimerA = 0;\r\n\tthis.soundTimerB = 0;\r\n\r\n\tthis.soundRatio = 1;\r\n\tthis.soundBias = 0x200;\r\n\r\n\tthis.squareChannels = new Array();\r\n\tfor (var i = 0; i < 2; ++i) {\r\n\t\tthis.squareChannels[i] = {\r\n\t\t\tenabled: false,\r\n\t\t\tplaying: false,\r\n\t\t\tsample: 0,\r\n\t\t\tduty: 0.5,\r\n\t\t\tincrement: 0,\r\n\t\t\tstep: 0,\r\n\t\t\tinitialVolume: 0,\r\n\t\t\tvolume: 0,\r\n\t\t\tfrequency: 0,\r\n\t\t\tinterval: 0,\r\n\t\t\tsweepSteps: 0,\r\n\t\t\tsweepIncrement: 0,\r\n\t\t\tsweepInterval: 0,\r\n\t\t\tdoSweep: false,\r\n\t\t\traise: 0,\r\n\t\t\tlower: 0,\r\n\t\t\tnextStep: 0,\r\n\t\t\ttimed: false,\r\n\t\t\tlength: 0,\r\n\t\t\tend: 0\r\n\t\t}\r\n\t}\r\n\r\n\tthis.waveData = new Uint8Array(32);\r\n\tthis.channel3Dimension = 0;\r\n\tthis.channel3Bank = 0;\r\n\tthis.channel3Volume = 0;\r\n\tthis.channel3Interval = 0;\r\n\tthis.channel3Next = 0;\r\n\tthis.channel3Length = 0;\r\n\tthis.channel3Timed = false;\r\n\tthis.channel3End = 0;\r\n\tthis.channel3Pointer =0;\r\n\tthis.channel3Sample = 0;\r\n\r\n\tthis.cpuFrequency = this.core.irq.FREQUENCY;\r\n\r\n\tthis.channel4 = {\r\n\t\tsample: 0,\r\n\t\tlfsr: 0,\r\n\t\twidth: 15,\r\n\t\tinterval: this.cpuFrequency / 524288,\r\n\t\tincrement: 0,\r\n\t\tstep: 0,\r\n\t\tinitialVolume: 0,\r\n\t\tvolume: 0,\r\n\t\tnextStep: 0,\r\n\t\ttimed: false,\r\n\t\tlength: 0,\r\n\t\tend: 0\r\n\t};\r\n\r\n\tthis.nextEvent = 0;\r\n\r\n\tthis.nextSample = 0;\r\n\tthis.outputPointer = 0;\r\n\tthis.samplePointer = 0;\r\n\r\n\tthis.backup = 0;\r\n\tthis.totalSamples = 0;\r\n\r\n\tthis.sampleRate = 32768;\r\n\tthis.sampleInterval = this.cpuFrequency / this.sampleRate;\r\n\tthis.resampleRatio = 1;\r\n\tif (this.context) {\r\n\t\tthis.resampleRatio = this.sampleRate / this.context.sampleRate;\r\n\t}\r\n\r\n\tthis.writeSquareChannelFC(0, 0);\r\n\tthis.writeSquareChannelFC(1, 0);\r\n\tthis.writeChannel4FC(0);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.freeze = function() {\r\n\treturn {\r\n\t\tnextSample: this.nextSample\r\n\t};\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.defrost = function(frost) {\r\n\tthis.nextSample = frost.nextSample;\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.pause = function(paused) {\r\n\tif (this.context) {\r\n\t\tif (paused) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Sigh\r\n\t\t\t}\r\n\t\t} else if (this.enabled) {\r\n\t\t\tthis.jsAudio.connect(this.context.destination);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateTimers = function() {\r\n\tvar cycles = this.cpu.cycles;\r\n\tif (!this.enabled || (cycles < this.nextEvent && cycles < this.nextSample)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (cycles >= this.nextEvent) {\r\n\t\tvar channel = this.squareChannels[0];\r\n\t\tthis.nextEvent = Infinity;\r\n\t\tif (channel.playing) {\r\n\t\t\tthis.updateSquareChannel(channel, cycles);\r\n\t\t}\r\n\r\n\t\tchannel = this.squareChannels[1];\r\n\t\tif (channel.playing) {\r\n\t\t\tthis.updateSquareChannel(channel, cycles);\r\n\t\t}\r\n\r\n\t\tif (this.enableChannel3 && this.playingChannel3) {\r\n\t\t\tif (cycles >= this.channel3Next) {\r\n\t\t\t\tif (this.channel3Write) {\r\n\t\t\t\t\tvar sample = this.waveData[this.channel3Pointer >> 1];\r\n\t\t\t\t\tthis.channel3Sample = (((sample >> ((this.channel3Pointer & 1) << 2)) & 0xF) - 0x8) / 8;\r\n\t\t\t\t\tthis.channel3Pointer = (this.channel3Pointer + 1);\r\n\t\t\t\t\tif (this.channel3Dimension && this.channel3Pointer >= 64) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 64;\r\n\t\t\t\t\t} else if (!this.channel3Bank && this.channel3Pointer >= 32) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 32;\r\n\t\t\t\t\t} else if (this.channel3Pointer >= 64) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 32;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.channel3Next += this.channel3Interval;\r\n\t\t\t\tif (this.channel3Interval && this.nextEvent > this.channel3Next) {\r\n\t\t\t\t\tthis.nextEvent = this.channel3Next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.channel3Timed && cycles >= this.channel3End) {\r\n\t\t\t\tthis.playingChannel3 = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.enableChannel4 && this.playingChannel4) {\r\n\t\t\tif (this.channel4.timed && cycles >= this.channel4.end) {\r\n\t\t\t\tthis.playingChannel4 = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (cycles >= this.channel4.next) {\r\n\t\t\t\t\tthis.channel4.lfsr >>= 1;\r\n\t\t\t\t\tvar sample = this.channel4.lfsr & 1;\r\n\t\t\t\t\tthis.channel4.lfsr |= (((this.channel4.lfsr >> 1) & 1) ^ sample) << (this.channel4.width - 1);\r\n\t\t\t\t\tthis.channel4.next += this.channel4.interval;\r\n\t\t\t\t\tthis.channel4.sample = (sample - 0.5) * 2 * this.channel4.volume;\r\n\t\t\t\t}\r\n\t\t\t\tthis.updateEnvelope(this.channel4, cycles);\r\n\t\t\t\tif (this.nextEvent > this.channel4.next) {\r\n\t\t\t\t\tthis.nextEvent = this.channel4.next;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.channel4.timed && this.nextEvent > this.channel4.end) {\r\n\t\t\t\t\tthis.nextEvent = this.channel4.end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (cycles >= this.nextSample) {\r\n\t\tthis.sample();\r\n\t\tthis.nextSample += this.sampleInterval;\r\n\t}\r\n\r\n\tthis.nextEvent = Math.ceil(this.nextEvent);\r\n\tif ((this.nextEvent < cycles) || (this.nextSample < cycles)) {\r\n\t\t// STM instructions may take a long time\r\n\t\tthis.updateTimers();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeEnable = function(value) {\r\n\tthis.enabled = !!value;\r\n\tthis.nextEvent = this.cpu.cycles;\r\n\tthis.nextSample = this.nextEvent;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n\tif (this.context) {\r\n\t\tif (value) {\r\n\t\t\tthis.jsAudio.connect(this.context.destination);\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t\t} catch (e) {\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSoundControlLo = function(value) {\r\n\tthis.masterVolumeLeft = value & 0x7;\r\n\tthis.masterVolumeRight = (value >> 4) & 0x7;\r\n\tthis.enabledLeft = (value >> 8) & 0xF;\r\n\tthis.enabledRight = (value >> 12) & 0xF;\r\n\r\n\tthis.setSquareChannelEnabled(this.squareChannels[0], (this.enabledLeft | this.enabledRight) & 0x1);\r\n\tthis.setSquareChannelEnabled(this.squareChannels[1], (this.enabledLeft | this.enabledRight) & 0x2);\r\n\tthis.enableChannel3 = (this.enabledLeft | this.enabledRight) & 0x4;\r\n\tthis.setChannel4Enabled((this.enabledLeft | this.enabledRight) & 0x8);\r\n\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSoundControlHi = function(value) {\r\n\tswitch (value & 0x0003) {\r\n\tcase 0:\r\n\t\tthis.soundRatio = 0.25;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tthis.soundRatio = 0.50;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tthis.soundRatio = 1;\r\n\t\tbreak;\r\n\t}\r\n\tthis.ratioChannelA = (((value & 0x0004) >> 2) + 1) * 0.5;\r\n\tthis.ratioChannelB = (((value & 0x0008) >> 3) + 1) * 0.5;\r\n\r\n\tthis.enableRightChannelA = value & 0x0100;\r\n\tthis.enableLeftChannelA = value & 0x0200;\r\n\tthis.enableChannelA  = value & 0x0300;\r\n\tthis.soundTimerA = value & 0x0400;\r\n\tif (value & 0x0800) {\r\n\t\tthis.fifoA = [];\r\n\t}\r\n\tthis.enableRightChannelB = value & 0x1000;\r\n\tthis.enableLeftChannelB = value & 0x2000;\r\n\tthis.enableChannelB  = value & 0x3000;\r\n\tthis.soundTimerB = value & 0x4000;\r\n\tif (value & 0x8000) {\r\n\t\tthis.fifoB = [];\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetSquareChannel = function(channel) {\r\n\tif (channel.step) {\r\n\t\tchannel.nextStep = this.cpu.cycles + channel.step;\r\n\t}\r\n\tif (channel.enabled && !channel.playing) {\r\n\t\tchannel.raise = this.cpu.cycles;\r\n\t\tchannel.lower = channel.raise + channel.duty * channel.interval;\r\n\t\tchannel.end = this.cpu.cycles + channel.length;\r\n\t\tthis.nextEvent = this.cpu.cycles;\r\n\t}\r\n\tchannel.playing = channel.enabled;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.setSquareChannelEnabled = function(channel, enable) {\r\n\tif (!(channel.enabled && channel.playing) && enable) {\r\n\t\tchannel.enabled = !!enable;\r\n\t\tthis.updateTimers();\r\n\t\tthis.core.irq.pollNextEvent();\r\n\t} else {\r\n\t\tchannel.enabled = !!enable;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelSweep = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tchannel.sweepSteps = value & 0x07;\r\n\tchannel.sweepIncrement = (value & 0x08) ? -1 : 1;\r\n\tchannel.sweepInterval = ((value >> 4) & 0x7) * this.cpuFrequency / 128;\r\n\tchannel.doSweep = !!channel.sweepInterval;\r\n\tchannel.nextSweep = this.cpu.cycles + channel.sweepInterval;\r\n\tthis.resetSquareChannel(channel);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelDLE = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tvar duty = (value >> 6) & 0x3;\r\n\tswitch (duty) {\r\n\tcase 0:\r\n\t\tchannel.duty = 0.125;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tchannel.duty = 0.25;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tchannel.duty = 0.5;\r\n\t\tbreak;\r\n\tcase 3:\r\n\t\tchannel.duty = 0.75;\r\n\t\tbreak;\r\n\t}\r\n\tthis.writeChannelLE(channel, value);\r\n\tthis.resetSquareChannel(channel);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelFC = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tvar frequency = value & 2047;\r\n\tchannel.frequency = frequency;\r\n\tchannel.interval = this.cpuFrequency * (2048 - frequency) / 131072;\r\n\tchannel.timed = !!(value & 0x4000);\r\n\r\n\tif (value & 0x8000) {\r\n\t\tthis.resetSquareChannel(channel);\r\n\t\tchannel.volume = channel.initialVolume;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateSquareChannel = function(channel, cycles) {\r\n\tif (channel.timed && cycles >= channel.end) {\r\n\t\tchannel.playing = false;\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (channel.doSweep && cycles >= channel.nextSweep) {\r\n\t\tchannel.frequency += channel.sweepIncrement * (channel.frequency >> channel.sweepSteps);\r\n\t\tif (channel.frequency < 0) {\r\n\t\t\tchannel.frequency = 0;\r\n\t\t} else if (channel.frequency > 2047) {\r\n\t\t\tchannel.frequency = 2047;\r\n\t\t\tchannel.playing = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tchannel.interval = this.cpuFrequency * (2048 - channel.frequency) / 131072;\r\n\t\tchannel.nextSweep += channel.sweepInterval;\r\n\t}\r\n\r\n\tif (cycles >= channel.raise) {\r\n\t\tchannel.sample = channel.volume;\r\n\t\tchannel.lower = channel.raise + channel.duty * channel.interval;\r\n\t\tchannel.raise += channel.interval;\r\n\t} else if (cycles >= channel.lower) {\r\n\t\tchannel.sample = -channel.volume;\r\n\t\tchannel.lower += channel.interval;\r\n\t}\r\n\r\n\tthis.updateEnvelope(channel, cycles);\r\n\r\n\tif (this.nextEvent > channel.raise) {\r\n\t\tthis.nextEvent = channel.raise;\r\n\t}\r\n\tif (this.nextEvent > channel.lower) {\r\n\t\tthis.nextEvent = channel.lower;\r\n\t}\r\n\tif (channel.timed && this.nextEvent > channel.end) {\r\n\t\tthis.nextEvent = channel.end;\r\n\t}\r\n\tif (channel.doSweep && this.nextEvent > channel.nextSweep) {\r\n\t\tthis.nextEvent = channel.nextSweep;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3Lo = function(value) {\r\n\tthis.channel3Dimension = value & 0x20;\r\n\tthis.channel3Bank = value & 0x40;\r\n\tvar enable = value & 0x80;\r\n\tif (!this.channel3Write && enable) {\r\n\t\tthis.channel3Write = enable;\r\n\t\tthis.resetChannel3();\r\n\t} else {\r\n\t\tthis.channel3Write = enable;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3Hi = function(value) {\r\n\tthis.channel3Length = this.cpuFrequency * (0x100 - (value & 0xFF)) / 256;\r\n\tvar volume = (value >> 13) & 0x7;\r\n\tswitch (volume) {\r\n\tcase 0:\r\n\t\tthis.channel3Volume = 0;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tthis.channel3Volume = 1;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tthis.channel3Volume = 0.5;\r\n\t\tbreak;\r\n\tcase 3:\r\n\t\tthis.channel3Volume = 0.25;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.channel3Volume = 0.75;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3X = function(value) {\r\n\tthis.channel3Interval = this.cpuFrequency * (2048 - (value & 0x7FF)) / 2097152;\r\n\tthis.channel3Timed = !!(value & 0x4000);\r\n\tif (this.channel3Write) {\r\n\t\tthis.resetChannel3();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetChannel3 = function() {\r\n\tthis.channel3Next = this.cpu.cycles;\r\n\tthis.nextEvent = this.channel3Next;\r\n\tthis.channel3End = this.cpu.cycles + this.channel3Length;\r\n\tthis.playingChannel3 = this.channel3Write;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeWaveData = function(offset, data, width) {\r\n\tif (!this.channel3Bank) {\r\n\t\toffset += 16;\r\n\t}\r\n\tif (width == 2) {\r\n\t\tthis.waveData[offset] = data & 0xFF;\r\n\t\tdata >>= 8;\r\n\t\t++offset;\r\n\t}\r\n\tthis.waveData[offset] = data & 0xFF;\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.setChannel4Enabled = function(enable) {\r\n\tif (!this.enableChannel4 && enable) {\r\n\t\tthis.channel4.next = this.cpu.cycles;\r\n\t\tthis.channel4.end = this.cpu.cycles + this.channel4.length;\r\n\t\tthis.enableChannel4 = true;\r\n\t\tthis.playingChannel4 = true;\r\n\t\tthis.nextEvent = this.cpu.cycles;\r\n\t\tthis.updateEnvelope(this.channel4);\r\n\t\tthis.updateTimers();\r\n\t\tthis.core.irq.pollNextEvent();\r\n\t} else {\r\n\t\tthis.enableChannel4 = enable;\r\n\t}\r\n}\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel4LE = function(value) {\r\n\tthis.writeChannelLE(this.channel4, value);\r\n\tthis.resetChannel4();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel4FC = function(value) {\r\n\tthis.channel4.timed = !!(value & 0x4000);\r\n\r\n\tvar r = value & 0x7;\r\n\tif (!r) {\r\n\t\tr = 0.5;\r\n\t}\r\n\tvar s = (value >> 4) & 0xF;\r\n\tvar interval = this.cpuFrequency * (r * (2 << s)) / 524288;\r\n\tif (interval != this.channel4.interval) {\r\n\t\tthis.channel4.interval = interval;\r\n\t\tthis.resetChannel4();\r\n\t}\r\n\r\n\tvar width = (value & 0x8) ? 7 : 15;\r\n\tif (width != this.channel4.width) {\r\n\t\tthis.channel4.width = width;\r\n\t\tthis.resetChannel4();\r\n\t}\r\n\r\n\tif (value & 0x8000) {\r\n\t\tthis.resetChannel4();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetChannel4 = function() {\r\n\tif (this.channel4.width == 15) {\r\n\t\tthis.channel4.lfsr = 0x4000;\r\n\t} else {\r\n\t\tthis.channel4.lfsr = 0x40;\r\n\t}\r\n\tthis.channel4.volume = this.channel4.initialVolume;\r\n\tif (this.channel4.step) {\r\n\t\tthis.channel4.nextStep = this.cpu.cycles + this.channel4.step;\r\n\t}\r\n\tthis.channel4.end = this.cpu.cycles + this.channel4.length;\r\n\tthis.channel4.next = this.cpu.cycles;\r\n\tthis.nextEvent = this.channel4.next;\r\n\r\n\tthis.playingChannel4 = this.enableChannel4;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannelLE = function(channel, value) {\r\n\tchannel.length = this.cpuFrequency * ((0x40 - (value & 0x3F)) / 256);\r\n\r\n\tif (value & 0x0800) {\r\n\t\tchannel.increment = 1 / 16;\r\n\t} else {\r\n\t\tchannel.increment = -1 / 16;\r\n\t}\r\n\tchannel.initialVolume = ((value >> 12) & 0xF) / 16;\r\n\r\n\tchannel.step = this.cpuFrequency * (((value >> 8) & 0x7) / 64);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateEnvelope = function(channel, cycles) {\r\n\tif (channel.step) {\r\n\t\tif (cycles >= channel.nextStep) {\r\n\t\t\tchannel.volume += channel.increment;\r\n\t\t\tif (channel.volume > 1) {\r\n\t\t\t\tchannel.volume = 1;\r\n\t\t\t} else if (channel.volume < 0) {\r\n\t\t\t\tchannel.volume = 0;\r\n\t\t\t}\r\n\t\t\tchannel.nextStep += channel.step;\r\n\t\t}\r\n\r\n\t\tif (this.nextEvent > channel.nextStep) {\r\n\t\t\tthis.nextEvent = channel.nextStep;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.appendToFifoA = function(value) {\r\n\tvar b;\r\n\tif (this.fifoA.length > 28) {\r\n\t\tthis.fifoA = this.fifoA.slice(-28);\r\n\t}\r\n\tfor (var i = 0; i < 4; ++i) {\r\n\t\tb = (value & 0xFF) << 24;\r\n\t\tvalue >>= 8;\r\n\t\tthis.fifoA.push(b / 0x80000000);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.appendToFifoB = function(value) {\r\n\tvar b;\r\n\tif (this.fifoB.length > 28) {\r\n\t\tthis.fifoB = this.fifoB.slice(-28);\r\n\t}\r\n\tfor (var i = 0; i < 4; ++i) {\r\n\t\tb = (value & 0xFF) << 24;\r\n\t\tvalue >>= 8;\r\n\t\tthis.fifoB.push(b / 0x80000000);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sampleFifoA = function() {\r\n\tif (this.fifoA.length <= 16) {\r\n\t\tvar dma = this.core.irq.dma[this.dmaA];\r\n\t\tdma.nextCount = 4;\r\n\t\tthis.core.mmu.serviceDma(this.dmaA, dma);\r\n\t}\r\n\tthis.fifoASample = this.fifoA.shift();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sampleFifoB = function() {\r\n\tif (this.fifoB.length <= 16) {\r\n\t\tvar dma = this.core.irq.dma[this.dmaB];\r\n\t\tdma.nextCount = 4;\r\n\t\tthis.core.mmu.serviceDma(this.dmaB, dma);\r\n\t}\r\n\tthis.fifoBSample = this.fifoB.shift();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.scheduleFIFODma = function(number, info) {\r\n\tswitch (info.dest) {\r\n\tcase this.cpu.mmu.BASE_IO | this.cpu.irq.io.FIFO_A_LO:\r\n\t\t// FIXME: is this needed or a hack?\r\n\t\tinfo.dstControl = 2;\r\n\t\tthis.dmaA = number;\r\n\t\tbreak;\r\n\tcase this.cpu.mmu.BASE_IO | this.cpu.irq.io.FIFO_B_LO:\r\n\t\tinfo.dstControl = 2;\r\n\t\tthis.dmaB = number;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.core.WARN('Tried to schedule FIFO DMA for non-FIFO destination');\r\n\t\tbreak;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sample = function() {\r\n\tvar sampleLeft = 0;\r\n\tvar sampleRight = 0;\r\n\tvar sample;\r\n\tvar channel;\r\n\r\n\tchannel = this.squareChannels[0];\r\n\tif (channel.playing) {\r\n\t\tsample = channel.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x1) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x1) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tchannel = this.squareChannels[1];\r\n\tif (channel.playing) {\r\n\t\tsample = channel.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x2) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x2) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.playingChannel3) {\r\n\t\tsample = this.channel3Sample * this.soundRatio * this.channel3Volume * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x4) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x4) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.playingChannel4) {\r\n\t\tsample = this.channel4.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x8) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x8) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.enableChannelA) {\r\n\t\tsample = this.fifoASample * this.FIFO_MAX * this.ratioChannelA;\r\n\t\tif (this.enableLeftChannelA) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enableRightChannelA) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.enableChannelB) {\r\n\t\tsample = this.fifoBSample * this.FIFO_MAX * this.ratioChannelB;\r\n\t\tif (this.enableLeftChannelB) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enableRightChannelB) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tvar samplePointer = this.samplePointer;\r\n\tsampleLeft *= this.masterVolume / this.SOUND_MAX;\r\n\tsampleLeft = Math.max(Math.min(sampleLeft, 1), -1);\r\n\tsampleRight *= this.masterVolume / this.SOUND_MAX;\r\n\tsampleRight = Math.max(Math.min(sampleRight, 1), -1);\r\n\tif (this.buffers) {\r\n\t\tthis.buffers[0][samplePointer] = sampleLeft;\r\n\t\tthis.buffers[1][samplePointer] = sampleRight;\r\n\t}\r\n\tthis.samplePointer = (samplePointer + 1) & this.sampleMask;\r\n};\r\n\r\nexport default GameBoyAdvanceAudio;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nfunction MemoryAligned16(size) {\n\tthis.buffer = new Uint16Array(size >> 1);\n};\n\nMemoryAligned16.prototype.load8 = function(offset) {\n\treturn (this.loadU8(offset) << 24) >> 24;\n};\n\nMemoryAligned16.prototype.load16 = function(offset) {\n\treturn (this.loadU16(offset) << 16) >> 16;\n};\n\nMemoryAligned16.prototype.loadU8 = function(offset) {\n\tvar index = offset >> 1;\n\tif (offset & 1) {\n\t\treturn (this.buffer[index] & 0xFF00) >>> 8;\n\t} else {\n\t\treturn this.buffer[index] & 0x00FF;\n\t}\n};\n\nMemoryAligned16.prototype.loadU16 = function(offset) {\n\treturn this.buffer[offset >> 1];\n};\n\nMemoryAligned16.prototype.load32 = function(offset) {\n\treturn this.buffer[(offset >> 1) & ~1] | (this.buffer[(offset >> 1) | 1] << 16);\n};\n\nMemoryAligned16.prototype.store8 = function(offset, value) {\n\tvar index = offset >> 1;\n\tthis.store16(offset, (value << 8) | value);\n};\n\nMemoryAligned16.prototype.store16 = function(offset, value) {\n\tthis.buffer[offset >> 1] = value;\n};\n\nMemoryAligned16.prototype.store32 = function(offset, value) {\n\tvar index = offset >> 1;\n\tthis.store16(offset, this.buffer[index] = value & 0xFFFF);\n\tthis.store16(offset + 2, this.buffer[index + 1] = value >>> 16);\n};\n\nMemoryAligned16.prototype.insert = function(start, data) {\n\tthis.buffer.set(data, start);\n};\n\nMemoryAligned16.prototype.invalidatePage = function(address) {};\n\nfunction GameBoyAdvanceVRAM(size) {\n\tMemoryAligned16.call(this, size);\n\tthis.vram = this.buffer;\n};\n\nGameBoyAdvanceVRAM.prototype = Object.create(MemoryAligned16.prototype);\n\nfunction GameBoyAdvanceOAM(size) {\n\tMemoryAligned16.call(this, size);\n\tthis.oam = this.buffer;\n\tthis.objs = new Array(128);\n\tfor (var i = 0; i < 128; ++i) {\n\t\tthis.objs[i] = new GameBoyAdvanceOBJ(this, i);\n\t}\n\tthis.scalerot = new Array(32);\n\tfor (var i = 0; i < 32; ++i) {\n\t\tthis.scalerot[i] = {\n\t\t\ta: 1,\n\t\t\tb: 0,\n\t\t\tc: 0,\n\t\t\td: 1\n\t\t};\n\t}\n};\n\nGameBoyAdvanceOAM.prototype = Object.create(MemoryAligned16.prototype);\n\nGameBoyAdvanceOAM.prototype.overwrite = function(memory) {\n\tfor (var i = 0; i < (this.buffer.byteLength >> 1); ++i) {\n\t\tthis.store16(i << 1, memory[i]);\n\t}\n};\n\nGameBoyAdvanceOAM.prototype.store16 = function(offset, value) {\n\tvar index = (offset & 0x3F8) >> 3;\n\tvar obj = this.objs[index];\n\tvar scalerot = this.scalerot[index >> 2];\n\tvar layer = obj.priority;\n\tvar disable = obj.disable;\n\tvar y = obj.y;\n\tswitch (offset & 0x00000006) {\n\tcase 0:\n\t\t// Attribute 0\n\t\tobj.y = value & 0x00FF;\n\t\tvar wasScalerot = obj.scalerot;\n\t\tobj.scalerot = value & 0x0100;\n\t\tif (obj.scalerot) {\n\t\t\tobj.scalerotOam = this.scalerot[obj.scalerotParam];\n\t\t\tobj.doublesize = !!(value & 0x0200);\n\t\t\tobj.disable = 0;\n\t\t\tobj.hflip = 0;\n\t\t\tobj.vflip = 0;\n\t\t} else {\n\t\t\tobj.doublesize = false;\n\t\t\tobj.disable = value & 0x0200;\n\t\t\tif (wasScalerot) {\n\t\t\t\tobj.hflip = obj.scalerotParam & 0x0008;\n\t\t\t\tobj.vflip = obj.scalerotParam & 0x0010;\n\t\t\t}\n\t\t}\n\t\tobj.mode = (value & 0x0C00) >> 6; // This lines up with the stencil format\n\t\tobj.mosaic = value & 0x1000;\n\t\tobj.multipalette = value & 0x2000;\n\t\tobj.shape = (value & 0xC000) >> 14;\n\n\t\tobj.recalcSize();\n\t\tbreak;\n\tcase 2:\n\t\t// Attribute 1\n\t\tobj.x = value & 0x01FF;\n\t\tif (obj.scalerot) {\n\t\t\tobj.scalerotParam = (value & 0x3E00) >> 9;\n\t\t\tobj.scalerotOam = this.scalerot[obj.scalerotParam];\n\t\t\tobj.hflip = 0;\n\t\t\tobj.vflip = 0;\n\t\t\tobj.drawScanline = obj.drawScanlineAffine;\n\t\t} else {\n\t\t\tobj.hflip = value & 0x1000;\n\t\t\tobj.vflip = value & 0x2000;\n\t\t\tobj.drawScanline = obj.drawScanlineNormal;\n\t\t}\n\t\tobj.size = (value & 0xC000) >> 14;\n\n\t\tobj.recalcSize();\n\t\tbreak;\n\tcase 4:\n\t\t// Attribute 2\n\t\tobj.tileBase = value & 0x03FF;\n\t\tobj.priority = (value & 0x0C00) >> 10;\n\t\tobj.palette = (value & 0xF000) >> 8; // This is shifted up 4 to make pushPixel faster\n\t\tbreak;\n\tcase 6:\n\t\t// Scaling/rotation parameter\n\t\tswitch (index & 0x3) {\n\t\tcase 0:\n\t\t\tscalerot.a = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tscalerot.b = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tscalerot.c = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tscalerot.d = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t}\n\n\tMemoryAligned16.prototype.store16.call(this, offset, value);\n};\n\nfunction GameBoyAdvancePalette() {\n\tthis.colors = [ new Array(0x100), new Array(0x100) ];\n\tthis.adjustedColors = [ new Array(0x100), new Array(0x100) ];\n\tthis.passthroughColors = [\n\t\tthis.colors[0], // BG0\n\t\tthis.colors[0], // BG1\n\t\tthis.colors[0], // BG2\n\t\tthis.colors[0], // BG3\n\t\tthis.colors[1], // OBJ\n\t\tthis.colors[0] // Backdrop\n\t];\n\tthis.blendY = 1;\n};\n\nGameBoyAdvancePalette.prototype.overwrite = function(memory) {\n\tfor (var i = 0; i < 512; ++i) {\n\t\tthis.store16(i << 1, memory[i]);\n\t}\n};\n\nGameBoyAdvancePalette.prototype.loadU8 = function(offset) {\n\treturn (this.loadU16(offset) >> (8 * (offset & 1))) & 0xFF;\n};\n\nGameBoyAdvancePalette.prototype.loadU16 = function(offset) {\n\treturn this.colors[(offset & 0x200) >> 9][(offset & 0x1FF) >> 1];\n};\n\nGameBoyAdvancePalette.prototype.load16 = function(offset) {\n\treturn (this.loadU16(offset) << 16) >> 16;\n};\n\nGameBoyAdvancePalette.prototype.load32 = function(offset) {\n\treturn this.loadU16(offset) | (this.loadU16(offset + 2) << 16);\n};\n\nGameBoyAdvancePalette.prototype.store16 = function(offset, value) {\n\tvar type = (offset & 0x200) >> 9;\n\tvar index = (offset & 0x1FF) >> 1;\n\tthis.colors[type][index] = value;\n\tthis.adjustedColors[type][index] = this.adjustColor(value);\n};\n\nGameBoyAdvancePalette.prototype.store32 = function(offset, value) {\n\tthis.store16(offset, value & 0xFFFF);\n\tthis.store16(offset + 2, value >> 16);\n};\n\nGameBoyAdvancePalette.prototype.invalidatePage = function(address) {};\n\nGameBoyAdvancePalette.prototype.convert16To32 = function(value, input) {\n\tvar r = (value & 0x001F) << 3;\n\tvar g = (value & 0x03E0) >> 2;\n\tvar b = (value & 0x7C00) >> 7;\n\n\tinput[0] = r;\n\tinput[1] = g;\n\tinput[2] = b;\n};\n\nGameBoyAdvancePalette.prototype.mix = function(aWeight, aColor, bWeight, bColor) {\n\tvar ar = (aColor & 0x001F);\n\tvar ag = (aColor & 0x03E0) >> 5;\n\tvar ab = (aColor & 0x7C00) >> 10;\n\n\tvar br = (bColor & 0x001F);\n\tvar bg = (bColor & 0x03E0) >> 5;\n\tvar bb = (bColor & 0x7C00) >> 10;\n\n\tvar r = Math.min(aWeight * ar + bWeight * br, 0x1F);\n\tvar g = Math.min(aWeight * ag + bWeight * bg, 0x1F);\n\tvar b = Math.min(aWeight * ab + bWeight * bb, 0x1F);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.makeDarkPalettes = function(layers) {\n\tif (this.adjustColor != this.adjustColorDark) {\n\t\tthis.adjustColor = this.adjustColorDark;\n\t\tthis.resetPalettes();\n\t}\n\tthis.resetPaletteLayers(layers);\n};\n\nGameBoyAdvancePalette.prototype.makeBrightPalettes = function(layers) {\n\tif (this.adjustColor != this.adjustColorBright) {\n\t\tthis.adjustColor = this.adjustColorBright;\n\t\tthis.resetPalettes();\n\t}\n\tthis.resetPaletteLayers(layers);\n};\n\nGameBoyAdvancePalette.prototype.makeNormalPalettes = function() {\n\tthis.passthroughColors[0] = this.colors[0];\n\tthis.passthroughColors[1] = this.colors[0];\n\tthis.passthroughColors[2] = this.colors[0];\n\tthis.passthroughColors[3] = this.colors[0];\n\tthis.passthroughColors[4] = this.colors[1];\n\tthis.passthroughColors[5] = this.colors[0];\n};\n\nGameBoyAdvancePalette.prototype.makeSpecialPalette = function(layer) {\n\tthis.passthroughColors[layer] = this.adjustedColors[layer == 4 ? 1 : 0];\n};\n\nGameBoyAdvancePalette.prototype.makeNormalPalette = function(layer) {\n\tthis.passthroughColors[layer] = this.colors[layer == 4 ? 1 : 0];\n};\n\nGameBoyAdvancePalette.prototype.resetPaletteLayers = function(layers) {\n\tif (layers & 0x01) {\n\t\tthis.passthroughColors[0] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[0] = this.colors[0];\n\t}\n\tif (layers & 0x02) {\n\t\tthis.passthroughColors[1] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[1] = this.colors[0];\n\t}\n\tif (layers & 0x04) {\n\t\tthis.passthroughColors[2] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[2] = this.colors[0];\n\t}\n\tif (layers & 0x08) {\n\t\tthis.passthroughColors[3] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[3] = this.colors[0];\n\t}\n\tif (layers & 0x10) {\n\t\tthis.passthroughColors[4] = this.adjustedColors[1];\n\t} else {\n\t\tthis.passthroughColors[4] = this.colors[1];\n\t}\n\tif (layers & 0x20) {\n\t\tthis.passthroughColors[5] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[5] = this.colors[0];\n\t}\n};\n\nGameBoyAdvancePalette.prototype.resetPalettes = function() {\n\tvar i;\n\tvar outPalette = this.adjustedColors[0];\n\tvar inPalette = this.colors[0];\n\tfor (i = 0; i < 256; ++i) {\n\t\toutPalette[i] = this.adjustColor(inPalette[i]);\n\t}\n\n\toutPalette = this.adjustedColors[1];\n\tinPalette = this.colors[1];\n\tfor (i = 0; i < 256; ++i) {\n\t\toutPalette[i] = this.adjustColor(inPalette[i]);\n\t}\n}\n\nGameBoyAdvancePalette.prototype.accessColor = function(layer, index) {\n\treturn this.passthroughColors[layer][index];\n};\n\nGameBoyAdvancePalette.prototype.adjustColorDark = function(color) {\n\tvar r = (color & 0x001F);\n\tvar g = (color & 0x03E0) >> 5;\n\tvar b = (color & 0x7C00) >> 10;\n\n\tr = r - (r * this.blendY);\n\tg = g - (g * this.blendY);\n\tb = b - (b * this.blendY);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.adjustColorBright = function(color) {\n\tvar r = (color & 0x001F);\n\tvar g = (color & 0x03E0) >> 5;\n\tvar b = (color & 0x7C00) >> 10;\n\n\tr = r + ((31 - r) * this.blendY);\n\tg = g + ((31 - g) * this.blendY);\n\tb = b + ((31 - b) * this.blendY);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.adjustColor = GameBoyAdvancePalette.prototype.adjustColorBright;\n\nGameBoyAdvancePalette.prototype.setBlendY = function(y) {\n\tif (this.blendY != y) {\n\t\tthis.blendY = y;\n\t\tthis.resetPalettes();\n\t}\n};\n\nfunction GameBoyAdvanceOBJ(oam, index) {\n\tthis.TILE_OFFSET = 0x10000;\n\tthis.oam = oam;\n\n\tthis.index = index;\n\tthis.x = 0;\n\tthis.y = 0;\n\tthis.scalerot = 0;\n\tthis.doublesize = false;\n\tthis.disable = 1;\n\tthis.mode = 0;\n\tthis.mosaic = false;\n\tthis.multipalette = false;\n\tthis.shape = 0;\n\tthis.scalerotParam = 0;\n\tthis.hflip = 0;\n\tthis.vflip = 0;\n\tthis.tileBase = 0;\n\tthis.priority = 0;\n\tthis.palette = 0;\n\tthis.drawScanline = this.drawScanlineNormal;\n\tthis.pushPixel = GameBoyAdvanceSoftwareRenderer.pushPixel;\n\tthis.cachedWidth = 8;\n\tthis.cachedHeight = 8;\n};\n\nGameBoyAdvanceOBJ.prototype.drawScanlineNormal = function(backing, y, yOff, start, end) {\n\tvar video = this.oam.video;\n\tvar x;\n\tvar underflow;\n\tvar offset;\n\tvar mask = this.mode | video.target2[video.LAYER_OBJ] | (this.priority << 1);\n\tif (this.mode == 0x10) {\n\t\tmask |= video.TARGET1_MASK;\n\t}\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[video.LAYER_OBJ];\n\t}\n\n\tvar totalWidth = this.cachedWidth;\n\tif (this.x < video.HORIZONTAL_PIXELS) {\n\t\tif (this.x < start) {\n\t\t\tunderflow = start - this.x;\n\t\t\toffset = start;\n\t\t} else {\n\t\t\tunderflow = 0;\n\t\t\toffset = this.x;\n\t\t}\n\t\tif (end < this.cachedWidth + this.x) {\n\t\t\ttotalWidth = end - this.x;\n\t\t}\n\t} else {\n\t\tunderflow = start + 512 - this.x;\n\t\toffset = start;\n\t\tif (end < this.cachedWidth - underflow) {\n\t\t\ttotalWidth = end;\n\t\t}\n\t}\n\t\n\tvar localX;\n\tvar localY;\n\tif (!this.vflip) {\n\t\tlocalY = y - yOff;\n\t} else {\n\t\tlocalY = this.cachedHeight - y + yOff - 1;\n\t}\n\tvar localYLo = localY & 0x7;\n\tvar mosaicX;\n\tvar tileOffset;\n\n\tvar paletteShift = this.multipalette ? 1 : 0;\n\n\tif (video.objCharacterMapping) {\n\t\ttileOffset = ((localY & 0x01F8) * this.cachedWidth) >> 6;\n\t} else {\n\t\ttileOffset = (localY & 0x01F8) << (2 - paletteShift);\n\t}\n\n\tif (this.mosaic) {\n\t\tmosaicX = video.objMosaicX - 1 - (video.objMosaicX + offset - 1) % video.objMosaicX;\n\t\toffset += mosaicX;\n\t\tunderflow += mosaicX;\n\t}\n\tif (!this.hflip) {\n\t\tlocalX = underflow;\n\t} else {\n\t\tlocalX = this.cachedWidth - underflow - 1;\n\t}\n\n\tvar tileRow = video.accessTile(this.TILE_OFFSET + (x & 0x4) * paletteShift, this.tileBase + (tileOffset << paletteShift) + ((localX & 0x01F8) >> (3 - paletteShift)), localYLo << paletteShift);\n\tfor (x = underflow; x < totalWidth; ++x) {\n\t\tmosaicX = this.mosaic ? offset % video.objMosaicX : 0;\n\t\tif (!this.hflip) {\n\t\t\tlocalX = x - mosaicX;\n\t\t} else {\n\t\t\tlocalX = this.cachedWidth - (x - mosaicX) - 1;\n\t\t}\n\t\tif (!paletteShift) {\n\t\t\tif (!(x & 0x7) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(this.TILE_OFFSET, this.tileBase + tileOffset + (localX >> 3), localYLo);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!(x & 0x3) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(this.TILE_OFFSET + (localX & 0x4), this.tileBase + (tileOffset << 1) + ((localX & 0x01F8) >> 2), localYLo << 1);\n\t\t\t}\n\t\t}\n\t\tthis.pushPixel(video.LAYER_OBJ, this, video, tileRow, localX & 0x7, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceOBJ.prototype.drawScanlineAffine = function(backing, y, yOff, start, end) {\n\tvar video = this.oam.video;\n\tvar x;\n\tvar underflow;\n\tvar offset;\n\tvar mask = this.mode | video.target2[video.LAYER_OBJ] | (this.priority << 1);\n\tif (this.mode == 0x10) {\n\t\tmask |= video.TARGET1_MASK;\n\t}\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[video.LAYER_OBJ];\n\t}\n\n\tvar localX;\n\tvar localY;\n\tvar yDiff = y - yOff;\n\tvar tileOffset;\n\n\tvar paletteShift = this.multipalette ? 1 : 0;\n\tvar totalWidth = this.cachedWidth << this.doublesize;\n\tvar totalHeight = this.cachedHeight << this.doublesize;\n\tvar drawWidth = totalWidth;\n\tif (drawWidth > video.HORIZONTAL_PIXELS) {\n\t\ttotalWidth = video.HORIZONTAL_PIXELS;\n\t}\n\n\tif (this.x < video.HORIZONTAL_PIXELS) {\n\t\tif (this.x < start) {\n\t\t\tunderflow = start - this.x;\n\t\t\toffset = start;\n\t\t} else {\n\t\t\tunderflow = 0;\n\t\t\toffset = this.x;\n\t\t}\n\t\tif (end < drawWidth + this.x) {\n\t\t\tdrawWidth = end - this.x;\n\t\t}\n\t} else {\n\t\tunderflow = start + 512 - this.x;\n\t\toffset = start;\n\t\tif (end < drawWidth - underflow) {\n\t\t\tdrawWidth = end;\n\t\t}\n\t}\n\n\tfor (x = underflow; x < drawWidth; ++x) {\n\t\tlocalX = this.scalerotOam.a * (x - (totalWidth >> 1)) + this.scalerotOam.b * (yDiff - (totalHeight >> 1)) + (this.cachedWidth >> 1);\n\t\tlocalY = this.scalerotOam.c * (x - (totalWidth >> 1)) + this.scalerotOam.d * (yDiff - (totalHeight >> 1)) + (this.cachedHeight >> 1);\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.objMosaicX) * this.scalerotOam.a + (y % video.objMosaicY) * this.scalerotOam.b;\n\t\t\tlocalY -= (x % video.objMosaicX) * this.scalerotOam.c + (y % video.objMosaicY) * this.scalerotOam.d;\n\t\t}\n\n\t\tif (localX < 0 || localX >= this.cachedWidth || localY < 0 || localY >= this.cachedHeight) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (video.objCharacterMapping) {\n\t\t\ttileOffset = ((localY & 0x01F8) * this.cachedWidth) >> 6;\n\t\t} else {\n\t\t\ttileOffset = (localY & 0x01F8) << (2 - paletteShift);\n\t\t}\n\t\tvar tileRow = video.accessTile(this.TILE_OFFSET + (localX & 0x4) * paletteShift, this.tileBase + (tileOffset << paletteShift) + ((localX & 0x01F8) >> (3 - paletteShift)), (localY & 0x7) << paletteShift);\n\t\tthis.pushPixel(video.LAYER_OBJ, this, video, tileRow, localX & 0x7, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceOBJ.prototype.recalcSize = function() {\n\tswitch (this.shape) {\n\tcase 0:\n\t\t// Square\n\t\tthis.cachedHeight = this.cachedWidth = 8 << this.size;\n\t\tbreak;\n\tcase 1:\n\t\t// Horizontal\n\t\tswitch (this.size) {\n\t\tcase 0:\n\t\t\tthis.cachedHeight = 8;\n\t\t\tthis.cachedWidth = 16;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tthis.cachedHeight = 8;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tthis.cachedHeight = 16;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 64;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase 2:\n\t\t// Vertical\n\t\tswitch (this.size) {\n\t\tcase 0:\n\t\t\tthis.cachedHeight = 16;\n\t\t\tthis.cachedWidth = 8;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 8;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 16;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tthis.cachedHeight = 64;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\t// Bad!\n\t}\n};\n\nfunction GameBoyAdvanceOBJLayer(video, index) {\n\tthis.video = video;\n\tthis.bg = false;\n\tthis.index = video.LAYER_OBJ;\n\tthis.priority = index;\n\tthis.enabled = false;\n\tthis.objwin = 0;\n};\n\nGameBoyAdvanceOBJLayer.prototype.drawScanline = function(backing, layer, start, end) {\n\tvar y = this.video.vcount;\n\tvar wrappedY;\n\tvar mosaicY;\n\tvar obj;\n\tif (start >= end) {\n\t\treturn;\n\t}\n\tvar objs = this.video.oam.objs;\n\tfor (var i = 0; i < objs.length; ++i) {\n\t\tobj = objs[i];\n\t\tif (obj.disable) {\n\t\t\tcontinue;\n\t\t}\n\t\tif ((obj.mode & this.video.OBJWIN_MASK) != this.objwin) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(obj.mode & this.video.OBJWIN_MASK) && this.priority != obj.priority) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (obj.y < this.video.VERTICAL_PIXELS) {\n\t\t\twrappedY = obj.y;\n\t\t} else {\n\t\t\twrappedY = obj.y - 256;\n\t\t}\n\t\tvar totalHeight;\n\t\tif (!obj.scalerot) {\n\t\t\ttotalHeight = obj.cachedHeight;\n\t\t} else {\n\t\t\ttotalHeight = obj.cachedHeight << obj.doublesize;\n\t\t}\n\t\tif (!obj.mosaic) {\n\t\t\tmosaicY = y;\n\t\t} else {\n\t\t\tmosaicY = y - y % this.video.objMosaicY;\n\t\t}\n\t\tif (wrappedY <= y && (wrappedY + totalHeight) > y) {\n\t\t\tobj.drawScanline(backing, mosaicY, wrappedY, start, end);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceOBJLayer.prototype.objComparator = function(a, b) {\n\treturn a.index - b.index;\n};\n\nfunction GameBoyAdvanceSoftwareRenderer() {\n\tthis.LAYER_BG0 = 0;\n\tthis.LAYER_BG1 = 1;\n\tthis.LAYER_BG2 = 2;\n\tthis.LAYER_BG3 = 3;\n\tthis.LAYER_OBJ = 4;\n\tthis.LAYER_BACKDROP = 5;\n\n\tthis.HORIZONTAL_PIXELS = 240;\n\tthis.VERTICAL_PIXELS = 160;\n\n\tthis.LAYER_MASK = 0x06;\n\tthis.BACKGROUND_MASK = 0x01;\n\tthis.TARGET2_MASK = 0x08;\n\tthis.TARGET1_MASK = 0x10;\n\tthis.OBJWIN_MASK = 0x20;\n\tthis.WRITTEN_MASK = 0x80;\n\n\tthis.PRIORITY_MASK = this.LAYER_MASK | this.BACKGROUND_MASK;\n\n\tthis.drawBackdrop = new (function(video) {\n\t\tthis.bg = true;\n\t\tthis.priority = -1;\n\t\tthis.index = video.LAYER_BACKDROP;\n\t\tthis.enabled = true;\n\n\t\tthis.drawScanline = function(backing, layer, start, end) {\n\t\t\t// TODO: interactions with blend modes and OBJWIN\n\t\t\tfor (var x = start; x < end; ++x) {\n\t\t\t\tif (!(backing.stencil[x] & video.WRITTEN_MASK)) {\n\t\t\t\t\tbacking.color[x] = video.palette.accessColor(this.index, 0);\n\t\t\t\t\tbacking.stencil[x] = video.WRITTEN_MASK;\n\t\t\t\t} else if (backing.stencil[x] & video.TARGET1_MASK) {\n\t\t\t\t\tbacking.color[x] = video.palette.mix(video.blendB, video.palette.accessColor(this.index, 0), video.blendA, backing.color[x]);\n\t\t\t\t\tbacking.stencil[x] = video.WRITTEN_MASK;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})(this);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.clear = function(mmu) {\n\tthis.palette = new GameBoyAdvancePalette();\n\tthis.vram = new GameBoyAdvanceVRAM(mmu.SIZE_VRAM);\n\tthis.oam = new GameBoyAdvanceOAM(mmu.SIZE_OAM);\n\tthis.oam.video = this;\n\tthis.objLayers = [\n\t\tnew GameBoyAdvanceOBJLayer(this, 0),\n\t\tnew GameBoyAdvanceOBJLayer(this, 1),\n\t\tnew GameBoyAdvanceOBJLayer(this, 2),\n\t\tnew GameBoyAdvanceOBJLayer(this, 3)\n\t];\n\tthis.objwinLayer = new GameBoyAdvanceOBJLayer(this, 4);\n\tthis.objwinLayer.objwin = this.OBJWIN_MASK;\n\n\t// DISPCNT\n\tthis.backgroundMode = 0;\n\tthis.displayFrameSelect = 0;\n\tthis.hblankIntervalFree = 0;\n\tthis.objCharacterMapping = 0;\n\tthis.forcedBlank = 1;\n\tthis.win0 = 0;\n\tthis.win1 = 0;\n\tthis.objwin = 0;\n\n\t// VCOUNT\n\tthis.vcount = -1;\n\n\t// WIN0H\n\tthis.win0Left = 0;\n\tthis.win0Right = 240;\n\n\t// WIN1H\n\tthis.win1Left = 0;\n\tthis.win1Right = 240;\n\n\t// WIN0V\n\tthis.win0Top = 0;\n\tthis.win0Bottom = 160;\n\n\t// WIN1V\n\tthis.win1Top = 0;\n\tthis.win1Bottom = 160;\n\n\t// WININ/WINOUT\n\tthis.windows = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.windows.push({\n\t\t\tenabled: [ false, false, false, false, false, true ],\n\t\t\tspecial: 0\n\t\t});\n\t};\n\n\t// BLDCNT\n\tthis.target1 = new Array(5);\n\tthis.target2 = new Array(5);\n\tthis.blendMode = 0;\n\n\t// BLDALPHA\n\tthis.blendA = 0;\n\tthis.blendB = 0;\n\n\t// BLDY\n\tthis.blendY = 0;\n\n\t// MOSAIC\n\tthis.bgMosaicX = 1;\n\tthis.bgMosaicY = 1;\n\tthis.objMosaicX = 1;\n\tthis.objMosaicY = 1;\n\n\tthis.lastHblank = 0;\n\tthis.nextHblank = this.HDRAW_LENGTH;\n\tthis.nextEvent = this.nextHblank;\n\n\tthis.nextHblankIRQ = 0;\n\tthis.nextVblankIRQ = 0;\n\tthis.nextVcounterIRQ = 0;\n\n\tthis.bg = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.bg.push({\n\t\t\tbg: true,\n\t\t\tindex: i,\n\t\t\tenabled: false,\n\t\t\tvideo: this,\n\t\t\tvram: this.vram,\n\t\t\tpriority: 0,\n\t\t\tcharBase: 0,\n\t\t\tmosaic: false,\n\t\t\tmultipalette: false,\n\t\t\tscreenBase: 0,\n\t\t\toverflow: 0,\n\t\t\tsize: 0,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\trefx: 0,\n\t\t\trefy: 0,\n\t\t\tdx: 1,\n\t\t\tdmx: 0,\n\t\t\tdy: 0,\n\t\t\tdmy: 1,\n\t\t\tsx: 0,\n\t\t\tsy: 0,\n\t\t\tpushPixel: GameBoyAdvanceSoftwareRenderer.pushPixel,\n\t\t\tdrawScanline: this.drawScanlineBGMode0\n\t\t});\n\t}\n\n\tthis.bgModes = [\n\t\tthis.drawScanlineBGMode0,\n\t\tthis.drawScanlineBGMode2, // Modes 1 and 2 are identical for layers 2 and 3\n\t\tthis.drawScanlineBGMode2,\n\t\tthis.drawScanlineBGMode3,\n\t\tthis.drawScanlineBGMode4,\n\t\tthis.drawScanlineBGMode5\n\t];\n\n\tthis.drawLayers = [\n\t\tthis.bg[0],\n\t\tthis.bg[1],\n\t\tthis.bg[2],\n\t\tthis.bg[3],\n\t\tthis.objLayers[0],\n\t\tthis.objLayers[1],\n\t\tthis.objLayers[2],\n\t\tthis.objLayers[3],\n\t\tthis.objwinLayer,\n\t\tthis.drawBackdrop\n\t];\n\n\tthis.objwinActive = false;\n\tthis.alphaEnabled = false;\n\n\tthis.scanline = {\n\t\tcolor: new Uint16Array(this.HORIZONTAL_PIXELS),\n\t\t// Stencil format:\n\t\t// Bits 0-1: Layer\n\t\t// Bit 2: Is background\n\t\t// Bit 3: Is Target 2\n\t\t// Bit 4: Is Target 1\n\t\t// Bit 5: Is OBJ Window\n\t\t// Bit 6: Reserved\n\t\t// Bit 7: Has been written\n\t\tstencil: new Uint8Array(this.HORIZONTAL_PIXELS)\n\t};\n\tthis.sharedColor = [ 0, 0, 0 ];\n\tthis.sharedMap = {\n\t\ttile: 0,\n\t\thflip: false,\n\t\tvflip: false,\n\t\tpalette: 0\n\t};\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.clearSubsets = function(mmu, regions) {\n\tif (regions & 0x04) {\n\t\tthis.palette.overwrite(new Uint16Array(mmu.SIZE_PALETTE >> 1));\n\t}\n\n\tif (regions & 0x08) {\n\t\tthis.vram.insert(0, new Uint16Array(mmu.SIZE_VRAM >> 1));\n\t}\n\n\tif (regions & 0x10) {\n\t\tthis.oam.overwrite(new Uint16Array(mmu.SIZE_OAM >> 1));\n\t\tthis.oam.video = this;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.freeze = function() {\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.defrost = function(frost) {\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.setBacking = function(backing) {\n\tthis.pixelData = backing;\n\n\t// Clear backing first\n\tfor (var offset = 0; offset < this.HORIZONTAL_PIXELS * this.VERTICAL_PIXELS * 4;) {\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeDisplayControl = function(value) {\n\tthis.backgroundMode = value & 0x0007;\n\tthis.displayFrameSelect = value & 0x0010;\n\tthis.hblankIntervalFree = value & 0x0020;\n\tthis.objCharacterMapping = value & 0x0040;\n\tthis.forcedBlank = value & 0x0080;\n\tthis.bg[0].enabled = value & 0x0100;\n\tthis.bg[1].enabled = value & 0x0200;\n\tthis.bg[2].enabled = value & 0x0400;\n\tthis.bg[3].enabled = value & 0x0800;\n\tthis.objLayers[0].enabled = value & 0x1000;\n\tthis.objLayers[1].enabled = value & 0x1000;\n\tthis.objLayers[2].enabled = value & 0x1000;\n\tthis.objLayers[3].enabled = value & 0x1000;\n\tthis.win0 = value & 0x2000;\n\tthis.win1 = value & 0x4000;\n\tthis.objwin = value & 0x8000;\n\tthis.objwinLayer.enabled = value & 0x1000 && value & 0x8000;\n\n\t// Total hack so we can store both things that would set it to 256-color mode in the same variable\n\tthis.bg[2].multipalette &= ~0x0001;\n\tthis.bg[3].multipalette &= ~0x0001;\n\tif (this.backgroundMode > 0) {\n\t\tthis.bg[2].multipalette |= 0x0001;\n\t}\n\tif (this.backgroundMode == 2) {\n\t\tthis.bg[3].multipalette |= 0x0001;\n\t}\n\t\n\tthis.resetLayers();\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundControl = function(bg, value) {\n\tvar bgData = this.bg[bg];\n\tbgData.priority = value & 0x0003;\n\tbgData.charBase = (value & 0x000C) << 12;\n\tbgData.mosaic = value & 0x0040;\n\tbgData.multipalette &= ~0x0080;\n\tif (bg < 2 || this.backgroundMode == 0) {\n\t\tbgData.multipalette |= value & 0x0080;\n\t}\n\tbgData.screenBase = (value & 0x1F00) << 3;\n\tbgData.overflow = value & 0x2000;\n\tbgData.size = (value & 0xC000) >> 14;\n\n\tthis.drawLayers.sort(this.layerComparator);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundHOffset = function(bg, value) {\n\tthis.bg[bg].x = value & 0x1FF;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundVOffset = function(bg, value) {\n\tthis.bg[bg].y = value & 0x1FF;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundRefX = function(bg, value) {\n\tthis.bg[bg].refx = (value << 4) / 0x1000;\n\tthis.bg[bg].sx = this.bg[bg].refx;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundRefY = function(bg, value) {\n\tthis.bg[bg].refy = (value << 4) / 0x1000;\n\tthis.bg[bg].sy = this.bg[bg].refy;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamA = function(bg, value) {\n\tthis.bg[bg].dx = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamB = function(bg, value) {\n\tthis.bg[bg].dmx = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamC = function(bg, value) {\n\tthis.bg[bg].dy = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamD = function(bg, value) {\n\tthis.bg[bg].dmy = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin0H = function(value) {\n\tthis.win0Left = (value & 0xFF00) >> 8;\n\tthis.win0Right = Math.min(this.HORIZONTAL_PIXELS, value & 0x00FF);\n\tif (this.win0Left > this.win0Right) {\n\t\tthis.win0Right = this.HORIZONTAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin1H = function(value) {\n\tthis.win1Left = (value & 0xFF00) >> 8;\n\tthis.win1Right = Math.min(this.HORIZONTAL_PIXELS, value & 0x00FF);\n\tif (this.win1Left > this.win1Right) {\n\t\tthis.win1Right = this.HORIZONTAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin0V = function(value) {\n\tthis.win0Top = (value & 0xFF00) >> 8;\n\tthis.win0Bottom = Math.min(this.VERTICAL_PIXELS, value & 0x00FF);\n\tif (this.win0Top > this.win0Bottom) {\n\t\tthis.win0Bottom = this.VERTICAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin1V = function(value) {\n\tthis.win1Top = (value & 0xFF00) >> 8;\n\tthis.win1Bottom = Math.min(this.VERTICAL_PIXELS, value & 0x00FF);\n\tif (this.win1Top > this.win1Bottom) {\n\t\tthis.win1Bottom = this.VERTICAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWindow = function(index, value) {\n\tvar window = this.windows[index];\n\twindow.enabled[0] = value & 0x01;\n\twindow.enabled[1] = value & 0x02;\n\twindow.enabled[2] = value & 0x04;\n\twindow.enabled[3] = value & 0x08;\n\twindow.enabled[4] = value & 0x10;\n\twindow.special = value & 0x20;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWinIn = function(value) {\n\tthis.writeWindow(0, value);\n\tthis.writeWindow(1, value >> 8);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWinOut = function(value) {\n\tthis.writeWindow(2, value);\n\tthis.writeWindow(3, value >> 8);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendControl = function(value) {\n\tthis.target1[0] = !!(value & 0x0001) * this.TARGET1_MASK;\n\tthis.target1[1] = !!(value & 0x0002) * this.TARGET1_MASK;\n\tthis.target1[2] = !!(value & 0x0004) * this.TARGET1_MASK;\n\tthis.target1[3] = !!(value & 0x0008) * this.TARGET1_MASK;\n\tthis.target1[4] = !!(value & 0x0010) * this.TARGET1_MASK;\n\tthis.target1[5] = !!(value & 0x0020) * this.TARGET1_MASK;\n\tthis.target2[0] = !!(value & 0x0100) * this.TARGET2_MASK;\n\tthis.target2[1] = !!(value & 0x0200) * this.TARGET2_MASK;\n\tthis.target2[2] = !!(value & 0x0400) * this.TARGET2_MASK;\n\tthis.target2[3] = !!(value & 0x0800) * this.TARGET2_MASK;\n\tthis.target2[4] = !!(value & 0x1000) * this.TARGET2_MASK;\n\tthis.target2[5] = !!(value & 0x2000) * this.TARGET2_MASK;\n\tthis.blendMode = (value & 0x00C0) >> 6;\n\n\tswitch (this.blendMode) {\n\tcase 1:\n\t\t// Alpha\n\t\t// Fall through\n\tcase 0:\n\t\t// Normal\n\t\tthis.palette.makeNormalPalettes();\n\t\tbreak;\n\tcase 2:\n\t\t// Brighter\n\t\tthis.palette.makeBrightPalettes(value & 0x3F);\n\t\tbreak;\n\tcase 3:\n\t\t// Darker\n\t\tthis.palette.makeDarkPalettes(value & 0x3F);\n\t\tbreak;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.setBlendEnabled = function(layer, enabled, override) {\n\tthis.alphaEnabled = enabled && override == 1;\n\tif (enabled) {\n\t\tswitch (override) {\n\t\tcase 1:\n\t\t\t// Alpha\n\t\t\t// Fall through\n\t\tcase 0:\n\t\t\t// Normal\n\t\t\tthis.palette.makeNormalPalette(layer);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t// Brighter\n\t\tcase 3:\n\t\t\t// Darker\n\t\t\tthis.palette.makeSpecialPalette(layer);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tthis.palette.makeNormalPalette(layer);\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendAlpha = function(value) {\n\tthis.blendA = (value & 0x001F) / 16;\n\tif (this.blendA > 1) {\n\t\tthis.blendA = 1;\n\t}\n\tthis.blendB = ((value & 0x1F00) >> 8) / 16;\n\tif (this.blendB > 1) {\n\t\tthis.blendB = 1;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendY = function(value) {\n\tthis.blendY = value;\n\tthis.palette.setBlendY(value >= 16 ? 1 : (value / 16));\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeMosaic = function(value) {\n\tthis.bgMosaicX = (value & 0xF) + 1;\n\tthis.bgMosaicY = ((value >> 4) & 0xF) + 1;\n\tthis.objMosaicX = ((value >> 8) & 0xF) + 1;\n\tthis.objMosaicY = ((value >> 12) & 0xF) + 1;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.resetLayers = function() {\n\tif (this.backgroundMode > 1) {\n\t\tthis.bg[0].enabled = false;\n\t\tthis.bg[1].enabled = false;\n\t}\n\tif (this.bg[2].enabled) {\n\t\tthis.bg[2].drawScanline = this.bgModes[this.backgroundMode];\n\t}\n\tif ((this.backgroundMode == 0 || this.backgroundMode == 2)) {\n\t\tif (this.bg[3].enabled) {\n\t\t\tthis.bg[3].drawScanline = this.bgModes[this.backgroundMode];\n\t\t}\n\t} else {\n\t\tthis.bg[3].enabled = false;\n\t}\n\tthis.drawLayers.sort(this.layerComparator);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.layerComparator = function(a, b) {\n\tvar diff = b.priority - a.priority;\n\tif (!diff) {\n\t\tif (a.bg && !b.bg) {\n\t\t\treturn -1;\n\t\t} else if (!a.bg && b.bg) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn b.index - a.index;\n\t}\n\treturn diff;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessMapMode0 = function(base, size, x, yBase, out) {\n\tvar offset = base + ((x >> 2) & 0x3E) + yBase;\n\n\tif (size & 1) {\n\t\toffset += (x & 0x100) << 3;\n\t}\n\n\tvar mem = this.vram.loadU16(offset);\n\tout.tile = mem & 0x03FF;\n\tout.hflip = mem & 0x0400;\n\tout.vflip = mem & 0x0800;\n\tout.palette = (mem & 0xF000) >> 8 // This is shifted up 4 to make pushPixel faster\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessMapMode1 = function(base, size, x, yBase, out) {\n\tvar offset = base + (x >> 3) + yBase;\n\n\tout.tile = this.vram.loadU8(offset);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessTile = function(base, tile, y) {\n\tvar offset = base + (tile << 5);\n\toffset |= y << 2;\n\n\treturn this.vram.load32(offset);\n}\n\nGameBoyAdvanceSoftwareRenderer.pushPixel = function(layer, map, video, row, x, offset, backing, mask, raw) {\n\tvar index;\n\tif (!raw) {\n\t\tif (this.multipalette) {\n\t\t\tindex = (row >> (x << 3)) & 0xFF;\n\t\t} else {\n\t\t\tindex = (row >> (x << 2)) & 0xF;\n\t\t}\n\t\t// Index 0 is transparent\n\t\tif (!index) {\n\t\t\treturn;\n\t\t} else if (!this.multipalette) {\n\t\t\tindex |= map.palette;\n\t\t}\n\t}\n\n\tvar stencil = video.WRITTEN_MASK;\n\tvar oldStencil = backing.stencil[offset];\n\tvar blend = video.blendMode;\n\tif (video.objwinActive) {\n\t\tif (oldStencil & video.OBJWIN_MASK) {\n\t\t\tif (video.windows[3].enabled[layer]) {\n\t\t\t\tvideo.setBlendEnabled(layer, video.windows[3].special && video.target1[layer], blend);\n\t\t\t\tif (video.windows[3].special && video.alphaEnabled) {\n\t\t\t\t\tmask |= video.target1[layer];\n\t\t\t\t}\n\t\t\t\tstencil |= video.OBJWIN_MASK;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (video.windows[2].enabled[layer]) {\n\t\t\tvideo.setBlendEnabled(layer, video.windows[2].special && video.target1[layer], blend);\n\t\t\tif (video.windows[2].special && video.alphaEnabled) {\n\t\t\t\tmask |= video.target1[layer];\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif ((mask & video.TARGET1_MASK) && (oldStencil & video.TARGET2_MASK)) {\n\t\tvideo.setBlendEnabled(layer, true, 1);\n\t}\n\n\tvar pixel = raw ? row : video.palette.accessColor(layer, index);\n\n\tif (mask & video.TARGET1_MASK) {\n\t\tvideo.setBlendEnabled(layer, !!blend, blend);\n\t}\n\tvar highPriority = (mask & video.PRIORITY_MASK) < (oldStencil & video.PRIORITY_MASK);\n\t// Backgrounds can draw over each other, too.\n\tif ((mask & video.PRIORITY_MASK) == (oldStencil & video.PRIORITY_MASK)) {\n\t\thighPriority = mask & video.BACKGROUND_MASK;\n\t}\n\n\tif (!(oldStencil & video.WRITTEN_MASK)) {\n\t\t// Nothing here yet, just continue\n\t\tstencil |= mask;\n\t} else if (highPriority) {\n\t\t// We are higher priority\n\t\tif (mask & video.TARGET1_MASK && oldStencil & video.TARGET2_MASK) {\n\t\t\tpixel = video.palette.mix(video.blendA, pixel, video.blendB, backing.color[offset]);\n\t\t}\n\t\t// We just drew over something, so it doesn't make sense for us to be a TARGET1 anymore...\n\t\tstencil |= mask & ~video.TARGET1_MASK;\n\t} else if ((mask & video.PRIORITY_MASK) > (oldStencil & video.PRIORITY_MASK)) {\n\t\t// We're below another layer, but might be the blend target for it\n\t\tstencil = oldStencil & ~(video.TARGET1_MASK | video.TARGET2_MASK);\n\t\tif (mask & video.TARGET2_MASK && oldStencil & video.TARGET1_MASK) {\n\t\t\tpixel = video.palette.mix(video.blendB, pixel, video.blendA, backing.color[offset]);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tif (mask & video.OBJWIN_MASK) {\n\t\t// We ARE the object window, don't draw pixels!\n\t\tbacking.stencil[offset] |= video.OBJWIN_MASK;\n\t\treturn;\n\t}\n\tbacking.color[offset] = pixel;\n\tbacking.stencil[offset] = stencil;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.identity = function(x) {\n\treturn x;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBlank = function(backing) {\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tbacking.color[x] = 0xFFFF;\n\t\tbacking.stencil[x] = 0;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.prepareScanline = function(backing) {\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tbacking.stencil[x] = this.target2[this.LAYER_BACKDROP];\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode0 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar xOff = bg.x;\n\tvar yOff = bg.y;\n\tvar localX;\n\tvar localXLo;\n\tvar localY = y + yOff;\n\tif (this.mosaic) {\n\t\tlocalY -= y % video.bgMosaicY;\n\t}\n\tvar localYLo = localY & 0x7;\n\tvar mosaicX;\n\tvar screenBase = bg.screenBase;\n\tvar charBase = bg.charBase;\n\tvar size = bg.size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar paletteShift = bg.multipalette ? 1 : 0;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase = (localY << 3) & 0x7C0;\n\tif (size == 2) {\n\t\tyBase += (localY << 3) & 0x800;\n\t} else if (size == 3) {\n\t\tyBase += (localY << 4) & 0x1000;\n\t}\n\n\tvar xMask;\n\tif (size & 1) {\n\t\txMask = 0x1FF;\n\t} else {\n\t\txMask = 0xFF;\n\t}\n\n\tvideo.accessMapMode0(screenBase, size, (start + xOff) & xMask, yBase, map);\n\tvar tileRow = video.accessTile(charBase, map.tile << paletteShift, (!map.vflip ? localYLo : 7 - localYLo) << paletteShift);\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = (x + xOff) & xMask;\n\t\tmosaicX = this.mosaic ? offset % video.bgMosaicX : 0;\n\t\tlocalX -= mosaicX;\n\t\tlocalXLo = localX & 0x7;\n\t\tif (!paletteShift) {\n\t\t\tif (!localXLo || (this.mosaic && !mosaicX)) {\n\t\t\t\tvideo.accessMapMode0(screenBase, size, localX, yBase, map);\n\t\t\t\ttileRow = video.accessTile(charBase, map.tile, !map.vflip ? localYLo : 7 - localYLo);\n\t\t\t\tif (!tileRow && !localXLo) {\n\t\t\t\t\tx += 7;\n\t\t\t\t\toffset += 8;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!localXLo || (this.mosaic && !mosaicX)) {\n\t\t\t\tvideo.accessMapMode0(screenBase, size, localX, yBase, map);\n\t\t\t}\n\t\t\tif (!(localXLo & 0x3) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(charBase + (!!(localX & 0x4) == !map.hflip ? 4 : 0), map.tile << 1, (!map.vflip ? localYLo : 7 - localYLo) << 1);\n\t\t\t\tif (!tileRow && !(localXLo & 0x3)) {\n\t\t\t\t\tx += 3;\n\t\t\t\t\toffset += 4;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (map.hflip) {\n\t\t\tlocalXLo = 7 - localXLo;\n\t\t}\n\t\tbg.pushPixel(index, map, video, tileRow, localXLo, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode2 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar screenBase = bg.screenBase;\n\tvar charBase = bg.charBase;\n\tvar size = bg.size;\n\tvar sizeAdjusted = 128 << size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (bg.overflow) {\n\t\t\tlocalX &= sizeAdjusted - 1;\n\t\t\tif (localX < 0) {\n\t\t\t\tlocalX += sizeAdjusted;\n\t\t\t}\n\t\t\tlocalY &= sizeAdjusted - 1;\n\t\t\tif (localY < 0) {\n\t\t\t\tlocalY += sizeAdjusted;\n\t\t\t}\n\t\t} else if (localX < 0 || localY < 0 || localX >= sizeAdjusted || localY >= sizeAdjusted) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tyBase = ((localY << 1) & 0x7F0) << size;\n\t\tvideo.accessMapMode1(screenBase, size, localX, yBase, map);\n\t\tcolor = this.vram.loadU8(charBase + (map.tile << 6) + ((localY & 0x7) << 3) + (localX & 0x7));\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode3 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (localX < 0 || localY < 0 || localX >= video.HORIZONTAL_PIXELS || localY >= video.VERTICAL_PIXELS) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU16(((localY * video.HORIZONTAL_PIXELS) + localX) << 1);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, true);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode4 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar charBase = 0;\n\tif (video.displayFrameSelect) {\n\t\tcharBase += 0xA000;\n\t}\n\tvar size = bg.size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = 0 | bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tyBase = (localY << 2) & 0x7E0;\n\t\tif (localX < 0 || localY < 0 || localX >= video.HORIZONTAL_PIXELS || localY >= video.VERTICAL_PIXELS) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU8(charBase + (localY * video.HORIZONTAL_PIXELS) + localX);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode5 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar charBase = 0;\n\tif (video.displayFrameSelect) {\n\t\tcharBase += 0xA000;\n\t}\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (localX < 0 || localY < 0 || localX >= 160 || localY >= 128) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU16(charBase + ((localY * 160) + localX) << 1);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, true);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanline = function(y) {\n\tvar backing = this.scanline;\n\tif (this.forcedBlank) {\n\t\tthis.drawScanlineBlank(backing);\n\t\treturn;\n\t}\n\tthis.prepareScanline(backing);\n\tvar layer;\n\tvar firstStart;\n\tvar firstEnd;\n\tvar lastStart;\n\tvar lastEnd;\n\tthis.vcount = y;\n\t// Draw lower priority first and then draw over them\n\tfor (var i = 0; i < this.drawLayers.length; ++i) {\n\t\tlayer = this.drawLayers[i];\n\t\tif (!layer.enabled) {\n\t\t\tcontinue;\n\t\t}\n\t\tthis.objwinActive = false;\n\t\tif (!(this.win0 || this.win1 || this.objwin)) {\n\t\t\tthis.setBlendEnabled(layer.index, this.target1[layer.index], this.blendMode);\n\t\t\tlayer.drawScanline(backing, layer, 0, this.HORIZONTAL_PIXELS);\n\t\t} else {\n\t\t\tfirstStart = 0;\n\t\t\tfirstEnd = this.HORIZONTAL_PIXELS;\n\t\t\tlastStart = 0;\n\t\t\tlastEnd = this.HORIZONTAL_PIXELS;\n\t\t\tif (this.win0 && y >= this.win0Top && y < this.win0Bottom) {\n\t\t\t\tif (this.windows[0].enabled[layer.index]) {\n\t\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[0].special && this.target1[layer.index], this.blendMode);\n\t\t\t\t\tlayer.drawScanline(backing, layer, this.win0Left, this.win0Right);\n\t\t\t\t}\n\t\t\t\tfirstStart = Math.max(firstStart, this.win0Left);\n\t\t\t\tfirstEnd = Math.min(firstEnd, this.win0Left);\n\t\t\t\tlastStart = Math.max(lastStart, this.win0Right);\n\t\t\t\tlastEnd = Math.min(lastEnd, this.win0Right);\n\t\t\t}\n\t\t\tif (this.win1 && y >= this.win1Top && y < this.win1Bottom) {\n\t\t\t\tif (this.windows[1].enabled[layer.index]) {\n\t\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[1].special && this.target1[layer.index], this.blendMode);\n\t\t\t\t\tif (!this.windows[0].enabled[layer.index] && (this.win1Left < firstStart || this.win1Right < lastStart)) {\n\t\t\t\t\t\t// We've been cut in two by window 0!\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, this.win1Left, firstStart);\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastEnd, this.win1Right);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, this.win1Left, this.win1Right);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfirstStart = Math.max(firstStart, this.win1Left);\n\t\t\t\tfirstEnd = Math.min(firstEnd, this.win1Left);\n\t\t\t\tlastStart = Math.max(lastStart, this.win1Right);\n\t\t\t\tlastEnd = Math.min(lastEnd, this.win1Right);\n\t\t\t}\n\t\t\t// Do last two\n\t\t\tif (this.windows[2].enabled[layer.index] || (this.objwin && this.windows[3].enabled[layer.index])) {\n\t\t\t\t// WINOUT/OBJWIN\n\t\t\t\tthis.objwinActive = this.objwin;\n\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[2].special && this.target1[layer.index], this.blendMode); // Window 3 handled in pushPixel\n\t\t\t\tif (firstEnd > lastStart) {\n\t\t\t\t\tlayer.drawScanline(backing, layer, 0, this.HORIZONTAL_PIXELS);\n\t\t\t\t} else {\n\t\t\t\t\tif (firstEnd) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, 0, firstEnd);\n\t\t\t\t\t}\n\t\t\t\t\tif (lastStart < this.HORIZONTAL_PIXELS) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastStart, this.HORIZONTAL_PIXELS);\n\t\t\t\t\t}\n\t\t\t\t\tif (lastEnd < firstStart) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastEnd, firstStart);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setBlendEnabled(this.LAYER_BACKDROP, this.target1[this.LAYER_BACKDROP] && this.windows[2].special, this.blendMode);\n\t\t}\n\t\tif (layer.bg) {\n\t\t\tlayer.sx += layer.dmx;\n\t\t\tlayer.sy += layer.dmy;\n\t\t}\n\t}\n\n\tthis.finishScanline(backing);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.finishScanline = function(backing) {\n\tvar color;\n\tvar bd = this.palette.accessColor(this.LAYER_BACKDROP, 0);\n\tvar xx = this.vcount * this.HORIZONTAL_PIXELS * 4;\n\tvar isTarget2 = this.target2[this.LAYER_BACKDROP];\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tif (backing.stencil[x] & this.WRITTEN_MASK) {\n\t\t\tcolor = backing.color[x];\n\t\t\tif (isTarget2 && backing.stencil[x] & this.TARGET1_MASK) {\n\t\t\t\tcolor = this.palette.mix(this.blendA, color, this.blendB, bd);\n\t\t\t}\n\t\t\tthis.palette.convert16To32(color, this.sharedColor);\n\t\t} else {\n\t\t\tthis.palette.convert16To32(bd, this.sharedColor);\n\t\t}\n\t\tthis.pixelData.data[xx++] = this.sharedColor[0];\n\t\tthis.pixelData.data[xx++] = this.sharedColor[1];\n\t\tthis.pixelData.data[xx++] = this.sharedColor[2];\n\t\txx++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.startDraw = function() {\n\t// Nothing to do\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.finishDraw = function(caller) {\n\tthis.bg[2].sx = this.bg[2].refx;\n\tthis.bg[2].sy = this.bg[2].refy;\n\tthis.bg[3].sx = this.bg[3].refx;\n\tthis.bg[3].sy = this.bg[3].refy;\n\tcaller.finishDraw(this.pixelData);\n};\n\nexport default GameBoyAdvanceSoftwareRenderer;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport GameBoyAdvanceSoftwareRenderer from './video/software';\n\nfunction GameBoyAdvanceVideo() {\n\tthis.renderPath = new GameBoyAdvanceSoftwareRenderer();\n\n\tthis.CYCLES_PER_PIXEL = 4;\n\n\tthis.HORIZONTAL_PIXELS = 240;\n\tthis.HBLANK_PIXELS = 68;\n\tthis.HDRAW_LENGTH = 1006;\n\tthis.HBLANK_LENGTH = 226;\n\tthis.HORIZONTAL_LENGTH = 1232;\n\n\tthis.VERTICAL_PIXELS = 160;\n\tthis.VBLANK_PIXELS = 68;\n\tthis.VERTICAL_TOTAL_PIXELS = 228;\n\n\tthis.TOTAL_LENGTH = 280896;\n\n\tthis.drawCallback = function() {};\n\tthis.vblankCallback = function() {};\n};\n\nGameBoyAdvanceVideo.prototype.clear = function() {\n\tthis.renderPath.clear(this.cpu.mmu);\n\n\t// DISPSTAT\n\tthis.DISPSTAT_MASK = 0xFF38;\n\tthis.inHblank = false;\n\tthis.inVblank = false;\n\tthis.vcounter = 0;\n\tthis.vblankIRQ = 0;\n\tthis.hblankIRQ = 0;\n\tthis.vcounterIRQ = 0;\n\tthis.vcountSetting = 0;\n\n\t// VCOUNT\n\tthis.vcount = -1;\n\n\tthis.lastHblank = 0;\n\tthis.nextHblank = this.HDRAW_LENGTH;\n\tthis.nextEvent = this.nextHblank;\n\n\tthis.nextHblankIRQ = 0;\n\tthis.nextVblankIRQ = 0;\n\tthis.nextVcounterIRQ = 0;\n};\n\nGameBoyAdvanceVideo.prototype.freeze = function() {\n\treturn {\n\t\t'inHblank': this.inHblank,\n\t\t'inVblank': this.inVblank,\n\t\t'vcounter': this.vcounter,\n\t\t'vblankIRQ': this.vblankIRQ,\n\t\t'hblankIRQ': this.hblankIRQ,\n\t\t'vcounterIRQ': this.vcounterIRQ,\n\t\t'vcountSetting': this.vcountSetting,\n\t\t'vcount': this.vcount,\n\t\t'lastHblank': this.lastHblank,\n\t\t'nextHblank': this.nextHblank,\n\t\t'nextEvent': this.nextEvent,\n\t\t'nextHblankIRQ': this.nextHblankIRQ,\n\t\t'nextVblankIRQ': this.nextVblankIRQ,\n\t\t'nextVcounterIRQ': this.nextVcounterIRQ,\n\t\t'renderPath': this.renderPath.freeze(this.core.encodeBase64)\n\t};\n};\n\nGameBoyAdvanceVideo.prototype.defrost = function(frost) {\n\tthis.inHblank = frost.inHblank;\n\tthis.inVblank = frost.inVblank;\n\tthis.vcounter = frost.vcounter;\n\tthis.vblankIRQ = frost.vblankIRQ;\n\tthis.hblankIRQ = frost.hblankIRQ;\n\tthis.vcounterIRQ = frost.vcounterIRQ;\n\tthis.vcountSetting = frost.vcountSetting;\n\tthis.vcount = frost.vcount;\n\tthis.lastHblank = frost.lastHblank;\n\tthis.nextHblank = frost.nextHblank;\n\tthis.nextEvent = frost.nextEvent;\n\tthis.nextHblankIRQ = frost.nextHblankIRQ;\n\tthis.nextVblankIRQ = frost.nextVblankIRQ;\n\tthis.nextVcounterIRQ = frost.nextVcounterIRQ;\n\tthis.renderPath.defrost(frost.renderPath, this.core.decodeBase64);\n};\n\nGameBoyAdvanceVideo.prototype.setBacking = function(backing) {\n\tvar pixelData = backing.createImageData(this.HORIZONTAL_PIXELS, this.VERTICAL_PIXELS);\n\tthis.context = backing;\n\n\t// Clear backing first\n\tfor (var offset = 0; offset < this.HORIZONTAL_PIXELS * this.VERTICAL_PIXELS * 4;) {\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t}\n\n\tthis.renderPath.setBacking(pixelData);\n}\n\nGameBoyAdvanceVideo.prototype.updateTimers = function(cpu) {\n\tvar cycles = cpu.cycles;\n\n\tif (this.nextEvent <= cycles) {\n\t\tif (this.inHblank) {\n\t\t\t// End Hblank\n\t\t\tthis.inHblank = false;\n\t\t\tthis.nextEvent = this.nextHblank;\n\n\t\t\t++this.vcount;\n\n\t\t\tswitch (this.vcount) {\n\t\t\tcase this.VERTICAL_PIXELS:\n\t\t\t\tthis.inVblank = true;\n\t\t\t\tthis.renderPath.finishDraw(this);\n\t\t\t\tthis.nextVblankIRQ = this.nextEvent + this.TOTAL_LENGTH;\n\t\t\t\tthis.cpu.mmu.runVblankDmas();\n\t\t\t\tif (this.vblankIRQ) {\n\t\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VBLANK);\n\t\t\t\t}\n\t\t\t\tthis.vblankCallback();\n\t\t\t\tbreak;\n\t\t\tcase this.VERTICAL_TOTAL_PIXELS - 1:\n\t\t\t\tthis.inVblank = false;\n\t\t\t\tbreak;\n\t\t\tcase this.VERTICAL_TOTAL_PIXELS:\n\t\t\t\tthis.vcount = 0;\n\t\t\t\tthis.renderPath.startDraw();\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.vcounter = this.vcount == this.vcountSetting;\n\t\t\tif (this.vcounter && this.vcounterIRQ) {\n\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VCOUNTER);\n\t\t\t\tthis.nextVcounterIRQ += this.TOTAL_LENGTH;\n\t\t\t}\n\n\t\t\tif (this.vcount < this.VERTICAL_PIXELS) {\n\t\t\t\tthis.renderPath.drawScanline(this.vcount);\n\t\t\t}\n\t\t} else {\n\t\t\t// Begin Hblank\n\t\t\tthis.inHblank = true;\n\t\t\tthis.lastHblank = this.nextHblank;\n\t\t\tthis.nextEvent = this.lastHblank + this.HBLANK_LENGTH;\n\t\t\tthis.nextHblank = this.nextEvent + this.HDRAW_LENGTH;\n\t\t\tthis.nextHblankIRQ = this.nextHblank;\n\n\t\t\tif (this.vcount < this.VERTICAL_PIXELS) {\n\t\t\t\tthis.cpu.mmu.runHblankDmas();\n\t\t\t}\n\t\t\tif (this.hblankIRQ) {\n\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_HBLANK);\n\t\t\t}\n\t\t}\n\t}\n};\n\nGameBoyAdvanceVideo.prototype.writeDisplayStat = function(value) {\n\tthis.vblankIRQ = value & 0x0008;\n\tthis.hblankIRQ = value & 0x0010;\n\tthis.vcounterIRQ = value & 0x0020;\n\tthis.vcountSetting = (value & 0xFF00) >> 8;\n\n\tif (this.vcounterIRQ) {\n\t\t// FIXME: this can be too late if we're in the middle of an Hblank\n\t\tthis.nextVcounterIRQ = this.nextHblank + this.HBLANK_LENGTH + (this.vcountSetting - this.vcount) * this.HORIZONTAL_LENGTH;\n\t\tif (this.nextVcounterIRQ < this.nextEvent) {\n\t\t\tthis.nextVcounterIRQ += this.TOTAL_LENGTH;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceVideo.prototype.readDisplayStat = function() {\n\treturn (this.inVblank) | (this.inHblank << 1) | (this.vcounter << 2);\n};\n\nGameBoyAdvanceVideo.prototype.finishDraw = function(pixelData) {\n\tthis.context.putImageData(pixelData, 0, 0);\n\tthis.drawCallback();\n};\n\nexport default GameBoyAdvanceVideo;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nfunction GameBoyAdvanceKeypad() {\n\tthis.KEYCODE_LEFT = 37;\n\tthis.KEYCODE_UP = 38;\n\tthis.KEYCODE_RIGHT = 39;\n\tthis.KEYCODE_DOWN = 40;\n\tthis.KEYCODE_START = 13;\n\tthis.KEYCODE_SELECT = 220;\n\tthis.KEYCODE_A = 90;\n\tthis.KEYCODE_B = 88;\n\tthis.KEYCODE_L = 65;\n\tthis.KEYCODE_R = 83;\n\n\tthis.GAMEPAD_LEFT = 14;\n\tthis.GAMEPAD_UP = 12;\n\tthis.GAMEPAD_RIGHT = 15;\n\tthis.GAMEPAD_DOWN = 13;\n\tthis.GAMEPAD_START = 9;\n\tthis.GAMEPAD_SELECT = 8;\n\tthis.GAMEPAD_A = 1;\n\tthis.GAMEPAD_B = 0;\n\tthis.GAMEPAD_L = 4;\n\tthis.GAMEPAD_R = 5;\n\tthis.GAMEPAD_THRESHOLD = 0.2;\n\n\tthis.A = 0;\n\tthis.B = 1;\n\tthis.SELECT = 2;\n\tthis.START = 3;\n\tthis.RIGHT = 4;\n\tthis.LEFT = 5;\n\tthis.UP = 6;\n\tthis.DOWN = 7;\n\tthis.R = 8;\n\tthis.L = 9;\n\n\tthis.currentDown = 0x03FF;\n\tthis.eatInput = false;\n\n\tthis.gamepads = [];\n};\n\nGameBoyAdvanceKeypad.prototype.clickHandlerStart = function(e) {\n\tvar toggle = e.clickedButton || 0;\n\ttoggle = 1 << toggle;\n\tthis.currentDown &= ~toggle;\n}\n\nGameBoyAdvanceKeypad.prototype.clickHandlerEnd = function(e) {\n\tvar toggle = e.clickedButton || 0;\n\ttoggle = 1 << toggle;\n\tthis.currentDown |= toggle;\n}\n\nGameBoyAdvanceKeypad.prototype.keyboardHandler = function(e) {\n\tvar toggle = 0;\n\tswitch (e.keyCode) {\n\tcase this.KEYCODE_START:\n\t\ttoggle = this.START;\n\t\tbreak;\n\tcase this.KEYCODE_SELECT:\n\t\ttoggle = this.SELECT;\n\t\tbreak;\n\tcase this.KEYCODE_A:\n\t\ttoggle = this.A;\n\t\tbreak;\n\tcase this.KEYCODE_B:\n\t\ttoggle = this.B;\n\t\tbreak;\n\tcase this.KEYCODE_L:\n\t\ttoggle = this.L;\n\t\tbreak;\n\tcase this.KEYCODE_R:\n\t\ttoggle = this.R;\n\t\tbreak;\n\tcase this.KEYCODE_UP:\n\t\ttoggle = this.UP;\n\t\tbreak;\n\tcase this.KEYCODE_RIGHT:\n\t\ttoggle = this.RIGHT;\n\t\tbreak;\n\tcase this.KEYCODE_DOWN:\n\t\ttoggle = this.DOWN;\n\t\tbreak;\n\tcase this.KEYCODE_LEFT:\n\t\ttoggle = this.LEFT;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\ttoggle = 1 << toggle;\n\tif (e.type == \"keydown\") {\n\t\tthis.currentDown &= ~toggle;\n\t} else {\n\t\tthis.currentDown |= toggle;\n\t}\n\n\tif (this.eatInput) {\n\t\te.preventDefault();\n\t}\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadHandler = function(gamepad) {\n\tvar value = 0;\n\tif (gamepad.buttons[this.GAMEPAD_LEFT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.LEFT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_UP] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.UP;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_RIGHT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.RIGHT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_DOWN] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.DOWN;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_START] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.START;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_SELECT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.SELECT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_A] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.A;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_B] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.B;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_L] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.L;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_R] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.R;\n\t}\n\n\tthis.currentDown = ~value & 0x3FF;\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadConnectHandler = function(gamepad) {\n\tthis.gamepads.push(gamepad);\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadDisconnectHandler = function(gamepad) {\n\tthis.gamepads = window.self.gamepads.filter(function(other) { return other != gamepad });\n};\n\nGameBoyAdvanceKeypad.prototype.pollGamepads = function() {\n\tvar navigatorList = [];\n\tif (navigator.webkitGetGamepads) {\n\t\tnavigatorList = navigator.webkitGetGamepads();\n\t} else if (navigator.getGamepads) {\n\t\tnavigatorList = navigator.getGamepads();\n\t}\n\n\t// Let's all give a shout out to Chrome for making us get the gamepads EVERY FRAME\n\tif (navigatorList.length) {\n\t\tthis.gamepads = [];\n\t}\n\tfor (var i = 0; i < navigatorList.length; ++i) {\n\t\tif (navigatorList[i]) {\n\t\t\tthis.gamepads.push(navigatorList[i]);\n\t\t}\n\t}\n\tif (this.gamepads.length > 0) {\n\t\tthis.gamepadHandler(this.gamepads[0]);\n\t}\n\n};\n\nGameBoyAdvanceKeypad.prototype.registerHandlers = function() {\n\twindow.addEventListener(\"keydown\", this.keyboardHandler.bind(this), true);\n\twindow.addEventListener(\"keyup\", this.keyboardHandler.bind(this), true);\n\n\twindow.addEventListener(\"gamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\twindow.addEventListener(\"mozgamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\twindow.addEventListener(\"webkitgamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\n\twindow.addEventListener(\"gamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n\twindow.addEventListener(\"mozgamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n\twindow.addEventListener(\"webkitgamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n};\n\nexport default GameBoyAdvanceKeypad;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { hex } from './util';\n\nfunction GameBoyAdvanceSIO() {\n\tthis.SIO_NORMAL_8 = 0;\n\tthis.SIO_NORMAL_32 = 1;\n\tthis.SIO_MULTI = 2;\n\tthis.SIO_UART = 3;\n\tthis.SIO_GPIO = 8;\n\tthis.SIO_JOYBUS = 12;\n\n\tthis.BAUD = [ 9600, 38400, 57600, 115200 ];\n}\n\nGameBoyAdvanceSIO.prototype.clear = function() {\n\tthis.mode = this.SIO_GPIO;\n\tthis.sd = false;\n\n\tthis.irq = false;\n\tthis.multiplayer = {\n\t\tbaud: 0,\n\t\tsi: 0,\n\t\tid: 0,\n\t\terror: 0,\n\t\tbusy: 0,\n\n\t\tstates: [ 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF ]\n\t};\n\n\tthis.linkLayer = null;\n};\n\nGameBoyAdvanceSIO.prototype.setMode = function(mode) {\n\tif (mode & 0x8) {\n\t\tmode &= 0xC;\n\t} else {\n\t\tmode &= 0x3;\n\t}\n\tthis.mode = mode;\n\n\tthis.core.INFO('Setting SIO mode to ' + hex(mode, 1));\n};\n\nGameBoyAdvanceSIO.prototype.writeRCNT = function(value) {\n\tif (this.mode != this.SIO_GPIO) {\n\t\treturn;\n\t}\n\n\tthis.core.STUB('General purpose serial not supported');\n};\n\nGameBoyAdvanceSIO.prototype.writeSIOCNT = function(value) {\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_8:\n\t\tthis.core.STUB('8-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\tthis.multiplayer.baud = value & 0x0003;\n\t\tif (this.linkLayer) {\n\t\t\tthis.linkLayer.setBaud(this.BAUD[this.multiplayer.baud]);\n\t\t}\n\n\t\tif (!this.multiplayer.si) {\n\t\t\tthis.multiplayer.busy = value & 0x0080;\n\t\t\tif (this.linkLayer && this.multiplayer.busy) {\n\t\t\t\tthis.linkLayer.startMultiplayerTransfer();\n\t\t\t}\n\t\t}\n\t\tthis.irq = value & 0x4000;\n\t\tbreak;\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tcase this.SIO_GPIO:\n\t\t// This register isn't used in general-purpose mode\n\t\tbreak;\n\tcase this.SIO_JOYBUS:\n\t\tthis.core.STUB('JOY BUS unsupported');\n\t\tbreak;\n\t}\n};\n\nGameBoyAdvanceSIO.prototype.readSIOCNT = function() {\n\tvar value = (this.mode << 12) & 0xFFFF;\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_8:\n\t\tthis.core.STUB('8-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\tvalue |= this.multiplayer.baud;\n\t\tvalue |= this.multiplayer.si;\n\t\tvalue |= (!!this.sd) << 3;\n\t\tvalue |= this.multiplayer.id << 4;\n\t\tvalue |= this.multiplayer.error;\n\t\tvalue |= this.multiplayer.busy;\n\t\tvalue |= (!!this.multiplayer.irq) << 14;\n\t\tbreak;\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tcase this.SIO_GPIO:\n\t\t// This register isn't used in general-purpose mode\n\t\tbreak;\n\tcase this.SIO_JOYBUS:\n\t\tthis.core.STUB('JOY BUS unsupported');\n\t\tbreak;\n\t}\n\treturn value;\n};\n\nGameBoyAdvanceSIO.prototype.read = function(slot) {\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\treturn this.multiplayer.states[slot];\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tdefault:\n\t\tthis.core.WARN('Reading from transfer register in unsupported mode');\n\t\tbreak;\n\t}\n\treturn 0;\n};\n\nexport default GameBoyAdvanceSIO;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport ARMCore from './core';\nimport GameBoyAdvanceMMU from './mmu';\nimport GameBoyAdvanceInterruptHandler from './irq';\nimport GameBoyAdvanceIO from './io';\nimport GameBoyAdvanceAudio from './audio';\nimport GameBoyAdvanceVideo from './video';\nimport GameBoyAdvanceKeypad from './keypad';\nimport GameBoyAdvanceSIO from './sio';\n\nfunction GameBoyAdvance() {\n\tthis.LOG_ERROR = 1;\n\tthis.LOG_WARN = 2;\n\tthis.LOG_STUB = 4;\n\tthis.LOG_INFO = 8;\n\tthis.LOG_DEBUG = 16;\n\n\tthis.SYS_ID = 'com.endrift.gbajs';\n\n\tthis.logLevel = this.LOG_ERROR | this.LOG_WARN;\n\n\tthis.rom = null;\n\n\tObject.prototype.inherit = function() {\n\t\tfor (var v in this) {\n\t\t\tthis[v] = this[v];\n\t\t}\n\t};\n\n\tthis.cpu = new ARMCore();\n\tthis.mmu = new GameBoyAdvanceMMU()\n\tthis.irq = new GameBoyAdvanceInterruptHandler();\n\tthis.io = new GameBoyAdvanceIO();\n\tthis.audio = new GameBoyAdvanceAudio();\n\tthis.video = new GameBoyAdvanceVideo();\n\tthis.keypad = new GameBoyAdvanceKeypad();\n\tthis.sio = new GameBoyAdvanceSIO();\n\n\t// TODO: simplify this graph\n\tthis.cpu.mmu = this.mmu;\n\tthis.cpu.irq = this.irq;\n\n\tthis.mmu.cpu = this.cpu;\n\tthis.mmu.core = this;\n\n\tthis.irq.cpu = this.cpu;\n\tthis.irq.io = this.io;\n\tthis.irq.audio = this.audio;\n\tthis.irq.video = this.video;\n\tthis.irq.core = this;\n\n\tthis.io.cpu = this.cpu;\n\tthis.io.audio = this.audio;\n\tthis.io.video = this.video;\n\tthis.io.keypad = this.keypad;\n\tthis.io.sio = this.sio;\n\tthis.io.core = this;\n\n\tthis.audio.cpu = this.cpu;\n\tthis.audio.core = this;\n\n\tthis.video.cpu = this.cpu;\n\tthis.video.core = this;\n\n\tthis.keypad.core = this;\n\n\tthis.sio.core = this;\n\n\tthis.keypad.registerHandlers();\n\tthis.doStep = this.waitFrame;\n\tthis.paused = false;\n\n\tthis.seenFrame = false;\n\tthis.seenSave = false;\n\tthis.lastVblank = 0;\n\n\tthis.queue = null;\n\tthis.reportFPS = null;\n\tthis.throttle = 16; // This is rough, but the 2/3ms difference gives us a good overhead\n\n\tvar self = this;\n\twindow.queueFrame = function (f) {\n\t\tself.queue = window.setTimeout(f, self.throttle);\n\t};\n\n\twindow.URL = window.URL || window.webkitURL;\n\n\tthis.video.vblankCallback = function() {\n\t\tself.seenFrame = true;\n\t};\n};\n\nGameBoyAdvance.prototype.setCanvas = function(canvas) {\n\tvar self = this;\n\tif (canvas.offsetWidth != 240 || canvas.offsetHeight != 160) {\n\t\tthis.indirectCanvas = document.createElement(\"canvas\");\n\t\tthis.indirectCanvas.setAttribute(\"height\", \"160\");\n\t\tthis.indirectCanvas.setAttribute(\"width\", \"240\");\n\t\tthis.targetCanvas = canvas;\n\t\tthis.setCanvasDirect(this.indirectCanvas);\n\t\tvar targetContext = canvas.getContext('2d');\n\t\tthis.video.drawCallback = function() {\n\t\t\ttargetContext.drawImage(self.indirectCanvas, 0, 0, canvas.offsetWidth, canvas.offsetHeight);\n\t\t}\n\t} else {\n\t\tthis.setCanvasDirect(canvas);\n\t\tvar self = this;\n\t}\n};\n\nGameBoyAdvance.prototype.setCanvasDirect = function(canvas) {\n\tthis.context = canvas.getContext('2d');\n\tthis.video.setBacking(this.context);\n};\n\nGameBoyAdvance.prototype.setBios = function(bios, real) {\n\tthis.mmu.loadBios(bios, real);\n};\n\nGameBoyAdvance.prototype.setRom = function(rom) {\n\tthis.reset();\n\n\tthis.rom = this.mmu.loadRom(rom, true);\n\tif (!this.rom) {\n\t\treturn false;\n\t}\n\tthis.retrieveSavedata();\n\treturn true;\n};\n\nGameBoyAdvance.prototype.hasRom = function() {\n\treturn !!this.rom;\n};\n\nGameBoyAdvance.prototype.loadRomFromFile = function(romFile, callback) {\n\tvar reader = new FileReader();\n\tvar self = this;\n\treader.onload = function(e) {\n\t\tvar result = self.setRom(e.target.result);\n\t\tif (callback) {\n\t\t\tcallback(result);\n\t\t}\n\t}\n\treader.readAsArrayBuffer(romFile);\n};\n\nGameBoyAdvance.prototype.reset = function() {\n\tthis.audio.pause(true);\n\n\tthis.mmu.clear();\n\tthis.io.clear();\n\tthis.audio.clear();\n\tthis.video.clear();\n\tthis.sio.clear();\n\n\tthis.mmu.mmap(this.mmu.REGION_IO, this.io);\n\tthis.mmu.mmap(this.mmu.REGION_PALETTE_RAM, this.video.renderPath.palette);\n\tthis.mmu.mmap(this.mmu.REGION_VRAM, this.video.renderPath.vram);\n\tthis.mmu.mmap(this.mmu.REGION_OAM, this.video.renderPath.oam);\n\n\tthis.cpu.resetCPU(0);\n};\n\nGameBoyAdvance.prototype.step = function() {\n\twhile (this.doStep()) {\n\t\tthis.cpu.step();\n\t}\n};\n\nGameBoyAdvance.prototype.waitFrame = function() {\n\tvar seen = this.seenFrame;\n\tthis.seenFrame = false;\n\treturn !seen;\n};\n\nGameBoyAdvance.prototype.pause = function() {\n\tthis.paused = true;\n\tthis.audio.pause(true);\n\tif (this.queue) {\n\t\tclearTimeout(this.queue);\n\t\tthis.queue = null;\n\t}\n};\n\nGameBoyAdvance.prototype.advanceFrame = function() {\n\tthis.step();\n\tif (this.seenSave) {\n\t\tif (!this.mmu.saveNeedsFlush()) {\n\t\t\tthis.storeSavedata();\n\t\t\tthis.seenSave = false;\n\t\t} else {\n\t\t\tthis.mmu.flushSave();\n\t\t}\n\t} else if (this.mmu.saveNeedsFlush()) {\n\t\tthis.seenSave = true;\n\t\tthis.mmu.flushSave();\n\t}\n};\n\nGameBoyAdvance.prototype.runStable = function() {\n\tif (this.interval) {\n\t\treturn; // Already running\n\t}\n\tvar self = this;\n\tvar timer = 0;\n\tvar frames = 0;\n\tvar runFunc;\n\tvar start = Date.now();\n\tthis.paused = false;\n\tthis.audio.context.resume();\n\tthis.audio.pause(false);\n\n\tif (this.reportFPS) {\n\t\trunFunc = function() {\n\t\t\ttry {\n\t\t\t\ttimer += Date.now() - start;\n\t\t\t\tif (self.paused) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\twindow.queueFrame(runFunc);\n\t\t\t\t}\n\t\t\t\tstart = Date.now();\n\t\t\t\tself.advanceFrame();\n\t\t\t\t++frames;\n\t\t\t\tif (frames == 60) {\n\t\t\t\t\tself.reportFPS((frames * 1000) / timer);\n\t\t\t\t\tframes = 0;\n\t\t\t\t\ttimer = 0;\n\t\t\t\t}\n\t\t\t} catch(exception) {\n\t\t\t\tself.ERROR(exception);\n\t\t\t\tif (exception.stack) {\n\t\t\t\t\tself.logStackTrace(exception.stack.split('\\n'));\n\t\t\t\t}\n\t\t\t\tthrow exception;\n\t\t\t}\n\t\t};\n\t} else {\n\t\trunFunc = function() {\n\t\t\ttry {\n\t\t\t\tif (self.paused) {\n\t\t\t\t\treturn;\n\t\t\t\t} else {\n\t\t\t\t\twindow.queueFrame(runFunc);\n\t\t\t\t}\n\t\t\t\tself.advanceFrame();\n\t\t\t} catch(exception) {\n\t\t\t\tself.ERROR(exception);\n\t\t\t\tif (exception.stack) {\n\t\t\t\t\tself.logStackTrace(exception.stack.split('\\n'));\n\t\t\t\t}\n\t\t\t\tthrow exception;\n\t\t\t}\n\t\t};\n\t}\n\twindow.queueFrame(runFunc);\n};\n\nGameBoyAdvance.prototype.setSavedata = function(data) {\n\tthis.mmu.loadSavedata(data);\n};\n\nGameBoyAdvance.prototype.loadSavedataFromFile = function(saveFile) {\n\tvar reader = new FileReader();\n\tvar self = this;\n\treader.onload = function(e) { self.setSavedata(e.target.result); }\n\treader.readAsArrayBuffer(saveFile);\n};\n\nGameBoyAdvance.prototype.decodeSavedata = function(string) {\n\tthis.setSavedata(this.decodeBase64(string));\n};\n\nGameBoyAdvance.prototype.decodeBase64 = function(string) {\n\tvar length = (string.length * 3 / 4);\n\tif (string[string.length - 2] == '=') {\n\t\tlength -= 2;\n\t} else if (string[string.length - 1] == '=') {\n\t\tlength -= 1;\n\t}\n\tvar buffer = new ArrayBuffer(length);\n\tvar view = new Uint8Array(buffer);\n\tvar bits = string.match(/..../g);\n\tfor (var i = 0; i + 2 < length; i += 3) {\n\t\tvar s = atob(bits.shift());\n\t\tview[i] = s.charCodeAt(0);\n\t\tview[i + 1] = s.charCodeAt(1);\n\t\tview[i + 2] = s.charCodeAt(2);\n\t}\n\tif (i < length) {\n\t\tvar s = atob(bits.shift());\n\t\tview[i++] = s.charCodeAt(0);\n\t\tif (s.length > 1) {\n\t\t\tview[i++] = s.charCodeAt(1);\n\t\t}\n\t}\n\n\treturn buffer;\n};\n\nGameBoyAdvance.prototype.encodeBase64 = function(view) {\n\tvar data = [];\n\tvar b;\n\tvar wordstring = [];\n\tvar triplet;\n\tfor (var i = 0; i < view.byteLength; ++i) {\n\t\tb = view.getUint8(i, true);\n\t\twordstring.push(String.fromCharCode(b));\n\t\twhile (wordstring.length >= 3) {\n\t\t\ttriplet = wordstring.splice(0, 3);\n\t\t\tdata.push(btoa(triplet.join('')));\n\t\t}\n\t};\n\tif (wordstring.length) {\n\t\tdata.push(btoa(wordstring.join('')));\n\t}\n\treturn data.join('');\n};\n\nGameBoyAdvance.prototype.downloadSavedata = function() {\n\tvar sram = this.mmu.save;\n\tif (!sram) {\n\t\tthis.WARN(\"No save data available\");\n\t\treturn null;\n\t}\n\tif (window.URL) {\n\t\tvar url = window.URL.createObjectURL(new Blob([sram.buffer], { type: 'application/octet-stream' }));\n\t\twindow.open(url);\n\t} else {\n\t\tvar data = this.encodeBase64(sram.view);\n\t\twindow.open('data:application/octet-stream;base64,' + data, this.rom.code + '.sav');\n\t}\n};\n\n\nGameBoyAdvance.prototype.storeSavedata = function() {\n\tvar sram = this.mmu.save;\n\ttry {\n\t\tvar storage = window.localStorage;\n\t\tstorage[this.SYS_ID + '.' + this.mmu.cart.code] = this.encodeBase64(sram.view);\n\t} catch (e) {\n\t\tthis.WARN('Could not store savedata! ' + e);\n\t}\n};\n\nGameBoyAdvance.prototype.retrieveSavedata = function() {\n\ttry {\n\t\tvar storage = window.localStorage;\n\t\tvar data = storage[this.SYS_ID + '.' + this.mmu.cart.code];\n\t\tif (data) {\n\t\t\tthis.decodeSavedata(data);\n\t\t\treturn true;\n\t\t}\n\t} catch (e) {\n\t\tthis.WARN('Could not retrieve savedata! ' + e);\n\t}\n\treturn false;\n};\n\nGameBoyAdvance.prototype.freeze = function() {\n\treturn {\n\t\t'cpu': this.cpu.freeze(),\n\t\t'mmu': this.mmu.freeze(),\n\t\t'irq': this.irq.freeze(),\n\t\t'io': this.io.freeze(),\n\t\t'audio': this.audio.freeze(),\n\t\t'video': this.video.freeze()\n\t}\n};\n\nGameBoyAdvance.prototype.defrost = function(frost) {\n\tthis.cpu.defrost(frost.cpu);\n\tthis.mmu.defrost(frost.mmu);\n\tthis.audio.defrost(frost.audio);\n\tthis.video.defrost(frost.video);\n\tthis.irq.defrost(frost.irq);\n\tthis.io.defrost(frost.io);\n};\n\nGameBoyAdvance.prototype.log = function(level, message) {};\n\nGameBoyAdvance.prototype.setLogger = function(logger) {\n\tthis.log = logger;\n};\n\nGameBoyAdvance.prototype.logStackTrace = function(stack) {\n\tvar overflow = stack.length - 32;\n\tthis.ERROR('Stack trace follows:');\n\tif (overflow > 0) {\n\t\tthis.log(-1, '> (Too many frames)');\n\t}\n\tfor (var i = Math.max(overflow, 0); i < stack.length; ++i) {\n\t\tthis.log(-1, '> ' + stack[i]);\n\t}\n};\n\nGameBoyAdvance.prototype.ERROR = function(error) {\n\tif (this.logLevel & this.LOG_ERROR) {\n\t\tthis.log(this.LOG_ERROR, error);\n\t}\n};\n\nGameBoyAdvance.prototype.WARN = function(warn) {\n\tif (this.logLevel & this.LOG_WARN) {\n\t\tthis.log(this.LOG_WARN, warn);\n\t}\n};\n\nGameBoyAdvance.prototype.STUB = function(func) {\n\tif (this.logLevel & this.LOG_STUB) {\n\t\tthis.log(this.LOG_STUB, func);\n\t}\n};\n\nGameBoyAdvance.prototype.INFO = function(info) {\n\tif (this.logLevel & this.LOG_INFO) {\n\t\tthis.log(this.LOG_INFO, info);\n\t}\n};\n\nGameBoyAdvance.prototype.DEBUG = function(info) {\n\tif (this.logLevel & this.LOG_DEBUG) {\n\t\tthis.log(this.LOG_DEBUG, info);\n\t}\n};\n\nGameBoyAdvance.prototype.ASSERT_UNREACHED = function(err) {\n\tthrow new Error(\"Should be unreached: \" + err);\n};\n\nGameBoyAdvance.prototype.ASSERT = function(test, err) {\n\tif (!test) {\n\t\tthrow new Error(\"Assertion failed: \" + err);\n\t}\n};\n\nexport default GameBoyAdvance;\n","import React from 'react';\r\nimport { Table, Paper, makeStyles, TableCell, TableRow } from '@material-ui/core';\r\n\r\nconst useStyle = makeStyles((theme) => ({\r\n    container: {\r\n        width: '100%',\r\n        maxWidth: 700,\r\n        margin: '16px auto',\r\n        height: 150,\r\n        textShadow: 'none',\r\n\r\n        '& td': {\r\n            padding: 0,\r\n        },\r\n    },\r\n    paper: {\r\n        textAlign: 'center',\r\n        margin: 0,\r\n        borderRadius: 0,\r\n        background: '#759',\r\n        color: 'white',\r\n        fontWeight: 'bold',\r\n    },\r\n    topPaper: {\r\n        background: '#648',\r\n    },\r\n}));\r\n\r\nfunction GBAControlsHelper (props) {\r\n    const classes = useStyle();\r\n\r\n    return (\r\n        <Table className={classes.container}>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={`${classes.paper} ${classes.topPaper}`}>GBA Buttons</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={`${classes.paper} ${classes.topPaper}`}>Respective Keyboard</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>A</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Z</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>B</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>X</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>L</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>A</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>R</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>S</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Start</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Enter</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Select</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>\\</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Arrows</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Arrows</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n        </Table>\r\n    );\r\n}\r\n\r\nexport default GBAControlsHelper;","import React from 'react';\r\nimport { Button, withStyles } from '@material-ui/core';\r\nimport { commands } from './GBAScreen';\r\n\r\nconst styles = () => {\r\n    const width = window.screen.width;\r\n\r\n    return {\r\n        container: {\r\n            position: 'relative',\r\n            height: 300,\r\n        },\r\n        \"LEFT\": {\r\n            position: 'absolute',\r\n            left: 8,\r\n            top: 150,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"RIGHT\": {\r\n            position: 'absolute',\r\n            left: 108,\r\n            top: 150,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"UP\": {\r\n            position: 'absolute',\r\n            left: 58,\r\n            top: 100,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"DOWN\": {\r\n            position: 'absolute',\r\n            left: 58,\r\n            top: 200,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"A\": {\r\n            position: 'absolute',\r\n            right: 8,\r\n            top: 110,\r\n            color: 'white',\r\n            padding: '16px 0',\r\n            border: '1px solid white',\r\n            borderRadius: '50%',\r\n        },\r\n        \"B\": {\r\n            position: 'absolute',\r\n            right: 68,\r\n            top: 170,\r\n            color: 'white',\r\n            padding: '16px 0',\r\n            border: '1px solid white',\r\n            borderRadius: '50%',\r\n        },\r\n        \"R\": {\r\n            position: 'absolute',\r\n            right: 8,\r\n            top: 30,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"L\": {\r\n            position: 'absolute',\r\n            left: 8,\r\n            top: 30,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"START\": {\r\n            position: 'absolute',\r\n            right: 70,\r\n            bottom: 8,\r\n            color: 'white',\r\n        },\r\n        \"SELECT\": {\r\n            position: 'absolute',\r\n            left: 70,\r\n            bottom: 8,\r\n            color: 'white',\r\n        },\r\n        fullscreen: {\r\n            color: 'white',\r\n        }\r\n    };\r\n};\r\n\r\nconst commandToStr = {\r\n    \"LEFT\": String.fromCharCode(parseInt(\"+2190\", 16)),\r\n    \"RIGHT\": String.fromCharCode(parseInt(\"+2192\", 16)),\r\n    \"UP\": String.fromCharCode(parseInt(\"+2191\", 16)),\r\n    \"DOWN\": String.fromCharCode(parseInt(\"+2193\", 16)),\r\n    \"A\": \"A\",\r\n    \"B\": \"B\",\r\n    \"R\": \"R\",\r\n    \"L\": \"L\",\r\n    \"START\": \"START\",\r\n    \"SELECT\": \"SELECT\",\r\n}\r\n\r\nconst GBAMobileController = ({ classes, goFull, toogleSpeed, throttle }) => {\r\n    // COmented for PWA reasons\r\n    // <Button className={classes.fullscreen} onClick={goFull}>Fullscreen</Button>\r\n    return (\r\n        <div className={classes.container}>\r\n            {commands.map(command => (\r\n                <Button id={command} className={classes[command]}>{commandToStr[command]}</Button>\r\n            ))}\r\n            {(document.body.requestFullscreen ||\r\n                document.body.mozRequestFullScreen ||\r\n                document.body.webkitRequestFullScreen ||\r\n                document.body.msRequestFullscreen) &&\r\n                <Button className={classes.fullscreen} onClick={goFull}>Fullscreen</Button>}\r\n            {throttle && <Button className={classes.fullscreen} onClick={toogleSpeed}>{{\r\n                16: '1x',\r\n                12: '1.5x',\r\n                8: '2x',\r\n            }[throttle]}</Button>}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withStyles(styles)(GBAMobileController);\r\n","import React from 'react';\r\nimport GameBoyAdvance from '../libs/js/gba';\r\nimport loadRom from '../libs/resources/xhr';\r\nimport '../libs/resources/main.css';\r\nimport CrashImage from '../libs/resources/crash.png';\r\nimport BackgroundImage from '../libs/resources/bg.png';\r\nimport Bios from '../libs/resources/bios.bin';\r\nimport { withStyles, Button } from '@material-ui/core';\r\nimport GBAControlsHelper from './GBAControlsHelper';\r\nimport GBAMobileController from './GBAMobileController';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport VolumeDown from '@material-ui/icons/VolumeDown';\r\nimport VolumeUp from '@material-ui/icons/VolumeUp';\r\n\r\nconst WhiteCheckbox = withStyles({\r\n    root: {\r\n      color: 'white',\r\n      '&$checked': {\r\n        color: 'white',\r\n      },\r\n    },\r\n    checked: {},\r\n})(props => <Checkbox color=\"default\" {...props} />);\r\n\r\nconst styles = () => {\r\n    const screenWidth = window.screen.width;\r\n    const width = screenWidth > 480 ? 480 : screenWidth;\r\n    const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n    const noselect = {\r\n        '-webkit-touch-callout': 'none', /* iOS Safari */\r\n        '-webkit-user-select': 'none', /* Safari */\r\n        '-khtml-user-select': 'none', /* Konqueror HTML */\r\n        '-moz-user-select': 'none',/* Old versions of Firefox */\r\n        '-ms-user-select': 'none', /* Internet Explorer/Edge */\r\n        'user-select': 'none', /* Non-prefixed version, currently\r\n                                    supported by Chrome, Opera and Firefox */\r\n    }\r\n\r\n    return ({\r\n        container: {\r\n            ...noselect,\r\n            width: '100%',\r\n            height: '100%',\r\n            overflow: 'hidden',\r\n            '-webkit-overflow-scrolling': 'touch',\r\n            minHeight: '100vh',\r\n            background: '-webkit-linear-gradient(#765490 560px, #6A4883 620px, #433061 900px)',\r\n            textAlign: 'center',\r\n            fontFamily: '\"Calibri\", \"Verdana\", sans-serif',\r\n            color: 'white',\r\n            textShadow: '0 2px rgba(0, 0, 0, 0.6)',\r\n        },\r\n        screen: {\r\n            ...noselect,\r\n            background: `url('${BackgroundImage}') no-repeat top center`,\r\n\r\n            '@media (max-width:480px)': {\r\n                background: 'none',\r\n            },\r\n        },\r\n        canvas: {\r\n            ...noselect,\r\n            marginTop: 85,\r\n            marginBottom: 150,\r\n            \r\n            '&[width=\"240\"]': {\r\n                marginTop: 42.5,\r\n                marginBottom: -363, /* Take up no height */\r\n                imageRendering: '-webkit-optimize-contrast',\r\n                imageRendering: '-moz-crisp-edges',\r\n                imageRendering: '-o-crisp-edges',\r\n                zoom: 2,\r\n                transform: 'scale(2)',\r\n            },\r\n            '@media (max-width:480px)': {\r\n                background: 'gray',\r\n                marginTop: 0,\r\n                marginBottom: 0,\r\n            },\r\n        },\r\n        controls: {\r\n            ...noselect,\r\n            borderRadius: 20,\r\n            border: '1px solid rgba(0, 0, 0, 0.4)',\r\n            borderTop: 'none',\r\n            boxShadow: '0 4px 4px -2px rgba(0, 0, 0, 0.9), 0 -40px 2px -1px #433061 inset',\r\n            width: '100vw',\r\n            maxWidth: 700,\r\n            margin: 'auto',\r\n            height: 200,\r\n            overflow: 'hidden',\r\n            backgroundColor: '#765490',\r\n            position: 'relative',\r\n\r\n            '&::before': {\r\n                content: '\"\"',\r\n                display: 'block',\r\n                height: 30,\r\n                width: 'calc(100vw + 7px)',\r\n                maxWidth: 707,\r\n                borderRadius: '5px / 15px',\r\n                border: '1px solid rgba(0, 0, 0, 0.4)',\r\n                borderWidth: '0 1px',\r\n                margin: '0 -5px 20px',\r\n                background: '-moz-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)',\r\n                background: '-webkit-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)',\r\n                boxShadow: '0 5px 4px -3px rgba(0, 0, 0, 0.6)',\r\n                position: 'absolute',\r\n            },\r\n            '& > div': {\r\n                // marginTop: 30,\r\n                marginTop: -15,\r\n                transform: 'rotateX(0deg)',\r\n                transformOrigin: '50% 0',\r\n                transition: 'transform linear 0.5s',\r\n                '-moz-transform-origin': '50% 0',\r\n                '-moz-transform': 'rotateX(0deg)',\r\n                '-moz-transition': '-moz-transform linear 0.5s',\r\n                '-webkit-transform-origin-y': 2,\r\n                '-webkit-transform': 'rotateX(0deg)',\r\n                '-webkit-transition': '-webkit-transform linear 0.5s',\r\n            },\r\n        },\r\n        hidden: {\r\n            transform: 'rotateX(90deg) !important',\r\n            // -moz-transform: 'rotateX(90deg) !important';\r\n            // -webkit-transform: 'rotateX(90deg) !important';\r\n        },\r\n        dead: {\r\n            display: 'none',\r\n        },\r\n        button: {\r\n            fontFamily: '\"Calibri\", \"Verdana\", sans-serif',\r\n            backgroundColor: '#6A4883',\r\n            fontWeight: 'bold',\r\n            fontSize: 18,\r\n            color: 'white',\r\n            textShadow: '0 3px #433061',\r\n            padding: '2px 10px 5px',\r\n            borderRadius: '0 0 10px 10px',\r\n            border: '0 solid rgba(0, 0, 0, 0.4)',\r\n            borderWidth: '3px 1px 0px',\r\n            display: 'inline',\r\n            boxShadow: '0 2px 6px -1px rgba(0, 0, 0, 0.2) inset',\r\n            margin: '0 0 20px',\r\n        },\r\n        noselect,\r\n    });\r\n};\r\n\r\nexport const commands = [\r\n    \"LEFT\",\r\n    \"RIGHT\",\r\n    \"UP\",\r\n    \"DOWN\",\r\n    \"A\",\r\n    \"B\",\r\n    \"R\",\r\n    \"L\",\r\n    \"START\",\r\n    \"SELECT\",\r\n];\r\n\r\nvar gba;\r\n\r\nclass GBAScreen extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isFull: false,\r\n            throttle: 16,\r\n        };\r\n\r\n        this.initGBA = this.initGBA.bind(this);\r\n        this.toogleSpeed = this.toogleSpeed.bind(this);\r\n        // this.goFull = this.goFull.bind(this);\r\n    }\r\n\r\n    goFull() {\r\n        // this.setState({ isFull: true });\r\n        var doc = window.document;\r\n        var docEl = doc.documentElement;\r\n        \r\n        var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n        var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n        \r\n        if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {\r\n            requestFullScreen.call(docEl);\r\n        }\r\n        else {\r\n            cancelFullScreen.call(doc);\r\n        }\r\n    }\r\n\r\n    toogleSpeed() {\r\n        if (gba) {\r\n            var throttle = gba.throttle;\r\n\r\n            gba.throttle = {\r\n                16: 12,\r\n                12: 8,\r\n                8: 16,\r\n            }[throttle];\r\n\r\n            this.setState({\r\n                throttle: gba.throttle,\r\n            });\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.initGBA();\r\n\r\n        window.addEventListener('beforeinstallprompt',e=>{\r\n            // For older browsers\r\n            e.preventDefault();\r\n            console.log(\"Install Prompt fired\");\r\n            this.installPrompt = e;\r\n            // See if the app is already installed, in that case, do nothing\r\n            if((window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone === true){\r\n              return false;\r\n            }\r\n            // Set the state variable to make button visible\r\n            this.setState({\r\n                installButton:true,\r\n            });\r\n        });\r\n    }\r\n\r\n    async installApp () {\r\n        if(!this.installPrompt) return false;\r\n        this.installPrompt.prompt();\r\n        let outcome = await this.installPrompt.userChoice;\r\n        if(outcome.outcome=='accepted'){\r\n          console.log(\"App Installed\")\r\n        }\r\n        else{\r\n          console.log(\"App not installed\");\r\n        }\r\n        // Remove the event reference\r\n        this.installPrompt=null;\r\n        // Hide the button\r\n        this.setState({\r\n          installButton:false\r\n        })\r\n    }\r\n\r\n    initGBA() {\r\n        var runCommands = [];\r\n        const {\r\n            classes,\r\n        } = this.props;  \r\n\r\n        document.addEventListener('gesturestart', function (e) {\r\n            e.preventDefault();\r\n        });\r\n\r\n        // Initialize emulator once the browser loads\r\n        window.onload = function () {\r\n            // Setup the emulator\r\n            try {\r\n                gba = new GameBoyAdvance();\r\n                gba.keypad.eatInput = true;\r\n\r\n                gba.setLogger(function (level, error) {\r\n                    console.error(error);\r\n                    \r\n                    gba.pause();\r\n                    \r\n                    var screen = document.getElementById('screen');\r\n                    \r\n                    if (screen.getAttribute('class') === classes.dead) {\r\n                        console.log('We appear to have crashed multiple times without reseting.');\r\n                        return;\r\n                    }\r\n\r\n                    // Show error image in the emulator screen\r\n                    // The image can be retrieven from the repository\r\n                    var crash = document.createElement('img');\r\n                    crash.setAttribute('id', 'crash');\r\n                    crash.setAttribute('src', CrashImage);\r\n                    screen.parentElement.insertBefore(crash, screen);\r\n                    screen.setAttribute('class', classes.dead);\r\n                });\r\n\r\n                // In order to pause/resume the game when the user changes the website tab in the browser\r\n                // add the 2 following listeners to the window !\r\n                // \r\n                // This feature is problematic/tricky to handle, so you can make it better if you need to\r\n                window.onblur = function () {\r\n                    if(gba.hasRom()){\r\n                        var e = document.getElementById('pause');\r\n\r\n                        if (!gba.paused) {\r\n                            gba.pause();\r\n                            e.textContent = \"UNPAUSE\";\r\n\r\n                            console.log(\"Window Focused: the game has been paused\");\r\n                        }\r\n                    }\r\n                };\r\n\r\n                window.onfocus = function () {\r\n                    if(gba.hasRom()){\r\n                        var e = document.getElementById('pause');\r\n\r\n                        if (gba.paused) {\r\n                            gba.runStable();\r\n                            e.textContent = \"PAUSE\";\r\n\r\n                            console.log(\"Window Focused: the game has been resumed\");\r\n                        }\r\n                    }\r\n                };\r\n            } catch (exception) {\r\n                gba = null;\r\n            }\r\n\r\n            if (gba && FileReader) {\r\n                var canvas = document.getElementById('screen');\r\n                gba.setCanvas(canvas);\r\n\r\n                gba.logLevel = gba.LOG_ERROR;\r\n\r\n                // Load the BIOS file of GBA (change the path according to yours)\r\n                loadRom(Bios, function (bios) {\r\n                    gba.setBios(bios);\r\n                });\r\n\r\n                if (!gba.audio.context) {\r\n                    // Remove the sound box if sound isn't available\r\n                    var soundbox = document.getElementById('sound');\r\n                    soundbox.parentElement.removeChild(soundbox);\r\n                }\r\n\r\n            } else {\r\n                var dead = document.getElementById('controls');\r\n                dead.parentElement.removeChild(dead);\r\n            }\r\n        }\r\n        window.onload();\r\n\r\n        function fadeOut(id, nextId, kill) {\r\n            var e = document.getElementById(id);\r\n            var e2 = document.getElementById(nextId);\r\n            if (!e) {\r\n                return;\r\n            }\r\n\r\n            var removeSelf = function () {\r\n                if (kill) {\r\n                    e.parentElement.removeChild(e);\r\n                } else {\r\n                    e.setAttribute('class', classes.dead);\r\n                    e.removeEventListener('webkitTransitionEnd', removeSelf);\r\n                    e.removeEventListener('oTransitionEnd', removeSelf);\r\n                    e.removeEventListener('transitionend', removeSelf);\r\n                }\r\n                if (e2) {\r\n                    e2.setAttribute('class', classes.hidden);\r\n                    setTimeout(function () {\r\n                        e2.removeAttribute('class');\r\n                    }, 0);\r\n                }\r\n            }\r\n\r\n            e.addEventListener('webkitTransitionEnd', removeSelf, false);\r\n            e.addEventListener('oTransitionEnd', removeSelf, false);\r\n            e.addEventListener('transitionend', removeSelf, false);\r\n            e.setAttribute('class', classes.hidden);\r\n        }\r\n\r\n        /**\r\n         * Starts the emulator with the given ROM file\r\n         * \r\n         * @param file \r\n         */\r\n        function run(file) {\r\n            var dead = document.getElementById('loader');\r\n\r\n            dead.value = '';\r\n            \r\n            var load = document.getElementById('select');\r\n            load.textContent = 'Loading...';\r\n            load.removeAttribute('onclick');\r\n            \r\n            var pause = document.getElementById('pause');\r\n            pause.textContent = \"PAUSE\";\r\n            \r\n            gba.loadRomFromFile(file, function (result) {\r\n                if (result) {\r\n                    for (var i = 0; i < runCommands.length; ++i) {\r\n                        runCommands[i]();\r\n                    }\r\n\r\n                    runCommands = [];\r\n                    fadeOut('preload', 'ingame');\r\n                    fadeOut('instructions', null, true);\r\n                    gba.runStable();\r\n                } else {\r\n                    load.textContent = 'FAILED';\r\n\r\n                    setTimeout(function () {\r\n                        load.textContent = 'SELECT';\r\n                        \r\n                        load.onclick = function () {\r\n                            document.getElementById('loader').click();\r\n                        };\r\n\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Resets the emulator\r\n         * \r\n         */\r\n        function reset() {\r\n            gba.pause();\r\n            gba.reset();\r\n\r\n            var load = document.getElementById('select');\r\n            \r\n            load.textContent = 'SELECT';\r\n\r\n            var crash = document.getElementById('crash');\r\n            const screenWidth = window.screen.width;\r\n            const width = screenWidth > 480 ? 480 : screenWidth;\r\n            const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n            if (crash) {\r\n                var context = gba.targetCanvas.getContext('2d');\r\n                context.clearRect(0, 0, width, height);\r\n                gba.video.drawCallback();\r\n                crash.parentElement.removeChild(crash);\r\n                var canvas = document.getElementById('screen');\r\n                canvas.removeAttribute('class');\r\n            } else {\r\n                lcdFade(gba.context, gba.targetCanvas.getContext('2d'), gba.video.drawCallback);\r\n            }\r\n\r\n            load.onclick = function () {\r\n                document.getElementById('loader').click();\r\n            };\r\n\r\n            fadeOut('ingame', 'preload');\r\n\r\n            // Clear the ROM\r\n            gba.rom = null;\r\n        }\r\n\r\n        /**\r\n         * Stores the savefile data in the emulator.\r\n         * \r\n         * @param file \r\n         */\r\n        function uploadSavedataPending(file) {\r\n            runCommands.push(function () { \r\n                gba.loadSavedataFromFile(file) \r\n            });\r\n        }\r\n\r\n        /**\r\n         * Toggles the state of the game\r\n         */\r\n        function togglePause() {\r\n            var e = document.getElementById('pause');\r\n\r\n            if (gba.paused) {\r\n                gba.runStable();\r\n                e.textContent = \"PAUSE\";\r\n            } else {\r\n                gba.pause();\r\n                e.textContent = \"UNPAUSE\";\r\n            }\r\n        }\r\n\r\n        /**\r\n         * From a canvas context, creates an LCD animation that fades the content away.\r\n         * \r\n         * @param context \r\n         * @param target \r\n         * @param callback \r\n         */\r\n        function lcdFade(context, target, callback) {\r\n            var i = 0;\r\n            const screenWidth = window.screen.width;\r\n            const width = screenWidth > 480 ? 480 : screenWidth;\r\n            const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n            var drawInterval = setInterval(function () {\r\n                i++;\r\n\r\n                var pixelData = context.getImageData(0, 0, width / 2, height / 2);\r\n\r\n                for (var y = 0; y < height / 2; ++y) {\r\n                    for (var x = 0; x < width / 2; ++x) {\r\n                        var xDiff = Math.abs(x - width / 4);\r\n                        var yDiff = Math.abs(y - height / 4) * 0.8;\r\n                        var xFactor = (width / 4 - i - xDiff) / (width / 4);\r\n                        var yFactor = (height / 4 - i - ((y & 1) * 10) - yDiff + Math.pow(xDiff, 1 / 2)) / (height / 4);\r\n                        pixelData.data[(x + y * width / 2) * 4 + 3] *= Math.pow(xFactor, 1 / 3) * Math.pow(yFactor, 1 / 2);\r\n                    }\r\n                }\r\n                \r\n                context.putImageData(pixelData, 0, 0);\r\n\r\n                target.clearRect(0, 0, width, height);\r\n\r\n                if (i > 40) {\r\n                    clearInterval(drawInterval);\r\n                } else {\r\n                    callback();\r\n                }\r\n            }, 50);\r\n        }\r\n\r\n        /**\r\n         * Set the volume of the emulator.\r\n         * \r\n         * @param value \r\n         */\r\n        function setVolume(value) {\r\n            gba.audio.masterVolume = Math.pow(2, value) - 1;\r\n        }\r\n\r\n        // If clicked, simulate click on the File Select input to load a ROM\r\n        document.getElementById(\"select\").addEventListener(\"click\", function(){\r\n            document.getElementById(\"loader\").click();\r\n        }, false);\r\n\r\n        // One-liner to resume playback when user interacted with the page.\r\n        document.querySelector('button').addEventListener('click', function() {\r\n            gba.audio.context.resume();\r\n        });\r\n\r\n        // Run the emulator with the loaded ROM\r\n        document.getElementById(\"loader\").addEventListener(\"change\", function(){\r\n            var ROM = this.files[0];\r\n            run(ROM);\r\n        }, false);\r\n\r\n        // If clicked, simulate click on the File Select Input to load the savegame file\r\n        document.getElementById(\"select-savegame-btn\").addEventListener(\"click\", function(){\r\n            document.getElementById('saveloader').click();\r\n        }, false);\r\n\r\n        // Load the savegame to the emulator\r\n        document.getElementById(\"saveloader\").addEventListener(\"change\", function(){\r\n            var SAVEGAME = this.files[0];\r\n            uploadSavedataPending(SAVEGAME);\r\n        }, false); \r\n\r\n        // Pause/Resume game\r\n        document.getElementById(\"pause\").addEventListener(\"click\", function(){\r\n                togglePause();\r\n        }, false);\r\n\r\n        // Reset game\r\n        document.getElementById(\"reset-btn\").addEventListener(\"click\", function(){\r\n                reset();\r\n        }, false);\r\n\r\n        // Download the savegamefile\r\n        document.getElementById(\"download-savegame\").addEventListener(\"click\", function(){\r\n                gba.downloadSavedata();\r\n        }, false);\r\n\r\n        // Mute/Unmute emulator\r\n        document.getElementById(\"audio-enabled-checkbox\").addEventListener(\"change\", function(){\r\n            gba.audio.masterEnable = this.checked;\r\n        }, false);\r\n\r\n        commands.forEach((command) => {\r\n            if (document.getElementById(command)) {\r\n                document.getElementById(command).ontouchstart = e => {\r\n                    gba.keypad.clickHandlerStart({\r\n                        ...e,\r\n                        clickedButton: gba.keypad[command],\r\n                    });\r\n                };\r\n        \r\n                document.getElementById(command).ontouchend = e => {\r\n                    gba.keypad.clickHandlerEnd({\r\n                        ...e,\r\n                        clickedButton: gba.keypad[command],\r\n                    });\r\n                };\r\n            }\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const {\r\n            classes,\r\n        } = this.props; // Canvas 480 x 320 => 320 x 214\r\n        const screenWidth = window.screen.width;\r\n        const width = screenWidth > 480 ? 480 : screenWidth;\r\n        const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n        return (\r\n            <div className={classes.container}>\r\n                {this.state.installButton && <Button onClick={this.installApp}>Install as application</Button>}\r\n\r\n                <div className={classes.screen}>\r\n                    <div id=\"fullscreenable\">\r\n                        <canvas id=\"screen\" className={classes.canvas} width={`${width}`} height={`${height}`}></canvas>\r\n                        \r\n                        {screenWidth <= 480 ? <GBAMobileController goFull={this.goFull} throttle={this.state.throttle} toogleSpeed={this.toogleSpeed} /> : <GBAControlsHelper />}\r\n                    </div>\r\n\r\n                    <div id=\"controls\" className={classes.controls}>\r\n                        <div id=\"preload\">\r\n                            <h4 className={classes.noselect}>App Controls</h4>\r\n                            <button className={classes.button} id=\"select\"> Select ROM file</button>\r\n                            <input id=\"loader\" type=\"file\" accept=\".gba\" />\r\n                            <button className={classes.button} id=\"select-savegame-btn\">Upload Savegame</button>\r\n                            <input id=\"saveloader\" type=\"file\" />\r\n                        </div>\r\n                        <div id=\"ingame\" className={classes.hidden}>\r\n                            <h4 className={classes.noselect}>In-game controls</h4>\r\n                            <button className={classes.button} id=\"pause\">Pause</button>\r\n                            <button className={classes.button} id=\"reset-btn\">Reset</button>\r\n                            <button className={classes.button} id=\"download-savegame\">Download Savegame</button>\r\n\r\n                            <div id=\"sound\">    \r\n                                <Grid container spacing={2}>\r\n                                    <Grid item xs>\r\n                                        <p>Audio enabled</p>\r\n                                        <WhiteCheckbox value={gba && gba.audio.masterEnable} id=\"audio-enabled-checkbox\" />\r\n                                    </Grid>\r\n                                    <Grid item xs>\r\n                                        <p>Change sound level</p>\r\n                                        <Grid container spacing={2}>\r\n                                            <Grid item>\r\n                                                <VolumeDown />\r\n                                            </Grid>\r\n                                            <Grid item xs>\r\n                                                <Slider\r\n                                                    style={{\r\n                                                        color: 'white',\r\n                                                    }}\r\n                                                    onChange={(e, newValue) => {\r\n                                                        console.log(newValue);\r\n                                                        gba.audio.masterVolume = Math.pow(2, newValue / 100) - 1;\r\n                                                    }}\r\n                                                    aria-labelledby=\"continuous-slider\"\r\n                                                    inputProps={{\r\n                                                        min: 0,\r\n                                                        max: 100,\r\n                                                        type: 'number',\r\n                                                    }}\r\n                                                />\r\n                                            </Grid>\r\n                                            <Grid item>\r\n                                                <VolumeUp />\r\n                                            </Grid>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(GBAScreen);","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nexport default function loadRom(url, callback) {\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', url);\n\txhr.responseType = 'arraybuffer';\n\n\txhr.onload = function() { callback(xhr.response) };\n\txhr.send();\n}\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\n\r\n// Pages\r\nimport App from './App';\r\nimport Page404 from './pages/Page404';\r\n\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { HashRouter, Switch, Route } from 'react-router-dom';\r\nimport { Provider } from 'react-redux';\r\nimport { Store } from './store';\r\nimport GBAScreen from './components/GBAScreen';\r\n\r\nReactDOM.render(\r\n    <HashRouter>\r\n        <Provider store={Store}>\r\n            <Switch>\r\n                <Route path=\"/\" exact={true} component={App} />\r\n\r\n                <Route path=\"/emulator\" component={GBAScreen} />\r\n\r\n                <Route path='*' component={Page404} />\r\n            </Switch>\r\n        </Provider>\r\n    </HashRouter>\r\n    , document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n"],"sourceRoot":""}