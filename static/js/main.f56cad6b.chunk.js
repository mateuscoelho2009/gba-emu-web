(this["webpackJsonpgba-emu-web"]=this["webpackJsonpgba-emu-web"]||[]).push([[0],{48:function(t,e,i){t.exports=i.p+"static/media/logo.25bf045c.svg"},57:function(t,e){t.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAYAAAAEACAMAAACNqVFVAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAACdQTFRFY0u/bm5vShKmXDS2kYLMiIiTblfEubnAKys26CwsWFhbGxsjAAAAiP3GPgAAAA10Uk5T////////////////AD3oIoYAAAciSURBVHja7J0Lc6s4DEazaZv2kv7/37vr9dXoYRkIIY1JzzfThodlbJ1BBhOR0zd6qk64AAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAACAAAQAAAAHo6gOt1RAfMt+rxbQbAqwO4Gi2X2uK65XoBAIDnAZj+0/Va/891dPpf+wIozl+qFQAA+KmBzocZGxqKm9qwUf/kv9aRA1Arewyp19dgy/VatSUoAgAA8wBqmKndtkHJd1PLSKmelXWSLxPr1a2xXN4quxUAANgLgK7FE9+e/hocqsvUOlpZJ9mQ0g6hdsmXy1u15hIXAAC4B4C97JQgEsNAtM6s7J6ylIc2D82Wy1sFAAA8GkC8YfJ7egB6N2LtEeJF5VJLfP0AAMBjAZTTX90ja3MDYWvVGz7bej2SeCOWtcq2CAAAuH9CTv/rmp0mmyZZt0uttbWyn9He12vLxnK9VmlJAAAAAQAACAAAQAAAAAIAABAAAIAAAAAEAAAgAAAAAQAAj9L5TgEAAMcC8OF0Pr/fqfPZ1wgAAIwM4OPj869qAHl/Pzm9rZC3KAiKpN7REAAAAN79MnjWABJdf12hiEFCkYAYCwEAAGAB6KAbQ8/1RimCumQHZQAAYNRB+Hy+XE6Jrhsk7v/zR2FcLqPdmgEAAD4E9QFMN0gBFKdrPQUAIQgAxwTwzw2yAKwAAIBxAfTdvx+A8RAAAAAtgHZaLQL4+qp/2RoAAHB8AGXieA7ANH19TVO+1gNQoQIAAGMDqG6qADQMtSGoOD1f8wCklre3Mtn98fH2BgAAjA2gPjisDyd7AErAsSHIrlkA6vZab6kRAAA4PoC1N2LqdkIQAI4CQL5EUj4rgPqA5VYABYG6/XSqD+W5DAXAmADsVJwA8A8ktwAQt487GQEAAGQAvNt6AL7+ag7A6NNxAABACyD/UkrrfHkE30IAAABeG0B1vk5FZJNxAADAcQG0DyTbyTivdjLOArBT2wAAwPgALpf6aObz894bMXkQWQQAABxpEK4Q7gVQXU8IAsDxB+FtKRqEIAAcB4BNJWoH4W0A2hA01kNJAAAgR9AOwvuEIB7KA2BkAAVBfN1GSbLe4v6a7G2H31J3OQYAADAigPqyJoGQvXCjaNnt7csOpL7qfJL0ADAqAJE8lM9fwDSvLClj5Bf4AQAASyDyV5HNywadsV9dCQAA3BaQ1ukor20FAABuB/EKLywGAAAQAACAAAAAACAAAAABAAAIAABAAAAAAgAAEAAAgAAAAAQAAKBnALheb6umfDF8jd2t9d5Wyz61P1axjQAYCUBNcdgGoPx42iMB2Ha1tWxrNQAAEAHUnwHcAuD7e5oeCaDUDgAAPBqA/JclKS7ByQYprUoS5Fo7H9hsSW2K2thy8dMe3Zftbc9aYY8lPZ3rV9yzxqotmfUQAOMD0IBUAoCEprLk95W9dhD2+9RWg5wPc2pjy2UA6nHa0tl23wpvoWWkVM8q98G8VVaybTMAxgRQTezJE0+//HRS5/cDRHRsb1lcai9upeFZ8Mq3z4U07U0c2qOV37/OKi/ZthkAIwKoAcaHBXuKxRMqB2D3xZN6HYBYY34jNg/AtyLuaY+6n1UeZAFwBACx+/3utbcX3lV9258CkPXM15S5ci8rABwfQDmN4g2OfOq+1l1+X3tzpAO97hMbeylXS+klpr0ha9sbt/tW2PrjbaN1WWx7NqgvW2Ul2x4CYDwAOqjWJRla5KdCdItdkvLy5/epbVybpnbNNk9tfIvint722EJ7IZGXb9tue7feqlfStwgA4wF45iSthqYj1r/7Q3kA/DIA+el5nPoBAAAEAAAgAAAAAQAACAAAQAAAAAIAABAAAIAAcGwAR0j9uacHy/17nAcAAID+0drUu60tyezsz7/t74G1FgAAQP9oNhFifwA+zQgAAJirrP3yqT1I+3VV+eyXzVOg2oSm3pHbxNA8pTRPbI1BLjuKt7+1hwB4LQAx/TNL1mmbN182r1O+ji5l7XovTdUnz2p4iXvaYCMtnk9iVVf7oDjXQwC8FgB7ynnn+GRSGw58al4/Bbvf9N5l6FxdMYz0AmC/vjzJVOGu6yEAfgOAPDnPnrTPAZCl1a4F0Esy9a8iWO7h2i8CA+D1ALRbfh7A3BHm6+snmVoEyz18YggCwEMBSLqlXO75ZFJ7eebLxokvm7bp64xpovE1GLG8rPvLw3gjth5A3ya+yGauhwB4JQDz6Z/+0ze0l5SqW/Tmx6Z5xuNZm7YNbZpqTKv1CaexZ8vpqG3i6lIPdx2EAfBkALdOxK5JBx03cXSvHgLgtwJYlw46buLoXj0EwG8FgAAAAAQAACAAAAABAAAIAABAAAAAAgAAEAAG078CDAC2aBhgKkAO3AAAAABJRU5ErkJggg=="},58:function(t,e,i){t.exports=i.p+"static/media/bg.d96f92c9.png"},59:function(t,e,i){t.exports=i.p+"static/media/bios.3465b6bf.bin"},65:function(t,e,i){t.exports=i(82)},70:function(t,e,i){},71:function(t,e,i){},81:function(t,e,i){},82:function(t,e,i){"use strict";i.r(e);var s=i(0),r=i.n(s),n=i(18),a=i.n(n),h=(i(70),i(22)),o=i(48),c=i.n(o);i(71);var u=function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},r.a.createElement("img",{src:c.a,className:"App-logo",alt:"logo"}),r.a.createElement("p",null,"Inspired by the project ",r.a.createElement("a",{href:"https://github.com/endrift/gbajs",target:"_blank"},"gbajs")," which was descontinued. This project intends to:",r.a.createElement("ul",null,r.a.createElement("li",null,"Create a react component that can be used for playing GameBoy Advanced games in browser;"),r.a.createElement("li",null,"Refactor code from ",r.a.createElement("a",{href:"https://github.com/endrift/gbajs",target:"_blank"},"gbajs"),";"),r.a.createElement("li",null,"Include mobile gameplay support;"),r.a.createElement("li",null,"Develop a platform for playing GBA online."))),r.a.createElement("p",null,r.a.createElement(h.b,{to:"/emulator",className:"App-link"},"Run Emulator"))))},p=i(103),l=i(110),d=i(104),m=i(51),f=i.n(m),A=Object(l.a)((function(t){return{background:{height:"100vh",width:"100vw",backgroundColor:"#aaf",overflow:"hidden",textAlign:"center"},alertIcon:{width:"40vh",height:"40vh",marginTop:"5vh",color:"#77f"},link:{color:"#77f",textDecorationColor:"#77f","&:visited, &:hover, &:active":{color:"#55f",textDecorationColor:"#55f"}}}}));var b=Object(d.a)((function(){var t=A();return r.a.createElement("div",{className:t.background},r.a.createElement(f.a,{className:t.alertIcon}),r.a.createElement(p.a,{variant:"h2",color:"primary"},"This page does not exist."),r.a.createElement("br",null),r.a.createElement(h.b,{to:"/",className:t.link},"Please follow to the main page."))})),C=Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));function S(t,e){navigator.serviceWorker.register(t).then((function(t){t.onupdatefound=function(){var i=t.installing;null!=i&&(i.onstatechange=function(){"installed"===i.state&&(navigator.serviceWorker.controller?(console.log("New content is available and will be used when all tabs for this page are closed. See https://bit.ly/CRA-PWA."),e&&e.onUpdate&&e.onUpdate(t)):(console.log("Content is cached for offline use."),e&&e.onSuccess&&e.onSuccess(t)))})}})).catch((function(t){console.error("Error during service worker registration:",t)}))}var g=i(19),R=i(60),w=i(23),E=Object(w.b)({}),v=Object(w.c)(E),I=i(41),O=i.n(I),_=i(53),y=i(54),T=i(55),P=i(61),M=i(56),N=i(26),D=i(62),k=i(16),B=(i(80),function(t){this.cpu=t,this.addressingMode23Immediate=[function(e,i,s){var r=t.gprs,n=function(){var t=r[e];return s&&!s()||(r[e]-=i),t};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){var t=r[e];return s&&!s()||(r[e]+=i),t};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){return r[e]-i};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){var t=r[e]-i;return s&&!s()||(r[e]=t),t};return n.writesPC=e==t.PC,n},null,null,function(e,i,s){var r=t.gprs,n=function(){return r[e]+i};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){var t=r[e]+i;return s&&!s()||(r[e]=t),t};return n.writesPC=e==t.PC,n},null,null],this.addressingMode23Register=[function(e,i,s){var r=t.gprs,n=function(){var t=r[e];return s&&!s()||(r[e]-=r[i]),t};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){var t=r[e];return s&&!s()||(r[e]+=r[i]),t};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){return r[e]-r[i]};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){var t=r[e]-r[i];return s&&!s()||(r[e]=t),t};return n.writesPC=e==t.PC,n},null,null,function(e,i,s){var r=t.gprs,n=function(){return r[e]+r[i]};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){var t=r[e]+r[i];return s&&!s()||(r[e]=t),t};return n.writesPC=e==t.PC,n},null,null],this.addressingMode2RegisterShifted=[function(e,i,s){var r=t.gprs,n=function(){var n=r[e];return s&&!s()||(i(),r[e]-=t.shifterOperand),n};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){var n=r[e];return s&&!s()||(i(),r[e]+=t.shifterOperand),n};return n.writesPC=e==t.PC,n},null,null,null,function(e,i,s){var r=t.gprs,n=function(){return i(),r[e]-t.shifterOperand};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){i();var n=r[e]-t.shifterOperand;return s&&!s()||(r[e]=n),n};return n.writesPC=e==t.PC,n},null,null,function(e,i,s){var r=t.gprs,n=function(){return i(),r[e]+t.shifterOperand};return n.writesPC=!1,n},function(e,i,s){var r=t.gprs,n=function(){i();var n=r[e]+t.shifterOperand;return s&&!s()||(r[e]=n),n};return n.writePC=e==t.PC,n},null,null]});B.prototype.constructAddressingMode1ASR=function(t,e){var i=this.cpu,s=i.gprs;return function(){++i.cycles;var r=s[t];t==i.PC&&(r+=4),r&=255;var n=s[e];e==i.PC&&(n+=4),0==r?(i.shifterOperand=n,i.shifterCarryOut=i.cpsrC):r<32?(i.shifterOperand=n>>r,i.shifterCarryOut=n&1<<r-1):s[e]>>31?(i.shifterOperand=4294967295,i.shifterCarryOut=2147483648):(i.shifterOperand=0,i.shifterCarryOut=0)}},B.prototype.constructAddressingMode1Immediate=function(t){var e=this.cpu;return function(){e.shifterOperand=t,e.shifterCarryOut=e.cpsrC}},B.prototype.constructAddressingMode1ImmediateRotate=function(t,e){var i=this.cpu;return function(){i.shifterOperand=t>>>e|t<<32-e,i.shifterCarryOut=i.shifterOperand>>31}},B.prototype.constructAddressingMode1LSL=function(t,e){var i=this.cpu,s=i.gprs;return function(){++i.cycles;var r=s[t];t==i.PC&&(r+=4),r&=255;var n=s[e];e==i.PC&&(n+=4),0==r?(i.shifterOperand=n,i.shifterCarryOut=i.cpsrC):r<32?(i.shifterOperand=n<<r,i.shifterCarryOut=n&1<<32-r):32==r?(i.shifterOperand=0,i.shifterCarryOut=1&n):(i.shifterOperand=0,i.shifterCarryOut=0)}},B.prototype.constructAddressingMode1LSR=function(t,e){var i=this.cpu,s=i.gprs;return function(){++i.cycles;var r=s[t];t==i.PC&&(r+=4),r&=255;var n=s[e];e==i.PC&&(n+=4),0==r?(i.shifterOperand=n,i.shifterCarryOut=i.cpsrC):r<32?(i.shifterOperand=n>>>r,i.shifterCarryOut=n&1<<r-1):32==r?(i.shifterOperand=0,i.shifterCarryOut=n>>31):(i.shifterOperand=0,i.shifterCarryOut=0)}},B.prototype.constructAddressingMode1ROR=function(t,e){var i=this.cpu,s=i.gprs;return function(){++i.cycles;var r=s[t];t==i.PC&&(r+=4),r&=255;var n=s[e];e==i.PC&&(n+=4);var a=31&r;0==r?(i.shifterOperand=n,i.shifterCarryOut=i.cpsrC):a?(i.shifterOperand=s[e]>>>a|s[e]<<32-a,i.shifterCarryOut=n&1<<a-1):(i.shifterOperand=n,i.shifterCarryOut=n>>31)}},B.prototype.constructAddressingMode23Immediate=function(t,e,i){var s=(983040&t)>>16;return this.addressingMode23Immediate[(27262976&t)>>21](s,e,i)},B.prototype.constructAddressingMode23Register=function(t,e,i){var s=(983040&t)>>16;return this.addressingMode23Register[(27262976&t)>>21](s,e,i)},B.prototype.constructAddressingMode2RegisterShifted=function(t,e,i){var s=(983040&t)>>16;return this.addressingMode2RegisterShifted[(27262976&t)>>21](s,e,i)},B.prototype.constructAddressingMode4=function(t,e){var i=this.cpu.gprs;return function(){return i[e]+t}},B.prototype.constructAddressingMode4Writeback=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(a){var h=n[i]+t;return a&&s&&r.mmu.store32(n[i]+t-4,n[i]),n[i]+=e,h}},B.prototype.constructADC=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(r.shifterOperand>>>0)+!!r.cpsrC;n[t]=(n[e]>>>0)+a}}},B.prototype.constructADCS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(r.shifterOperand>>>0)+!!r.cpsrC,h=(n[e]>>>0)+a;t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=h>>31,r.cpsrZ=!(4294967295&h),r.cpsrC=h>4294967295,r.cpsrV=n[e]>>31==a>>31&&n[e]>>31!=h>>31&&a>>31!=h>>31),n[t]=h}}},B.prototype.constructADD=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=(n[e]>>>0)+(r.shifterOperand>>>0))}},B.prototype.constructADDS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(n[e]>>>0)+(r.shifterOperand>>>0);t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=a>>31,r.cpsrZ=!(4294967295&a),r.cpsrC=a>4294967295,r.cpsrV=n[e]>>31==r.shifterOperand>>31&&n[e]>>31!=a>>31&&r.shifterOperand>>31!=a>>31),n[t]=a}}},B.prototype.constructAND=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]&r.shifterOperand)}},B.prototype.constructANDS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]&r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructB=function(t,e){var i=this.cpu,s=i.gprs;return function(){!e||e()?(i.mmu.waitPrefetch32(s[i.PC]),s[i.PC]+=t):i.mmu.waitPrefetch32(s[i.PC])}},B.prototype.constructBIC=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]&~r.shifterOperand)}},B.prototype.constructBICS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]&~r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructBL=function(t,e){var i=this.cpu,s=i.gprs;return function(){!e||e()?(i.mmu.waitPrefetch32(s[i.PC]),s[i.LR]=s[i.PC]-4,s[i.PC]+=t):i.mmu.waitPrefetch32(s[i.PC])}},B.prototype.constructBX=function(t,e){var i=this.cpu,s=i.gprs;return function(){!e||e()?(i.mmu.waitPrefetch32(s[i.PC]),i.switchExecMode(1&s[t]),s[i.PC]=4294967294&s[t]):i.mmu.waitPrefetch32(s[i.PC])}},B.prototype.constructCMN=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var t=(n[e]>>>0)+(r.shifterOperand>>>0);r.cpsrN=t>>31,r.cpsrZ=!(4294967295&t),r.cpsrC=t>4294967295,r.cpsrV=n[e]>>31==r.shifterOperand>>31&&n[e]>>31!=t>>31&&r.shifterOperand>>31!=t>>31}}},B.prototype.constructCMP=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var t=n[e]-r.shifterOperand;r.cpsrN=t>>31,r.cpsrZ=!(4294967295&t),r.cpsrC=n[e]>>>0>=r.shifterOperand>>>0,r.cpsrV=n[e]>>31!=r.shifterOperand>>31&&n[e]>>31!=t>>31}}},B.prototype.constructEOR=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]^r.shifterOperand)}},B.prototype.constructEORS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]^r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructLDM=function(t,e,i){var s=this.cpu,r=s.gprs,n=s.mmu;return function(){if(n.waitPrefetch32(r[s.PC]),!i||i()){var a,h,o=e(!1),c=0;for(a=t,h=0;a;a>>=1,++h)1&a&&(r[h]=n.load32(4294967292&o),o+=4,++c);n.waitMulti32(o,c),++s.cycles}}},B.prototype.constructLDMS=function(t,e,i){var s=this.cpu,r=s.gprs,n=s.mmu;return function(){if(n.waitPrefetch32(r[s.PC]),!i||i()){var a,h,o=e(!1),c=0,u=s.mode;for(s.switchMode(s.MODE_SYSTEM),a=t,h=0;a;a>>=1,++h)1&a&&(r[h]=n.load32(4294967292&o),o+=4,++c);s.switchMode(u),n.waitMulti32(o,c),++s.cycles}}},B.prototype.constructLDR=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(s.mmu.waitPrefetch32(r[s.PC]),!i||i()){var n=e();r[t]=s.mmu.load32(n),s.mmu.wait32(n),++s.cycles}}},B.prototype.constructLDRB=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(s.mmu.waitPrefetch32(r[s.PC]),!i||i()){var n=e();r[t]=s.mmu.loadU8(n),s.mmu.wait(n),++s.cycles}}},B.prototype.constructLDRH=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(s.mmu.waitPrefetch32(r[s.PC]),!i||i()){var n=e();r[t]=s.mmu.loadU16(n),s.mmu.wait(n),++s.cycles}}},B.prototype.constructLDRSB=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(s.mmu.waitPrefetch32(r[s.PC]),!i||i()){var n=e();r[t]=s.mmu.load8(n),s.mmu.wait(n),++s.cycles}}},B.prototype.constructLDRSH=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(s.mmu.waitPrefetch32(r[s.PC]),!i||i()){var n=e();r[t]=s.mmu.load16(n),s.mmu.wait(n),++s.cycles}}},B.prototype.constructMLA=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r())if(++n.cycles,n.mmu.waitMul(i),4294901760&a[s]&&4294901760&a[i]){var h=(4294901760&a[s])*a[i]&4294967295,o=(65535&a[s])*a[i]&4294967295;a[t]=h+o+a[e]&4294967295}else a[t]=a[s]*a[i]+a[e]}},B.prototype.constructMLAS=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){if(++n.cycles,n.mmu.waitMul(i),4294901760&a[s]&&4294901760&a[i]){var h=(4294901760&a[s])*a[i]&4294967295,o=(65535&a[s])*a[i]&4294967295;a[t]=h+o+a[e]&4294967295}else a[t]=a[s]*a[i]+a[e];n.cpsrN=a[t]>>31,n.cpsrZ=!(4294967295&a[t])}}},B.prototype.constructMOV=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=r.shifterOperand)}},B.prototype.constructMOVS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructMRS=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch32(r[s.PC]),i&&!i()||(r[t]=e?s.spsr:s.packCPSR())}},B.prototype.constructMSR=function(t,e,i,s,r){var n=this.cpu,a=n.gprs,h=65536&i,o=524288&i;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){var c;c=33554432&i?s:a[t];var u=(h?255:0)|(o?4278190080:0);e?(u&=n.USER_MASK|n.PRIV_MASK|n.STATE_MASK,n.spsr=n.spsr&~u|c&u):(u&n.USER_MASK&&(n.cpsrN=c>>31,n.cpsrZ=1073741824&c,n.cpsrC=536870912&c,n.cpsrV=268435456&c),n.mode!=n.MODE_USER&&u&n.PRIV_MASK&&(n.switchMode(15&c|16),n.cpsrI=128&c,n.cpsrF=64&c))}}},B.prototype.constructMUL=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s())if(r.mmu.waitMul(n[e]),4294901760&n[i]&&4294901760&n[e]){var a=(4294901760&n[i])*n[e]|0,h=(65535&n[i])*n[e]|0;n[t]=a+h}else n[t]=n[i]*n[e]}},B.prototype.constructMULS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){if(r.mmu.waitMul(n[e]),4294901760&n[i]&&4294901760&n[e]){var a=(4294901760&n[i])*n[e]|0,h=(65535&n[i])*n[e]|0;n[t]=a+h}else n[t]=n[i]*n[e];r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t])}}},B.prototype.constructMVN=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=~r.shifterOperand)}},B.prototype.constructMVNS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=~r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructORR=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]|r.shifterOperand)}},B.prototype.constructORRS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]|r.shifterOperand,t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=n[t]>>31,r.cpsrZ=!(4294967295&n[t]),r.cpsrC=r.shifterCarryOut))}},B.prototype.constructRSB=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=r.shifterOperand-n[e])}},B.prototype.constructRSBS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=r.shifterOperand-n[e];t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=a>>31,r.cpsrZ=!(4294967295&a),r.cpsrC=r.shifterOperand>>>0>=n[e]>>>0,r.cpsrV=r.shifterOperand>>31!=n[e]>>31&&r.shifterOperand>>31!=a>>31),n[t]=a}}},B.prototype.constructRSC=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(n[e]>>>0)+!r.cpsrC;n[t]=(r.shifterOperand>>>0)-a}}},B.prototype.constructRSCS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(n[e]>>>0)+!r.cpsrC,h=(r.shifterOperand>>>0)-a;t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=h>>31,r.cpsrZ=!(4294967295&h),r.cpsrC=r.shifterOperand>>>0>=h>>>0,r.cpsrV=r.shifterOperand>>31!=a>>31&&r.shifterOperand>>31!=h>>31),n[t]=h}}},B.prototype.constructSBC=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(r.shifterOperand>>>0)+!r.cpsrC;n[t]=(n[e]>>>0)-a}}},B.prototype.constructSBCS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=(r.shifterOperand>>>0)+!r.cpsrC,h=(n[e]>>>0)-a;t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=h>>31,r.cpsrZ=!(4294967295&h),r.cpsrC=n[e]>>>0>=h>>>0,r.cpsrV=n[e]>>31!=a>>31&&n[e]>>31!=h>>31),n[t]=h}}},B.prototype.constructSMLAL=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){n.cycles+=2,n.mmu.waitMul(i);var h=(4294901760&a[s])*a[i],o=(65535&a[s])*a[i],c=(a[e]>>>0)+h+o;a[e]=c,a[t]+=Math.floor(c*(1/4294967296))}}},B.prototype.constructSMLALS=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){n.cycles+=2,n.mmu.waitMul(i);var h=(4294901760&a[s])*a[i],o=(65535&a[s])*a[i],c=(a[e]>>>0)+h+o;a[e]=c,a[t]+=Math.floor(c*(1/4294967296)),n.cpsrN=a[t]>>31,n.cpsrZ=!(4294967295&a[t]||4294967295&a[e])}}},B.prototype.constructSMULL=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){++n.cycles,n.mmu.waitMul(a[i]);var h=((4294901760&a[s])>>0)*(a[i]>>0),o=((65535&a[s])>>0)*(a[i]>>0);a[e]=(4294967295&h)+(4294967295&o)&4294967295,a[t]=Math.floor(h*(1/4294967296)+o*(1/4294967296))}}},B.prototype.constructSMULLS=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){++n.cycles,n.mmu.waitMul(a[i]);var h=((4294901760&a[s])>>0)*(a[i]>>0),o=((65535&a[s])>>0)*(a[i]>>0);a[e]=(4294967295&h)+(4294967295&o)&4294967295,a[t]=Math.floor(h*(1/4294967296)+o*(1/4294967296)),n.cpsrN=a[t]>>31,n.cpsrZ=!(4294967295&a[t]||4294967295&a[e])}}},B.prototype.constructSTM=function(t,e,i){var s=this.cpu,r=s.gprs,n=s.mmu;return function(){if(!i||i()){n.wait32(r[s.PC]);var a,h,o=e(!0),c=0;for(a=t,h=0;a;a>>=1,++h)1&a&&(n.store32(o,r[h]),o+=4,++c);n.waitMulti32(o,c)}else n.waitPrefetch32(r[s.PC])}},B.prototype.constructSTMS=function(t,e,i){var s=this.cpu,r=s.gprs,n=s.mmu;return function(){if(!i||i()){n.wait32(r[s.PC]);var a,h,o=s.mode,c=e(!0),u=0;for(s.switchMode(s.MODE_SYSTEM),a=t,h=0;a;a>>=1,++h)1&a&&(n.store32(c,r[h]),c+=4,++u);s.switchMode(o),n.waitMulti32(c,u)}else n.waitPrefetch32(r[s.PC])}},B.prototype.constructSTR=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(!i||i()){var n=e();s.mmu.store32(n,r[t]),s.mmu.wait32(n),s.mmu.wait32(r[s.PC])}else s.mmu.waitPrefetch32(r[s.PC])}},B.prototype.constructSTRB=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(!i||i()){var n=e();s.mmu.store8(n,r[t]),s.mmu.wait(n),s.mmu.wait32(r[s.PC])}else s.mmu.waitPrefetch32(r[s.PC])}},B.prototype.constructSTRH=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){if(!i||i()){var n=e();s.mmu.store16(n,r[t]),s.mmu.wait(n),s.mmu.wait32(r[s.PC])}else s.mmu.waitPrefetch32(r[s.PC])}},B.prototype.constructSUB=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){r.mmu.waitPrefetch32(n[r.PC]),s&&!s()||(i(),n[t]=n[e]-r.shifterOperand)}},B.prototype.constructSUBS=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var a=n[e]-r.shifterOperand;t==r.PC&&r.hasSPSR()?r.unpackCPSR(r.spsr):(r.cpsrN=a>>31,r.cpsrZ=!(4294967295&a),r.cpsrC=n[e]>>>0>=r.shifterOperand>>>0,r.cpsrV=n[e]>>31!=r.shifterOperand>>31&&n[e]>>31!=a>>31),n[t]=a}}},B.prototype.constructSWI=function(t,e){var i=this.cpu,s=i.gprs;return function(){!e||e()?(i.irq.swi32(t),i.mmu.waitPrefetch32(s[i.PC])):i.mmu.waitPrefetch32(s[i.PC])}},B.prototype.constructSWP=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){r.mmu.wait32(n[e]),r.mmu.wait32(n[e]);var a=r.mmu.load32(n[e]);r.mmu.store32(n[e],n[i]),n[t]=a,++r.cycles}}},B.prototype.constructSWPB=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){r.mmu.wait(n[e]),r.mmu.wait(n[e]);var a=r.mmu.load8(n[e]);r.mmu.store8(n[e],n[i]),n[t]=a,++r.cycles}}},B.prototype.constructTEQ=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var t=n[e]^r.shifterOperand;r.cpsrN=t>>31,r.cpsrZ=!(4294967295&t),r.cpsrC=r.shifterCarryOut}}},B.prototype.constructTST=function(t,e,i,s){var r=this.cpu,n=r.gprs;return function(){if(r.mmu.waitPrefetch32(n[r.PC]),!s||s()){i();var t=n[e]&r.shifterOperand;r.cpsrN=t>>31,r.cpsrZ=!(4294967295&t),r.cpsrC=r.shifterCarryOut}}},B.prototype.constructUMLAL=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){n.cycles+=2,n.mmu.waitMul(i);var h=((4294901760&a[s])>>>0)*(a[i]>>>0),o=(65535&a[s])*(a[i]>>>0),c=(a[e]>>>0)+h+o;a[e]=c,a[t]+=c*(1/4294967296)}}},B.prototype.constructUMLALS=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){n.cycles+=2,n.mmu.waitMul(i);var h=((4294901760&a[s])>>>0)*(a[i]>>>0),o=(65535&a[s])*(a[i]>>>0),c=(a[e]>>>0)+h+o;a[e]=c,a[t]+=c*(1/4294967296),n.cpsrN=a[t]>>31,n.cpsrZ=!(4294967295&a[t]||4294967295&a[e])}}},B.prototype.constructUMULL=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){++n.cycles,n.mmu.waitMul(a[i]);var h=((4294901760&a[s])>>>0)*(a[i]>>>0),o=((65535&a[s])>>>0)*(a[i]>>>0);a[e]=(4294967295&h)+(4294967295&o)&4294967295,a[t]=h*(1/4294967296)+o*(1/4294967296)>>>0}}},B.prototype.constructUMULLS=function(t,e,i,s,r){var n=this.cpu,a=n.gprs;return function(){if(n.mmu.waitPrefetch32(a[n.PC]),!r||r()){++n.cycles,n.mmu.waitMul(a[i]);var h=((4294901760&a[s])>>>0)*(a[i]>>>0),o=((65535&a[s])>>>0)*(a[i]>>>0);a[e]=(4294967295&h)+(4294967295&o)&4294967295,a[t]=h*(1/4294967296)+o*(1/4294967296)>>>0,n.cpsrN=a[t]>>31,n.cpsrZ=!(4294967295&a[t]||4294967295&a[e])}}};var L=B,x=function(t){this.cpu=t};x.prototype.constructADC=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=(s[e]>>>0)+!!i.cpsrC,n=s[t],a=(n>>>0)+r,h=n>>31,o=a>>31,c=r>>31;i.cpsrN=o,i.cpsrZ=!(4294967295&a),i.cpsrC=a>4294967295,i.cpsrV=h==c&&h!=o&&c!=o,s[t]=a}},x.prototype.constructADD1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var n=(r[e]>>>0)+i;s.cpsrN=n>>31,s.cpsrZ=!(4294967295&n),s.cpsrC=n>4294967295,s.cpsrV=!(r[e]>>31)&&(r[e]>>31^n)>>31&&n>>31,r[t]=n}},x.prototype.constructADD2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=(s[t]>>>0)+e;i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=r>4294967295,i.cpsrV=!(s[t]>>31)&&(s[t]^r)>>31&&(e^r)>>31,s[t]=r}},x.prototype.constructADD3=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var n=(r[e]>>>0)+(r[i]>>>0);s.cpsrN=n>>31,s.cpsrZ=!(4294967295&n),s.cpsrC=n>4294967295,s.cpsrV=!((r[e]^r[i])>>31)&&(r[e]^n)>>31&&(r[i]^n)>>31,r[t]=n}},x.prototype.constructADD4=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]+=s[e]}},x.prototype.constructADD5=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=(4294967292&s[i.PC])+e}},x.prototype.constructADD6=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[i.SP]+e}},x.prototype.constructADD7=function(t){var e=this.cpu,i=e.gprs;return function(){e.mmu.waitPrefetch(i[e.PC]),i[e.SP]+=t}},x.prototype.constructAND=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[t]&s[e],i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructASR1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),0==i?(s.cpsrC=r[e]>>31,s.cpsrC?r[t]=4294967295:r[t]=0):(s.cpsrC=r[e]&1<<i-1,r[t]=r[e]>>i),s.cpsrN=r[t]>>31,s.cpsrZ=!(4294967295&r[t])}},x.prototype.constructASR2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=255&s[e];r&&(r<32?(i.cpsrC=s[t]&1<<r-1,s[t]>>=r):(i.cpsrC=s[t]>>31,i.cpsrC?s[t]=4294967295:s[t]=0)),i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructB1=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),e()&&(s[i.PC]+=t)}},x.prototype.constructB2=function(t){var e=this.cpu,i=e.gprs;return function(){e.mmu.waitPrefetch(i[e.PC]),i[e.PC]+=t}},x.prototype.constructBIC=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[t]&~s[e],i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructBL1=function(t){var e=this.cpu,i=e.gprs;return function(){e.mmu.waitPrefetch(i[e.PC]),i[e.LR]=i[e.PC]+t}},x.prototype.constructBL2=function(t){var e=this.cpu,i=e.gprs;return function(){e.mmu.waitPrefetch(i[e.PC]);var s=i[e.PC];i[e.PC]=i[e.LR]+(t<<1),i[e.LR]=s-1}},x.prototype.constructBX=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),i.switchExecMode(1&s[e]);var t=0;15==e&&(t=2&s[e]),s[i.PC]=s[e]&4294967294-t}},x.prototype.constructCMN=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=(s[t]>>>0)+(s[e]>>>0);i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=r>4294967295,i.cpsrV=s[t]>>31==s[e]>>31&&s[t]>>31!=r>>31&&s[e]>>31!=r>>31}},x.prototype.constructCMP1=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=s[t]-e;i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=s[t]>>>0>=e,i.cpsrV=s[t]>>31&&(s[t]^r)>>31}},x.prototype.constructCMP2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=s[t],n=s[e],a=r-n,h=a>>31,o=r>>31;i.cpsrN=h,i.cpsrZ=!(4294967295&a),i.cpsrC=r>>>0>=n>>>0,i.cpsrV=o!=n>>31&&o!=h}},x.prototype.constructCMP3=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=s[t]-s[e];i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=s[t]>>>0>=s[e]>>>0,i.cpsrV=(s[t]^s[e])>>31&&(s[t]^r)>>31}},x.prototype.constructEOR=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[t]^s[e],i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructLDMIA=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r,n,a=s[t],h=0;for(r=1,n=0;n<8;r<<=1,++n)e&r&&(s[n]=i.mmu.load32(a),a+=4,++h);i.mmu.waitMulti32(a,h),1<<t&e||(s[t]=a)}},x.prototype.constructLDR1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var n=r[e]+i;r[t]=s.mmu.load32(n),s.mmu.wait32(n),++s.cycles}},x.prototype.constructLDR2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.load32(r[e]+r[i]),s.mmu.wait32(r[e]+r[i]),++s.cycles}},x.prototype.constructLDR3=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=i.mmu.load32((4294967292&s[i.PC])+e),i.mmu.wait32(s[i.PC]),++i.cycles}},x.prototype.constructLDR4=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=i.mmu.load32(s[i.SP]+e),i.mmu.wait32(s[i.SP]+e),++i.cycles}},x.prototype.constructLDRB1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){var n=r[e]+i;s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.loadU8(n),s.mmu.wait(n),++s.cycles}},x.prototype.constructLDRB2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.loadU8(r[e]+r[i]),s.mmu.wait(r[e]+r[i]),++s.cycles}},x.prototype.constructLDRH1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){var n=r[e]+i;s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.loadU16(n),s.mmu.wait(n),++s.cycles}},x.prototype.constructLDRH2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.loadU16(r[e]+r[i]),s.mmu.wait(r[e]+r[i]),++s.cycles}},x.prototype.constructLDRSB=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.load8(r[e]+r[i]),s.mmu.wait(r[e]+r[i]),++s.cycles}},x.prototype.constructLDRSH=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),r[t]=s.mmu.load16(r[e]+r[i]),s.mmu.wait(r[e]+r[i]),++s.cycles}},x.prototype.constructLSL1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),0==i?r[t]=r[e]:(s.cpsrC=r[e]&1<<32-i,r[t]=r[e]<<i),s.cpsrN=r[t]>>31,s.cpsrZ=!(4294967295&r[t])}},x.prototype.constructLSL2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=255&s[e];r&&(r<32?(i.cpsrC=s[t]&1<<32-r,s[t]<<=r):(i.cpsrC=r>32?0:1&s[t],s[t]=0)),i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructLSR1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]),0==i?(s.cpsrC=r[e]>>31,r[t]=0):(s.cpsrC=r[e]&1<<i-1,r[t]=r[e]>>>i),s.cpsrN=0,s.cpsrZ=!(4294967295&r[t])}},x.prototype.constructLSR2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=255&s[e];r&&(r<32?(i.cpsrC=s[t]&1<<r-1,s[t]>>>=r):(i.cpsrC=r>32?0:s[t]>>31,s[t]=0)),i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructMOV1=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=e,i.cpsrN=e>>31,i.cpsrZ=!(4294967295&e)}},x.prototype.constructMOV2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var i=r[e];s.cpsrN=i>>31,s.cpsrZ=!(4294967295&i),s.cpsrC=0,s.cpsrV=0,r[t]=i}},x.prototype.constructMOV3=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[e]}},x.prototype.constructMUL=function(t,e){var i=this.cpu,s=i.gprs;return function(){if(i.mmu.waitPrefetch(s[i.PC]),i.mmu.waitMul(s[e]),4294901760&s[e]&&4294901760&s[t]){var r=(4294901760&s[t])*s[e]&4294967295,n=(65535&s[t])*s[e]&4294967295;s[t]=r+n&4294967295}else s[t]*=s[e];i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructMVN=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=~s[e],i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructNEG=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=-s[e];i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=0>=r>>>0,i.cpsrV=s[e]>>31&&r>>31,s[t]=r}},x.prototype.constructORR=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),s[t]=s[t]|s[e],i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructPOP=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]),++i.cycles;var r,n,a=s[i.SP],h=0;for(r=1,n=0;n<8;r<<=1,++n)t&r&&(i.mmu.waitSeq32(a),s[n]=i.mmu.load32(a),a+=4,++h);e&&(s[i.PC]=4294967294&i.mmu.load32(a),a+=4,++h),i.mmu.waitMulti32(a,h),s[i.SP]=a}},x.prototype.constructPUSH=function(t,e){var i=this.cpu,s=i.gprs;return function(){var r,n,a=s[i.SP]-4,h=0;for(i.mmu.waitPrefetch(s[i.PC]),e&&(i.mmu.store32(a,s[i.LR]),a-=4,++h),r=128,n=7;r;r>>=1,--n)if(t&r){i.mmu.store32(a,s[n]),a-=4,++h;break}for(r>>=1,--n;r;r>>=1,--n)t&r&&(i.mmu.store32(a,s[n]),a-=4,++h);i.mmu.waitMulti32(a,h),s[i.SP]=a+4}},x.prototype.constructROR=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=255&s[e];if(r){var n=31&r;n>0?(i.cpsrC=s[t]&1<<n-1,s[t]=s[t]>>>n|s[t]<<32-n):i.cpsrC=s[t]>>31}i.cpsrN=s[t]>>31,i.cpsrZ=!(4294967295&s[t])}},x.prototype.constructSBC=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=(s[e]>>>0)+!i.cpsrC,n=(s[t]>>>0)-r;i.cpsrN=n>>31,i.cpsrZ=!(4294967295&n),i.cpsrC=s[t]>>>0>=n>>>0,i.cpsrV=(s[t]^r)>>31&&(s[t]^n)>>31,s[t]=n}},x.prototype.constructSTMIA=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.wait(s[i.PC]);var r,n,a=s[t],h=0;for(r=1,n=0;n<8;r<<=1,++n)if(e&r){i.mmu.store32(a,s[n]),a+=4,++h;break}for(r<<=1,++n;n<8;r<<=1,++n)e&r&&(i.mmu.store32(a,s[n]),a+=4,++h);i.mmu.waitMulti32(a,h),s[t]=a}},x.prototype.constructSTR1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){var n=r[e]+i;s.mmu.store32(n,r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait32(n)}},x.prototype.constructSTR2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.store32(r[e]+r[i],r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait32(r[e]+r[i])}},x.prototype.constructSTR3=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.store32(s[i.SP]+e,s[t]),i.mmu.wait(s[i.PC]),i.mmu.wait32(s[i.SP]+e)}},x.prototype.constructSTRB1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){var n=r[e]+i;s.mmu.store8(n,r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait(n)}},x.prototype.constructSTRB2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.store8(r[e]+r[i],r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait(r[e]+r[i])}},x.prototype.constructSTRH1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){var n=r[e]+i;s.mmu.store16(n,r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait(n)}},x.prototype.constructSTRH2=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.store16(r[e]+r[i],r[t]),s.mmu.wait(r[s.PC]),s.mmu.wait(r[e]+r[i])}},x.prototype.constructSUB1=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var n=r[e]-i;s.cpsrN=n>>31,s.cpsrZ=!(4294967295&n),s.cpsrC=r[e]>>>0>=i,s.cpsrV=r[e]>>31&&(r[e]^n)>>31,r[t]=n}},x.prototype.constructSUB2=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=s[t]-e;i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r),i.cpsrC=s[t]>>>0>=e,i.cpsrV=s[t]>>31&&(s[t]^r)>>31,s[t]=r}},x.prototype.constructSUB3=function(t,e,i){var s=this.cpu,r=s.gprs;return function(){s.mmu.waitPrefetch(r[s.PC]);var n=r[e]-r[i];s.cpsrN=n>>31,s.cpsrZ=!(4294967295&n),s.cpsrC=r[e]>>>0>=r[i]>>>0,s.cpsrV=r[e]>>31!=r[i]>>31&&r[e]>>31!=n>>31,r[t]=n}},x.prototype.constructSWI=function(t){var e=this.cpu,i=e.gprs;return function(){e.irq.swi(t),e.mmu.waitPrefetch(i[e.PC])}},x.prototype.constructTST=function(t,e){var i=this.cpu,s=i.gprs;return function(){i.mmu.waitPrefetch(s[i.PC]);var r=s[t]&s[e];i.cpsrN=r>>31,i.cpsrZ=!(4294967295&r)}};var G=x;function U(){this.inherit(),this.SP=13,this.LR=14,this.PC=15,this.MODE_ARM=0,this.MODE_THUMB=1,this.MODE_USER=16,this.MODE_FIQ=17,this.MODE_IRQ=18,this.MODE_SUPERVISOR=19,this.MODE_ABORT=23,this.MODE_UNDEFINED=27,this.MODE_SYSTEM=31,this.BANK_NONE=0,this.BANK_FIQ=1,this.BANK_IRQ=2,this.BANK_SUPERVISOR=3,this.BANK_ABORT=4,this.BANK_UNDEFINED=5,this.UNALLOC_MASK=268435200,this.USER_MASK=4026531840,this.PRIV_MASK=207,this.STATE_MASK=32,this.WORD_SIZE_ARM=4,this.WORD_SIZE_THUMB=2,this.BASE_RESET=0,this.BASE_UNDEF=4,this.BASE_SWI=8,this.BASE_PABT=12,this.BASE_DABT=16,this.BASE_IRQ=24,this.BASE_FIQ=28,this.armCompiler=new L(this),this.thumbCompiler=new G(this),this.generateConds(),this.gprs=new Int32Array(16)}U.prototype.resetCPU=function(t){for(var e=0;e<this.PC;++e)this.gprs[e]=0;this.gprs[this.PC]=t+this.WORD_SIZE_ARM,this.loadInstruction=this.loadInstructionArm,this.execMode=this.MODE_ARM,this.instructionWidth=this.WORD_SIZE_ARM,this.mode=this.MODE_SYSTEM,this.cpsrI=!1,this.cpsrF=!1,this.cpsrV=!1,this.cpsrC=!1,this.cpsrZ=!1,this.cpsrN=!1,this.bankedRegisters=[new Int32Array(7),new Int32Array(7),new Int32Array(2),new Int32Array(2),new Int32Array(2),new Int32Array(2)],this.spsr=0,this.bankedSPSRs=new Int32Array(6),this.cycles=0,this.shifterOperand=0,this.shifterCarryOut=0,this.page=null,this.pageId=0,this.pageRegion=-1,this.instruction=null,this.irq.clear();var i=this.gprs,s=this.mmu;this.step=function(){var t=this.instruction||(this.instruction=this.loadInstruction(i[this.PC]-this.instructionWidth));if(i[this.PC]+=this.instructionWidth,this.conditionPassed=!0,t(),t.writesPC)if(this.conditionPassed){var e=i[this.PC]&=4294967294;this.execMode==this.MODE_ARM?(s.wait32(e),s.waitPrefetch32(e)):(s.wait(e),s.waitPrefetch(e)),i[this.PC]+=this.instructionWidth,t.fixedJump?null!=this.instruction&&((null==t.next||t.next.page.invalid)&&(t.next=this.loadInstruction(i[this.PC]-this.instructionWidth)),this.instruction=t.next):this.instruction=null}else this.instruction=null;else null!=this.instruction&&((null==t.next||t.next.page.invalid)&&(t.next=this.loadInstruction(i[this.PC]-this.instructionWidth)),this.instruction=t.next);this.irq.updateTimers()}},U.prototype.freeze=function(){return{gprs:[this.gprs[0],this.gprs[1],this.gprs[2],this.gprs[3],this.gprs[4],this.gprs[5],this.gprs[6],this.gprs[7],this.gprs[8],this.gprs[9],this.gprs[10],this.gprs[11],this.gprs[12],this.gprs[13],this.gprs[14],this.gprs[15]],mode:this.mode,cpsrI:this.cpsrI,cpsrF:this.cpsrF,cpsrV:this.cpsrV,cpsrC:this.cpsrC,cpsrZ:this.cpsrZ,cpsrN:this.cpsrN,bankedRegisters:[[this.bankedRegisters[0][0],this.bankedRegisters[0][1],this.bankedRegisters[0][2],this.bankedRegisters[0][3],this.bankedRegisters[0][4],this.bankedRegisters[0][5],this.bankedRegisters[0][6]],[this.bankedRegisters[1][0],this.bankedRegisters[1][1],this.bankedRegisters[1][2],this.bankedRegisters[1][3],this.bankedRegisters[1][4],this.bankedRegisters[1][5],this.bankedRegisters[1][6]],[this.bankedRegisters[2][0],this.bankedRegisters[2][1]],[this.bankedRegisters[3][0],this.bankedRegisters[3][1]],[this.bankedRegisters[4][0],this.bankedRegisters[4][1]],[this.bankedRegisters[5][0],this.bankedRegisters[5][1]]],spsr:this.spsr,bankedSPSRs:[this.bankedSPSRs[0],this.bankedSPSRs[1],this.bankedSPSRs[2],this.bankedSPSRs[3],this.bankedSPSRs[4],this.bankedSPSRs[5]],cycles:this.cycles}},U.prototype.defrost=function(t){this.instruction=null,this.page=null,this.pageId=0,this.pageRegion=-1,this.gprs[0]=t.gprs[0],this.gprs[1]=t.gprs[1],this.gprs[2]=t.gprs[2],this.gprs[3]=t.gprs[3],this.gprs[4]=t.gprs[4],this.gprs[5]=t.gprs[5],this.gprs[6]=t.gprs[6],this.gprs[7]=t.gprs[7],this.gprs[8]=t.gprs[8],this.gprs[9]=t.gprs[9],this.gprs[10]=t.gprs[10],this.gprs[11]=t.gprs[11],this.gprs[12]=t.gprs[12],this.gprs[13]=t.gprs[13],this.gprs[14]=t.gprs[14],this.gprs[15]=t.gprs[15],this.mode=t.mode,this.cpsrI=t.cpsrI,this.cpsrF=t.cpsrF,this.cpsrV=t.cpsrV,this.cpsrC=t.cpsrC,this.cpsrZ=t.cpsrZ,this.cpsrN=t.cpsrN,this.bankedRegisters[0][0]=t.bankedRegisters[0][0],this.bankedRegisters[0][1]=t.bankedRegisters[0][1],this.bankedRegisters[0][2]=t.bankedRegisters[0][2],this.bankedRegisters[0][3]=t.bankedRegisters[0][3],this.bankedRegisters[0][4]=t.bankedRegisters[0][4],this.bankedRegisters[0][5]=t.bankedRegisters[0][5],this.bankedRegisters[0][6]=t.bankedRegisters[0][6],this.bankedRegisters[1][0]=t.bankedRegisters[1][0],this.bankedRegisters[1][1]=t.bankedRegisters[1][1],this.bankedRegisters[1][2]=t.bankedRegisters[1][2],this.bankedRegisters[1][3]=t.bankedRegisters[1][3],this.bankedRegisters[1][4]=t.bankedRegisters[1][4],this.bankedRegisters[1][5]=t.bankedRegisters[1][5],this.bankedRegisters[1][6]=t.bankedRegisters[1][6],this.bankedRegisters[2][0]=t.bankedRegisters[2][0],this.bankedRegisters[2][1]=t.bankedRegisters[2][1],this.bankedRegisters[3][0]=t.bankedRegisters[3][0],this.bankedRegisters[3][1]=t.bankedRegisters[3][1],this.bankedRegisters[4][0]=t.bankedRegisters[4][0],this.bankedRegisters[4][1]=t.bankedRegisters[4][1],this.bankedRegisters[5][0]=t.bankedRegisters[5][0],this.bankedRegisters[5][1]=t.bankedRegisters[5][1],this.spsr=t.spsr,this.bankedSPSRs[0]=t.bankedSPSRs[0],this.bankedSPSRs[1]=t.bankedSPSRs[1],this.bankedSPSRs[2]=t.bankedSPSRs[2],this.bankedSPSRs[3]=t.bankedSPSRs[3],this.bankedSPSRs[4]=t.bankedSPSRs[4],this.bankedSPSRs[5]=t.bankedSPSRs[5],this.cycles=t.cycles},U.prototype.fetchPage=function(t){var e=t>>this.mmu.BASE_OFFSET,i=this.mmu.addressToPage(e,t&this.mmu.OFFSET_MASK);if(e==this.pageRegion){if(i==this.pageId&&!this.page.invalid)return;this.pageId=i}else this.pageMask=this.mmu.memory[e].PAGE_MASK,this.pageRegion=e,this.pageId=i;this.page=this.mmu.accessPage(e,i)},U.prototype.loadInstructionArm=function(t){var e=null;this.fetchPage(t);var i=(t&this.pageMask)>>2;if(e=this.page.arm[i])return e;var s=this.mmu.load32(t)>>>0;return(e=this.compileArm(s)).next=null,e.page=this.page,e.address=t,e.opcode=s,this.page.arm[i]=e,e},U.prototype.loadInstructionThumb=function(t){var e=null;this.fetchPage(t);var i=(t&this.pageMask)>>1;if(e=this.page.thumb[i])return e;var s=this.mmu.load16(t);return(e=this.compileThumb(s)).next=null,e.page=this.page,e.address=t,e.opcode=s,this.page.thumb[i]=e,e},U.prototype.selectBank=function(t){switch(t){case this.MODE_USER:case this.MODE_SYSTEM:return this.BANK_NONE;case this.MODE_FIQ:return this.BANK_FIQ;case this.MODE_IRQ:return this.BANK_IRQ;case this.MODE_SUPERVISOR:return this.BANK_SUPERVISOR;case this.MODE_ABORT:return this.BANK_ABORT;case this.MODE_UNDEFINED:return this.BANK_UNDEFINED;default:throw"Invalid user mode passed to selectBank"}},U.prototype.switchExecMode=function(t){this.execMode!=t&&(this.execMode=t,t==this.MODE_ARM?(this.instructionWidth=this.WORD_SIZE_ARM,this.loadInstruction=this.loadInstructionArm):(this.instructionWidth=this.WORD_SIZE_THUMB,this.loadInstruction=this.loadInstructionThumb))},U.prototype.switchMode=function(t){if(t!=this.mode){if(t!=this.MODE_USER||t!=this.MODE_SYSTEM){var e=this.selectBank(t),i=this.selectBank(this.mode);if(e!=i){if(t==this.MODE_FIQ||this.mode==this.MODE_FIQ){var s=(i==this.BANK_FIQ)+0,r=(e==this.BANK_FIQ)+0;this.bankedRegisters[s][2]=this.gprs[8],this.bankedRegisters[s][3]=this.gprs[9],this.bankedRegisters[s][4]=this.gprs[10],this.bankedRegisters[s][5]=this.gprs[11],this.bankedRegisters[s][6]=this.gprs[12],this.gprs[8]=this.bankedRegisters[r][2],this.gprs[9]=this.bankedRegisters[r][3],this.gprs[10]=this.bankedRegisters[r][4],this.gprs[11]=this.bankedRegisters[r][5],this.gprs[12]=this.bankedRegisters[r][6]}this.bankedRegisters[i][0]=this.gprs[this.SP],this.bankedRegisters[i][1]=this.gprs[this.LR],this.gprs[this.SP]=this.bankedRegisters[e][0],this.gprs[this.LR]=this.bankedRegisters[e][1],this.bankedSPSRs[i]=this.spsr,this.spsr=this.bankedSPSRs[e]}}this.mode=t}},U.prototype.packCPSR=function(){return this.mode|!!this.execMode<<5|!!this.cpsrF<<6|!!this.cpsrI<<7|!!this.cpsrN<<31|!!this.cpsrZ<<30|!!this.cpsrC<<29|!!this.cpsrV<<28},U.prototype.unpackCPSR=function(t){this.switchMode(31&t),this.switchExecMode(!!(32&t)),this.cpsrF=64&t,this.cpsrI=128&t,this.cpsrN=2147483648&t,this.cpsrZ=1073741824&t,this.cpsrC=536870912&t,this.cpsrV=268435456&t,this.irq.testIRQ()},U.prototype.hasSPSR=function(){return this.mode!=this.MODE_SYSTEM&&this.mode!=this.MODE_USER},U.prototype.raiseIRQ=function(){if(!this.cpsrI){var t=this.packCPSR(),e=this.instructionWidth;this.switchMode(this.MODE_IRQ),this.spsr=t,this.gprs[this.LR]=this.gprs[this.PC]-e+4,this.gprs[this.PC]=this.BASE_IRQ+this.WORD_SIZE_ARM,this.instruction=null,this.switchExecMode(this.MODE_ARM),this.cpsrI=!0}},U.prototype.raiseTrap=function(){var t=this.packCPSR(),e=this.instructionWidth;this.switchMode(this.MODE_SUPERVISOR),this.spsr=t,this.gprs[this.LR]=this.gprs[this.PC]-e,this.gprs[this.PC]=this.BASE_SWI+this.WORD_SIZE_ARM,this.instruction=null,this.switchExecMode(this.MODE_ARM),this.cpsrI=!0},U.prototype.badOp=function(t){var e=function(){throw"Illegal instruction: 0x"+t.toString(16)};return e.writesPC=!0,e.fixedJump=!1,e},U.prototype.generateConds=function(){var t=this;this.conds=[function(){return t.conditionPassed=t.cpsrZ},function(){return t.conditionPassed=!t.cpsrZ},function(){return t.conditionPassed=t.cpsrC},function(){return t.conditionPassed=!t.cpsrC},function(){return t.conditionPassed=t.cpsrN},function(){return t.conditionPassed=!t.cpsrN},function(){return t.conditionPassed=t.cpsrV},function(){return t.conditionPassed=!t.cpsrV},function(){return t.conditionPassed=t.cpsrC&&!t.cpsrZ},function(){return t.conditionPassed=!t.cpsrC||t.cpsrZ},function(){return t.conditionPassed=!t.cpsrN==!t.cpsrV},function(){return t.conditionPassed=!t.cpsrN!=!t.cpsrV},function(){return t.conditionPassed=!t.cpsrZ&&!t.cpsrN==!t.cpsrV},function(){return t.conditionPassed=t.cpsrZ||!t.cpsrN!=!t.cpsrV},null,null]},U.prototype.barrelShiftImmediate=function(t,e,i){var s=this,r=this.gprs,n=this.badOp;switch(t){case 0:n=e?function(){s.shifterOperand=r[i]<<e,s.shifterCarryOut=r[i]&1<<32-e}:function(){s.shifterOperand=r[i],s.shifterCarryOut=s.cpsrC};break;case 32:n=e?function(){s.shifterOperand=r[i]>>>e,s.shifterCarryOut=r[i]&1<<e-1}:function(){s.shifterOperand=0,s.shifterCarryOut=2147483648&r[i]};break;case 64:n=e?function(){s.shifterOperand=r[i]>>e,s.shifterCarryOut=r[i]&1<<e-1}:function(){s.shifterCarryOut=2147483648&r[i],s.shifterCarryOut?s.shifterOperand=4294967295:s.shifterOperand=0};break;case 96:n=e?function(){s.shifterOperand=r[i]>>>e|r[i]<<32-e,s.shifterCarryOut=r[i]&1<<e-1}:function(){s.shifterOperand=!!s.cpsrC<<31|r[i]>>>1,s.shifterCarryOut=1&r[i]}}return n},U.prototype.compileArm=function(t){var e=this.badOp(t),i=234881024&t,s=(this.gprs,this.conds[(4026531840&t)>>>28]);if(19922704==(268435440&t)){var r=15&t;(e=this.armCompiler.constructBX(r,s)).writesPC=!0,e.fixedJump=!1}else if(201326592&t||33554432!=i&&144==(144&t))if(16777360==(263196656&t)){r=15&t,g=t>>12&15,S=t>>16&15;(e=4194304&t?this.armCompiler.constructSWPB(g,S,r,s):this.armCompiler.constructSWP(g,S,r,s)).writesPC=g==this.PC}else switch(i){case 0:if(144==(16777456&t)){g=(983040&t)>>16,S=(61440&t)>>12,I=(3840&t)>>8,r=15&t;switch(15728640&t){case 0:e=this.armCompiler.constructMUL(g,I,r,s);break;case 1048576:e=this.armCompiler.constructMULS(g,I,r,s);break;case 2097152:e=this.armCompiler.constructMLA(g,S,I,r,s);break;case 3145728:e=this.armCompiler.constructMLAS(g,S,I,r,s);break;case 8388608:e=this.armCompiler.constructUMULL(g,S,I,r,s);break;case 9437184:e=this.armCompiler.constructUMULLS(g,S,I,r,s);break;case 10485760:e=this.armCompiler.constructUMLAL(g,S,I,r,s);break;case 11534336:e=this.armCompiler.constructUMLALS(g,S,I,r,s);break;case 12582912:e=this.armCompiler.constructSMULL(g,S,I,r,s);break;case 13631488:e=this.armCompiler.constructSMULLS(g,S,I,r,s);break;case 14680064:e=this.armCompiler.constructSMLAL(g,S,I,r,s);break;case 15728640:e=this.armCompiler.constructSMLALS(g,S,I,r,s)}e.writesPC=g==this.PC}else{var n=1048576&t,a=(g=(61440&t)>>12,r=15&t),h=32&t,o=(C=64&t,2097152&t);if(i=4194304&t){E=a|(3840&t)>>4;u=this.armCompiler.constructAddressingMode23Immediate(t,E,s)}else u=this.armCompiler.constructAddressingMode23Register(t,r,s);u.writesPC=!!o&&S==this.PC,144==(144&t)&&(n?h?e=C?this.armCompiler.constructLDRSH(g,u,s):this.armCompiler.constructLDRH(g,u,s):C&&(e=this.armCompiler.constructLDRSB(g,u,s)):!C&&h&&(e=this.armCompiler.constructSTRH(g,u,s))),e.writesPC=g==this.PC||u.writesPC}break;case 67108864:case 100663296:g=(61440&t)>>12,n=1048576&t;var c=4194304&t,u=(i=33554432&t,function(){throw"Unimplemented memory access: 0x"+t.toString(16)});if(16777216&~t&&(t&=4292870143),i){r=15&t;var p=(3968&t)>>7;if((R=96&t)||p){w=this.barrelShiftImmediate(R,p,r);u=this.armCompiler.constructAddressingMode2RegisterShifted(t,w,s)}else u=this.armCompiler.constructAddressingMode23Register(t,r,s)}else{var l=4095&t;u=this.armCompiler.constructAddressingMode23Immediate(t,l,s)}(e=n?c?this.armCompiler.constructLDRB(g,u,s):this.armCompiler.constructLDR(g,u,s):c?this.armCompiler.constructSTRB(g,u,s):this.armCompiler.constructSTR(g,u,s)).writesPC=g==this.PC||u.writesPC;break;case 134217728:n=1048576&t,o=2097152&t;var d=4194304&t,m=16777216&t,f=(I=65535&t,S=(983040&t)>>16,E=0,l=0,!1);if(8388608&t){m&&(E=4);var A=1;for(i=0;i<16;A<<=1,++i)I&A&&(o&&i==S&&!l&&(I&=~A,E+=4,f=!0),l+=4)}else{m||(E=4);for(A=1,i=0;i<16;A<<=1,++i)I&A&&(o&&i==S&&!l&&(I&=~A,E+=4,f=!0),E-=4,l-=4)}u=o?this.armCompiler.constructAddressingMode4Writeback(E,l,S,f):this.armCompiler.constructAddressingMode4(E,S),n?(e=d?this.armCompiler.constructLDMS(I,u,s):this.armCompiler.constructLDM(I,u,s)).writesPC=!!(32768&I):(e=d?this.armCompiler.constructSTMS(I,u,s):this.armCompiler.constructSTM(I,u,s)).writesPC=!1;break;case 167772160:8388608&(E=16777215&t)&&(E|=4278190080),E<<=2,(e=16777216&t?this.armCompiler.constructBL(E,s):this.armCompiler.constructB(E,s)).writesPC=!0,e.fixedJump=!0;break;case 201326592:break;case 234881024:if(251658240==(251658240&t)){E=16777215&t;(e=this.armCompiler.constructSWI(E,s)).writesPC=!1}break;default:throw"Bad opcode: 0x"+t.toString(16)}else{var b=31457280&t,C=1048576&t;if(16777216!=(25165824&b)||C){var S=(983040&t)>>16,g=(61440&t)>>12,R=96&t,r=15&t,w=function(){throw"BUG: invalid barrel shifter"};if(33554432&t){var E=255&t,v=(3840&t)>>7;w=v?this.armCompiler.constructAddressingMode1ImmediateRotate(E,v):this.armCompiler.constructAddressingMode1Immediate(E)}else if(16&t){var I=(3840&t)>>8;switch(!0,R){case 0:w=this.armCompiler.constructAddressingMode1LSL(I,r);break;case 32:w=this.armCompiler.constructAddressingMode1LSR(I,r);break;case 64:w=this.armCompiler.constructAddressingMode1ASR(I,r);break;case 96:w=this.armCompiler.constructAddressingMode1ROR(I,r)}}else{var E=(3968&t)>>7;w=this.barrelShiftImmediate(R,E,r)}switch(b){case 0:e=C?this.armCompiler.constructANDS(g,S,w,s):this.armCompiler.constructAND(g,S,w,s);break;case 2097152:e=C?this.armCompiler.constructEORS(g,S,w,s):this.armCompiler.constructEOR(g,S,w,s);break;case 4194304:e=C?this.armCompiler.constructSUBS(g,S,w,s):this.armCompiler.constructSUB(g,S,w,s);break;case 6291456:e=C?this.armCompiler.constructRSBS(g,S,w,s):this.armCompiler.constructRSB(g,S,w,s);break;case 8388608:e=C?this.armCompiler.constructADDS(g,S,w,s):this.armCompiler.constructADD(g,S,w,s);break;case 10485760:e=C?this.armCompiler.constructADCS(g,S,w,s):this.armCompiler.constructADC(g,S,w,s);break;case 12582912:e=C?this.armCompiler.constructSBCS(g,S,w,s):this.armCompiler.constructSBC(g,S,w,s);break;case 14680064:e=C?this.armCompiler.constructRSCS(g,S,w,s):this.armCompiler.constructRSC(g,S,w,s);break;case 16777216:e=this.armCompiler.constructTST(g,S,w,s);break;case 18874368:e=this.armCompiler.constructTEQ(g,S,w,s);break;case 20971520:e=this.armCompiler.constructCMP(g,S,w,s);break;case 23068672:e=this.armCompiler.constructCMN(g,S,w,s);break;case 25165824:e=C?this.armCompiler.constructORRS(g,S,w,s):this.armCompiler.constructORR(g,S,w,s);break;case 27262976:e=C?this.armCompiler.constructMOVS(g,S,w,s):this.armCompiler.constructMOV(g,S,w,s);break;case 29360128:e=C?this.armCompiler.constructBICS(g,S,w,s):this.armCompiler.constructBIC(g,S,w,s);break;case 31457280:e=C?this.armCompiler.constructMVNS(g,S,w,s):this.armCompiler.constructMVN(g,S,w,s)}e.writesPC=g==this.PC}else{var O=4194304&t;if(2158592==(11595776&t)){var r=15&t,_=(3840&t)>>7;E=(E=255&t)>>>_|E<<32-_,(e=this.armCompiler.constructMSR(r,O,t,E,s)).writesPC=!1}else if(983040==(12517376&t)){var g=(61440&t)>>12;(e=this.armCompiler.constructMRS(g,O,s)).writesPC=g==this.PC}}}return e.execMode=this.MODE_ARM,e.fixedJump=e.fixedJump||!1,e},U.prototype.compileThumb=function(t){var e=this.badOp(65535&t);this.gprs;if(16384==(64512&t)){var i=(56&t)>>3,s=7&t;switch(960&t){case 0:e=this.thumbCompiler.constructAND(s,i);break;case 64:e=this.thumbCompiler.constructEOR(s,i);break;case 128:e=this.thumbCompiler.constructLSL2(s,i);break;case 192:e=this.thumbCompiler.constructLSR2(s,i);break;case 256:e=this.thumbCompiler.constructASR2(s,i);break;case 320:e=this.thumbCompiler.constructADC(s,i);break;case 384:e=this.thumbCompiler.constructSBC(s,i);break;case 448:e=this.thumbCompiler.constructROR(s,i);break;case 512:e=this.thumbCompiler.constructTST(s,i);break;case 576:e=this.thumbCompiler.constructNEG(s,i);break;case 640:e=this.thumbCompiler.constructCMP2(s,i);break;case 704:e=this.thumbCompiler.constructCMN(s,i);break;case 768:e=this.thumbCompiler.constructORR(s,i);break;case 832:e=this.thumbCompiler.constructMUL(s,i);break;case 896:e=this.thumbCompiler.constructBIC(s,i);break;case 960:e=this.thumbCompiler.constructMVN(s,i)}e.writesPC=!1}else if(17408==(64512&t)){i=(120&t)>>3,s=(r=7&t)|(128&t)>>4;switch(768&t){case 0:(e=this.thumbCompiler.constructADD4(s,i)).writesPC=s==this.PC;break;case 256:(e=this.thumbCompiler.constructCMP3(s,i)).writesPC=!1;break;case 512:(e=this.thumbCompiler.constructMOV3(s,i)).writesPC=s==this.PC;break;case 768:(e=this.thumbCompiler.constructBX(s,i)).writesPC=!0,e.fixedJump=!1}}else if(6144==(63488&t)){i=(448&t)>>6;var r=(56&t)>>3;s=7&t;switch(1536&t){case 0:e=this.thumbCompiler.constructADD3(s,r,i);break;case 512:e=this.thumbCompiler.constructSUB3(s,r,i);break;case 1024:e=(n=(448&t)>>6)?this.thumbCompiler.constructADD1(s,r,n):this.thumbCompiler.constructMOV2(s,r,i);break;case 1536:var n=(448&t)>>6;e=this.thumbCompiler.constructSUB1(s,r,n)}e.writesPC=!1}else if(57344&t)if(8192==(57344&t)){n=255&t,r=(1792&t)>>8;switch(6144&t){case 0:e=this.thumbCompiler.constructMOV1(r,n);break;case 2048:e=this.thumbCompiler.constructCMP1(r,n);break;case 4096:e=this.thumbCompiler.constructADD2(r,n);break;case 6144:e=this.thumbCompiler.constructSUB2(r,n)}e.writesPC=!1}else if(18432==(63488&t)){s=(1792&t)>>8,n=(255&t)<<2;(e=this.thumbCompiler.constructLDR3(s,n)).writesPC=!1}else if(20480==(61440&t)){s=7&t,r=(56&t)>>3,i=(448&t)>>6;switch(3584&t){case 0:e=this.thumbCompiler.constructSTR2(s,r,i);break;case 512:e=this.thumbCompiler.constructSTRH2(s,r,i);break;case 1024:e=this.thumbCompiler.constructSTRB2(s,r,i);break;case 1536:e=this.thumbCompiler.constructLDRSB(s,r,i);break;case 2048:e=this.thumbCompiler.constructLDR2(s,r,i);break;case 2560:e=this.thumbCompiler.constructLDRH2(s,r,i);break;case 3072:e=this.thumbCompiler.constructLDRB2(s,r,i);break;case 3584:e=this.thumbCompiler.constructLDRSH(s,r,i)}e.writesPC=!1}else if(24576==(57344&t)){s=7&t,r=(56&t)>>3,n=(1984&t)>>4;(o=4096&t)&&(n>>=2),(e=2048&t?o?this.thumbCompiler.constructLDRB1(s,r,n):this.thumbCompiler.constructLDR1(s,r,n):o?this.thumbCompiler.constructSTRB1(s,r,n):this.thumbCompiler.constructSTR1(s,r,n)).writesPC=!1}else if(46080==(62976&t)){var a=!!(256&t),h=255&t;2048&t?((e=this.thumbCompiler.constructPOP(h,a)).writesPC=a,e.fixedJump=!1):(e=this.thumbCompiler.constructPUSH(h,a)).writesPC=!1}else{if(!(32768&t))throw"Bad opcode: 0x"+t.toString(16);switch(28672&t){case 0:s=7&t,r=(56&t)>>3,n=(1984&t)>>5;(e=2048&t?this.thumbCompiler.constructLDRH1(s,r,n):this.thumbCompiler.constructSTRH1(s,r,n)).writesPC=!1;break;case 4096:s=(1792&t)>>8,n=(255&t)<<2;(e=2048&t?this.thumbCompiler.constructLDR4(s,n):this.thumbCompiler.constructSTR3(s,n)).writesPC=!1;break;case 8192:s=(1792&t)>>8,n=(255&t)<<2;(e=2048&t?this.thumbCompiler.constructADD6(s,n):this.thumbCompiler.constructADD5(s,n)).writesPC=!1;break;case 12288:if(!(3840&t)){var o;n=(127&t)<<2;(o=128&t)&&(n=-n),(e=this.thumbCompiler.constructADD7(n)).writesPC=!1}break;case 16384:r=(1792&t)>>8,h=255&t;(e=2048&t?this.thumbCompiler.constructLDMIA(r,h):this.thumbCompiler.constructSTMIA(r,h)).writesPC=!1;break;case 20480:var c=(3840&t)>>8;n=255&t;if(15==c)(e=this.thumbCompiler.constructSWI(n)).writesPC=!1;else{128&t&&(n|=4294967040),n<<=1;var u=this.conds[c];(e=this.thumbCompiler.constructB1(n,u)).writesPC=!0,e.fixedJump=!0}break;case 24576:case 28672:n=2047&t;switch(6144&t){case 0:1024&n&&(n|=4294965248),n<<=1,(e=this.thumbCompiler.constructB2(n)).writesPC=!0,e.fixedJump=!0;break;case 2048:break;case 4096:1024&n&&(n|=4294966272),n<<=12,(e=this.thumbCompiler.constructBL1(n)).writesPC=!1;break;case 6144:(e=this.thumbCompiler.constructBL2(n)).writesPC=!0,e.fixedJump=!1}break;default:this.WARN("Undefined instruction: 0x"+t.toString(16))}}else{var s=7&t,i=(56&t)>>3,n=(1984&t)>>6;switch(6144&t){case 0:e=this.thumbCompiler.constructLSL1(s,i,n);break;case 2048:e=this.thumbCompiler.constructLSR1(s,i,n);break;case 4096:e=this.thumbCompiler.constructASR1(s,i,n)}e.writesPC=!1}return e.execMode=this.MODE_THUMB,e.fixedJump=e.fixedJump||!1,e};var H=U;var F={TAG_INT:1,TAG_STRING:2,TAG_STRUCT:3,TAG_BLOB:4,TAG_BOOLEAN:5,TYPE:"application/octet-stream",pointer:function(){this.index=0,this.top=0,this.stack=[]},pack:function(t){var e=new DataView(new ArrayBuffer(4));return e.setUint32(0,t,!0),e.buffer},pack8:function(t){var e=new DataView(new ArrayBuffer(1));return e.setUint8(0,t,!0),e.buffer},prefix:function(t){return new Blob([F.pack(t.size||t.length||t.byteLength),t],{type:F.TYPE})},serialize:function(t){var e=[],i=4;for(var s in t)if(t.hasOwnProperty(s)){var r,n,a=F.prefix(s);switch(typeof t[s]){case"number":r=F.TAG_INT,n=F.pack(t[s]);break;case"string":r=F.TAG_STRING,n=F.prefix(t[s]);break;case"object":t[s].type==F.TYPE?(r=F.TAG_BLOB,n=t[s]):(r=F.TAG_STRUCT,n=F.serialize(t[s]));break;case"boolean":r=F.TAG_BOOLEAN,n=F.pack8(t[s]);break;default:console.log(t[s])}i+=1+a.size+(n.size||n.byteLength||n.length),e.push(F.pack8(r)),e.push(a),e.push(n)}return e.unshift(F.pack(i)),new Blob(e)},deserialize:function(t,e){var i=new FileReader;i.onload=function(t){e(F.deserealizeStream(new DataView(t.target.result),new F.pointer))},i.readAsArrayBuffer(t)},deserealizeStream:function(t,e){e.push();for(var i={},s=t.getUint32(e.advance(4),!0);e.mark()<s;){var r,n=t.getUint8(e.advance(1)),a=e.readString(t);switch(n){case F.TAG_INT:r=t.getUint32(e.advance(4),!0);break;case F.TAG_STRING:r=e.readString(t);break;case F.TAG_STRUCT:r=F.deserealizeStream(t,e);break;case F.TAG_BLOB:var h=t.getUint32(e.advance(4),!0);r=t.buffer.slice(e.advance(h),e.advance(0));break;case F.TAG_BOOLEAN:r=!!t.getUint8(e.advance(1))}i[a]=r}if(e.mark()>s)throw"Size of serialized data exceeded";return e.pop(),i},serializePNG:function(t,e,i){for(var s=document.createElement("canvas"),r=s.getContext("2d"),n=e.getContext("2d").getImageData(0,0,e.width,e.height),a=0,h=0;h<e.height;++h)for(var o=0;o<e.width;++o)n.data[4*(o+h*e.width)+3]||++a;for(var c=3*a+(e.width*e.height-a),u=1;c*u*u<t.size;++u);var p=c*u*u-t.size,l=Math.ceil(p/(e.width*u));s.setAttribute("width",e.width*u),s.setAttribute("height",e.height*u+l);var d=new FileReader;return d.onload=function(t){for(var a=new Uint8Array(t.target.result),h=0,o=0,c=r.createImageData(s.width,s.height+l),p=0;p<s.height;++p)for(var d=0;d<s.width;++d){var m=p/u|0,f=d/u|0;if(m>e.height||!n.data[4*(f+m*e.width)+3])c.data[o++]=a[h++],c.data[o++]=a[h++],c.data[o++]=a[h++],c.data[o++]=0;else{var A=a[h++];c.data[o++]=n.data[4*(f+m*e.width)+0]|7&A,c.data[o++]=n.data[4*(f+m*e.width)+1]|A>>3&7,c.data[o++]=n.data[4*(f+m*e.width)+2]|A>>6&7,c.data[o++]=n.data[4*(f+m*e.width)+3]}}r.putImageData(c,0,0),i(s.toDataURL("image/png"))},d.readAsArrayBuffer(t),s},deserializePNG:function(t,e){var i=new FileReader;i.onload=function(t){var i=document.createElement("img");i.setAttribute("src",t.target.result);var s=document.createElement("canvas");s.setAttribute("height",i.height),s.setAttribute("width",i.width);var r=s.getContext("2d");r.drawImage(i,0,0);for(var n=r.getImageData(0,0,s.width,s.height),a=(t=[],0);a<s.height;++a)for(var h=0;h<s.width;++h)if(n.data[4*(h+a*s.width)+3]){var o=0;o|=7&n.data[4*(h+a*s.width)+0],o|=(7&n.data[4*(h+a*s.width)+1])<<3,o|=(7&n.data[4*(h+a*s.width)+2])<<6,t.push(o)}else t.push(n.data[4*(h+a*s.width)+0]),t.push(n.data[4*(h+a*s.width)+1]),t.push(n.data[4*(h+a*s.width)+2]);var c=new Blob(t.map((function(t){var e=new Uint8Array(1);return e[0]=t,e})),{type:F.TYPE});F.deserialize(c,e)},i.readAsDataURL(t)}};F.pointer.prototype.advance=function(t){var e=this.index;return this.index+=t,e},F.pointer.prototype.mark=function(){return this.index-this.top},F.pointer.prototype.push=function(){this.stack.push(this.top),this.top=this.index},F.pointer.prototype.pop=function(){this.top=this.stack.pop()},F.pointer.prototype.readString=function(t){for(var e=t.getUint32(this.advance(4),!0),i=[],s=0;s<e;++s)i.push(String.fromCharCode(t.getUint8(this.advance(1))));return i.join("")};var W=F;function q(t){Z.call(this,new ArrayBuffer(t),0),this.writePending=!1}function V(t){Z.call(this,new ArrayBuffer(t),0),this.COMMAND_WIPE=16,this.COMMAND_ERASE_SECTOR=48,this.COMMAND_ERASE=128,this.COMMAND_ID=144,this.COMMAND_WRITE=160,this.COMMAND_SWITCH_BANK=176,this.COMMAND_TERMINATE_ID=240,this.ID_PANASONIC=6962,this.ID_SANYO=4962,this.bank0=new DataView(this.buffer,0,65536),t>65536?(this.id=this.ID_SANYO,this.bank1=new DataView(this.buffer,65536)):(this.id=this.ID_PANASONIC,this.bank1=null),this.bank=this.bank0,this.idMode=!1,this.writePending=!1,this.first=0,this.second=0,this.command=0,this.pendingCommand=0}function Q(t,e){Z.call(this,new ArrayBuffer(t),0),this.writeAddress=0,this.readBitsRemaining=0,this.readAddress=0,this.command=0,this.commandBitsRemaining=0,this.realSize=0,this.addressBits=0,this.writePending=!1,this.dma=e.core.irq.dma[3],this.COMMAND_NULL=0,this.COMMAND_PENDING=1,this.COMMAND_WRITE=2,this.COMMAND_READ_PENDING=3,this.COMMAND_READ=4}function K(t,e){this.core=t,this.rom=e,this.readWrite=0,this.direction=0,this.device=new Y(this)}function Y(t){this.gpio=t,this.pins=0,this.direction=0,this.totalBytes=[0,0,7,0,1,0,3,0],this.bytesRemaining=0,this.transferStep=0,this.reading=0,this.bitsRead=0,this.bits=0,this.command=-1,this.control=64,this.time=[0,0,0,0,0,0,0]}q.prototype=Object.create(Z.prototype),q.prototype.store8=function(t,e){this.view.setInt8(t,e),this.writePending=!0},q.prototype.store16=function(t,e){this.view.setInt16(t,e,!0),this.writePending=!0},q.prototype.store32=function(t,e){this.view.setInt32(t,e,!0),this.writePending=!0},V.prototype=Object.create(Z.prototype),V.prototype.load8=function(t){return this.idMode&&t<2?this.id>>(t<<3)&255:t<65536?this.bank.getInt8(t):0},V.prototype.load16=function(t){return 255&this.load8(t)|this.load8(t+1)<<8},V.prototype.load32=function(t){return 255&this.load8(t)|this.load8(t+1)<<8|this.load8(t+2)<<16|this.load8(t+3)<<24},V.prototype.loadU8=function(t){return 255&this.load8(t)},V.prototype.loadU16=function(t){return 255&this.loadU8(t)|this.loadU8(t+1)<<8},V.prototype.store8=function(t,e){switch(this.command){case 0:if(21845==t)if(85==this.second){switch(e){case this.COMMAND_ERASE:this.pendingCommand=e;break;case this.COMMAND_ID:this.idMode=!0;break;case this.COMMAND_TERMINATE_ID:this.idMode=!1;break;default:this.command=e}this.second=0,this.first=0}else this.command=0,this.first=e,this.idMode=!1;else 10922==t&&170==this.first&&(this.first=0,this.pendingCommand?this.command=this.pendingCommand:this.second=e);break;case this.COMMAND_ERASE:switch(e){case this.COMMAND_WIPE:if(21845==t)for(var i=0;i<this.view.byteLength;i+=4)this.view.setInt32(i,-1);break;case this.COMMAND_ERASE_SECTOR:if(0==(4095&t))for(i=t;i<t+4096;i+=4)this.bank.setInt32(i,-1)}this.pendingCommand=0,this.command=0;break;case this.COMMAND_WRITE:this.bank.setInt8(t,e),this.command=0,this.writePending=!0;break;case this.COMMAND_SWITCH_BANK:this.bank1&&0==t&&(this.bank=1==e?this.bank1:this.bank0),this.command=0}},V.prototype.store16=function(t,e){throw new Error("Unaligned save to flash!")},V.prototype.store32=function(t,e){throw new Error("Unaligned save to flash!")},V.prototype.replaceData=function(t){var e=this.view===this.bank1;Z.prototype.replaceData.call(this,t,0),this.bank0=new DataView(this.buffer,0,65536),t.byteLength>65536?this.bank1=new DataView(this.buffer,65536):this.bank1=null,this.bank=e?this.bank1:this.bank0},Q.prototype=Object.create(Z.prototype),Q.prototype.load8=function(t){throw new Error("Unsupported 8-bit access!")},Q.prototype.load16=function(t){return this.loadU16(t)},Q.prototype.loadU8=function(t){throw new Error("Unsupported 8-bit access!")},Q.prototype.loadU16=function(t){if(this.command!=this.COMMAND_READ||!this.dma.enable)return 1;if(--this.readBitsRemaining,this.readBitsRemaining<64){var e=63-this.readBitsRemaining,i=this.view.getUint8(this.readAddress+e>>3,!1)>>7-(7&e);return this.readBitsRemaining||(this.command=this.COMMAND_NULL),1&i}return 0},Q.prototype.load32=function(t){throw new Error("Unsupported 32-bit access!")},Q.prototype.store8=function(t,e){throw new Error("Unsupported 8-bit access!")},Q.prototype.store16=function(t,e){switch(this.command){case this.COMMAND_NULL:default:this.command=1&e;break;case this.COMMAND_PENDING:if(this.command<<=1,this.command|=1&e,this.command==this.COMMAND_WRITE){if(!this.realSize){var i=this.dma.count-67;this.realSize=8<<i,this.addressBits=i}this.commandBitsRemaining=this.addressBits+64+1,this.writeAddress=0}else{if(!this.realSize){i=this.dma.count-3;this.realSize=8<<i,this.addressBits=i}this.commandBitsRemaining=this.addressBits+1,this.readAddress=0}break;case this.COMMAND_WRITE:if(--this.commandBitsRemaining>64)this.writeAddress<<=1,this.writeAddress|=(1&e)<<6;else if(this.commandBitsRemaining<=0)this.command=this.COMMAND_NULL,this.writePending=!0;else{var s=this.view.getUint8(this.writeAddress>>3);s&=~(1<<7-(7&this.writeAddress)),s|=(1&e)<<7-(7&this.writeAddress),this.view.setUint8(this.writeAddress>>3,s),++this.writeAddress}break;case this.COMMAND_READ_PENDING:--this.commandBitsRemaining>0?(this.readAddress<<=1,1&e&&(this.readAddress|=64)):(this.readBitsRemaining=68,this.command=this.COMMAND_READ)}},Q.prototype.store32=function(t,e){throw new Error("Unsupported 32-bit access!")},Q.prototype.replaceData=function(t){Z.prototype.replaceData.call(this,t,0)},K.prototype.store16=function(t,e){switch(t){case 196:this.device.setPins(15&e);break;case 198:this.direction=15&e,this.device.setDirection(this.direction);break;case 200:this.readWrite=1&e;break;default:throw new Error("BUG: Bad offset passed to GPIO: "+t.toString(16))}if(this.readWrite){var i=this.rom.view.getUint16(t,!0);i&=~this.direction,this.rom.view.setUint16(t,i|e&this.direction,!0)}},K.prototype.outputPins=function(t){if(this.readWrite){var e=this.rom.view.getUint16(196,!0);e&=this.direction,this.rom.view.setUint16(196,e|t&~this.direction&15,!0)}},Y.prototype.setPins=function(t){switch(this.transferStep){case 0:1==(5&t)&&(this.transferStep=1);break;case 1:4&t&&(this.transferStep=2);break;case 2:1&t?4&t?2&this.direction&&!this.read?(++this.bitsRead,8==this.bitsRead&&this.processByte()):(this.gpio.outputPins(5|this.sioOutputPin()<<1),++this.bitsRead,8==this.bitsRead&&(--this.bytesRemaining,this.bytesRemaining<=0&&(this.command=-1),this.bitsRead=0)):(this.bitsRead=0,this.bytesRemaining=0,this.command=-1,this.transferStep=0):(this.bits&=~(1<<this.bitsRead),this.bits|=(2&t)>>1<<this.bitsRead)}this.pins=7&t},Y.prototype.setDirection=function(t){this.direction=t},Y.prototype.processByte=function(){switch(--this.bytesRemaining,this.command){case-1:if(6==(15&this.bits))switch(this.command=this.bits>>4&7,this.reading=128&this.bits,this.bytesRemaining=this.totalBytes[this.command],this.command){case 0:this.control=0;break;case 2:case 6:this.updateClock()}else this.gpio.core.WARN("Invalid RTC command byte: "+this.bits.toString(16));break;case 4:this.control=64&this.bits}this.bits=0,this.bitsRead=0,this.bytesRemaining||(this.command=-1)},Y.prototype.sioOutputPin=function(){var t=0;switch(this.command){case 4:t=this.control;break;case 2:case 6:t=this.time[7-this.bytesRemaining]}return t>>this.bitsRead&1},Y.prototype.updateClock=function(){var t=new Date;this.time[0]=this.bcd(t.getFullYear()),this.time[1]=this.bcd(t.getMonth()+1),this.time[2]=this.bcd(t.getDate()),this.time[3]=t.getDay()-1,this.time[3]<0&&(this.time[3]=6),64&this.control?this.time[4]=this.bcd(t.getHours()):(this.time[4]=this.bcd(t.getHours()%2),t.getHours()>=12&&(this.time[4]|=128)),this.time[5]=this.bcd(t.getMinutes()),this.time[6]=this.bcd(t.getSeconds())},Y.prototype.bcd=function(t){var e=t%10;return e+=(t/=10)%10<<4};var j=K;function Z(t,e){this.inherit(),this.buffer=t,this.view=new DataView(this.buffer,"number"===typeof e?e:0),this.mask=t.byteLength-1,this.resetMask()}function X(t,e){Z.call(this,new ArrayBuffer(t)),this.ICACHE_PAGE_BITS=e,this.PAGE_MASK=(2<<this.ICACHE_PAGE_BITS)-1,this.icache=new Array(t>>this.ICACHE_PAGE_BITS+1)}function z(t,e){Z.call(this,t,e),this.ICACHE_PAGE_BITS=10,this.PAGE_MASK=(2<<this.ICACHE_PAGE_BITS)-1,this.icache=new Array(t.byteLength>>this.ICACHE_PAGE_BITS+1),this.mask=33554431,this.resetMask()}function J(t,e){Z.call(this,t,e),this.ICACHE_PAGE_BITS=16,this.PAGE_MASK=(2<<this.ICACHE_PAGE_BITS)-1,this.icache=new Array(1)}function $(t,e){this.inherit(),this.cpu=e,this.mmu=t}function tt(){this.inherit(),this.REGION_BIOS=0,this.REGION_WORKING_RAM=2,this.REGION_WORKING_IRAM=3,this.REGION_IO=4,this.REGION_PALETTE_RAM=5,this.REGION_VRAM=6,this.REGION_OAM=7,this.REGION_CART0=8,this.REGION_CART1=10,this.REGION_CART2=12,this.REGION_CART_SRAM=14,this.BASE_BIOS=0,this.BASE_WORKING_RAM=33554432,this.BASE_WORKING_IRAM=50331648,this.BASE_IO=67108864,this.BASE_PALETTE_RAM=83886080,this.BASE_VRAM=100663296,this.BASE_OAM=117440512,this.BASE_CART0=134217728,this.BASE_CART1=167772160,this.BASE_CART2=201326592,this.BASE_CART_SRAM=234881024,this.BASE_MASK=251658240,this.BASE_OFFSET=24,this.OFFSET_MASK=16777215,this.SIZE_BIOS=16384,this.SIZE_WORKING_RAM=262144,this.SIZE_WORKING_IRAM=32768,this.SIZE_IO=1024,this.SIZE_PALETTE_RAM=1024,this.SIZE_VRAM=98304,this.SIZE_OAM=1024,this.SIZE_CART0=33554432,this.SIZE_CART1=33554432,this.SIZE_CART2=33554432,this.SIZE_CART_SRAM=32768,this.SIZE_CART_FLASH512=65536,this.SIZE_CART_FLASH1M=131072,this.SIZE_CART_EEPROM=8192,this.DMA_TIMING_NOW=0,this.DMA_TIMING_VBLANK=1,this.DMA_TIMING_HBLANK=2,this.DMA_TIMING_CUSTOM=3,this.DMA_INCREMENT=0,this.DMA_DECREMENT=1,this.DMA_FIXED=2,this.DMA_INCREMENT_RELOAD=3,this.DMA_OFFSET=[1,-1,0,1],this.WAITSTATES=[0,0,2,0,0,0,0,0,4,4,4,4,4,4,4],this.WAITSTATES_32=[0,0,5,0,0,1,0,1,7,7,9,9,13,13,8],this.WAITSTATES_SEQ=[0,0,2,0,0,0,0,0,2,2,4,4,8,8,4],this.WAITSTATES_SEQ_32=[0,0,5,0,0,1,0,1,5,5,9,9,17,17,8],this.NULLWAIT=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(var t=15;t<256;++t)this.WAITSTATES[t]=0,this.WAITSTATES_32[t]=0,this.WAITSTATES_SEQ[t]=0,this.WAITSTATES_SEQ_32[t]=0,this.NULLWAIT[t]=0;this.ROM_WS=[4,3,2,8],this.ROM_WS_SEQ=[[2,1],[4,1],[8,1]],this.ICACHE_PAGE_BITS=8,this.PAGE_MASK=(2<<this.ICACHE_PAGE_BITS)-1,this.bios=null}Z.prototype.resetMask=function(){this.mask8=4294967295&this.mask,this.mask16=4294967294&this.mask,this.mask32=4294967292&this.mask},Z.prototype.load8=function(t){return this.view.getInt8(t&this.mask8)},Z.prototype.load16=function(t){return this.view.getInt16(t&this.mask,!0)},Z.prototype.loadU8=function(t){return this.view.getUint8(t&this.mask8)},Z.prototype.loadU16=function(t){return this.view.getUint16(t&this.mask,!0)},Z.prototype.load32=function(t){var e=(3&t)<<3,i=this.view.getInt32(t&this.mask32,!0);return i>>>e|i<<32-e},Z.prototype.store8=function(t,e){this.view.setInt8(t&this.mask8,e)},Z.prototype.store16=function(t,e){this.view.setInt16(t&this.mask16,e,!0)},Z.prototype.store32=function(t,e){this.view.setInt32(t&this.mask32,e,!0)},Z.prototype.invalidatePage=function(t){},Z.prototype.replaceData=function(t,e){this.buffer=t,this.view=new DataView(this.buffer,"number"===typeof e?e:0),this.icache&&(this.icache=new Array(this.icache.length))},X.prototype=Object.create(Z.prototype),X.prototype.invalidatePage=function(t){var e=this.icache[(t&this.mask)>>this.ICACHE_PAGE_BITS];e&&(e.invalid=!0)},z.prototype=Object.create(Z.prototype),z.prototype.store8=function(t,e){},z.prototype.store16=function(t,e){t<202&&t>=196&&(this.gpio||(this.gpio=this.mmu.allocGPIO(this)),this.gpio.store16(t,e))},z.prototype.store32=function(t,e){t<202&&t>=196&&(this.gpio||(this.gpio=this.mmu.allocGPIO(this)),this.gpio.store32(t,e))},J.prototype=Object.create(Z.prototype),J.prototype.load8=function(t){return t>=this.buffer.byteLength?-1:this.view.getInt8(t)},J.prototype.load16=function(t){return t>=this.buffer.byteLength?-1:this.view.getInt16(t,!0)},J.prototype.loadU8=function(t){return t>=this.buffer.byteLength?-1:this.view.getUint8(t)},J.prototype.loadU16=function(t){return t>=this.buffer.byteLength?-1:this.view.getUint16(t,!0)},J.prototype.load32=function(t){return t>=this.buffer.byteLength?-1:this.view.getInt32(t,!0)},J.prototype.store8=function(t,e){},J.prototype.store16=function(t,e){},J.prototype.store32=function(t,e){},$.prototype.load8=function(t){return this.mmu.load8(this.cpu.gprs[this.cpu.PC]-this.cpu.instructionWidth+(3&t))},$.prototype.load16=function(t){return this.mmu.load16(this.cpu.gprs[this.cpu.PC]-this.cpu.instructionWidth+(2&t))},$.prototype.loadU8=function(t){return this.mmu.loadU8(this.cpu.gprs[this.cpu.PC]-this.cpu.instructionWidth+(3&t))},$.prototype.loadU16=function(t){return this.mmu.loadU16(this.cpu.gprs[this.cpu.PC]-this.cpu.instructionWidth+(2&t))},$.prototype.load32=function(t){if(this.cpu.execMode==this.cpu.MODE_ARM)return this.mmu.load32(this.cpu.gprs[this.cpu.gprs.PC]-this.cpu.instructionWidth);var e=this.mmu.loadU16(this.cpu.gprs[this.cpu.PC]-this.cpu.instructionWidth);return e|e<<16},$.prototype.store8=function(t,e){},$.prototype.store16=function(t,e){},$.prototype.store32=function(t,e){},$.prototype.invalidatePage=function(t){},tt.prototype.mmap=function(t,e){this.memory[t]=e},tt.prototype.clear=function(){this.badMemory=new $(this,this.cpu),this.memory=[this.bios,this.badMemory,new X(this.SIZE_WORKING_RAM,9),new X(this.SIZE_WORKING_IRAM,7),null,null,null,null,this.badMemory,this.badMemory,this.badMemory,this.badMemory,this.badMemory,this.badMemory,this.badMemory,this.badMemory];for(var t=16;t<256;++t)this.memory[t]=this.badMemory;this.waitstates=this.WAITSTATES.slice(0),this.waitstatesSeq=this.WAITSTATES_SEQ.slice(0),this.waitstates32=this.WAITSTATES_32.slice(0),this.waitstatesSeq32=this.WAITSTATES_SEQ_32.slice(0),this.waitstatesPrefetch=this.WAITSTATES_SEQ.slice(0),this.waitstatesPrefetch32=this.WAITSTATES_SEQ_32.slice(0),this.cart=null,this.save=null,this.DMA_REGISTER=[this.core.io.DMA0CNT_HI>>1,this.core.io.DMA1CNT_HI>>1,this.core.io.DMA2CNT_HI>>1,this.core.io.DMA3CNT_HI>>1]},tt.prototype.freeze=function(){return{ram:W.prefix(this.memory[this.REGION_WORKING_RAM].buffer),iram:W.prefix(this.memory[this.REGION_WORKING_IRAM].buffer)}},tt.prototype.defrost=function(t){this.memory[this.REGION_WORKING_RAM].replaceData(t.ram),this.memory[this.REGION_WORKING_IRAM].replaceData(t.iram)},tt.prototype.loadBios=function(t,e){this.bios=new J(t),this.bios.real=!!e},tt.prototype.loadRom=function(t,e){var i={title:null,code:null,maker:null,memory:t,saveType:null},s=new z(t);if(150!=s.view.getUint8(178))return null;if(s.mmu=this,this.memory[this.REGION_CART0]=s,this.memory[this.REGION_CART1]=s,this.memory[this.REGION_CART2]=s,t.byteLength>16777216){var r=new z(t,16777216);this.memory[this.REGION_CART0+1]=r,this.memory[this.REGION_CART1+1]=r,this.memory[this.REGION_CART2+1]=r}if(e){for(var n="",a=0;a<12;++a){if(!(c=s.loadU8(a+160)))break;n+=String.fromCharCode(c)}i.title=n;var h="";for(a=0;a<4;++a){if(!(c=s.loadU8(a+172)))break;h+=String.fromCharCode(c)}i.code=h;var o="";for(a=0;a<2;++a){var c;if(!(c=s.loadU8(a+176)))break;o+=String.fromCharCode(c)}i.maker=o;var u,p="",l=!1;for(a=228;a<t.byteLength&&!l;++a)switch(p+=u=String.fromCharCode(s.loadU8(a))){case"F":case"FL":case"FLA":case"FLAS":case"FLASH":case"FLASH_":case"FLASH5":case"FLASH51":case"FLASH512":case"FLASH512_":case"FLASH1":case"FLASH1M":case"FLASH1M_":case"S":case"SR":case"SRA":case"SRAM":case"SRAM_":case"E":case"EE":case"EEP":case"EEPR":case"EEPRO":case"EEPROM":case"EEPROM_":break;case"FLASH_V":case"FLASH512_V":case"FLASH1M_V":case"SRAM_V":case"EEPROM_V":l=!0;break;default:p=u}if(l)switch(i.saveType=p,p){case"FLASH_V":case"FLASH512_V":this.save=this.memory[this.REGION_CART_SRAM]=new V(this.SIZE_CART_FLASH512);break;case"FLASH1M_V":this.save=this.memory[this.REGION_CART_SRAM]=new V(this.SIZE_CART_FLASH1M);break;case"SRAM_V":this.save=this.memory[this.REGION_CART_SRAM]=new q(this.SIZE_CART_SRAM);break;case"EEPROM_V":this.save=this.memory[this.REGION_CART2+1]=new Q(this.SIZE_CART_EEPROM,this)}this.save||(this.save=this.memory[this.REGION_CART_SRAM]=new q(this.SIZE_CART_SRAM))}return this.cart=i,i},tt.prototype.loadSavedata=function(t){this.save.replaceData(t)},tt.prototype.load8=function(t){return this.memory[t>>>this.BASE_OFFSET].load8(16777215&t)},tt.prototype.load16=function(t){return this.memory[t>>>this.BASE_OFFSET].load16(16777215&t)},tt.prototype.load32=function(t){return this.memory[t>>>this.BASE_OFFSET].load32(16777215&t)},tt.prototype.loadU8=function(t){return this.memory[t>>>this.BASE_OFFSET].loadU8(16777215&t)},tt.prototype.loadU16=function(t){return this.memory[t>>>this.BASE_OFFSET].loadU16(16777215&t)},tt.prototype.store8=function(t,e){var i=16777215&t,s=this.memory[t>>>this.BASE_OFFSET];s.store8(i,e),s.invalidatePage(i)},tt.prototype.store16=function(t,e){var i=16777214&t,s=this.memory[t>>>this.BASE_OFFSET];s.store16(i,e),s.invalidatePage(i)},tt.prototype.store32=function(t,e){var i=16777212&t,s=this.memory[t>>>this.BASE_OFFSET];s.store32(i,e),s.invalidatePage(i),s.invalidatePage(i+2)},tt.prototype.waitPrefetch=function(t){this.cpu.cycles+=1+this.waitstatesPrefetch[t>>>this.BASE_OFFSET]},tt.prototype.waitPrefetch32=function(t){this.cpu.cycles+=1+this.waitstatesPrefetch32[t>>>this.BASE_OFFSET]},tt.prototype.wait=function(t){this.cpu.cycles+=1+this.waitstates[t>>>this.BASE_OFFSET]},tt.prototype.wait32=function(t){this.cpu.cycles+=1+this.waitstates32[t>>>this.BASE_OFFSET]},tt.prototype.waitSeq=function(t){this.cpu.cycles+=1+this.waitstatesSeq[t>>>this.BASE_OFFSET]},tt.prototype.waitSeq32=function(t){this.cpu.cycles+=1+this.waitstatesSeq32[t>>>this.BASE_OFFSET]},tt.prototype.waitMul=function(t){this.cpu.cycles+=!0&t||!(4294967040&t)?1:!0&t||!(4294901760&t)?2:!0&t||!(4278190080&t)?3:4},tt.prototype.waitMulti32=function(t,e){this.cpu.cycles+=1+this.waitstates32[t>>>this.BASE_OFFSET],this.cpu.cycles+=(1+this.waitstatesSeq32[t>>>this.BASE_OFFSET])*(e-1)},tt.prototype.addressToPage=function(t,e){return e>>this.memory[t].ICACHE_PAGE_BITS},tt.prototype.accessPage=function(t,e){var i=this.memory[t],s=i.icache[e];return s&&!s.invalid||(s={thumb:new Array(1<<i.ICACHE_PAGE_BITS),arm:new Array(1<<i.ICACHE_PAGE_BITS-1),invalid:!1},i.icache[e]=s),s},tt.prototype.scheduleDma=function(t,e){switch(e.timing){case this.DMA_TIMING_NOW:this.serviceDma(t,e);break;case this.DMA_TIMING_HBLANK:case this.DMA_TIMING_VBLANK:break;case this.DMA_TIMING_CUSTOM:switch(t){case 0:this.core.WARN("Discarding invalid DMA0 scheduling");break;case 1:case 2:this.cpu.irq.audio.scheduleFIFODma(t,e);break;case 3:this.cpu.irq.video.scheduleVCaptureDma(t,e)}}},tt.prototype.runHblankDmas=function(){for(var t,e=0;e<this.cpu.irq.dma.length;++e)(t=this.cpu.irq.dma[e]).enable&&t.timing==this.DMA_TIMING_HBLANK&&this.serviceDma(e,t)},tt.prototype.runVblankDmas=function(){for(var t,e=0;e<this.cpu.irq.dma.length;++e)(t=this.cpu.irq.dma[e]).enable&&t.timing==this.DMA_TIMING_VBLANK&&this.serviceDma(e,t)},tt.prototype.serviceDma=function(t,e){if(e.enable){var i,s=e.width,r=this.DMA_OFFSET[e.srcControl]*s,n=this.DMA_OFFSET[e.dstControl]*s,a=e.nextCount,h=e.nextSource&this.OFFSET_MASK,o=e.nextDest&this.OFFSET_MASK,c=e.nextSource>>>this.BASE_OFFSET,u=e.nextDest>>>this.BASE_OFFSET,p=this.memory[c],l=this.memory[u],d=null,m=null,f=4294967295,A=4294967295;if(l.ICACHE_PAGE_BITS)for(var b=o+a*s>>l.ICACHE_PAGE_BITS,C=o>>l.ICACHE_PAGE_BITS;C<=b;++C)l.invalidatePage(C<<l.ICACHE_PAGE_BITS);if(u!=this.REGION_WORKING_RAM&&u!=this.REGION_WORKING_IRAM||(m=l.view,A=l.mask),c!=this.REGION_WORKING_RAM&&c!=this.REGION_WORKING_IRAM&&c!=this.REGION_CART0&&c!=this.REGION_CART1||(d=p.view,f=p.mask),p&&l)if(d&&m)if(4==s)for(h&=4294967292,o&=4294967292;a--;)i=d.getInt32(h&f),m.setInt32(o&A,i),h+=r,o+=n;else for(;a--;)i=d.getUint16(h&f),m.setUint16(o&A,i),h+=r,o+=n;else if(d)if(4==s)for(h&=4294967292,o&=4294967292;a--;)i=d.getInt32(h&f,!0),l.store32(o,i),h+=r,o+=n;else for(;a--;)i=d.getUint16(h&f,!0),l.store16(o,i),h+=r,o+=n;else if(4==s)for(h&=4294967292,o&=4294967292;a--;)i=p.load32(h),l.store32(o,i),h+=r,o+=n;else for(;a--;)i=p.loadU16(h),l.store16(o,i),h+=r,o+=n;else this.core.WARN("Invalid DMA");if(e.doIrq&&(e.nextIRQ=this.cpu.cycles+2,e.nextIRQ+=4==s?this.waitstates32[c]+this.waitstates32[u]:this.waitstates[c]+this.waitstates[u],e.nextIRQ+=(e.count-1)*(4==s?this.waitstatesSeq32[c]+this.waitstatesSeq32[u]:this.waitstatesSeq[c]+this.waitstatesSeq[u])),e.nextSource=h|c<<this.BASE_OFFSET,e.nextDest=o|u<<this.BASE_OFFSET,e.nextCount=a,e.repeat)e.nextCount=e.count,e.dstControl==this.DMA_INCREMENT_RELOAD&&(e.nextDest=e.dest),this.scheduleDma(t,e);else e.enable=!1,this.memory[this.REGION_IO].registers[this.DMA_REGISTER[t]]&=32736}},tt.prototype.adjustTimings=function(t){var e=3&t,i=(12&t)>>2,s=(16&t)>>4,r=(96&t)>>5,n=(128&t)>>7,a=(768&t)>>8,h=(1024&t)>>10,o=16384&t;this.waitstates[this.REGION_CART_SRAM]=this.ROM_WS[e],this.waitstatesSeq[this.REGION_CART_SRAM]=this.ROM_WS[e],this.waitstates32[this.REGION_CART_SRAM]=this.ROM_WS[e],this.waitstatesSeq32[this.REGION_CART_SRAM]=this.ROM_WS[e],this.waitstates[this.REGION_CART0]=this.waitstates[this.REGION_CART0+1]=this.ROM_WS[i],this.waitstates[this.REGION_CART1]=this.waitstates[this.REGION_CART1+1]=this.ROM_WS[r],this.waitstates[this.REGION_CART2]=this.waitstates[this.REGION_CART2+1]=this.ROM_WS[a],this.waitstatesSeq[this.REGION_CART0]=this.waitstatesSeq[this.REGION_CART0+1]=this.ROM_WS_SEQ[0][s],this.waitstatesSeq[this.REGION_CART1]=this.waitstatesSeq[this.REGION_CART1+1]=this.ROM_WS_SEQ[1][n],this.waitstatesSeq[this.REGION_CART2]=this.waitstatesSeq[this.REGION_CART2+1]=this.ROM_WS_SEQ[2][h],this.waitstates32[this.REGION_CART0]=this.waitstates32[this.REGION_CART0+1]=this.waitstates[this.REGION_CART0]+1+this.waitstatesSeq[this.REGION_CART0],this.waitstates32[this.REGION_CART1]=this.waitstates32[this.REGION_CART1+1]=this.waitstates[this.REGION_CART1]+1+this.waitstatesSeq[this.REGION_CART1],this.waitstates32[this.REGION_CART2]=this.waitstates32[this.REGION_CART2+1]=this.waitstates[this.REGION_CART2]+1+this.waitstatesSeq[this.REGION_CART2],this.waitstatesSeq32[this.REGION_CART0]=this.waitstatesSeq32[this.REGION_CART0+1]=2*this.waitstatesSeq[this.REGION_CART0]+1,this.waitstatesSeq32[this.REGION_CART1]=this.waitstatesSeq32[this.REGION_CART1+1]=2*this.waitstatesSeq[this.REGION_CART1]+1,this.waitstatesSeq32[this.REGION_CART2]=this.waitstatesSeq32[this.REGION_CART2+1]=2*this.waitstatesSeq[this.REGION_CART2]+1,o?(this.waitstatesPrefetch[this.REGION_CART0]=this.waitstatesPrefetch[this.REGION_CART0+1]=0,this.waitstatesPrefetch[this.REGION_CART1]=this.waitstatesPrefetch[this.REGION_CART1+1]=0,this.waitstatesPrefetch[this.REGION_CART2]=this.waitstatesPrefetch[this.REGION_CART2+1]=0,this.waitstatesPrefetch32[this.REGION_CART0]=this.waitstatesPrefetch32[this.REGION_CART0+1]=0,this.waitstatesPrefetch32[this.REGION_CART1]=this.waitstatesPrefetch32[this.REGION_CART1+1]=0,this.waitstatesPrefetch32[this.REGION_CART2]=this.waitstatesPrefetch32[this.REGION_CART2+1]=0):(this.waitstatesPrefetch[this.REGION_CART0]=this.waitstatesPrefetch[this.REGION_CART0+1]=this.waitstatesSeq[this.REGION_CART0],this.waitstatesPrefetch[this.REGION_CART1]=this.waitstatesPrefetch[this.REGION_CART1+1]=this.waitstatesSeq[this.REGION_CART1],this.waitstatesPrefetch[this.REGION_CART2]=this.waitstatesPrefetch[this.REGION_CART2+1]=this.waitstatesSeq[this.REGION_CART2],this.waitstatesPrefetch32[this.REGION_CART0]=this.waitstatesPrefetch32[this.REGION_CART0+1]=this.waitstatesSeq32[this.REGION_CART0],this.waitstatesPrefetch32[this.REGION_CART1]=this.waitstatesPrefetch32[this.REGION_CART1+1]=this.waitstatesSeq32[this.REGION_CART1],this.waitstatesPrefetch32[this.REGION_CART2]=this.waitstatesPrefetch32[this.REGION_CART2+1]=this.waitstatesSeq32[this.REGION_CART2])},tt.prototype.saveNeedsFlush=function(){return this.save.writePending},tt.prototype.flushSave=function(){this.save.writePending=!1},tt.prototype.allocGPIO=function(t){return new j(this.core,t)};var et=tt;function it(){this.inherit(),this.FREQUENCY=16777216,this.cpu=null,this.enable=!1,this.IRQ_VBLANK=0,this.IRQ_HBLANK=1,this.IRQ_VCOUNTER=2,this.IRQ_TIMER0=3,this.IRQ_TIMER1=4,this.IRQ_TIMER2=5,this.IRQ_TIMER3=6,this.IRQ_SIO=7,this.IRQ_DMA0=8,this.IRQ_DMA1=9,this.IRQ_DMA2=10,this.IRQ_DMA3=11,this.IRQ_KEYPAD=12,this.IRQ_GAMEPAK=13,this.MASK_VBLANK=1,this.MASK_HBLANK=2,this.MASK_VCOUNTER=4,this.MASK_TIMER0=8,this.MASK_TIMER1=16,this.MASK_TIMER2=32,this.MASK_TIMER3=64,this.MASK_SIO=128,this.MASK_DMA0=256,this.MASK_DMA1=512,this.MASK_DMA2=1024,this.MASK_DMA3=2048,this.MASK_KEYPAD=4096,this.MASK_GAMEPAK=8192}it.prototype.clear=function(){this.enable=!1,this.enabledIRQs=0,this.interruptFlags=0,this.dma=new Array;for(var t=0;t<4;++t)this.dma.push({source:0,dest:0,count:0,nextSource:0,nextDest:0,nextCount:0,srcControl:0,dstControl:0,repeat:!1,width:0,drq:!1,timing:0,doIrq:!1,enable:!1,nextIRQ:0});this.timersEnabled=0,this.timers=new Array;for(t=0;t<4;++t)this.timers.push({reload:0,oldReload:0,prescaleBits:0,countUp:!1,doIrq:!1,enable:!1,lastEvent:0,nextEvent:0,overflowInterval:1});this.nextEvent=0,this.springIRQ=!1,this.resetSP()},it.prototype.freeze=function(){return{enable:this.enable,enabledIRQs:this.enabledIRQs,interruptFlags:this.interruptFlags,dma:this.dma,timers:this.timers,nextEvent:this.nextEvent,springIRQ:this.springIRQ}},it.prototype.defrost=function(t){this.enable=t.enable,this.enabledIRQs=t.enabledIRQs,this.interruptFlags=t.interruptFlags,this.dma=t.dma,this.timers=t.timers,this.timersEnabled=0,this.timers[0].enable&&++this.timersEnabled,this.timers[1].enable&&++this.timersEnabled,this.timers[2].enable&&++this.timersEnabled,this.timers[3].enable&&++this.timersEnabled,this.nextEvent=t.nextEvent,this.springIRQ=t.springIRQ},it.prototype.updateTimers=function(){if(!(this.nextEvent>this.cpu.cycles)){if(this.springIRQ&&(this.cpu.raiseIRQ(),this.springIRQ=!1),this.video.updateTimers(this.cpu),this.audio.updateTimers(),this.timersEnabled){var t=this.timers[0];t.enable&&this.cpu.cycles>=t.nextEvent&&(t.lastEvent=t.nextEvent,t.nextEvent+=t.overflowInterval,this.io.registers[this.io.TM0CNT_LO>>1]=t.reload,t.oldReload=t.reload,t.doIrq&&this.raiseIRQ(this.IRQ_TIMER0),this.audio.enabled&&(this.audio.enableChannelA&&!this.audio.soundTimerA&&this.audio.dmaA>=0&&this.audio.sampleFifoA(),this.audio.enableChannelB&&!this.audio.soundTimerB&&this.audio.dmaB>=0&&this.audio.sampleFifoB()),(t=this.timers[1]).countUp&&65536==++this.io.registers[this.io.TM1CNT_LO>>1]&&(t.nextEvent=this.cpu.cycles)),(t=this.timers[1]).enable&&this.cpu.cycles>=t.nextEvent&&(t.lastEvent=t.nextEvent,t.nextEvent+=t.overflowInterval,t.countUp&&65536!=this.io.registers[this.io.TM1CNT_LO>>1]||(this.io.registers[this.io.TM1CNT_LO>>1]=t.reload),t.oldReload=t.reload,t.doIrq&&this.raiseIRQ(this.IRQ_TIMER1),t.countUp&&(t.nextEvent=0),this.audio.enabled&&(this.audio.enableChannelA&&this.audio.soundTimerA&&this.audio.dmaA>=0&&this.audio.sampleFifoA(),this.audio.enableChannelB&&this.audio.soundTimerB&&this.audio.dmaB>=0&&this.audio.sampleFifoB()),(t=this.timers[2]).countUp&&65536==++this.io.registers[this.io.TM2CNT_LO>>1]&&(t.nextEvent=this.cpu.cycles)),(t=this.timers[2]).enable&&this.cpu.cycles>=t.nextEvent&&(t.lastEvent=t.nextEvent,t.nextEvent+=t.overflowInterval,t.countUp&&65536!=this.io.registers[this.io.TM2CNT_LO>>1]||(this.io.registers[this.io.TM2CNT_LO>>1]=t.reload),t.oldReload=t.reload,t.doIrq&&this.raiseIRQ(this.IRQ_TIMER2),t.countUp&&(t.nextEvent=0),(t=this.timers[3]).countUp&&65536==++this.io.registers[this.io.TM3CNT_LO>>1]&&(t.nextEvent=this.cpu.cycles)),(t=this.timers[3]).enable&&this.cpu.cycles>=t.nextEvent&&(t.lastEvent=t.nextEvent,t.nextEvent+=t.overflowInterval,t.countUp&&65536!=this.io.registers[this.io.TM3CNT_LO>>1]||(this.io.registers[this.io.TM3CNT_LO>>1]=t.reload),t.oldReload=t.reload,t.doIrq&&this.raiseIRQ(this.IRQ_TIMER3),t.countUp&&(t.nextEvent=0))}var e=this.dma[0];e.enable&&e.doIrq&&e.nextIRQ&&this.cpu.cycles>=e.nextIRQ&&(e.nextIRQ=0,this.raiseIRQ(this.IRQ_DMA0)),(e=this.dma[1]).enable&&e.doIrq&&e.nextIRQ&&this.cpu.cycles>=e.nextIRQ&&(e.nextIRQ=0,this.raiseIRQ(this.IRQ_DMA1)),(e=this.dma[2]).enable&&e.doIrq&&e.nextIRQ&&this.cpu.cycles>=e.nextIRQ&&(e.nextIRQ=0,this.raiseIRQ(this.IRQ_DMA2)),(e=this.dma[3]).enable&&e.doIrq&&e.nextIRQ&&this.cpu.cycles>=e.nextIRQ&&(e.nextIRQ=0,this.raiseIRQ(this.IRQ_DMA3)),this.pollNextEvent()}},it.prototype.resetSP=function(){this.cpu.switchMode(this.cpu.MODE_SUPERVISOR),this.cpu.gprs[this.cpu.SP]=50364384,this.cpu.switchMode(this.cpu.MODE_IRQ),this.cpu.gprs[this.cpu.SP]=50364320,this.cpu.switchMode(this.cpu.MODE_SYSTEM),this.cpu.gprs[this.cpu.SP]=50364160},it.prototype.swi32=function(t){this.swi(t>>16)},it.prototype.swi=function(t){if(this.core.mmu.bios.real)this.cpu.raiseTrap();else switch(t){case 0:for(var e=this.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM],i=e.loadU8(32762),s=32256;s<32768;s+=4)e.store32(s,0);this.resetSP(),this.cpu.gprs[this.cpu.LR]=i?33554432:134217728,this.cpu.switchExecMode(this.cpu.MODE_ARM),this.cpu.instruction.writesPC=!0,this.cpu.gprs[this.cpu.PC]=this.cpu.gprs[this.cpu.LR];break;case 1:var r=this.cpu.gprs[0];if(1&r&&(this.core.mmu.memory[this.core.mmu.REGION_WORKING_RAM]=new X(this.core.mmu.SIZE_WORKING_RAM,9)),2&r)for(s=0;s<this.core.mmu.SIZE_WORKING_IRAM-512;s+=4)this.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM].store32(s,0);28&r&&this.video.renderPath.clearSubsets(this.core.mmu,r),224&r&&this.core.STUB("Unimplemented RegisterRamReset");break;case 2:this.halt();break;case 5:this.cpu.gprs[0]=1,this.cpu.gprs[1]=1;case 4:if(this.enable||this.io.store16(this.io.IME,1),!this.cpu.gprs[0]&&this.interruptFlags&this.cpu.gprs[1])return;this.dismissIRQs(4294967295),this.cpu.raiseTrap();break;case 6:var n=(0|this.cpu.gprs[0])/(0|this.cpu.gprs[1]),a=(0|this.cpu.gprs[0])%(0|this.cpu.gprs[1]);this.cpu.gprs[0]=0|n,this.cpu.gprs[1]=0|a,this.cpu.gprs[3]=Math.abs(0|n);break;case 7:n=(0|this.cpu.gprs[1])/(0|this.cpu.gprs[0]),a=(0|this.cpu.gprs[1])%(0|this.cpu.gprs[0]);this.cpu.gprs[0]=0|n,this.cpu.gprs[1]=0|a,this.cpu.gprs[3]=Math.abs(0|n);break;case 8:var h=Math.sqrt(this.cpu.gprs[0]);this.cpu.gprs[0]=0|h;break;case 10:var o=this.cpu.gprs[0]/16384,c=this.cpu.gprs[1]/16384;this.cpu.gprs[0]=Math.atan2(c,o)/(2*Math.PI)*65536;break;case 11:var u=this.cpu.gprs[0],p=this.cpu.gprs[1],l=1048575&(f=this.cpu.gprs[2]),d=67108864&f?4:2;if(16777216&f)if(4==d){u&=4294967292,p&=4294967292;var m=this.cpu.mmu.load32(u);for(s=0;s<l;++s)this.cpu.mmu.store32(p+(s<<2),m)}else{u&=4294967294,p&=4294967294;for(m=this.cpu.mmu.load16(u),s=0;s<l;++s)this.cpu.mmu.store16(p+(s<<1),m)}else if(4==d){u&=4294967292,p&=4294967292;for(s=0;s<l;++s){m=this.cpu.mmu.load32(u+(s<<2));this.cpu.mmu.store32(p+(s<<2),m)}}else{u&=4294967294,p&=4294967294;for(s=0;s<l;++s){m=this.cpu.mmu.load16(u+(s<<1));this.cpu.mmu.store16(p+(s<<1),m)}}return;case 12:var f;u=4294967292&this.cpu.gprs[0],p=4294967292&this.cpu.gprs[1];if(l=(l=1048575&(f=this.cpu.gprs[2]))+7>>3<<3,16777216&f)for(m=this.cpu.mmu.load32(u),s=0;s<l;++s)this.cpu.mmu.store32(p+(s<<2),m);else for(s=0;s<l;++s){m=this.cpu.mmu.load32(u+(s<<2));this.cpu.mmu.store32(p+(s<<2),m)}return;case 14:s=this.cpu.gprs[2];for(var A,b,C,S,g,R,w=this.cpu.gprs[0],E=this.cpu.gprs[1];s--;)A=this.core.mmu.load32(w)/256,b=this.core.mmu.load32(w+4)/256,C=this.core.mmu.load16(w+8),S=this.core.mmu.load16(w+10),v=this.core.mmu.load16(w+12)/256,I=this.core.mmu.load16(w+14)/256,O=(this.core.mmu.loadU16(w+16)>>8)/128*Math.PI,w+=20,_=P=Math.cos(O),y=T=Math.sin(O),g=A-((_*=v)*C+(y*=-v)*S),R=b-((T*=I)*C+(P*=I)*S),this.core.mmu.store16(E,256*_|0),this.core.mmu.store16(E+2,256*y|0),this.core.mmu.store16(E+4,256*T|0),this.core.mmu.store16(E+6,256*P|0),this.core.mmu.store32(E+8,256*g|0),this.core.mmu.store32(E+12,256*R|0),E+=16;break;case 15:s=this.cpu.gprs[2],w=this.cpu.gprs[0],E=this.cpu.gprs[1];for(var v,I,O,_,y,T,P,M=this.cpu.gprs[3];s--;)v=this.core.mmu.load16(w)/256,I=this.core.mmu.load16(w+2)/256,O=(this.core.mmu.loadU16(w+4)>>8)/128*Math.PI,w+=6,_=P=Math.cos(O),y=T=Math.sin(O),_*=v,y*=-v,T*=I,P*=I,this.core.mmu.store16(E,256*_|0),this.core.mmu.store16(E+M,256*y|0),this.core.mmu.store16(E+2*M,256*T|0),this.core.mmu.store16(E+3*M,256*P|0),E+=4*M;break;case 17:this.lz77(this.cpu.gprs[0],this.cpu.gprs[1],1);break;case 18:this.lz77(this.cpu.gprs[0],this.cpu.gprs[1],2);break;case 19:this.huffman(this.cpu.gprs[0],this.cpu.gprs[1]);break;case 20:this.rl(this.cpu.gprs[0],this.cpu.gprs[1],1);break;case 21:this.rl(this.cpu.gprs[0],this.cpu.gprs[1],2);break;case 31:var N=this.cpu.mmu.load32(this.cpu.gprs[0]+4);this.cpu.gprs[0]=N/Math.pow(2,(180-this.cpu.gprs[1]-this.cpu.gprs[2]/256)/12)>>>0;break;default:throw"Unimplemented software interrupt: 0x"+t.toString(16)}},it.prototype.masterEnable=function(t){this.enable=t,this.enable&&this.enabledIRQs&this.interruptFlags&&this.cpu.raiseIRQ()},it.prototype.setInterruptsEnabled=function(t){this.enabledIRQs=t,this.enabledIRQs&this.MASK_SIO&&this.core.STUB("Serial I/O interrupts not implemented"),this.enabledIRQs&this.MASK_KEYPAD&&this.core.STUB("Keypad interrupts not implemented"),this.enable&&this.enabledIRQs&this.interruptFlags&&this.cpu.raiseIRQ()},it.prototype.pollNextEvent=function(){var t,e=this.video.nextEvent;if(this.audio.enabled&&(t=this.audio.nextEvent,(!e||t<e)&&(e=t)),this.timersEnabled){var i=this.timers[0];t=i.nextEvent,i.enable&&t&&(!e||t<e)&&(e=t),t=(i=this.timers[1]).nextEvent,i.enable&&t&&(!e||t<e)&&(e=t),t=(i=this.timers[2]).nextEvent,i.enable&&t&&(!e||t<e)&&(e=t),t=(i=this.timers[3]).nextEvent,i.enable&&t&&(!e||t<e)&&(e=t)}var s=this.dma[0];t=s.nextIRQ,s.enable&&s.doIrq&&t&&(!e||t<e)&&(e=t),t=(s=this.dma[1]).nextIRQ,s.enable&&s.doIrq&&t&&(!e||t<e)&&(e=t),t=(s=this.dma[2]).nextIRQ,s.enable&&s.doIrq&&t&&(!e||t<e)&&(e=t),t=(s=this.dma[3]).nextIRQ,s.enable&&s.doIrq&&t&&(!e||t<e)&&(e=t),this.core.ASSERT(e>=this.cpu.cycles,"Next event is before present"),this.nextEvent=e},it.prototype.waitForIRQ=function(){var t,e=this.testIRQ()||this.video.hblankIRQ||this.video.vblankIRQ||this.video.vcounterIRQ;if(this.timersEnabled&&(t=this.timers[0],e=e||t.doIrq,t=this.timers[1],e=e||t.doIrq,t=this.timers[2],e=e||t.doIrq,t=this.timers[3],e=e||t.doIrq),!e)return!1;for(;;){if(this.pollNextEvent(),!this.nextEvent)return!1;if(this.cpu.cycles=this.nextEvent,this.updateTimers(),this.interruptFlags)return!0}},it.prototype.testIRQ=function(){return!!(this.enable&&this.enabledIRQs&this.interruptFlags)&&(this.springIRQ=!0,this.nextEvent=this.cpu.cycles,!0)},it.prototype.raiseIRQ=function(t){this.interruptFlags|=1<<t,this.io.registers[this.io.IF>>1]=this.interruptFlags,this.enable&&this.enabledIRQs&1<<t&&this.cpu.raiseIRQ()},it.prototype.dismissIRQs=function(t){this.interruptFlags&=~t,this.io.registers[this.io.IF>>1]=this.interruptFlags},it.prototype.dmaSetSourceAddress=function(t,e){this.dma[t].source=4294967294&e},it.prototype.dmaSetDestAddress=function(t,e){this.dma[t].dest=4294967294&e},it.prototype.dmaSetWordCount=function(t,e){this.dma[t].count=e||(3==t?65536:16384)},it.prototype.dmaWriteControl=function(t,e){var i=this.dma[t],s=i.enable;i.dstControl=(96&e)>>5,i.srcControl=(384&e)>>7,i.repeat=!!(512&e),i.width=1024&e?4:2,i.drq=!!(2048&e),i.timing=(12288&e)>>12,i.doIrq=!!(16384&e),i.enable=!!(32768&e),i.nextIRQ=0,i.drq&&this.core.WARN("DRQ not implemented"),!s&&i.enable&&(i.nextSource=i.source,i.nextDest=i.dest,i.nextCount=i.count,this.cpu.mmu.scheduleDma(t,i))},it.prototype.timerSetReload=function(t,e){this.timers[t].reload=65535&e},it.prototype.timerWriteControl=function(t,e){var i=this.timers[t],s=i.prescaleBits;switch(3&e){case 0:i.prescaleBits=0;break;case 1:i.prescaleBits=6;break;case 2:i.prescaleBits=8;break;case 3:i.prescaleBits=10}i.countUp=!!(4&e),i.doIrq=!!(64&e),i.overflowInterval=65536-i.reload<<i.prescaleBits;var r=i.enable;i.enable=!!((128&e)>>7<<t),!r&&i.enable?(i.countUp?i.nextEvent=0:(i.lastEvent=this.cpu.cycles,i.nextEvent=this.cpu.cycles+i.overflowInterval),this.io.registers[this.io.TM0CNT_LO+(t<<2)>>1]=i.reload,i.oldReload=i.reload,++this.timersEnabled):r&&!i.enable?(i.countUp||(this.io.registers[this.io.TM0CNT_LO+(t<<2)>>1]=i.oldReload+(this.cpu.cycles-i.lastEvent)>>s),--this.timersEnabled):i.prescaleBits==s||i.countUp||(i.nextEvent=i.lastEvent+i.overflowInterval),this.pollNextEvent()},it.prototype.timerRead=function(t){var e=this.timers[t];return e.enable&&!e.countUp?e.oldReload+(this.cpu.cycles-e.lastEvent)>>e.prescaleBits:this.io.registers[this.io.TM0CNT_LO+(t<<2)>>1]},it.prototype.halt=function(){if(!this.enable)throw"Requested HALT when interrupts were disabled!";if(!this.waitForIRQ())throw"Waiting on interrupt forever."},it.prototype.lz77=function(t,e,i){for(var s,r,n,a,h,o=(4294967040&this.cpu.mmu.load32(t))>>8,c=t+4,u=e,p=0,l=0;o>0;)if(p){if(128&s)for(r=this.cpu.mmu.loadU8(c)|this.cpu.mmu.loadU8(c+1)<<8,c+=2,n=u-((15&r)<<8|(65280&r)>>8)-1,a=3+((240&r)>>4);a--&&o;)h=this.cpu.mmu.loadU8(n++),2==i?(l>>=8,l|=h<<8,1&u&&this.cpu.mmu.store16(u-1,l)):this.cpu.mmu.store8(u,h),--o,++u;else h=this.cpu.mmu.loadU8(c++),2==i?(l>>=8,l|=h<<8,1&u&&this.cpu.mmu.store16(u-1,l)):this.cpu.mmu.store8(u,h),--o,++u;s<<=1,--p}else s=this.cpu.mmu.loadU8(c++),p=8},it.prototype.huffman=function(t,e){t&=4294967292;var i=this.cpu.mmu.load32(t),s=i>>8,r=15&i;if(32%r)throw"Unimplemented unaligned Huffman";var n=4-s&3;s&=4294967292;var a,h,o,c=[],u=1+(this.cpu.mmu.loadU8(t+4)<<1),p=t+5+u,l=4294967292&e;for(h=0;h<u;++h)c.push(this.cpu.mmu.loadU8(t+5+h));var d,m,f=0,A=0;for(o=c[0];s>0;){var b=this.cpu.mmu.load32(p);for(p+=4,d=32;d>0;--d,b<<=1){if("number"===typeof o){var C=(f-1|1)+((63&o)<<1)+2;o={l:C,r:C+1,lTerm:128&o,rTerm:64&o},c[f]=o}if(2147483648&b){if(!o.rTerm){f=o.r,o=c[o.r];continue}m=c[o.r]}else{if(!o.lTerm){o=c[f=o.l];continue}m=c[o.l]}a|=(m&(1<<r)-1)<<A,A+=r,f=0,o=c[0],32==A&&(A=0,this.cpu.mmu.store32(l,a),l+=4,s-=4,a=0)}}n&&this.cpu.mmu.store32(l,a)},it.prototype.rl=function(t,e,i){t&=4294967292;for(var s,r,n=(4294967040&this.cpu.mmu.load32(t))>>8,a=4-n&3,h=t+4,o=e,c=0;n>0;)if(128&(s=this.cpu.mmu.loadU8(h++)))for(s&=127,s+=3,r=this.cpu.mmu.loadU8(h++);s--&&n;)--n,2==i?(c>>=8,c|=r<<8,1&o&&this.cpu.mmu.store16(o-1,c)):this.cpu.mmu.store8(o,r),++o;else for(s++;s--&&n;)--n,r=this.cpu.mmu.loadU8(h++),2==i?(c>>=8,c|=r<<8,1&o&&this.cpu.mmu.store16(o-1,c)):this.cpu.mmu.store8(o,r),++o;for(;a--;)this.cpu.mmu.store8(o++,0)};var st=it;function rt(){this.DISPCNT=0,this.GREENSWP=2,this.DISPSTAT=4,this.VCOUNT=6,this.BG0CNT=8,this.BG1CNT=10,this.BG2CNT=12,this.BG3CNT=14,this.BG0HOFS=16,this.BG0VOFS=18,this.BG1HOFS=20,this.BG1VOFS=22,this.BG2HOFS=24,this.BG2VOFS=26,this.BG3HOFS=28,this.BG3VOFS=30,this.BG2PA=32,this.BG2PB=34,this.BG2PC=36,this.BG2PD=38,this.BG2X_LO=40,this.BG2X_HI=42,this.BG2Y_LO=44,this.BG2Y_HI=46,this.BG3PA=48,this.BG3PB=50,this.BG3PC=52,this.BG3PD=54,this.BG3X_LO=56,this.BG3X_HI=58,this.BG3Y_LO=60,this.BG3Y_HI=62,this.WIN0H=64,this.WIN1H=66,this.WIN0V=68,this.WIN1V=70,this.WININ=72,this.WINOUT=74,this.MOSAIC=76,this.BLDCNT=80,this.BLDALPHA=82,this.BLDY=84,this.SOUND1CNT_LO=96,this.SOUND1CNT_HI=98,this.SOUND1CNT_X=100,this.SOUND2CNT_LO=104,this.SOUND2CNT_HI=108,this.SOUND3CNT_LO=112,this.SOUND3CNT_HI=114,this.SOUND3CNT_X=116,this.SOUND4CNT_LO=120,this.SOUND4CNT_HI=124,this.SOUNDCNT_LO=128,this.SOUNDCNT_HI=130,this.SOUNDCNT_X=132,this.SOUNDBIAS=136,this.WAVE_RAM0_LO=144,this.WAVE_RAM0_HI=146,this.WAVE_RAM1_LO=148,this.WAVE_RAM1_HI=150,this.WAVE_RAM2_LO=152,this.WAVE_RAM2_HI=154,this.WAVE_RAM3_LO=156,this.WAVE_RAM3_HI=158,this.FIFO_A_LO=160,this.FIFO_A_HI=162,this.FIFO_B_LO=164,this.FIFO_B_HI=166,this.DMA0SAD_LO=176,this.DMA0SAD_HI=178,this.DMA0DAD_LO=180,this.DMA0DAD_HI=182,this.DMA0CNT_LO=184,this.DMA0CNT_HI=186,this.DMA1SAD_LO=188,this.DMA1SAD_HI=190,this.DMA1DAD_LO=192,this.DMA1DAD_HI=194,this.DMA1CNT_LO=196,this.DMA1CNT_HI=198,this.DMA2SAD_LO=200,this.DMA2SAD_HI=202,this.DMA2DAD_LO=204,this.DMA2DAD_HI=206,this.DMA2CNT_LO=208,this.DMA2CNT_HI=210,this.DMA3SAD_LO=212,this.DMA3SAD_HI=214,this.DMA3DAD_LO=216,this.DMA3DAD_HI=218,this.DMA3CNT_LO=220,this.DMA3CNT_HI=222,this.TM0CNT_LO=256,this.TM0CNT_HI=258,this.TM1CNT_LO=260,this.TM1CNT_HI=262,this.TM2CNT_LO=264,this.TM2CNT_HI=266,this.TM3CNT_LO=268,this.TM3CNT_HI=270,this.SIODATA32_LO=288,this.SIOMULTI0=288,this.SIODATA32_HI=290,this.SIOMULTI1=290,this.SIOMULTI2=292,this.SIOMULTI3=294,this.SIOCNT=296,this.SIOMLT_SEND=298,this.SIODATA8=298,this.RCNT=308,this.JOYCNT=320,this.JOY_RECV=336,this.JOY_TRANS=340,this.JOYSTAT=344,this.KEYINPUT=304,this.KEYCNT=306,this.IE=512,this.IF=514,this.WAITCNT=516,this.IME=520,this.POSTFLG=768,this.HALTCNT=769,this.DEFAULT_DISPCNT=128,this.DEFAULT_SOUNDBIAS=512,this.DEFAULT_BGPA=1,this.DEFAULT_BGPD=1,this.DEFAULT_RCNT=32768}rt.prototype.clear=function(){this.registers=new Uint16Array(this.cpu.mmu.SIZE_IO),this.registers[this.DISPCNT>>1]=this.DEFAULT_DISPCNT,this.registers[this.SOUNDBIAS>>1]=this.DEFAULT_SOUNDBIAS,this.registers[this.BG2PA>>1]=this.DEFAULT_BGPA,this.registers[this.BG2PD>>1]=this.DEFAULT_BGPD,this.registers[this.BG3PA>>1]=this.DEFAULT_BGPA,this.registers[this.BG3PD>>1]=this.DEFAULT_BGPD,this.registers[this.RCNT>>1]=this.DEFAULT_RCNT},rt.prototype.freeze=function(){return{registers:W.prefix(this.registers.buffer)}},rt.prototype.defrost=function(t){this.registers=new Uint16Array(t.registers);for(var e=0;e<=this.BLDY;e+=2)this.store16(this.registers[e>>1])},rt.prototype.load8=function(t){throw"Unimplmeneted unaligned I/O access"},rt.prototype.load16=function(t){return this.loadU16(t)<<16>>16},rt.prototype.load32=function(t){switch(t&=4294967292){case this.DMA0CNT_LO:case this.DMA1CNT_LO:case this.DMA2CNT_LO:case this.DMA3CNT_LO:return this.loadU16(2|t)<<16;case this.IME:return 65535&this.loadU16(t);case this.JOY_RECV:case this.JOY_TRANS:return this.core.STUB("Unimplemented JOY register read: 0x"+t.toString(16)),0}return this.loadU16(t)|this.loadU16(2|t)<<16},rt.prototype.loadU8=function(t){var e=1&t;return this.loadU16(65534&t)>>>(e<<3)&255},rt.prototype.loadU16=function(t){switch(t){case this.DISPCNT:case this.BG0CNT:case this.BG1CNT:case this.BG2CNT:case this.BG3CNT:case this.WININ:case this.WINOUT:case this.SOUND1CNT_LO:case this.SOUND3CNT_LO:case this.SOUNDCNT_LO:case this.SOUNDCNT_HI:case this.SOUNDBIAS:case this.BLDCNT:case this.BLDALPHA:case this.TM0CNT_HI:case this.TM1CNT_HI:case this.TM2CNT_HI:case this.TM3CNT_HI:case this.DMA0CNT_HI:case this.DMA1CNT_HI:case this.DMA2CNT_HI:case this.DMA3CNT_HI:case this.RCNT:case this.WAITCNT:case this.IE:case this.IF:case this.IME:case this.POSTFLG:break;case this.DISPSTAT:return this.registers[t>>1]|this.video.readDisplayStat();case this.VCOUNT:return this.video.vcount;case this.SOUND1CNT_HI:case this.SOUND2CNT_LO:return 65472&this.registers[t>>1];case this.SOUND1CNT_X:case this.SOUND2CNT_HI:case this.SOUND3CNT_X:return 16384&this.registers[t>>1];case this.SOUND3CNT_HI:return 57344&this.registers[t>>1];case this.SOUND4CNT_LO:return 65280&this.registers[t>>1];case this.SOUND4CNT_HI:return 16639&this.registers[t>>1];case this.SOUNDCNT_X:return this.core.STUB("Unimplemented sound register read: SOUNDCNT_X"),0|this.registers[t>>1];case this.TM0CNT_LO:return this.cpu.irq.timerRead(0);case this.TM1CNT_LO:return this.cpu.irq.timerRead(1);case this.TM2CNT_LO:return this.cpu.irq.timerRead(2);case this.TM3CNT_LO:return this.cpu.irq.timerRead(3);case this.SIOCNT:return this.sio.readSIOCNT();case this.KEYINPUT:return this.keypad.pollGamepads(),this.keypad.currentDown;case this.KEYCNT:return this.core.STUB("Unimplemented I/O register read: KEYCNT"),0;case this.BG0HOFS:case this.BG0VOFS:case this.BG1HOFS:case this.BG1VOFS:case this.BG2HOFS:case this.BG2VOFS:case this.BG3HOFS:case this.BG3VOFS:case this.BG2PA:case this.BG2PB:case this.BG2PC:case this.BG2PD:case this.BG3PA:case this.BG3PB:case this.BG3PC:case this.BG3PD:case this.BG2X_LO:case this.BG2X_HI:case this.BG2Y_LO:case this.BG2Y_HI:case this.BG3X_LO:case this.BG3X_HI:case this.BG3Y_LO:case this.BG3Y_HI:case this.WIN0H:case this.WIN1H:case this.WIN0V:case this.WIN1V:case this.BLDY:case this.DMA0SAD_LO:case this.DMA0SAD_HI:case this.DMA0DAD_LO:case this.DMA0DAD_HI:case this.DMA0CNT_LO:case this.DMA1SAD_LO:case this.DMA1SAD_HI:case this.DMA1DAD_LO:case this.DMA1DAD_HI:case this.DMA1CNT_LO:case this.DMA2SAD_LO:case this.DMA2SAD_HI:case this.DMA2DAD_LO:case this.DMA2DAD_HI:case this.DMA2CNT_LO:case this.DMA3SAD_LO:case this.DMA3SAD_HI:case this.DMA3DAD_LO:case this.DMA3DAD_HI:case this.DMA3CNT_LO:case this.FIFO_A_LO:case this.FIFO_A_HI:case this.FIFO_B_LO:case this.FIFO_B_HI:return this.core.WARN("Read for write-only register: 0x"+t.toString(16)),this.core.mmu.badMemory.loadU16(0);case this.MOSAIC:return this.core.WARN("Read for write-only register: 0x"+t.toString(16)),0;case this.SIOMULTI0:case this.SIOMULTI1:case this.SIOMULTI2:case this.SIOMULTI3:return this.sio.read(t-this.SIOMULTI0>>1);case this.SIODATA8:return this.core.STUB("Unimplemented SIO register read: 0x"+t.toString(16)),0;case this.JOYCNT:case this.JOYSTAT:return this.core.STUB("Unimplemented JOY register read: 0x"+t.toString(16)),0;default:return this.core.WARN("Bad I/O register read: 0x"+t.toString(16)),this.core.mmu.badMemory.loadU16(0)}return this.registers[t>>1]},rt.prototype.store8=function(t,e){switch(t){case this.WININ:case 1|this.WININ:case this.WINOUT:case 1|this.WINOUT:this.value&=63;break;case this.SOUND1CNT_LO:case 1|this.SOUND1CNT_LO:case this.SOUND1CNT_HI:case 1|this.SOUND1CNT_HI:case this.SOUND1CNT_X:case 1|this.SOUND1CNT_X:case this.SOUND2CNT_LO:case 1|this.SOUND2CNT_LO:case this.SOUND2CNT_HI:case 1|this.SOUND2CNT_HI:case this.SOUND3CNT_LO:case 1|this.SOUND3CNT_LO:case this.SOUND3CNT_HI:case 1|this.SOUND3CNT_HI:case this.SOUND3CNT_X:case 1|this.SOUND3CNT_X:case this.SOUND4CNT_LO:case 1|this.SOUND4CNT_LO:case this.SOUND4CNT_HI:case 1|this.SOUND4CNT_HI:case this.SOUNDCNT_LO:case 1|this.SOUNDCNT_LO:case this.SOUNDCNT_X:case this.IF:case this.IME:break;case 1|this.SOUNDBIAS:this.STUB_REG("sound",t);break;case this.HALTCNT:return void((e&=128)?this.core.STUB("Stop"):this.core.irq.halt());default:this.STUB_REG("8-bit I/O",t)}1&t?(e<<=8,e|=255&this.registers[t>>1]):(e&=255,e|=65280&this.registers[t>>1]),this.store16(268435454&t,e)},rt.prototype.store16=function(t,e){switch(t){case this.DISPCNT:this.video.renderPath.writeDisplayControl(e);break;case this.DISPSTAT:e&=this.video.DISPSTAT_MASK,this.video.writeDisplayStat(e);break;case this.BG0CNT:this.video.renderPath.writeBackgroundControl(0,e);break;case this.BG1CNT:this.video.renderPath.writeBackgroundControl(1,e);break;case this.BG2CNT:this.video.renderPath.writeBackgroundControl(2,e);break;case this.BG3CNT:this.video.renderPath.writeBackgroundControl(3,e);break;case this.BG0HOFS:this.video.renderPath.writeBackgroundHOffset(0,e);break;case this.BG0VOFS:this.video.renderPath.writeBackgroundVOffset(0,e);break;case this.BG1HOFS:this.video.renderPath.writeBackgroundHOffset(1,e);break;case this.BG1VOFS:this.video.renderPath.writeBackgroundVOffset(1,e);break;case this.BG2HOFS:this.video.renderPath.writeBackgroundHOffset(2,e);break;case this.BG2VOFS:this.video.renderPath.writeBackgroundVOffset(2,e);break;case this.BG3HOFS:this.video.renderPath.writeBackgroundHOffset(3,e);break;case this.BG3VOFS:this.video.renderPath.writeBackgroundVOffset(3,e);break;case this.BG2X_LO:this.video.renderPath.writeBackgroundRefX(2,this.registers[t>>1|1]<<16|e);break;case this.BG2X_HI:this.video.renderPath.writeBackgroundRefX(2,this.registers[t>>1^1]|e<<16);break;case this.BG2Y_LO:this.video.renderPath.writeBackgroundRefY(2,this.registers[t>>1|1]<<16|e);break;case this.BG2Y_HI:this.video.renderPath.writeBackgroundRefY(2,this.registers[t>>1^1]|e<<16);break;case this.BG2PA:this.video.renderPath.writeBackgroundParamA(2,e);break;case this.BG2PB:this.video.renderPath.writeBackgroundParamB(2,e);break;case this.BG2PC:this.video.renderPath.writeBackgroundParamC(2,e);break;case this.BG2PD:this.video.renderPath.writeBackgroundParamD(2,e);break;case this.BG3X_LO:this.video.renderPath.writeBackgroundRefX(3,this.registers[t>>1|1]<<16|e);break;case this.BG3X_HI:this.video.renderPath.writeBackgroundRefX(3,this.registers[t>>1^1]|e<<16);break;case this.BG3Y_LO:this.video.renderPath.writeBackgroundRefY(3,this.registers[t>>1|1]<<16|e);break;case this.BG3Y_HI:this.video.renderPath.writeBackgroundRefY(3,this.registers[t>>1^1]|e<<16);break;case this.BG3PA:this.video.renderPath.writeBackgroundParamA(3,e);break;case this.BG3PB:this.video.renderPath.writeBackgroundParamB(3,e);break;case this.BG3PC:this.video.renderPath.writeBackgroundParamC(3,e);break;case this.BG3PD:this.video.renderPath.writeBackgroundParamD(3,e);break;case this.WIN0H:this.video.renderPath.writeWin0H(e);break;case this.WIN1H:this.video.renderPath.writeWin1H(e);break;case this.WIN0V:this.video.renderPath.writeWin0V(e);break;case this.WIN1V:this.video.renderPath.writeWin1V(e);break;case this.WININ:e&=16191,this.video.renderPath.writeWinIn(e);break;case this.WINOUT:e&=16191,this.video.renderPath.writeWinOut(e);break;case this.BLDCNT:e&=32767,this.video.renderPath.writeBlendControl(e);break;case this.BLDALPHA:e&=7967,this.video.renderPath.writeBlendAlpha(e);break;case this.BLDY:e&=31,this.video.renderPath.writeBlendY(e);break;case this.MOSAIC:this.video.renderPath.writeMosaic(e);break;case this.SOUND1CNT_LO:e&=127,this.audio.writeSquareChannelSweep(0,e);break;case this.SOUND1CNT_HI:this.audio.writeSquareChannelDLE(0,e);break;case this.SOUND1CNT_X:e&=51199,this.audio.writeSquareChannelFC(0,e),e&=-32769;break;case this.SOUND2CNT_LO:this.audio.writeSquareChannelDLE(1,e);break;case this.SOUND2CNT_HI:e&=51199,this.audio.writeSquareChannelFC(1,e),e&=-32769;break;case this.SOUND3CNT_LO:e&=224,this.audio.writeChannel3Lo(e);break;case this.SOUND3CNT_HI:e&=57599,this.audio.writeChannel3Hi(e);break;case this.SOUND3CNT_X:e&=51199,this.audio.writeChannel3X(e),e&=-32769;break;case this.SOUND4CNT_LO:e&=65343,this.audio.writeChannel4LE(e);break;case this.SOUND4CNT_HI:e&=49407,this.audio.writeChannel4FC(e),e&=-32769;break;case this.SOUNDCNT_LO:e&=65399,this.audio.writeSoundControlLo(e);break;case this.SOUNDCNT_HI:e&=65295,this.audio.writeSoundControlHi(e);break;case this.SOUNDCNT_X:e&=128,this.audio.writeEnable(e);break;case this.WAVE_RAM0_LO:case this.WAVE_RAM0_HI:case this.WAVE_RAM1_LO:case this.WAVE_RAM1_HI:case this.WAVE_RAM2_LO:case this.WAVE_RAM2_HI:case this.WAVE_RAM3_LO:case this.WAVE_RAM3_HI:this.audio.writeWaveData(t-this.WAVE_RAM0_LO,e,2);break;case this.DMA0SAD_LO:case this.DMA0DAD_LO:case this.DMA1SAD_LO:case this.DMA1DAD_LO:case this.DMA2SAD_LO:case this.DMA2DAD_LO:case this.DMA3SAD_LO:case this.DMA3DAD_LO:return void this.store32(t,this.registers[1+(t>>1)]<<16|e);case this.DMA0SAD_HI:case this.DMA0DAD_HI:case this.DMA1SAD_HI:case this.DMA1DAD_HI:case this.DMA2SAD_HI:case this.DMA2DAD_HI:case this.DMA3SAD_HI:case this.DMA3DAD_HI:return void this.store32(t-2,this.registers[(t>>1)-1]|e<<16);case this.DMA0CNT_LO:this.cpu.irq.dmaSetWordCount(0,e);break;case this.DMA0CNT_HI:return this.registers[t>>1]=65504&e,void this.cpu.irq.dmaWriteControl(0,e);case this.DMA1CNT_LO:this.cpu.irq.dmaSetWordCount(1,e);break;case this.DMA1CNT_HI:return this.registers[t>>1]=65504&e,void this.cpu.irq.dmaWriteControl(1,e);case this.DMA2CNT_LO:this.cpu.irq.dmaSetWordCount(2,e);break;case this.DMA2CNT_HI:return this.registers[t>>1]=65504&e,void this.cpu.irq.dmaWriteControl(2,e);case this.DMA3CNT_LO:this.cpu.irq.dmaSetWordCount(3,e);break;case this.DMA3CNT_HI:return this.registers[t>>1]=65504&e,void this.cpu.irq.dmaWriteControl(3,e);case this.TM0CNT_LO:return void this.cpu.irq.timerSetReload(0,e);case this.TM1CNT_LO:return void this.cpu.irq.timerSetReload(1,e);case this.TM2CNT_LO:return void this.cpu.irq.timerSetReload(2,e);case this.TM3CNT_LO:return void this.cpu.irq.timerSetReload(3,e);case this.TM0CNT_HI:e&=199,this.cpu.irq.timerWriteControl(0,e);break;case this.TM1CNT_HI:e&=199,this.cpu.irq.timerWriteControl(1,e);break;case this.TM2CNT_HI:e&=199,this.cpu.irq.timerWriteControl(2,e);break;case this.TM3CNT_HI:e&=199,this.cpu.irq.timerWriteControl(3,e);break;case this.SIOMULTI0:case this.SIOMULTI1:case this.SIOMULTI2:case this.SIOMULTI3:case this.SIODATA8:this.STUB_REG("SIO",t);break;case this.RCNT:this.sio.setMode(e>>12&12|this.registers[this.SIOCNT>>1]>>12&3),this.sio.writeRCNT(e);break;case this.SIOCNT:return this.sio.setMode(e>>12&3|this.registers[this.RCNT>>1]>>12&12),void this.sio.writeSIOCNT(e);case this.JOYCNT:case this.JOYSTAT:this.STUB_REG("JOY",t);break;case this.IE:e&=16383,this.cpu.irq.setInterruptsEnabled(e);break;case this.IF:return void this.cpu.irq.dismissIRQs(e);case this.WAITCNT:e&=57343,this.cpu.mmu.adjustTimings(e);break;case this.IME:e&=1,this.cpu.irq.masterEnable(e);break;default:this.STUB_REG("I/O",t)}this.registers[t>>1]=e},rt.prototype.store32=function(t,e){switch(t){case this.BG2X_LO:e&=268435455,this.video.renderPath.writeBackgroundRefX(2,e);break;case this.BG2Y_LO:e&=268435455,this.video.renderPath.writeBackgroundRefY(2,e);break;case this.BG3X_LO:e&=268435455,this.video.renderPath.writeBackgroundRefX(3,e);break;case this.BG3Y_LO:e&=268435455,this.video.renderPath.writeBackgroundRefY(3,e);break;case this.DMA0SAD_LO:this.cpu.irq.dmaSetSourceAddress(0,e);break;case this.DMA0DAD_LO:this.cpu.irq.dmaSetDestAddress(0,e);break;case this.DMA1SAD_LO:this.cpu.irq.dmaSetSourceAddress(1,e);break;case this.DMA1DAD_LO:this.cpu.irq.dmaSetDestAddress(1,e);break;case this.DMA2SAD_LO:this.cpu.irq.dmaSetSourceAddress(2,e);break;case this.DMA2DAD_LO:this.cpu.irq.dmaSetDestAddress(2,e);break;case this.DMA3SAD_LO:this.cpu.irq.dmaSetSourceAddress(3,e);break;case this.DMA3DAD_LO:this.cpu.irq.dmaSetDestAddress(3,e);break;case this.FIFO_A_LO:return void this.audio.appendToFifoA(e);case this.FIFO_B_LO:return void this.audio.appendToFifoB(e);case this.IME:return void this.store16(t,65535&e);case this.JOY_RECV:case this.JOY_TRANS:return void this.STUB_REG("JOY",t);default:return this.store16(t,65535&e),void this.store16(2|t,e>>>16)}this.registers[t>>1]=65535&e,this.registers[1+(t>>1)]=e>>>16},rt.prototype.invalidatePage=function(t){},rt.prototype.STUB_REG=function(t,e){this.core.STUB("Unimplemented "+t+" register write: "+e.toString(16))};var nt=rt;function at(){var t=this;this.masterEnable=!0,this.masterVolume=1,this.SOUND_MAX=1024,this.FIFO_MAX=512,this.PSG_MAX=128,window.AudioContext=window.AudioContext||window.webkitAudioContext,window.AudioContext?(this.context=new AudioContext,this.bufferSize=0,this.bufferSize=4096,this.maxSamples=this.bufferSize<<2,this.buffers=[new Float32Array(this.maxSamples),new Float32Array(this.maxSamples)],this.sampleMask=this.maxSamples-1,this.context.createScriptProcessor?this.jsAudio=this.context.createScriptProcessor(this.bufferSize):this.jsAudio=this.context.createJavaScriptNode(this.bufferSize),this.audioProcess=function(t){var e=t.outputBuffer.getChannelData(0),i=t.outputBuffer.getChannelData(1);if(this.masterEnable){var s,r=this.outputPointer;for(s=0;s<this.bufferSize;++s,r+=this.resampleRatio){if(r>=this.maxSamples&&(r-=this.maxSamples),(0|r)==this.samplePointer){++this.backup;break}e[s]=this.buffers[0][0|r],i[s]=this.buffers[1][0|r]}for(;s<this.bufferSize;++s)e[s]=0,i[s]=0;this.outputPointer=r,++this.totalSamples}else for(s=0;s<this.bufferSize;++s)e[s]=0,i[s]=0},this.jsAudio.onaudioprocess=function(e){t.audioProcess(e)}):this.context=null}at.prototype.clear=function(){if(this.fifoA=[],this.fifoB=[],this.fifoASample=0,this.fifoBSample=0,this.enabled=!1,this.context)try{this.jsAudio.disconnect(this.context.destination)}catch(e){}this.enableChannel3=!1,this.enableChannel4=!1,this.enableChannelA=!1,this.enableChannelB=!1,this.enableRightChannelA=!1,this.enableLeftChannelA=!1,this.enableRightChannelB=!1,this.enableLeftChannelB=!1,this.playingChannel3=!1,this.playingChannel4=!1,this.volumeLeft=0,this.volumeRight=0,this.ratioChannelA=1,this.ratioChannelB=1,this.enabledLeft=0,this.enabledRight=0,this.dmaA=-1,this.dmaB=-1,this.soundTimerA=0,this.soundTimerB=0,this.soundRatio=1,this.soundBias=512,this.squareChannels=new Array;for(var t=0;t<2;++t)this.squareChannels[t]={enabled:!1,playing:!1,sample:0,duty:.5,increment:0,step:0,initialVolume:0,volume:0,frequency:0,interval:0,sweepSteps:0,sweepIncrement:0,sweepInterval:0,doSweep:!1,raise:0,lower:0,nextStep:0,timed:!1,length:0,end:0};this.waveData=new Uint8Array(32),this.channel3Dimension=0,this.channel3Bank=0,this.channel3Volume=0,this.channel3Interval=0,this.channel3Next=0,this.channel3Length=0,this.channel3Timed=!1,this.channel3End=0,this.channel3Pointer=0,this.channel3Sample=0,this.cpuFrequency=this.core.irq.FREQUENCY,this.channel4={sample:0,lfsr:0,width:15,interval:this.cpuFrequency/524288,increment:0,step:0,initialVolume:0,volume:0,nextStep:0,timed:!1,length:0,end:0},this.nextEvent=0,this.nextSample=0,this.outputPointer=0,this.samplePointer=0,this.backup=0,this.totalSamples=0,this.sampleRate=32768,this.sampleInterval=this.cpuFrequency/this.sampleRate,this.resampleRatio=1,this.context&&(this.resampleRatio=this.sampleRate/this.context.sampleRate),this.writeSquareChannelFC(0,0),this.writeSquareChannelFC(1,0),this.writeChannel4FC(0)},at.prototype.freeze=function(){return{nextSample:this.nextSample}},at.prototype.defrost=function(t){this.nextSample=t.nextSample},at.prototype.pause=function(t){if(this.context)if(t)try{this.jsAudio.disconnect(this.context.destination)}catch(e){}else this.enabled&&this.jsAudio.connect(this.context.destination)},at.prototype.updateTimers=function(){var t=this.cpu.cycles;if(this.enabled&&!(t<this.nextEvent&&t<this.nextSample)){if(t>=this.nextEvent){var e=this.squareChannels[0];if(this.nextEvent=1/0,e.playing&&this.updateSquareChannel(e,t),(e=this.squareChannels[1]).playing&&this.updateSquareChannel(e,t),this.enableChannel3&&this.playingChannel3){if(t>=this.channel3Next){if(this.channel3Write){var i=this.waveData[this.channel3Pointer>>1];this.channel3Sample=((i>>((1&this.channel3Pointer)<<2)&15)-8)/8,this.channel3Pointer=this.channel3Pointer+1,this.channel3Dimension&&this.channel3Pointer>=64?this.channel3Pointer-=64:!this.channel3Bank&&this.channel3Pointer>=32?this.channel3Pointer-=32:this.channel3Pointer>=64&&(this.channel3Pointer-=32)}this.channel3Next+=this.channel3Interval,this.channel3Interval&&this.nextEvent>this.channel3Next&&(this.nextEvent=this.channel3Next)}this.channel3Timed&&t>=this.channel3End&&(this.playingChannel3=!1)}if(this.enableChannel4&&this.playingChannel4)if(this.channel4.timed&&t>=this.channel4.end)this.playingChannel4=!1;else{if(t>=this.channel4.next){this.channel4.lfsr>>=1;i=1&this.channel4.lfsr;this.channel4.lfsr|=(this.channel4.lfsr>>1&1^i)<<this.channel4.width-1,this.channel4.next+=this.channel4.interval,this.channel4.sample=2*(i-.5)*this.channel4.volume}this.updateEnvelope(this.channel4,t),this.nextEvent>this.channel4.next&&(this.nextEvent=this.channel4.next),this.channel4.timed&&this.nextEvent>this.channel4.end&&(this.nextEvent=this.channel4.end)}}t>=this.nextSample&&(this.sample(),this.nextSample+=this.sampleInterval),this.nextEvent=Math.ceil(this.nextEvent),(this.nextEvent<t||this.nextSample<t)&&this.updateTimers()}},at.prototype.writeEnable=function(t){if(this.enabled=!!t,this.nextEvent=this.cpu.cycles,this.nextSample=this.nextEvent,this.updateTimers(),this.core.irq.pollNextEvent(),this.context)if(t)this.jsAudio.connect(this.context.destination);else try{this.jsAudio.disconnect(this.context.destination)}catch(e){}},at.prototype.writeSoundControlLo=function(t){this.masterVolumeLeft=7&t,this.masterVolumeRight=t>>4&7,this.enabledLeft=t>>8&15,this.enabledRight=t>>12&15,this.setSquareChannelEnabled(this.squareChannels[0],1&(this.enabledLeft|this.enabledRight)),this.setSquareChannelEnabled(this.squareChannels[1],2&(this.enabledLeft|this.enabledRight)),this.enableChannel3=4&(this.enabledLeft|this.enabledRight),this.setChannel4Enabled(8&(this.enabledLeft|this.enabledRight)),this.updateTimers(),this.core.irq.pollNextEvent()},at.prototype.writeSoundControlHi=function(t){switch(3&t){case 0:this.soundRatio=.25;break;case 1:this.soundRatio=.5;break;case 2:this.soundRatio=1}this.ratioChannelA=.5*(1+((4&t)>>2)),this.ratioChannelB=.5*(1+((8&t)>>3)),this.enableRightChannelA=256&t,this.enableLeftChannelA=512&t,this.enableChannelA=768&t,this.soundTimerA=1024&t,2048&t&&(this.fifoA=[]),this.enableRightChannelB=4096&t,this.enableLeftChannelB=8192&t,this.enableChannelB=12288&t,this.soundTimerB=16384&t,32768&t&&(this.fifoB=[])},at.prototype.resetSquareChannel=function(t){t.step&&(t.nextStep=this.cpu.cycles+t.step),t.enabled&&!t.playing&&(t.raise=this.cpu.cycles,t.lower=t.raise+t.duty*t.interval,t.end=this.cpu.cycles+t.length,this.nextEvent=this.cpu.cycles),t.playing=t.enabled,this.updateTimers(),this.core.irq.pollNextEvent()},at.prototype.setSquareChannelEnabled=function(t,e){t.enabled&&t.playing||!e?t.enabled=!!e:(t.enabled=!!e,this.updateTimers(),this.core.irq.pollNextEvent())},at.prototype.writeSquareChannelSweep=function(t,e){var i=this.squareChannels[t];i.sweepSteps=7&e,i.sweepIncrement=8&e?-1:1,i.sweepInterval=(e>>4&7)*this.cpuFrequency/128,i.doSweep=!!i.sweepInterval,i.nextSweep=this.cpu.cycles+i.sweepInterval,this.resetSquareChannel(i)},at.prototype.writeSquareChannelDLE=function(t,e){var i=this.squareChannels[t];switch(e>>6&3){case 0:i.duty=.125;break;case 1:i.duty=.25;break;case 2:i.duty=.5;break;case 3:i.duty=.75}this.writeChannelLE(i,e),this.resetSquareChannel(i)},at.prototype.writeSquareChannelFC=function(t,e){var i=this.squareChannels[t],s=2047&e;i.frequency=s,i.interval=this.cpuFrequency*(2048-s)/131072,i.timed=!!(16384&e),32768&e&&(this.resetSquareChannel(i),i.volume=i.initialVolume)},at.prototype.updateSquareChannel=function(t,e){if(t.timed&&e>=t.end)t.playing=!1;else{if(t.doSweep&&e>=t.nextSweep){if(t.frequency+=t.sweepIncrement*(t.frequency>>t.sweepSteps),t.frequency<0)t.frequency=0;else if(t.frequency>2047)return t.frequency=2047,void(t.playing=!1);t.interval=this.cpuFrequency*(2048-t.frequency)/131072,t.nextSweep+=t.sweepInterval}e>=t.raise?(t.sample=t.volume,t.lower=t.raise+t.duty*t.interval,t.raise+=t.interval):e>=t.lower&&(t.sample=-t.volume,t.lower+=t.interval),this.updateEnvelope(t,e),this.nextEvent>t.raise&&(this.nextEvent=t.raise),this.nextEvent>t.lower&&(this.nextEvent=t.lower),t.timed&&this.nextEvent>t.end&&(this.nextEvent=t.end),t.doSweep&&this.nextEvent>t.nextSweep&&(this.nextEvent=t.nextSweep)}},at.prototype.writeChannel3Lo=function(t){this.channel3Dimension=32&t,this.channel3Bank=64&t;var e=128&t;!this.channel3Write&&e?(this.channel3Write=e,this.resetChannel3()):this.channel3Write=e},at.prototype.writeChannel3Hi=function(t){switch(this.channel3Length=this.cpuFrequency*(256-(255&t))/256,t>>13&7){case 0:this.channel3Volume=0;break;case 1:this.channel3Volume=1;break;case 2:this.channel3Volume=.5;break;case 3:this.channel3Volume=.25;break;default:this.channel3Volume=.75}},at.prototype.writeChannel3X=function(t){this.channel3Interval=this.cpuFrequency*(2048-(2047&t))/2097152,this.channel3Timed=!!(16384&t),this.channel3Write&&this.resetChannel3()},at.prototype.resetChannel3=function(){this.channel3Next=this.cpu.cycles,this.nextEvent=this.channel3Next,this.channel3End=this.cpu.cycles+this.channel3Length,this.playingChannel3=this.channel3Write,this.updateTimers(),this.core.irq.pollNextEvent()},at.prototype.writeWaveData=function(t,e,i){this.channel3Bank||(t+=16),2==i&&(this.waveData[t]=255&e,e>>=8,++t),this.waveData[t]=255&e},at.prototype.setChannel4Enabled=function(t){!this.enableChannel4&&t?(this.channel4.next=this.cpu.cycles,this.channel4.end=this.cpu.cycles+this.channel4.length,this.enableChannel4=!0,this.playingChannel4=!0,this.nextEvent=this.cpu.cycles,this.updateEnvelope(this.channel4),this.updateTimers(),this.core.irq.pollNextEvent()):this.enableChannel4=t},at.prototype.writeChannel4LE=function(t){this.writeChannelLE(this.channel4,t),this.resetChannel4()},at.prototype.writeChannel4FC=function(t){this.channel4.timed=!!(16384&t);var e=7&t;e||(e=.5);var i=t>>4&15,s=this.cpuFrequency*(e*(2<<i))/524288;s!=this.channel4.interval&&(this.channel4.interval=s,this.resetChannel4());var r=8&t?7:15;r!=this.channel4.width&&(this.channel4.width=r,this.resetChannel4()),32768&t&&this.resetChannel4()},at.prototype.resetChannel4=function(){15==this.channel4.width?this.channel4.lfsr=16384:this.channel4.lfsr=64,this.channel4.volume=this.channel4.initialVolume,this.channel4.step&&(this.channel4.nextStep=this.cpu.cycles+this.channel4.step),this.channel4.end=this.cpu.cycles+this.channel4.length,this.channel4.next=this.cpu.cycles,this.nextEvent=this.channel4.next,this.playingChannel4=this.enableChannel4,this.updateTimers(),this.core.irq.pollNextEvent()},at.prototype.writeChannelLE=function(t,e){t.length=this.cpuFrequency*((64-(63&e))/256),t.increment=2048&e?1/16:-1/16,t.initialVolume=(e>>12&15)/16,t.step=this.cpuFrequency*((e>>8&7)/64)},at.prototype.updateEnvelope=function(t,e){t.step&&(e>=t.nextStep&&(t.volume+=t.increment,t.volume>1?t.volume=1:t.volume<0&&(t.volume=0),t.nextStep+=t.step),this.nextEvent>t.nextStep&&(this.nextEvent=t.nextStep))},at.prototype.appendToFifoA=function(t){var e;this.fifoA.length>28&&(this.fifoA=this.fifoA.slice(-28));for(var i=0;i<4;++i)e=(255&t)<<24,t>>=8,this.fifoA.push(e/2147483648)},at.prototype.appendToFifoB=function(t){var e;this.fifoB.length>28&&(this.fifoB=this.fifoB.slice(-28));for(var i=0;i<4;++i)e=(255&t)<<24,t>>=8,this.fifoB.push(e/2147483648)},at.prototype.sampleFifoA=function(){if(this.fifoA.length<=16){var t=this.core.irq.dma[this.dmaA];t.nextCount=4,this.core.mmu.serviceDma(this.dmaA,t)}this.fifoASample=this.fifoA.shift()},at.prototype.sampleFifoB=function(){if(this.fifoB.length<=16){var t=this.core.irq.dma[this.dmaB];t.nextCount=4,this.core.mmu.serviceDma(this.dmaB,t)}this.fifoBSample=this.fifoB.shift()},at.prototype.scheduleFIFODma=function(t,e){switch(e.dest){case this.cpu.mmu.BASE_IO|this.cpu.irq.io.FIFO_A_LO:e.dstControl=2,this.dmaA=t;break;case this.cpu.mmu.BASE_IO|this.cpu.irq.io.FIFO_B_LO:e.dstControl=2,this.dmaB=t;break;default:this.core.WARN("Tried to schedule FIFO DMA for non-FIFO destination")}},at.prototype.sample=function(){var t,e,i=0,s=0;(e=this.squareChannels[0]).playing&&(t=e.sample*this.soundRatio*this.PSG_MAX,1&this.enabledLeft&&(i+=t),1&this.enabledRight&&(s+=t)),(e=this.squareChannels[1]).playing&&(t=e.sample*this.soundRatio*this.PSG_MAX,2&this.enabledLeft&&(i+=t),2&this.enabledRight&&(s+=t)),this.playingChannel3&&(t=this.channel3Sample*this.soundRatio*this.channel3Volume*this.PSG_MAX,4&this.enabledLeft&&(i+=t),4&this.enabledRight&&(s+=t)),this.playingChannel4&&(t=this.channel4.sample*this.soundRatio*this.PSG_MAX,8&this.enabledLeft&&(i+=t),8&this.enabledRight&&(s+=t)),this.enableChannelA&&(t=this.fifoASample*this.FIFO_MAX*this.ratioChannelA,this.enableLeftChannelA&&(i+=t),this.enableRightChannelA&&(s+=t)),this.enableChannelB&&(t=this.fifoBSample*this.FIFO_MAX*this.ratioChannelB,this.enableLeftChannelB&&(i+=t),this.enableRightChannelB&&(s+=t));var r=this.samplePointer;i*=this.masterVolume/this.SOUND_MAX,i=Math.max(Math.min(i,1),-1),s*=this.masterVolume/this.SOUND_MAX,s=Math.max(Math.min(s,1),-1),this.buffers&&(this.buffers[0][r]=i,this.buffers[1][r]=s),this.samplePointer=r+1&this.sampleMask};var ht=at;function ot(t){this.buffer=new Uint16Array(t>>1)}function ct(t){ot.call(this,t),this.vram=this.buffer}function ut(t){ot.call(this,t),this.oam=this.buffer,this.objs=new Array(128);for(var e=0;e<128;++e)this.objs[e]=new lt(this,e);this.scalerot=new Array(32);for(e=0;e<32;++e)this.scalerot[e]={a:1,b:0,c:0,d:1}}function pt(){this.colors=[new Array(256),new Array(256)],this.adjustedColors=[new Array(256),new Array(256)],this.passthroughColors=[this.colors[0],this.colors[0],this.colors[0],this.colors[0],this.colors[1],this.colors[0]],this.blendY=1}function lt(t,e){this.TILE_OFFSET=65536,this.oam=t,this.index=e,this.x=0,this.y=0,this.scalerot=0,this.doublesize=!1,this.disable=1,this.mode=0,this.mosaic=!1,this.multipalette=!1,this.shape=0,this.scalerotParam=0,this.hflip=0,this.vflip=0,this.tileBase=0,this.priority=0,this.palette=0,this.drawScanline=this.drawScanlineNormal,this.pushPixel=mt.pushPixel,this.cachedWidth=8,this.cachedHeight=8}function dt(t,e){this.video=t,this.bg=!1,this.index=t.LAYER_OBJ,this.priority=e,this.enabled=!1,this.objwin=0}function mt(){this.LAYER_BG0=0,this.LAYER_BG1=1,this.LAYER_BG2=2,this.LAYER_BG3=3,this.LAYER_OBJ=4,this.LAYER_BACKDROP=5,this.HORIZONTAL_PIXELS=240,this.VERTICAL_PIXELS=160,this.LAYER_MASK=6,this.BACKGROUND_MASK=1,this.TARGET2_MASK=8,this.TARGET1_MASK=16,this.OBJWIN_MASK=32,this.WRITTEN_MASK=128,this.PRIORITY_MASK=this.LAYER_MASK|this.BACKGROUND_MASK,this.drawBackdrop=new function(t){this.bg=!0,this.priority=-1,this.index=t.LAYER_BACKDROP,this.enabled=!0,this.drawScanline=function(e,i,s,r){for(var n=s;n<r;++n)e.stencil[n]&t.WRITTEN_MASK?e.stencil[n]&t.TARGET1_MASK&&(e.color[n]=t.palette.mix(t.blendB,t.palette.accessColor(this.index,0),t.blendA,e.color[n]),e.stencil[n]=t.WRITTEN_MASK):(e.color[n]=t.palette.accessColor(this.index,0),e.stencil[n]=t.WRITTEN_MASK)}}(this)}ot.prototype.load8=function(t){return this.loadU8(t)<<24>>24},ot.prototype.load16=function(t){return this.loadU16(t)<<16>>16},ot.prototype.loadU8=function(t){var e=t>>1;return 1&t?(65280&this.buffer[e])>>>8:255&this.buffer[e]},ot.prototype.loadU16=function(t){return this.buffer[t>>1]},ot.prototype.load32=function(t){return this.buffer[t>>1&-2]|this.buffer[t>>1|1]<<16},ot.prototype.store8=function(t,e){this.store16(t,e<<8|e)},ot.prototype.store16=function(t,e){this.buffer[t>>1]=e},ot.prototype.store32=function(t,e){var i=t>>1;this.store16(t,this.buffer[i]=65535&e),this.store16(t+2,this.buffer[i+1]=e>>>16)},ot.prototype.insert=function(t,e){this.buffer.set(e,t)},ot.prototype.invalidatePage=function(t){},ct.prototype=Object.create(ot.prototype),ut.prototype=Object.create(ot.prototype),ut.prototype.overwrite=function(t){for(var e=0;e<this.buffer.byteLength>>1;++e)this.store16(e<<1,t[e])},ut.prototype.store16=function(t,e){var i=(1016&t)>>3,s=this.objs[i],r=this.scalerot[i>>2];s.priority,s.disable,s.y;switch(6&t){case 0:s.y=255&e;var n=s.scalerot;s.scalerot=256&e,s.scalerot?(s.scalerotOam=this.scalerot[s.scalerotParam],s.doublesize=!!(512&e),s.disable=0,s.hflip=0,s.vflip=0):(s.doublesize=!1,s.disable=512&e,n&&(s.hflip=8&s.scalerotParam,s.vflip=16&s.scalerotParam)),s.mode=(3072&e)>>6,s.mosaic=4096&e,s.multipalette=8192&e,s.shape=(49152&e)>>14,s.recalcSize();break;case 2:s.x=511&e,s.scalerot?(s.scalerotParam=(15872&e)>>9,s.scalerotOam=this.scalerot[s.scalerotParam],s.hflip=0,s.vflip=0,s.drawScanline=s.drawScanlineAffine):(s.hflip=4096&e,s.vflip=8192&e,s.drawScanline=s.drawScanlineNormal),s.size=(49152&e)>>14,s.recalcSize();break;case 4:s.tileBase=1023&e,s.priority=(3072&e)>>10,s.palette=(61440&e)>>8;break;case 6:switch(3&i){case 0:r.a=(e<<16)/16777216;break;case 1:r.b=(e<<16)/16777216;break;case 2:r.c=(e<<16)/16777216;break;case 3:r.d=(e<<16)/16777216}}ot.prototype.store16.call(this,t,e)},pt.prototype.overwrite=function(t){for(var e=0;e<512;++e)this.store16(e<<1,t[e])},pt.prototype.loadU8=function(t){return this.loadU16(t)>>8*(1&t)&255},pt.prototype.loadU16=function(t){return this.colors[(512&t)>>9][(511&t)>>1]},pt.prototype.load16=function(t){return this.loadU16(t)<<16>>16},pt.prototype.load32=function(t){return this.loadU16(t)|this.loadU16(t+2)<<16},pt.prototype.store16=function(t,e){var i=(512&t)>>9,s=(511&t)>>1;this.colors[i][s]=e,this.adjustedColors[i][s]=this.adjustColor(e)},pt.prototype.store32=function(t,e){this.store16(t,65535&e),this.store16(t+2,e>>16)},pt.prototype.invalidatePage=function(t){},pt.prototype.convert16To32=function(t,e){var i=(31&t)<<3,s=(992&t)>>2,r=(31744&t)>>7;e[0]=i,e[1]=s,e[2]=r},pt.prototype.mix=function(t,e,i,s){var r=31&e,n=(992&e)>>5,a=(31744&e)>>10,h=31&s,o=(992&s)>>5,c=(31744&s)>>10;return Math.min(t*r+i*h,31)|Math.min(t*n+i*o,31)<<5|Math.min(t*a+i*c,31)<<10},pt.prototype.makeDarkPalettes=function(t){this.adjustColor!=this.adjustColorDark&&(this.adjustColor=this.adjustColorDark,this.resetPalettes()),this.resetPaletteLayers(t)},pt.prototype.makeBrightPalettes=function(t){this.adjustColor!=this.adjustColorBright&&(this.adjustColor=this.adjustColorBright,this.resetPalettes()),this.resetPaletteLayers(t)},pt.prototype.makeNormalPalettes=function(){this.passthroughColors[0]=this.colors[0],this.passthroughColors[1]=this.colors[0],this.passthroughColors[2]=this.colors[0],this.passthroughColors[3]=this.colors[0],this.passthroughColors[4]=this.colors[1],this.passthroughColors[5]=this.colors[0]},pt.prototype.makeSpecialPalette=function(t){this.passthroughColors[t]=this.adjustedColors[4==t?1:0]},pt.prototype.makeNormalPalette=function(t){this.passthroughColors[t]=this.colors[4==t?1:0]},pt.prototype.resetPaletteLayers=function(t){this.passthroughColors[0]=1&t?this.adjustedColors[0]:this.colors[0],this.passthroughColors[1]=2&t?this.adjustedColors[0]:this.colors[0],this.passthroughColors[2]=4&t?this.adjustedColors[0]:this.colors[0],this.passthroughColors[3]=8&t?this.adjustedColors[0]:this.colors[0],this.passthroughColors[4]=16&t?this.adjustedColors[1]:this.colors[1],this.passthroughColors[5]=32&t?this.adjustedColors[0]:this.colors[0]},pt.prototype.resetPalettes=function(){var t,e=this.adjustedColors[0],i=this.colors[0];for(t=0;t<256;++t)e[t]=this.adjustColor(i[t]);for(e=this.adjustedColors[1],i=this.colors[1],t=0;t<256;++t)e[t]=this.adjustColor(i[t])},pt.prototype.accessColor=function(t,e){return this.passthroughColors[t][e]},pt.prototype.adjustColorDark=function(t){var e=31&t,i=(992&t)>>5,s=(31744&t)>>10;return(e-=e*this.blendY)|(i-=i*this.blendY)<<5|(s-=s*this.blendY)<<10},pt.prototype.adjustColorBright=function(t){var e=31&t,i=(992&t)>>5,s=(31744&t)>>10;return(e+=(31-e)*this.blendY)|(i+=(31-i)*this.blendY)<<5|(s+=(31-s)*this.blendY)<<10},pt.prototype.adjustColor=pt.prototype.adjustColorBright,pt.prototype.setBlendY=function(t){this.blendY!=t&&(this.blendY=t,this.resetPalettes())},lt.prototype.drawScanlineNormal=function(t,e,i,s,r){var n,a,h,o=this.oam.video,c=this.mode|o.target2[o.LAYER_OBJ]|this.priority<<1;16==this.mode&&(c|=o.TARGET1_MASK),1==o.blendMode&&o.alphaEnabled&&(c|=o.target1[o.LAYER_OBJ]);var u,p,l=this.cachedWidth;this.x<o.HORIZONTAL_PIXELS?(this.x<s?(a=s-this.x,h=s):(a=0,h=this.x),r<this.cachedWidth+this.x&&(l=r-this.x)):(a=s+512-this.x,h=s,r<this.cachedWidth-a&&(l=r));var d,m,f=7&(p=this.vflip?this.cachedHeight-e+i-1:e-i),A=this.multipalette?1:0;m=o.objCharacterMapping?(504&p)*this.cachedWidth>>6:(504&p)<<2-A,this.mosaic&&(h+=d=o.objMosaicX-1-(o.objMosaicX+h-1)%o.objMosaicX,a+=d),u=this.hflip?this.cachedWidth-a-1:a;var b=o.accessTile(this.TILE_OFFSET+(4&n)*A,this.tileBase+(m<<A)+((504&u)>>3-A),f<<A);for(n=a;n<l;++n)d=this.mosaic?h%o.objMosaicX:0,u=this.hflip?this.cachedWidth-(n-d)-1:n-d,A?3&n&&(!this.mosaic||d)||(b=o.accessTile(this.TILE_OFFSET+(4&u),this.tileBase+(m<<1)+((504&u)>>2),f<<1)):7&n&&(!this.mosaic||d)||(b=o.accessTile(this.TILE_OFFSET,this.tileBase+m+(u>>3),f)),this.pushPixel(o.LAYER_OBJ,this,o,b,7&u,h,t,c,!1),h++},lt.prototype.drawScanlineAffine=function(t,e,i,s,r){var n,a,h,o,c,u=this.oam.video,p=this.mode|u.target2[u.LAYER_OBJ]|this.priority<<1;16==this.mode&&(p|=u.TARGET1_MASK),1==u.blendMode&&u.alphaEnabled&&(p|=u.target1[u.LAYER_OBJ]);var l,d=e-i,m=this.multipalette?1:0,f=this.cachedWidth<<this.doublesize,A=this.cachedHeight<<this.doublesize,b=f;for(b>u.HORIZONTAL_PIXELS&&(f=u.HORIZONTAL_PIXELS),this.x<u.HORIZONTAL_PIXELS?(this.x<s?(a=s-this.x,h=s):(a=0,h=this.x),r<b+this.x&&(b=r-this.x)):(h=s,r<b-(a=s+512-this.x)&&(b=r)),n=a;n<b;++n)if(o=this.scalerotOam.a*(n-(f>>1))+this.scalerotOam.b*(d-(A>>1))+(this.cachedWidth>>1),c=this.scalerotOam.c*(n-(f>>1))+this.scalerotOam.d*(d-(A>>1))+(this.cachedHeight>>1),this.mosaic&&(o-=n%u.objMosaicX*this.scalerotOam.a+e%u.objMosaicY*this.scalerotOam.b,c-=n%u.objMosaicX*this.scalerotOam.c+e%u.objMosaicY*this.scalerotOam.d),o<0||o>=this.cachedWidth||c<0||c>=this.cachedHeight)h++;else{l=u.objCharacterMapping?(504&c)*this.cachedWidth>>6:(504&c)<<2-m;var C=u.accessTile(this.TILE_OFFSET+(4&o)*m,this.tileBase+(l<<m)+((504&o)>>3-m),(7&c)<<m);this.pushPixel(u.LAYER_OBJ,this,u,C,7&o,h,t,p,!1),h++}},lt.prototype.recalcSize=function(){switch(this.shape){case 0:this.cachedHeight=this.cachedWidth=8<<this.size;break;case 1:switch(this.size){case 0:this.cachedHeight=8,this.cachedWidth=16;break;case 1:this.cachedHeight=8,this.cachedWidth=32;break;case 2:this.cachedHeight=16,this.cachedWidth=32;break;case 3:this.cachedHeight=32,this.cachedWidth=64}break;case 2:switch(this.size){case 0:this.cachedHeight=16,this.cachedWidth=8;break;case 1:this.cachedHeight=32,this.cachedWidth=8;break;case 2:this.cachedHeight=32,this.cachedWidth=16;break;case 3:this.cachedHeight=64,this.cachedWidth=32}}},dt.prototype.drawScanline=function(t,e,i,s){var r,n,a,h=this.video.vcount;if(!(i>=s))for(var o=this.video.oam.objs,c=0;c<o.length;++c){var u;if(!(a=o[c]).disable)if((a.mode&this.video.OBJWIN_MASK)==this.objwin)if(a.mode&this.video.OBJWIN_MASK||this.priority==a.priority)r=a.y<this.video.VERTICAL_PIXELS?a.y:a.y-256,u=a.scalerot?a.cachedHeight<<a.doublesize:a.cachedHeight,n=a.mosaic?h-h%this.video.objMosaicY:h,r<=h&&r+u>h&&a.drawScanline(t,n,r,i,s)}},dt.prototype.objComparator=function(t,e){return t.index-e.index},mt.prototype.clear=function(t){this.palette=new pt,this.vram=new ct(t.SIZE_VRAM),this.oam=new ut(t.SIZE_OAM),this.oam.video=this,this.objLayers=[new dt(this,0),new dt(this,1),new dt(this,2),new dt(this,3)],this.objwinLayer=new dt(this,4),this.objwinLayer.objwin=this.OBJWIN_MASK,this.backgroundMode=0,this.displayFrameSelect=0,this.hblankIntervalFree=0,this.objCharacterMapping=0,this.forcedBlank=1,this.win0=0,this.win1=0,this.objwin=0,this.vcount=-1,this.win0Left=0,this.win0Right=240,this.win1Left=0,this.win1Right=240,this.win0Top=0,this.win0Bottom=160,this.win1Top=0,this.win1Bottom=160,this.windows=new Array;for(var e=0;e<4;++e)this.windows.push({enabled:[!1,!1,!1,!1,!1,!0],special:0});this.target1=new Array(5),this.target2=new Array(5),this.blendMode=0,this.blendA=0,this.blendB=0,this.blendY=0,this.bgMosaicX=1,this.bgMosaicY=1,this.objMosaicX=1,this.objMosaicY=1,this.lastHblank=0,this.nextHblank=this.HDRAW_LENGTH,this.nextEvent=this.nextHblank,this.nextHblankIRQ=0,this.nextVblankIRQ=0,this.nextVcounterIRQ=0,this.bg=new Array;for(e=0;e<4;++e)this.bg.push({bg:!0,index:e,enabled:!1,video:this,vram:this.vram,priority:0,charBase:0,mosaic:!1,multipalette:!1,screenBase:0,overflow:0,size:0,x:0,y:0,refx:0,refy:0,dx:1,dmx:0,dy:0,dmy:1,sx:0,sy:0,pushPixel:mt.pushPixel,drawScanline:this.drawScanlineBGMode0});this.bgModes=[this.drawScanlineBGMode0,this.drawScanlineBGMode2,this.drawScanlineBGMode2,this.drawScanlineBGMode3,this.drawScanlineBGMode4,this.drawScanlineBGMode5],this.drawLayers=[this.bg[0],this.bg[1],this.bg[2],this.bg[3],this.objLayers[0],this.objLayers[1],this.objLayers[2],this.objLayers[3],this.objwinLayer,this.drawBackdrop],this.objwinActive=!1,this.alphaEnabled=!1,this.scanline={color:new Uint16Array(this.HORIZONTAL_PIXELS),stencil:new Uint8Array(this.HORIZONTAL_PIXELS)},this.sharedColor=[0,0,0],this.sharedMap={tile:0,hflip:!1,vflip:!1,palette:0}},mt.prototype.clearSubsets=function(t,e){4&e&&this.palette.overwrite(new Uint16Array(t.SIZE_PALETTE>>1)),8&e&&this.vram.insert(0,new Uint16Array(t.SIZE_VRAM>>1)),16&e&&(this.oam.overwrite(new Uint16Array(t.SIZE_OAM>>1)),this.oam.video=this)},mt.prototype.freeze=function(){},mt.prototype.defrost=function(t){},mt.prototype.setBacking=function(t){this.pixelData=t;for(var e=0;e<this.HORIZONTAL_PIXELS*this.VERTICAL_PIXELS*4;)this.pixelData.data[e++]=255,this.pixelData.data[e++]=255,this.pixelData.data[e++]=255,this.pixelData.data[e++]=255},mt.prototype.writeDisplayControl=function(t){this.backgroundMode=7&t,this.displayFrameSelect=16&t,this.hblankIntervalFree=32&t,this.objCharacterMapping=64&t,this.forcedBlank=128&t,this.bg[0].enabled=256&t,this.bg[1].enabled=512&t,this.bg[2].enabled=1024&t,this.bg[3].enabled=2048&t,this.objLayers[0].enabled=4096&t,this.objLayers[1].enabled=4096&t,this.objLayers[2].enabled=4096&t,this.objLayers[3].enabled=4096&t,this.win0=8192&t,this.win1=16384&t,this.objwin=32768&t,this.objwinLayer.enabled=4096&t&&32768&t,this.bg[2].multipalette&=-2,this.bg[3].multipalette&=-2,this.backgroundMode>0&&(this.bg[2].multipalette|=1),2==this.backgroundMode&&(this.bg[3].multipalette|=1),this.resetLayers()},mt.prototype.writeBackgroundControl=function(t,e){var i=this.bg[t];i.priority=3&e,i.charBase=(12&e)<<12,i.mosaic=64&e,i.multipalette&=-129,(t<2||0==this.backgroundMode)&&(i.multipalette|=128&e),i.screenBase=(7936&e)<<3,i.overflow=8192&e,i.size=(49152&e)>>14,this.drawLayers.sort(this.layerComparator)},mt.prototype.writeBackgroundHOffset=function(t,e){this.bg[t].x=511&e},mt.prototype.writeBackgroundVOffset=function(t,e){this.bg[t].y=511&e},mt.prototype.writeBackgroundRefX=function(t,e){this.bg[t].refx=(e<<4)/4096,this.bg[t].sx=this.bg[t].refx},mt.prototype.writeBackgroundRefY=function(t,e){this.bg[t].refy=(e<<4)/4096,this.bg[t].sy=this.bg[t].refy},mt.prototype.writeBackgroundParamA=function(t,e){this.bg[t].dx=(e<<16)/16777216},mt.prototype.writeBackgroundParamB=function(t,e){this.bg[t].dmx=(e<<16)/16777216},mt.prototype.writeBackgroundParamC=function(t,e){this.bg[t].dy=(e<<16)/16777216},mt.prototype.writeBackgroundParamD=function(t,e){this.bg[t].dmy=(e<<16)/16777216},mt.prototype.writeWin0H=function(t){this.win0Left=(65280&t)>>8,this.win0Right=Math.min(this.HORIZONTAL_PIXELS,255&t),this.win0Left>this.win0Right&&(this.win0Right=this.HORIZONTAL_PIXELS)},mt.prototype.writeWin1H=function(t){this.win1Left=(65280&t)>>8,this.win1Right=Math.min(this.HORIZONTAL_PIXELS,255&t),this.win1Left>this.win1Right&&(this.win1Right=this.HORIZONTAL_PIXELS)},mt.prototype.writeWin0V=function(t){this.win0Top=(65280&t)>>8,this.win0Bottom=Math.min(this.VERTICAL_PIXELS,255&t),this.win0Top>this.win0Bottom&&(this.win0Bottom=this.VERTICAL_PIXELS)},mt.prototype.writeWin1V=function(t){this.win1Top=(65280&t)>>8,this.win1Bottom=Math.min(this.VERTICAL_PIXELS,255&t),this.win1Top>this.win1Bottom&&(this.win1Bottom=this.VERTICAL_PIXELS)},mt.prototype.writeWindow=function(t,e){var i=this.windows[t];i.enabled[0]=1&e,i.enabled[1]=2&e,i.enabled[2]=4&e,i.enabled[3]=8&e,i.enabled[4]=16&e,i.special=32&e},mt.prototype.writeWinIn=function(t){this.writeWindow(0,t),this.writeWindow(1,t>>8)},mt.prototype.writeWinOut=function(t){this.writeWindow(2,t),this.writeWindow(3,t>>8)},mt.prototype.writeBlendControl=function(t){switch(this.target1[0]=!!(1&t)*this.TARGET1_MASK,this.target1[1]=!!(2&t)*this.TARGET1_MASK,this.target1[2]=!!(4&t)*this.TARGET1_MASK,this.target1[3]=!!(8&t)*this.TARGET1_MASK,this.target1[4]=!!(16&t)*this.TARGET1_MASK,this.target1[5]=!!(32&t)*this.TARGET1_MASK,this.target2[0]=!!(256&t)*this.TARGET2_MASK,this.target2[1]=!!(512&t)*this.TARGET2_MASK,this.target2[2]=!!(1024&t)*this.TARGET2_MASK,this.target2[3]=!!(2048&t)*this.TARGET2_MASK,this.target2[4]=!!(4096&t)*this.TARGET2_MASK,this.target2[5]=!!(8192&t)*this.TARGET2_MASK,this.blendMode=(192&t)>>6,this.blendMode){case 1:case 0:this.palette.makeNormalPalettes();break;case 2:this.palette.makeBrightPalettes(63&t);break;case 3:this.palette.makeDarkPalettes(63&t)}},mt.prototype.setBlendEnabled=function(t,e,i){if(this.alphaEnabled=e&&1==i,e)switch(i){case 1:case 0:this.palette.makeNormalPalette(t);break;case 2:case 3:this.palette.makeSpecialPalette(t)}else this.palette.makeNormalPalette(t)},mt.prototype.writeBlendAlpha=function(t){this.blendA=(31&t)/16,this.blendA>1&&(this.blendA=1),this.blendB=((7936&t)>>8)/16,this.blendB>1&&(this.blendB=1)},mt.prototype.writeBlendY=function(t){this.blendY=t,this.palette.setBlendY(t>=16?1:t/16)},mt.prototype.writeMosaic=function(t){this.bgMosaicX=1+(15&t),this.bgMosaicY=1+(t>>4&15),this.objMosaicX=1+(t>>8&15),this.objMosaicY=1+(t>>12&15)},mt.prototype.resetLayers=function(){this.backgroundMode>1&&(this.bg[0].enabled=!1,this.bg[1].enabled=!1),this.bg[2].enabled&&(this.bg[2].drawScanline=this.bgModes[this.backgroundMode]),0==this.backgroundMode||2==this.backgroundMode?this.bg[3].enabled&&(this.bg[3].drawScanline=this.bgModes[this.backgroundMode]):this.bg[3].enabled=!1,this.drawLayers.sort(this.layerComparator)},mt.prototype.layerComparator=function(t,e){var i=e.priority-t.priority;return i||(t.bg&&!e.bg?-1:!t.bg&&e.bg?1:e.index-t.index)},mt.prototype.accessMapMode0=function(t,e,i,s,r){var n=t+(i>>2&62)+s;1&e&&(n+=(256&i)<<3);var a=this.vram.loadU16(n);r.tile=1023&a,r.hflip=1024&a,r.vflip=2048&a,r.palette=(61440&a)>>8},mt.prototype.accessMapMode1=function(t,e,i,s,r){var n=t+(i>>3)+s;r.tile=this.vram.loadU8(n)},mt.prototype.accessTile=function(t,e,i){var s=t+(e<<5);return s|=i<<2,this.vram.load32(s)},mt.pushPixel=function(t,e,i,s,r,n,a,h,o){var c;if(!o){if(!(c=this.multipalette?s>>(r<<3)&255:s>>(r<<2)&15))return;this.multipalette||(c|=e.palette)}var u=i.WRITTEN_MASK,p=a.stencil[n],l=i.blendMode;if(i.objwinActive)if(p&i.OBJWIN_MASK){if(!i.windows[3].enabled[t])return;i.setBlendEnabled(t,i.windows[3].special&&i.target1[t],l),i.windows[3].special&&i.alphaEnabled&&(h|=i.target1[t]),u|=i.OBJWIN_MASK}else{if(!i.windows[2].enabled[t])return;i.setBlendEnabled(t,i.windows[2].special&&i.target1[t],l),i.windows[2].special&&i.alphaEnabled&&(h|=i.target1[t])}h&i.TARGET1_MASK&&p&i.TARGET2_MASK&&i.setBlendEnabled(t,!0,1);var d=o?s:i.palette.accessColor(t,c);h&i.TARGET1_MASK&&i.setBlendEnabled(t,!!l,l);var m=(h&i.PRIORITY_MASK)<(p&i.PRIORITY_MASK);if((h&i.PRIORITY_MASK)==(p&i.PRIORITY_MASK)&&(m=h&i.BACKGROUND_MASK),p&i.WRITTEN_MASK)if(m)h&i.TARGET1_MASK&&p&i.TARGET2_MASK&&(d=i.palette.mix(i.blendA,d,i.blendB,a.color[n])),u|=h&~i.TARGET1_MASK;else{if(!((h&i.PRIORITY_MASK)>(p&i.PRIORITY_MASK)))return;if(u=p&~(i.TARGET1_MASK|i.TARGET2_MASK),!(h&i.TARGET2_MASK&&p&i.TARGET1_MASK))return;d=i.palette.mix(i.blendB,d,i.blendA,a.color[n])}else u|=h;h&i.OBJWIN_MASK?a.stencil[n]|=i.OBJWIN_MASK:(a.color[n]=d,a.stencil[n]=u)},mt.prototype.identity=function(t){return t},mt.prototype.drawScanlineBlank=function(t){for(var e=0;e<this.HORIZONTAL_PIXELS;++e)t.color[e]=65535,t.stencil[e]=0},mt.prototype.prepareScanline=function(t){for(var e=0;e<this.HORIZONTAL_PIXELS;++e)t.stencil[e]=this.target2[this.LAYER_BACKDROP]},mt.prototype.drawScanlineBGMode0=function(t,e,i,s){var r,n,a,h=this.video,o=h.vcount,c=i,u=e.x,p=o+e.y;this.mosaic&&(p-=o%h.bgMosaicY);var l,d=7&p,m=e.screenBase,f=e.charBase,A=e.size,b=e.index,C=h.sharedMap,S=e.multipalette?1:0,g=h.target2[b]|e.priority<<1|h.BACKGROUND_MASK;1==h.blendMode&&h.alphaEnabled&&(g|=h.target1[b]);var R,w=p<<3&1984;2==A?w+=p<<3&2048:3==A&&(w+=p<<4&4096),R=1&A?511:255,h.accessMapMode0(m,A,i+u&R,w,C);var E=h.accessTile(f,C.tile<<S,(C.vflip?7-d:d)<<S);for(r=i;r<s;++r){if(n=r+u&R,a=7&(n-=l=this.mosaic?c%h.bgMosaicX:0),S){if((!a||this.mosaic&&!l)&&h.accessMapMode0(m,A,n,w,C),(!(3&a)||this.mosaic&&!l)&&!(E=h.accessTile(f+(!!(4&n)==!C.hflip?4:0),C.tile<<1,(C.vflip?7-d:d)<<1))&&!(3&a)){r+=3,c+=4;continue}}else if((!a||this.mosaic&&!l)&&(h.accessMapMode0(m,A,n,w,C),!(E=h.accessTile(f,C.tile,C.vflip?7-d:d))&&!a)){r+=7,c+=8;continue}C.hflip&&(a=7-a),e.pushPixel(b,C,h,E,a,c,t,g,!1),c++}},mt.prototype.drawScanlineBGMode2=function(t,e,i,s){var r,n,a,h,o,c=this.video,u=c.vcount,p=i,l=e.screenBase,d=e.charBase,m=e.size,f=128<<m,A=e.index,b=c.sharedMap,C=c.target2[A]|e.priority<<1|c.BACKGROUND_MASK;for(1==c.blendMode&&c.alphaEnabled&&(C|=c.target1[A]),r=i;r<s;++r){if(n=e.dx*r+e.sx,a=e.dy*r+e.sy,this.mosaic&&(n-=r%c.bgMosaicX*e.dx+u%c.bgMosaicY*e.dmx,a-=r%c.bgMosaicX*e.dy+u%c.bgMosaicY*e.dmy),e.overflow)(n&=f-1)<0&&(n+=f),(a&=f-1)<0&&(a+=f);else if(n<0||a<0||n>=f||a>=f){p++;continue}o=(a<<1&2032)<<m,c.accessMapMode1(l,m,n,o,b),h=this.vram.loadU8(d+(b.tile<<6)+((7&a)<<3)+(7&n)),e.pushPixel(A,b,c,h,0,p,t,C,!1),p++}},mt.prototype.drawScanlineBGMode3=function(t,e,i,s){var r,n,a,h,o=this.video,c=o.vcount,u=i,p=e.index,l=o.sharedMap,d=o.target2[p]|e.priority<<1|o.BACKGROUND_MASK;for(1==o.blendMode&&o.alphaEnabled&&(d|=o.target1[p]),r=i;r<s;++r)n=e.dx*r+e.sx,a=e.dy*r+e.sy,this.mosaic&&(n-=r%o.bgMosaicX*e.dx+c%o.bgMosaicY*e.dmx,a-=r%o.bgMosaicX*e.dy+c%o.bgMosaicY*e.dmy),n<0||a<0||n>=o.HORIZONTAL_PIXELS||a>=o.VERTICAL_PIXELS?u++:(h=this.vram.loadU16(a*o.HORIZONTAL_PIXELS+n<<1),e.pushPixel(p,l,o,h,0,u,t,d,!0),u++)},mt.prototype.drawScanlineBGMode4=function(t,e,i,s){var r,n,a,h=this.video,o=h.vcount,c=i,u=0;h.displayFrameSelect&&(u+=40960);e.size;var p,l=e.index,d=h.sharedMap,m=h.target2[l]|e.priority<<1|h.BACKGROUND_MASK;for(1==h.blendMode&&h.alphaEnabled&&(m|=h.target1[l]),r=i;r<s;++r)n=e.dx*r+e.sx,a=0|e.dy*r+e.sy,this.mosaic&&(n-=r%h.bgMosaicX*e.dx+o%h.bgMosaicY*e.dmx,a-=r%h.bgMosaicX*e.dy+o%h.bgMosaicY*e.dmy),a<<2&2016,n<0||a<0||n>=h.HORIZONTAL_PIXELS||a>=h.VERTICAL_PIXELS?c++:(p=this.vram.loadU8(u+a*h.HORIZONTAL_PIXELS+n),e.pushPixel(l,d,h,p,0,c,t,m,!1),c++)},mt.prototype.drawScanlineBGMode5=function(t,e,i,s){var r,n,a,h=this.video,o=h.vcount,c=i,u=0;h.displayFrameSelect&&(u+=40960);var p,l=e.index,d=h.sharedMap,m=h.target2[l]|e.priority<<1|h.BACKGROUND_MASK;for(1==h.blendMode&&h.alphaEnabled&&(m|=h.target1[l]),r=i;r<s;++r)n=e.dx*r+e.sx,a=e.dy*r+e.sy,this.mosaic&&(n-=r%h.bgMosaicX*e.dx+o%h.bgMosaicY*e.dmx,a-=r%h.bgMosaicX*e.dy+o%h.bgMosaicY*e.dmy),n<0||a<0||n>=160||a>=128?c++:(p=this.vram.loadU16(u+(160*a+n)<<1),e.pushPixel(l,d,h,p,0,c,t,m,!0),c++)},mt.prototype.drawScanline=function(t){var e=this.scanline;if(this.forcedBlank)this.drawScanlineBlank(e);else{var i,s,r,n,a;this.prepareScanline(e),this.vcount=t;for(var h=0;h<this.drawLayers.length;++h)(i=this.drawLayers[h]).enabled&&(this.objwinActive=!1,this.win0||this.win1||this.objwin?(s=0,r=this.HORIZONTAL_PIXELS,n=0,a=this.HORIZONTAL_PIXELS,this.win0&&t>=this.win0Top&&t<this.win0Bottom&&(this.windows[0].enabled[i.index]&&(this.setBlendEnabled(i.index,this.windows[0].special&&this.target1[i.index],this.blendMode),i.drawScanline(e,i,this.win0Left,this.win0Right)),s=Math.max(s,this.win0Left),r=Math.min(r,this.win0Left),n=Math.max(n,this.win0Right),a=Math.min(a,this.win0Right)),this.win1&&t>=this.win1Top&&t<this.win1Bottom&&(this.windows[1].enabled[i.index]&&(this.setBlendEnabled(i.index,this.windows[1].special&&this.target1[i.index],this.blendMode),!this.windows[0].enabled[i.index]&&(this.win1Left<s||this.win1Right<n)?(i.drawScanline(e,i,this.win1Left,s),i.drawScanline(e,i,a,this.win1Right)):i.drawScanline(e,i,this.win1Left,this.win1Right)),s=Math.max(s,this.win1Left),r=Math.min(r,this.win1Left),n=Math.max(n,this.win1Right),a=Math.min(a,this.win1Right)),(this.windows[2].enabled[i.index]||this.objwin&&this.windows[3].enabled[i.index])&&(this.objwinActive=this.objwin,this.setBlendEnabled(i.index,this.windows[2].special&&this.target1[i.index],this.blendMode),r>n?i.drawScanline(e,i,0,this.HORIZONTAL_PIXELS):(r&&i.drawScanline(e,i,0,r),n<this.HORIZONTAL_PIXELS&&i.drawScanline(e,i,n,this.HORIZONTAL_PIXELS),a<s&&i.drawScanline(e,i,a,s))),this.setBlendEnabled(this.LAYER_BACKDROP,this.target1[this.LAYER_BACKDROP]&&this.windows[2].special,this.blendMode)):(this.setBlendEnabled(i.index,this.target1[i.index],this.blendMode),i.drawScanline(e,i,0,this.HORIZONTAL_PIXELS)),i.bg&&(i.sx+=i.dmx,i.sy+=i.dmy));this.finishScanline(e)}},mt.prototype.finishScanline=function(t){for(var e,i=this.palette.accessColor(this.LAYER_BACKDROP,0),s=this.vcount*this.HORIZONTAL_PIXELS*4,r=this.target2[this.LAYER_BACKDROP],n=0;n<this.HORIZONTAL_PIXELS;++n)t.stencil[n]&this.WRITTEN_MASK?(e=t.color[n],r&&t.stencil[n]&this.TARGET1_MASK&&(e=this.palette.mix(this.blendA,e,this.blendB,i)),this.palette.convert16To32(e,this.sharedColor)):this.palette.convert16To32(i,this.sharedColor),this.pixelData.data[s++]=this.sharedColor[0],this.pixelData.data[s++]=this.sharedColor[1],this.pixelData.data[s++]=this.sharedColor[2],s++},mt.prototype.startDraw=function(){},mt.prototype.finishDraw=function(t){this.bg[2].sx=this.bg[2].refx,this.bg[2].sy=this.bg[2].refy,this.bg[3].sx=this.bg[3].refx,this.bg[3].sy=this.bg[3].refy,t.finishDraw(this.pixelData)};var ft=mt;function At(){this.renderPath=new ft,this.CYCLES_PER_PIXEL=4,this.HORIZONTAL_PIXELS=240,this.HBLANK_PIXELS=68,this.HDRAW_LENGTH=1006,this.HBLANK_LENGTH=226,this.HORIZONTAL_LENGTH=1232,this.VERTICAL_PIXELS=160,this.VBLANK_PIXELS=68,this.VERTICAL_TOTAL_PIXELS=228,this.TOTAL_LENGTH=280896,this.drawCallback=function(){},this.vblankCallback=function(){}}At.prototype.clear=function(){this.renderPath.clear(this.cpu.mmu),this.DISPSTAT_MASK=65336,this.inHblank=!1,this.inVblank=!1,this.vcounter=0,this.vblankIRQ=0,this.hblankIRQ=0,this.vcounterIRQ=0,this.vcountSetting=0,this.vcount=-1,this.lastHblank=0,this.nextHblank=this.HDRAW_LENGTH,this.nextEvent=this.nextHblank,this.nextHblankIRQ=0,this.nextVblankIRQ=0,this.nextVcounterIRQ=0},At.prototype.freeze=function(){return{inHblank:this.inHblank,inVblank:this.inVblank,vcounter:this.vcounter,vblankIRQ:this.vblankIRQ,hblankIRQ:this.hblankIRQ,vcounterIRQ:this.vcounterIRQ,vcountSetting:this.vcountSetting,vcount:this.vcount,lastHblank:this.lastHblank,nextHblank:this.nextHblank,nextEvent:this.nextEvent,nextHblankIRQ:this.nextHblankIRQ,nextVblankIRQ:this.nextVblankIRQ,nextVcounterIRQ:this.nextVcounterIRQ,renderPath:this.renderPath.freeze(this.core.encodeBase64)}},At.prototype.defrost=function(t){this.inHblank=t.inHblank,this.inVblank=t.inVblank,this.vcounter=t.vcounter,this.vblankIRQ=t.vblankIRQ,this.hblankIRQ=t.hblankIRQ,this.vcounterIRQ=t.vcounterIRQ,this.vcountSetting=t.vcountSetting,this.vcount=t.vcount,this.lastHblank=t.lastHblank,this.nextHblank=t.nextHblank,this.nextEvent=t.nextEvent,this.nextHblankIRQ=t.nextHblankIRQ,this.nextVblankIRQ=t.nextVblankIRQ,this.nextVcounterIRQ=t.nextVcounterIRQ,this.renderPath.defrost(t.renderPath,this.core.decodeBase64)},At.prototype.setBacking=function(t){var e=t.createImageData(this.HORIZONTAL_PIXELS,this.VERTICAL_PIXELS);this.context=t;for(var i=0;i<this.HORIZONTAL_PIXELS*this.VERTICAL_PIXELS*4;)e.data[i++]=255,e.data[i++]=255,e.data[i++]=255,e.data[i++]=255;this.renderPath.setBacking(e)},At.prototype.updateTimers=function(t){var e=t.cycles;if(this.nextEvent<=e)if(this.inHblank){switch(this.inHblank=!1,this.nextEvent=this.nextHblank,++this.vcount,this.vcount){case this.VERTICAL_PIXELS:this.inVblank=!0,this.renderPath.finishDraw(this),this.nextVblankIRQ=this.nextEvent+this.TOTAL_LENGTH,this.cpu.mmu.runVblankDmas(),this.vblankIRQ&&this.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VBLANK),this.vblankCallback();break;case this.VERTICAL_TOTAL_PIXELS-1:this.inVblank=!1;break;case this.VERTICAL_TOTAL_PIXELS:this.vcount=0,this.renderPath.startDraw()}this.vcounter=this.vcount==this.vcountSetting,this.vcounter&&this.vcounterIRQ&&(this.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VCOUNTER),this.nextVcounterIRQ+=this.TOTAL_LENGTH),this.vcount<this.VERTICAL_PIXELS&&this.renderPath.drawScanline(this.vcount)}else this.inHblank=!0,this.lastHblank=this.nextHblank,this.nextEvent=this.lastHblank+this.HBLANK_LENGTH,this.nextHblank=this.nextEvent+this.HDRAW_LENGTH,this.nextHblankIRQ=this.nextHblank,this.vcount<this.VERTICAL_PIXELS&&this.cpu.mmu.runHblankDmas(),this.hblankIRQ&&this.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_HBLANK)},At.prototype.writeDisplayStat=function(t){this.vblankIRQ=8&t,this.hblankIRQ=16&t,this.vcounterIRQ=32&t,this.vcountSetting=(65280&t)>>8,this.vcounterIRQ&&(this.nextVcounterIRQ=this.nextHblank+this.HBLANK_LENGTH+(this.vcountSetting-this.vcount)*this.HORIZONTAL_LENGTH,this.nextVcounterIRQ<this.nextEvent&&(this.nextVcounterIRQ+=this.TOTAL_LENGTH))},At.prototype.readDisplayStat=function(){return this.inVblank|this.inHblank<<1|this.vcounter<<2},At.prototype.finishDraw=function(t){this.context.putImageData(t,0,0),this.drawCallback()};var bt=At;function Ct(){this.KEYCODE_LEFT=37,this.KEYCODE_UP=38,this.KEYCODE_RIGHT=39,this.KEYCODE_DOWN=40,this.KEYCODE_START=13,this.KEYCODE_SELECT=220,this.KEYCODE_A=90,this.KEYCODE_B=88,this.KEYCODE_L=65,this.KEYCODE_R=83,this.GAMEPAD_LEFT=14,this.GAMEPAD_UP=12,this.GAMEPAD_RIGHT=15,this.GAMEPAD_DOWN=13,this.GAMEPAD_START=9,this.GAMEPAD_SELECT=8,this.GAMEPAD_A=1,this.GAMEPAD_B=0,this.GAMEPAD_L=4,this.GAMEPAD_R=5,this.GAMEPAD_THRESHOLD=.2,this.A=0,this.B=1,this.SELECT=2,this.START=3,this.RIGHT=4,this.LEFT=5,this.UP=6,this.DOWN=7,this.R=8,this.L=9,this.currentDown=1023,this.eatInput=!1,this.gamepads=[]}Ct.prototype.clickHandlerStart=function(t){var e=t.clickedButton||0;e=1<<e,this.currentDown&=~e},Ct.prototype.clickHandlerEnd=function(t){var e=t.clickedButton||0;e=1<<e,this.currentDown|=e},Ct.prototype.keyboardHandler=function(t){var e=0;switch(t.keyCode){case this.KEYCODE_START:e=this.START;break;case this.KEYCODE_SELECT:e=this.SELECT;break;case this.KEYCODE_A:e=this.A;break;case this.KEYCODE_B:e=this.B;break;case this.KEYCODE_L:e=this.L;break;case this.KEYCODE_R:e=this.R;break;case this.KEYCODE_UP:e=this.UP;break;case this.KEYCODE_RIGHT:e=this.RIGHT;break;case this.KEYCODE_DOWN:e=this.DOWN;break;case this.KEYCODE_LEFT:e=this.LEFT;break;default:return}e=1<<e,"keydown"==t.type?this.currentDown&=~e:this.currentDown|=e,this.eatInput&&t.preventDefault()},Ct.prototype.gamepadHandler=function(t){var e=0;t.buttons[this.GAMEPAD_LEFT]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.LEFT),t.buttons[this.GAMEPAD_UP]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.UP),t.buttons[this.GAMEPAD_RIGHT]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.RIGHT),t.buttons[this.GAMEPAD_DOWN]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.DOWN),t.buttons[this.GAMEPAD_START]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.START),t.buttons[this.GAMEPAD_SELECT]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.SELECT),t.buttons[this.GAMEPAD_A]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.A),t.buttons[this.GAMEPAD_B]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.B),t.buttons[this.GAMEPAD_L]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.L),t.buttons[this.GAMEPAD_R]>this.GAMEPAD_THRESHOLD&&(e|=1<<this.R),this.currentDown=1023&~e},Ct.prototype.gamepadConnectHandler=function(t){this.gamepads.push(t)},Ct.prototype.gamepadDisconnectHandler=function(t){this.gamepads=window.self.gamepads.filter((function(e){return e!=t}))},Ct.prototype.pollGamepads=function(){var t=[];navigator.webkitGetGamepads?t=navigator.webkitGetGamepads():navigator.getGamepads&&(t=navigator.getGamepads()),t.length&&(this.gamepads=[]);for(var e=0;e<t.length;++e)t[e]&&this.gamepads.push(t[e]);this.gamepads.length>0&&this.gamepadHandler(this.gamepads[0])},Ct.prototype.registerHandlers=function(){window.addEventListener("keydown",this.keyboardHandler.bind(this),!0),window.addEventListener("keyup",this.keyboardHandler.bind(this),!0),window.addEventListener("gamepadconnected",this.gamepadConnectHandler.bind(this),!0),window.addEventListener("mozgamepadconnected",this.gamepadConnectHandler.bind(this),!0),window.addEventListener("webkitgamepadconnected",this.gamepadConnectHandler.bind(this),!0),window.addEventListener("gamepaddisconnected",this.gamepadDisconnectHandler.bind(this),!0),window.addEventListener("mozgamepaddisconnected",this.gamepadDisconnectHandler.bind(this),!0),window.addEventListener("webkitgamepaddisconnected",this.gamepadDisconnectHandler.bind(this),!0)};var St=Ct;function gt(){this.SIO_NORMAL_8=0,this.SIO_NORMAL_32=1,this.SIO_MULTI=2,this.SIO_UART=3,this.SIO_GPIO=8,this.SIO_JOYBUS=12,this.BAUD=[9600,38400,57600,115200]}gt.prototype.clear=function(){this.mode=this.SIO_GPIO,this.sd=!1,this.irq=!1,this.multiplayer={baud:0,si:0,id:0,error:0,busy:0,states:[65535,65535,65535,65535]},this.linkLayer=null},gt.prototype.setMode=function(t){t&=8&t?12:3,this.mode=t,this.core.INFO("Setting SIO mode to "+function(t,e,i){"undefined"===typeof i&&(i=!0),"undefined"===typeof e&&(e=8);var s=(t>>>0).toString(16).toUpperCase();return(e-=s.length)<0?s:(i?"0x":"")+new Array(e+1).join("0")+s}(t,1))},gt.prototype.writeRCNT=function(t){this.mode==this.SIO_GPIO&&this.core.STUB("General purpose serial not supported")},gt.prototype.writeSIOCNT=function(t){switch(this.mode){case this.SIO_NORMAL_8:this.core.STUB("8-bit transfer unsupported");break;case this.SIO_NORMAL_32:this.core.STUB("32-bit transfer unsupported");break;case this.SIO_MULTI:this.multiplayer.baud=3&t,this.linkLayer&&this.linkLayer.setBaud(this.BAUD[this.multiplayer.baud]),this.multiplayer.si||(this.multiplayer.busy=128&t,this.linkLayer&&this.multiplayer.busy&&this.linkLayer.startMultiplayerTransfer()),this.irq=16384&t;break;case this.SIO_UART:this.core.STUB("UART unsupported");break;case this.SIO_GPIO:break;case this.SIO_JOYBUS:this.core.STUB("JOY BUS unsupported")}},gt.prototype.readSIOCNT=function(){var t=this.mode<<12&65535;switch(this.mode){case this.SIO_NORMAL_8:this.core.STUB("8-bit transfer unsupported");break;case this.SIO_NORMAL_32:this.core.STUB("32-bit transfer unsupported");break;case this.SIO_MULTI:t|=this.multiplayer.baud,t|=this.multiplayer.si,t|=!!this.sd<<3,t|=this.multiplayer.id<<4,t|=this.multiplayer.error,t|=this.multiplayer.busy,t|=!!this.multiplayer.irq<<14;break;case this.SIO_UART:this.core.STUB("UART unsupported");break;case this.SIO_GPIO:break;case this.SIO_JOYBUS:this.core.STUB("JOY BUS unsupported")}return t},gt.prototype.read=function(t){switch(this.mode){case this.SIO_NORMAL_32:this.core.STUB("32-bit transfer unsupported");break;case this.SIO_MULTI:return this.multiplayer.states[t];case this.SIO_UART:this.core.STUB("UART unsupported");break;default:this.core.WARN("Reading from transfer register in unsupported mode")}return 0};var Rt=gt;function wt(){this.LOG_ERROR=1,this.LOG_WARN=2,this.LOG_STUB=4,this.LOG_INFO=8,this.LOG_DEBUG=16,this.SYS_ID="com.endrift.gbajs",this.logLevel=this.LOG_ERROR|this.LOG_WARN,this.rom=null,Object.prototype.inherit=function(){for(var t in this)this[t]=this[t]},this.cpu=new H,this.mmu=new et,this.irq=new st,this.io=new nt,this.audio=new ht,this.video=new bt,this.keypad=new St,this.sio=new Rt,this.cpu.mmu=this.mmu,this.cpu.irq=this.irq,this.mmu.cpu=this.cpu,this.mmu.core=this,this.irq.cpu=this.cpu,this.irq.io=this.io,this.irq.audio=this.audio,this.irq.video=this.video,this.irq.core=this,this.io.cpu=this.cpu,this.io.audio=this.audio,this.io.video=this.video,this.io.keypad=this.keypad,this.io.sio=this.sio,this.io.core=this,this.audio.cpu=this.cpu,this.audio.core=this,this.video.cpu=this.cpu,this.video.core=this,this.keypad.core=this,this.sio.core=this,this.keypad.registerHandlers(),this.doStep=this.waitFrame,this.paused=!1,this.seenFrame=!1,this.seenSave=!1,this.lastVblank=0,this.queue=null,this.reportFPS=null,this.throttle=16;var t=this;window.queueFrame=function(e){t.queue=window.setTimeout(e,t.throttle)},window.URL=window.URL||window.webkitURL,this.video.vblankCallback=function(){t.seenFrame=!0}}wt.prototype.setCanvas=function(t){var e=this;if(240!=t.offsetWidth||160!=t.offsetHeight){this.indirectCanvas=document.createElement("canvas"),this.indirectCanvas.setAttribute("height","160"),this.indirectCanvas.setAttribute("width","240"),this.targetCanvas=t,this.setCanvasDirect(this.indirectCanvas);var i=t.getContext("2d");this.video.drawCallback=function(){i.drawImage(e.indirectCanvas,0,0,t.offsetWidth,t.offsetHeight)}}else{this.setCanvasDirect(t);e=this}},wt.prototype.setCanvasDirect=function(t){this.context=t.getContext("2d"),this.video.setBacking(this.context)},wt.prototype.setBios=function(t,e){this.mmu.loadBios(t,e)},wt.prototype.setRom=function(t){return this.reset(),this.rom=this.mmu.loadRom(t,!0),!!this.rom&&(this.retrieveSavedata(),!0)},wt.prototype.hasRom=function(){return!!this.rom},wt.prototype.loadRomFromFile=function(t,e){var i=new FileReader,s=this;i.onload=function(t){var i=s.setRom(t.target.result);e&&e(i)},i.readAsArrayBuffer(t)},wt.prototype.reset=function(){this.audio.pause(!0),this.mmu.clear(),this.io.clear(),this.audio.clear(),this.video.clear(),this.sio.clear(),this.mmu.mmap(this.mmu.REGION_IO,this.io),this.mmu.mmap(this.mmu.REGION_PALETTE_RAM,this.video.renderPath.palette),this.mmu.mmap(this.mmu.REGION_VRAM,this.video.renderPath.vram),this.mmu.mmap(this.mmu.REGION_OAM,this.video.renderPath.oam),this.cpu.resetCPU(0)},wt.prototype.step=function(){for(;this.doStep();)this.cpu.step()},wt.prototype.waitFrame=function(){var t=this.seenFrame;return this.seenFrame=!1,!t},wt.prototype.pause=function(){this.paused=!0,this.audio.pause(!0),this.queue&&(clearTimeout(this.queue),this.queue=null)},wt.prototype.advanceFrame=function(){this.step(),this.seenSave?this.mmu.saveNeedsFlush()?this.mmu.flushSave():(this.storeSavedata(),this.seenSave=!1):this.mmu.saveNeedsFlush()&&(this.seenSave=!0,this.mmu.flushSave())},wt.prototype.runStable=function(){if(!this.interval){var t,e=this,i=0,s=0,r=Date.now();this.paused=!1,this.audio.context.resume(),this.audio.pause(!1),t=this.reportFPS?function(){try{if(i+=Date.now()-r,e.paused)return;window.queueFrame(t),r=Date.now(),e.advanceFrame(),60==++s&&(e.reportFPS(1e3*s/i),s=0,i=0)}catch(n){throw e.ERROR(n),n.stack&&e.logStackTrace(n.stack.split("\n")),n}}:function(){try{if(e.paused)return;window.queueFrame(t),e.advanceFrame()}catch(i){throw e.ERROR(i),i.stack&&e.logStackTrace(i.stack.split("\n")),i}},window.queueFrame(t)}},wt.prototype.setSavedata=function(t){this.mmu.loadSavedata(t)},wt.prototype.loadSavedataFromFile=function(t){var e=new FileReader,i=this;e.onload=function(t){i.setSavedata(t.target.result)},e.readAsArrayBuffer(t)},wt.prototype.decodeSavedata=function(t){this.setSavedata(this.decodeBase64(t))},wt.prototype.decodeBase64=function(t){var e=3*t.length/4;"="==t[t.length-2]?e-=2:"="==t[t.length-1]&&(e-=1);for(var i=new ArrayBuffer(e),s=new Uint8Array(i),r=t.match(/..../g),n=0;n+2<e;n+=3){var a=atob(r.shift());s[n]=a.charCodeAt(0),s[n+1]=a.charCodeAt(1),s[n+2]=a.charCodeAt(2)}if(n<e){a=atob(r.shift());s[n++]=a.charCodeAt(0),a.length>1&&(s[n++]=a.charCodeAt(1))}return i},wt.prototype.encodeBase64=function(t){for(var e,i,s=[],r=[],n=0;n<t.byteLength;++n)for(e=t.getUint8(n,!0),r.push(String.fromCharCode(e));r.length>=3;)i=r.splice(0,3),s.push(btoa(i.join("")));return r.length&&s.push(btoa(r.join(""))),s.join("")},wt.prototype.downloadSavedata=function(){var t=this.mmu.save;if(!t)return this.WARN("No save data available"),null;if(window.URL){var e=window.URL.createObjectURL(new Blob([t.buffer],{type:"application/octet-stream"}));window.open(e)}else{var i=this.encodeBase64(t.view);window.open("data:application/octet-stream;base64,"+i,this.rom.code+".sav")}},wt.prototype.storeSavedata=function(){var t=this.mmu.save;try{window.localStorage[this.SYS_ID+"."+this.mmu.cart.code]=this.encodeBase64(t.view)}catch(e){this.WARN("Could not store savedata! "+e)}},wt.prototype.retrieveSavedata=function(){try{var t=window.localStorage[this.SYS_ID+"."+this.mmu.cart.code];if(t)return this.decodeSavedata(t),!0}catch(e){this.WARN("Could not retrieve savedata! "+e)}return!1},wt.prototype.freeze=function(){return{cpu:this.cpu.freeze(),mmu:this.mmu.freeze(),irq:this.irq.freeze(),io:this.io.freeze(),audio:this.audio.freeze(),video:this.video.freeze()}},wt.prototype.defrost=function(t){this.cpu.defrost(t.cpu),this.mmu.defrost(t.mmu),this.audio.defrost(t.audio),this.video.defrost(t.video),this.irq.defrost(t.irq),this.io.defrost(t.io)},wt.prototype.log=function(t,e){},wt.prototype.setLogger=function(t){this.log=t},wt.prototype.logStackTrace=function(t){var e=t.length-32;this.ERROR("Stack trace follows:"),e>0&&this.log(-1,"> (Too many frames)");for(var i=Math.max(e,0);i<t.length;++i)this.log(-1,"> "+t[i])},wt.prototype.ERROR=function(t){this.logLevel&this.LOG_ERROR&&this.log(this.LOG_ERROR,t)},wt.prototype.WARN=function(t){this.logLevel&this.LOG_WARN&&this.log(this.LOG_WARN,t)},wt.prototype.STUB=function(t){this.logLevel&this.LOG_STUB&&this.log(this.LOG_STUB,t)},wt.prototype.INFO=function(t){this.logLevel&this.LOG_INFO&&this.log(this.LOG_INFO,t)},wt.prototype.DEBUG=function(t){this.logLevel&this.LOG_DEBUG&&this.log(this.LOG_DEBUG,t)},wt.prototype.ASSERT_UNREACHED=function(t){throw new Error("Should be unreached: "+t)},wt.prototype.ASSERT=function(t,e){if(!t)throw new Error("Assertion failed: "+e)};var Et=wt;i(81);var vt=i(57),It=i.n(vt),Ot=i(58),_t=i.n(Ot),yt=i(59),Tt=i.n(yt),Pt=i(109),Mt=i(7),Nt=i(105),Dt=i(106),kt=i(107),Bt=i(108),Lt=i(111),xt=Object(Nt.a)((function(t){return{container:{width:"100%",maxWidth:700,margin:"16px auto",height:150,textShadow:"none","& td":{padding:0}},paper:{textAlign:"center",margin:0,borderRadius:0,background:"#759",color:"white",fontWeight:"bold"},topPaper:{background:"#648"}}}));var Gt=function(t){var e=xt();return r.a.createElement(Dt.a,{className:e.container},r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:"".concat(e.paper," ").concat(e.topPaper)},"GBA Buttons")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:"".concat(e.paper," ").concat(e.topPaper)},"Respective Keyboard"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"A")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Z"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"B")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"X"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"L")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"A"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"R")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"S"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Start")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Enter"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Select")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"\\"))),r.a.createElement(kt.a,null,r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Arrows")),r.a.createElement(Bt.a,null,r.a.createElement(Lt.a,{className:e.paper},"Arrows"))))},Ut={LEFT:String.fromCharCode(parseInt("+2190",16)),RIGHT:String.fromCharCode(parseInt("+2192",16)),UP:String.fromCharCode(parseInt("+2191",16)),DOWN:String.fromCharCode(parseInt("+2193",16)),A:"A",B:"B",R:"R",L:"L",START:"START",SELECT:"SELECT"},Ht=Object(Mt.a)((function(){window.screen.width;return{container:{position:"relative",height:300},LEFT:{position:"absolute",left:8,top:150,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},RIGHT:{position:"absolute",left:108,top:150,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},UP:{position:"absolute",left:58,top:100,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},DOWN:{position:"absolute",left:58,top:200,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},A:{position:"absolute",right:8,top:130,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},B:{position:"absolute",right:58,top:170,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},R:{position:"absolute",right:8,top:30,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},L:{position:"absolute",left:8,top:30,color:"white","& span":{border:"1px solid white",borderRadius:"50%"}},START:{position:"absolute",right:70,bottom:8,color:"white"},SELECT:{position:"absolute",left:70,bottom:8,color:"white"},fullscreen:{color:"white"}}}))((function(t){var e=t.classes,i=t.goFull,s=t.toogleSpeed,n=t.throttle;return r.a.createElement("div",{className:e.container},Vt.map((function(t){return r.a.createElement(Pt.a,{id:t,className:e[t]},Ut[t])})),(document.body.requestFullscreen||document.body.mozRequestFullScreen||document.body.webkitRequestFullScreen||document.body.msRequestFullscreen)&&r.a.createElement(Pt.a,{className:e.fullscreen,onClick:i},"Fullscreen"),n&&r.a.createElement(Pt.a,{className:e.fullscreen,onClick:s},{16:"1x",12:"1.5x",8:"2x"}[n]))}));function Ft(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function Wt(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?Ft(i,!0).forEach((function(e){Object(k.a)(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):Ft(i).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}var qt,Vt=["LEFT","RIGHT","UP","DOWN","A","B","R","L","START","SELECT"],Qt=function(t){function e(t){var i;return Object(y.a)(this,e),(i=Object(P.a)(this,Object(M.a)(e).call(this,t))).state={isFull:!1,throttle:16},i.initGBA=i.initGBA.bind(Object(N.a)(i)),i.toogleSpeed=i.toogleSpeed.bind(Object(N.a)(i)),i}return Object(D.a)(e,t),Object(T.a)(e,[{key:"goFull",value:function(){var t=window.document,e=t.documentElement,i=e.requestFullscreen||e.mozRequestFullScreen||e.webkitRequestFullScreen||e.msRequestFullscreen,s=t.exitFullscreen||t.mozCancelFullScreen||t.webkitExitFullscreen||t.msExitFullscreen;t.fullscreenElement||t.mozFullScreenElement||t.webkitFullscreenElement||t.msFullscreenElement?s.call(t):i.call(e)}},{key:"toogleSpeed",value:function(){if(qt){var t=qt.throttle;qt.throttle={16:12,12:8,8:16}[t],this.setState({throttle:qt.throttle})}}},{key:"componentDidMount",value:function(){var t=this;this.initGBA(),window.addEventListener("beforeinstallprompt",(function(e){if(e.preventDefault(),console.log("Install Prompt fired"),t.installPrompt=e,window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||!0===window.navigator.standalone)return!1;t.setState({installButton:!0})}))}},{key:"installApp",value:function(){var t=Object(_.a)(O.a.mark((function t(){return O.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.installPrompt){t.next=2;break}return t.abrupt("return",!1);case 2:return this.installPrompt.prompt(),t.next=5,this.installPrompt.userChoice;case 5:"accepted"==t.sent.outcome?console.log("App Installed"):console.log("App not installed"),this.installPrompt=null,this.setState({installButton:!1});case 9:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}()},{key:"initGBA",value:function(){var t=[],e=this.props.classes;function i(t,i,s){var r=document.getElementById(t),n=document.getElementById(i);if(r){var a=function t(){s?r.parentElement.removeChild(r):(r.setAttribute("class",e.dead),r.removeEventListener("webkitTransitionEnd",t),r.removeEventListener("oTransitionEnd",t),r.removeEventListener("transitionend",t)),n&&(n.setAttribute("class",e.hidden),setTimeout((function(){n.removeAttribute("class")}),0))};r.addEventListener("webkitTransitionEnd",a,!1),r.addEventListener("oTransitionEnd",a,!1),r.addEventListener("transitionend",a,!1),r.setAttribute("class",e.hidden)}}function s(){qt.pause(),qt.reset();var t=document.getElementById("select");t.textContent="SELECT";var e=document.getElementById("crash"),s=window.screen.width,r=s>480?480:s,n=s>480?320:320*s/480;e?(qt.targetCanvas.getContext("2d").clearRect(0,0,r,n),qt.video.drawCallback(),e.parentElement.removeChild(e),document.getElementById("screen").removeAttribute("class")):function(t,e,i){var s=0,r=window.screen.width,n=r>480?480:r,a=r>480?320:320*r/480,h=setInterval((function(){s++;for(var r=t.getImageData(0,0,n/2,a/2),o=0;o<a/2;++o)for(var c=0;c<n/2;++c){var u=Math.abs(c-n/4),p=.8*Math.abs(o-a/4),l=(n/4-s-u)/(n/4),d=(a/4-s-10*(1&o)-p+Math.pow(u,.5))/(a/4);r.data[4*(c+o*n/2)+3]*=Math.pow(l,1/3)*Math.pow(d,.5)}t.putImageData(r,0,0),e.clearRect(0,0,n,a),s>40?clearInterval(h):i()}),50)}(qt.context,qt.targetCanvas.getContext("2d"),qt.video.drawCallback);t.onclick=function(){document.getElementById("loader").click()},i("ingame","preload"),qt.rom=null}function r(t){qt.audio.masterVolume=Math.pow(2,t)-1}document.addEventListener("gesturestart",(function(t){t.preventDefault()})),window.onload=function(){try{(qt=new Et).keypad.eatInput=!0,qt.setLogger((function(t,i){console.error(i),qt.pause();var s=document.getElementById("screen");if(s.getAttribute("class")!==e.dead){var r=document.createElement("img");r.setAttribute("id","crash"),r.setAttribute("src",It.a),s.parentElement.insertBefore(r,s),s.setAttribute("class",e.dead)}else console.log("We appear to have crashed multiple times without reseting.")})),window.onblur=function(){if(qt.hasRom()){var t=document.getElementById("pause");qt.paused||(qt.pause(),t.textContent="UNPAUSE",console.log("Window Focused: the game has been paused"))}},window.onfocus=function(){if(qt.hasRom()){var t=document.getElementById("pause");qt.paused&&(qt.runStable(),t.textContent="PAUSE",console.log("Window Focused: the game has been resumed"))}}}catch(r){qt=null}if(qt&&FileReader){var t=document.getElementById("screen");if(qt.setCanvas(t),qt.logLevel=qt.LOG_ERROR,function(t,e){var i=new XMLHttpRequest;i.open("GET",t),i.responseType="arraybuffer",i.onload=function(){e(i.response)},i.send()}(Tt.a,(function(t){qt.setBios(t)})),!qt.audio.context){var i=document.getElementById("sound");i.parentElement.removeChild(i)}}else{var s=document.getElementById("controls");s.parentElement.removeChild(s)}},window.onload(),document.getElementById("select").addEventListener("click",(function(){document.getElementById("loader").click()}),!1),document.querySelector("button").addEventListener("click",(function(){qt.audio.context.resume()})),document.getElementById("loader").addEventListener("change",(function(){!function(e){document.getElementById("loader").value="";var s=document.getElementById("select");s.textContent="Loading...",s.removeAttribute("onclick"),document.getElementById("pause").textContent="PAUSE",qt.loadRomFromFile(e,(function(e){if(e){for(var r=0;r<t.length;++r)t[r]();t=[],i("preload","ingame"),i("instructions",null,!0),qt.runStable()}else s.textContent="FAILED",setTimeout((function(){s.textContent="SELECT",s.onclick=function(){document.getElementById("loader").click()}}),3e3)}))}(this.files[0])}),!1),document.getElementById("select-savegame-btn").addEventListener("click",(function(){document.getElementById("saveloader").click()}),!1),document.getElementById("saveloader").addEventListener("change",(function(){var e,i=this.files[0];e=i,t.push((function(){qt.loadSavedataFromFile(e)}))}),!1),document.getElementById("pause").addEventListener("click",(function(){!function(){var t=document.getElementById("pause");qt.paused?(qt.runStable(),t.textContent="PAUSE"):(qt.pause(),t.textContent="UNPAUSE")}()}),!1),document.getElementById("reset-btn").addEventListener("click",(function(){s()}),!1),document.getElementById("download-savegame").addEventListener("click",(function(){qt.downloadSavedata()}),!1),document.getElementById("audio-enabled-checkbox").addEventListener("change",(function(){qt.audio.masterEnable=this.checked}),!1),document.getElementById("volume-level-slider").addEventListener("change",(function(){r(this.value)}),!1),document.getElementById("volume-level-slider").addEventListener("input",(function(){r(this.value),console.log(qt.audio)}),!1),Vt.forEach((function(t){document.getElementById(t)&&(document.getElementById(t).ontouchstart=function(e){qt.keypad.clickHandlerStart(Wt({},e,{clickedButton:qt.keypad[t]}))},document.getElementById(t).ontouchend=function(e){qt.keypad.clickHandlerEnd(Wt({},e,{clickedButton:qt.keypad[t]}))})}))}},{key:"render",value:function(){var t=this.props.classes,e=window.screen.width,i=e>480?480:e,s=e>480?320:320*e/480;return r.a.createElement("div",{className:t.container},this.state.installButton&&r.a.createElement(Pt.a,{onClick:this.installApp},"Install as application"),r.a.createElement("div",{className:t.screen},r.a.createElement("div",{id:"fullscreenable"},r.a.createElement("canvas",{id:"screen",className:t.canvas,width:"".concat(i),height:"".concat(s)}),e<=480?r.a.createElement(Ht,{goFull:this.goFull,throttle:this.state.throttle,toogleSpeed:this.toogleSpeed}):r.a.createElement(Gt,null)),r.a.createElement("div",{id:"controls",className:t.controls},r.a.createElement("div",{id:"preload"},r.a.createElement("h4",{className:t.noselect},"App Controls"),r.a.createElement("button",{className:t.button,id:"select"}," Select ROM file "),r.a.createElement("input",{id:"loader",type:"file",accept:".gba"}),r.a.createElement("button",{className:t.button,id:"select-savegame-btn"},"Upload Savegame"),r.a.createElement("input",{id:"saveloader",type:"file"})),r.a.createElement("div",{id:"ingame",className:t.hidden},r.a.createElement("h4",{className:t.noselect},"In-game controls"),r.a.createElement("button",{className:t.button,id:"pause"},"Pause game"),r.a.createElement("button",{className:t.button,id:"reset-btn"},"Reset"),r.a.createElement("button",{className:t.button,id:"download-savegame"},"Download Savegame File"),r.a.createElement("div",{id:"sound"},r.a.createElement("p",null,"Audio enabled"),r.a.createElement("input",{type:"checkbox",id:"audio-enabled-checkbox"}),r.a.createElement("p",null,"Change sound level"),r.a.createElement("input",{id:"volume-level-slider",type:"range",min:"0",max:"1",step:"any"}))))))}}]),e}(r.a.Component),Kt=Object(Mt.a)((function(){window.screen.width;var t,e,i={"-webkit-touch-callout":"none","-webkit-user-select":"none","-khtml-user-select":"none","-moz-user-select":"none","-ms-user-select":"none","user-select":"none"};return{container:Wt({},i,{width:"100%",height:"100%",overflow:"hidden","-webkit-overflow-scrolling":"touch",minHeight:"100vh",background:"-webkit-linear-gradient(#765490 560px, #6A4883 620px, #433061 900px)",textAlign:"center",fontFamily:'"Calibri", "Verdana", sans-serif',color:"white",textShadow:"0 2px rgba(0, 0, 0, 0.6)"}),screen:Wt({},i,{background:"url('".concat(_t.a,"') no-repeat top center"),"@media (max-width:480px)":{background:"none"}}),canvas:Wt({},i,{marginTop:85,marginBottom:150,'&[width="240"]':(t={marginTop:42.5,marginBottom:-363,imageRendering:"-webkit-optimize-contrast"},Object(k.a)(t,"imageRendering","-moz-crisp-edges"),Object(k.a)(t,"imageRendering","-o-crisp-edges"),Object(k.a)(t,"zoom",2),Object(k.a)(t,"transform","scale(2)"),t),"@media (max-width:480px)":{background:"gray",marginTop:0,marginBottom:0}}),controls:Wt({},i,{borderRadius:20,border:"1px solid rgba(0, 0, 0, 0.4)",borderTop:"none",boxShadow:"0 4px 4px -2px rgba(0, 0, 0, 0.9), 0 -40px 2px -1px #433061 inset",width:"100vw",maxWidth:700,margin:"auto",height:200,overflow:"hidden",backgroundColor:"#765490",position:"relative","&::before":(e={content:'""',display:"block",height:30,width:"calc(100vw + 7px)",maxWidth:707,borderRadius:"5px / 15px",border:"1px solid rgba(0, 0, 0, 0.4)",borderWidth:"0 1px",margin:"0 -5px 20px",background:"-moz-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)"},Object(k.a)(e,"background","-webkit-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)"),Object(k.a)(e,"boxShadow","0 5px 4px -3px rgba(0, 0, 0, 0.6)"),Object(k.a)(e,"position","absolute"),e),"& > div":{marginTop:-15,transform:"rotateX(0deg)",transformOrigin:"50% 0",transition:"transform linear 0.5s","-moz-transform-origin":"50% 0","-moz-transform":"rotateX(0deg)","-moz-transition":"-moz-transform linear 0.5s","-webkit-transform-origin-y":2,"-webkit-transform":"rotateX(0deg)","-webkit-transition":"-webkit-transform linear 0.5s"}}),hidden:{transform:"rotateX(90deg) !important"},dead:{display:"none"},button:{fontFamily:'"Calibri", "Verdana", sans-serif',backgroundColor:"#6A4883",fontWeight:"bold",fontSize:18,color:"white",textShadow:"0 3px #433061",padding:"2px 10px 5px",borderRadius:"0 0 10px 10px",border:"0 solid rgba(0, 0, 0, 0.4)",borderWidth:"3px 1px 0px",display:"inline",boxShadow:"0 2px 6px -1px rgba(0, 0, 0, 0.2) inset",margin:"0 0 20px"},noselect:i}}))(Qt);a.a.render(r.a.createElement(h.a,null,r.a.createElement(R.a,{store:v},r.a.createElement(g.c,null,r.a.createElement(g.a,{path:"/",exact:!0,component:u}),r.a.createElement(g.a,{path:"/emulator",component:Kt}),r.a.createElement(g.a,{path:"*",component:b})))),document.getElementById("root")),function(t){if("serviceWorker"in navigator){if(new URL("/gba-emu-web",window.location.href).origin!==window.location.origin)return;window.addEventListener("load",(function(){var e="".concat("/gba-emu-web","/service-worker.js");C?(!function(t,e){fetch(t).then((function(i){var s=i.headers.get("content-type");404===i.status||null!=s&&-1===s.indexOf("javascript")?navigator.serviceWorker.ready.then((function(t){t.unregister().then((function(){window.location.reload()}))})):S(t,e)})).catch((function(){console.log("No internet connection found. App is running in offline mode.")}))}(e,t),navigator.serviceWorker.ready.then((function(){console.log("This web app is being served cache-first by a service worker. To learn more, visit https://bit.ly/CRA-PWA")}))):S(e,t)}))}}()}},[[65,1,2]]]);
//# sourceMappingURL=main.f56cad6b.chunk.js.map