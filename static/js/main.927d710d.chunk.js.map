{"version":3,"sources":["App.js","pages/Page404.js","serviceWorker.js","reducers/index.js","store/index.js","libs/js/arm.js","libs/js/thumb.js","libs/js/core.js","libs/js/util.js","libs/js/savedata.js","libs/js/gpio.js","libs/js/mmu.js","libs/js/irq.js","libs/js/io.js","libs/js/audio.js","libs/js/video/software.js","libs/js/video.js","libs/js/keypad.js","libs/js/sio.js","libs/js/gba.js","components/GBAMobileController.js","components/GBAControlsHelper.js","components/GBAScreen.js","libs/resources/xhr.js","index.js","logo.svg","libs/resources/crash.png","libs/resources/bg.png","libs/resources/bios.bin"],"names":["MyButton","styled","Button","background","border","borderRadius","boxShadow","color","height","padding","textTransform","App","className","src","logo","alt","href","target","to","variant","useNonExistingPageStyle","makeStyles","theme","width","backgroundColor","overflow","textAlign","alertIcon","marginTop","link","textDecorationColor","withTheme","classes","Typography","isLocalhost","Boolean","window","location","hostname","match","registerValidSW","swUrl","config","navigator","serviceWorker","register","then","registration","onupdatefound","installingWorker","installing","onstatechange","state","controller","console","log","onUpdate","onSuccess","catch","error","Reducers","combineReducers","Store","createStore","ARMCoreArm","cpu","this","addressingMode23Immediate","rn","offset","condOp","gprs","address","addr","writesPC","PC","addressingMode23Register","rm","addressingMode2RegisterShifted","shiftOp","shifterOperand","writePC","prototype","constructAddressingMode1ASR","rs","cycles","shift","shiftVal","shifterCarryOut","cpsrC","constructAddressingMode1Immediate","immediate","constructAddressingMode1ImmediateRotate","rotate","constructAddressingMode1LSL","constructAddressingMode1LSR","constructAddressingMode1ROR","constructAddressingMode23Immediate","instruction","constructAddressingMode23Register","constructAddressingMode2RegisterShifted","constructAddressingMode4","constructAddressingMode4Writeback","overlap","writeInitial","mmu","store32","constructADC","rd","waitPrefetch32","constructADCS","d","hasSPSR","unpackCPSR","spsr","cpsrN","cpsrZ","cpsrV","constructADD","constructADDS","constructAND","constructANDS","constructB","constructBIC","constructBICS","constructBL","LR","constructBX","switchExecMode","constructCMN","aluOut","constructCMP","constructEOR","constructEORS","constructLDM","m","i","total","load32","waitMulti32","constructLDMS","mode","switchMode","MODE_SYSTEM","constructLDR","wait32","constructLDRB","loadU8","wait","constructLDRH","loadU16","constructLDRSB","load8","constructLDRSH","load16","constructMLA","waitMul","hi","lo","constructMLAS","constructMOV","constructMOVS","constructMRS","r","packCPSR","constructMSR","c","f","operand","mask","USER_MASK","PRIV_MASK","STATE_MASK","MODE_USER","cpsrI","cpsrF","constructMUL","constructMULS","constructMVN","constructMVNS","constructORR","constructORRS","constructRSB","constructRSBS","constructRSC","n","constructRSCS","constructSBC","constructSBCS","constructSMLAL","carry","Math","floor","constructSMLALS","constructSMULL","constructSMULLS","constructSTM","constructSTMS","constructSTR","constructSTRB","store8","constructSTRH","store16","constructSUB","constructSUBS","constructSWI","irq","swi32","constructSWP","constructSWPB","constructTEQ","constructTST","constructUMLAL","constructUMLALS","constructUMULL","constructUMULLS","ARMCoreThumb","waitPrefetch","oldD","oldDn","dn","mn","constructADD1","constructADD2","constructADD3","constructADD4","constructADD5","constructADD6","SP","constructADD7","constructASR1","constructASR2","constructB1","constructB2","constructBL1","constructBL2","pc","misalign","constructCMP1","constructCMP2","an","constructCMP3","constructLDMIA","constructLDR1","constructLDR2","constructLDR3","constructLDR4","constructLDRB1","constructLDRB2","constructLDRH1","constructLDRH2","constructLSL1","constructLSL2","constructLSR1","constructLSR2","constructMOV1","constructMOV2","constructMOV3","constructNEG","constructPOP","waitSeq32","constructPUSH","constructROR","r4","constructSTMIA","constructSTR1","constructSTR2","constructSTR3","constructSTRB1","constructSTRB2","constructSTRH1","constructSTRH2","constructSUB1","constructSUB2","constructSUB3","swi","ARMCore","inherit","MODE_ARM","MODE_THUMB","MODE_FIQ","MODE_IRQ","MODE_SUPERVISOR","MODE_ABORT","MODE_UNDEFINED","BANK_NONE","BANK_FIQ","BANK_IRQ","BANK_SUPERVISOR","BANK_ABORT","BANK_UNDEFINED","UNALLOC_MASK","WORD_SIZE_ARM","WORD_SIZE_THUMB","BASE_RESET","BASE_UNDEF","BASE_SWI","BASE_PABT","BASE_DABT","BASE_IRQ","BASE_FIQ","armCompiler","thumbCompiler","generateConds","Int32Array","resetCPU","startOffset","loadInstruction","loadInstructionArm","execMode","instructionWidth","bankedRegisters","bankedSPSRs","page","pageId","pageRegion","clear","step","conditionPassed","fixedJump","next","invalid","updateTimers","freeze","defrost","frost","fetchPage","region","BASE_OFFSET","addressToPage","OFFSET_MASK","pageMask","memory","PAGE_MASK","accessPage","arm","compileArm","opcode","loadInstructionThumb","thumb","compileThumb","selectBank","newMode","newBank","oldBank","oldFiqBank","newFiqBank","testIRQ","raiseIRQ","cpsr","raiseTrap","badOp","func","toString","conds","barrelShiftImmediate","shiftType","op","load","loOffset","h","w","s","b","shiftImmediate","user","p","rotateImm","cond","WARN","Serializer","TAG_INT","TAG_STRING","TAG_STRUCT","TAG_BLOB","TAG_BOOLEAN","TYPE","pointer","index","top","stack","pack","value","object","DataView","ArrayBuffer","setUint32","buffer","pack8","setUint8","prefix","Blob","size","length","byteLength","type","serialize","stream","parts","hasOwnProperty","tag","body","head","push","unshift","deserialize","blob","callback","reader","FileReader","onload","data","deserealizeStream","result","readAsArrayBuffer","view","remaining","getUint32","advance","mark","getUint8","readString","slice","pop","serializePNG","base","canvas","document","createElement","context","getContext","pixels","getImageData","transparent","y","x","bytesInCanvas","multiplier","edges","ceil","setAttribute","Uint8Array","pixelPointer","newPixels","createImageData","oldY","oldX","byte","putImageData","toDataURL","deserializePNG","image","drawImage","newBlob","map","array","readAsDataURL","amount","bytes","String","fromCharCode","join","SRAMSavedata","MemoryView","call","writePending","FlashSavedata","COMMAND_WIPE","COMMAND_ERASE_SECTOR","COMMAND_ERASE","COMMAND_ID","COMMAND_WRITE","COMMAND_SWITCH_BANK","COMMAND_TERMINATE_ID","ID_PANASONIC","ID_SANYO","bank0","id","bank1","bank","idMode","first","second","command","pendingCommand","EEPROMSavedata","writeAddress","readBitsRemaining","readAddress","commandBitsRemaining","realSize","addressBits","dma","core","COMMAND_NULL","COMMAND_PENDING","COMMAND_READ_PENDING","COMMAND_READ","GameBoyAdvanceGPIO","rom","readWrite","direction","device","GameBoyAdvanceRTC","gpio","pins","totalBytes","bytesRemaining","transferStep","reading","bitsRead","bits","control","time","Object","create","setInt8","setInt16","setInt32","getInt8","Error","replaceData","enable","count","current","setPins","setDirection","old","getUint16","setUint16","outputPins","nybble","read","processByte","sioOutputPin","updateClock","outputByte","date","Date","bcd","getFullYear","getMonth","getDate","getDay","getHours","getMinutes","getSeconds","binary","counter","resetMask","MemoryBlock","cacheBits","ICACHE_PAGE_BITS","icache","Array","ROMView","BIOSView","BadMemory","GameBoyAdvanceMMU","REGION_BIOS","REGION_WORKING_RAM","REGION_WORKING_IRAM","REGION_IO","REGION_PALETTE_RAM","REGION_VRAM","REGION_OAM","REGION_CART0","REGION_CART1","REGION_CART2","REGION_CART_SRAM","BASE_BIOS","BASE_WORKING_RAM","BASE_WORKING_IRAM","BASE_IO","BASE_PALETTE_RAM","BASE_VRAM","BASE_OAM","BASE_CART0","BASE_CART1","BASE_CART2","BASE_CART_SRAM","BASE_MASK","SIZE_BIOS","SIZE_WORKING_RAM","SIZE_WORKING_IRAM","SIZE_IO","SIZE_PALETTE_RAM","SIZE_VRAM","SIZE_OAM","SIZE_CART0","SIZE_CART1","SIZE_CART2","SIZE_CART_SRAM","SIZE_CART_FLASH512","SIZE_CART_FLASH1M","SIZE_CART_EEPROM","DMA_TIMING_NOW","DMA_TIMING_VBLANK","DMA_TIMING_HBLANK","DMA_TIMING_CUSTOM","DMA_INCREMENT","DMA_DECREMENT","DMA_FIXED","DMA_INCREMENT_RELOAD","DMA_OFFSET","WAITSTATES","WAITSTATES_32","WAITSTATES_SEQ","WAITSTATES_SEQ_32","NULLWAIT","ROM_WS","ROM_WS_SEQ","bios","mask8","mask16","mask32","getInt16","mem","getInt32","invalidatePage","allocGPIO","halfword","mmap","badMemory","waitstates","waitstatesSeq","waitstates32","waitstatesSeq32","waitstatesPrefetch","waitstatesPrefetch32","cart","save","DMA_REGISTER","io","DMA0CNT_HI","DMA1CNT_HI","DMA2CNT_HI","DMA3CNT_HI","ram","iram","loadBios","real","loadRom","process","title","code","maker","saveType","name","terminal","loadSavedata","maskedOffset","waitSeq","seq","scheduleDma","number","info","timing","serviceDma","audio","scheduleFIFODma","video","scheduleVCaptureDma","runHblankDmas","runVblankDmas","word","sourceOffset","srcControl","destOffset","dstControl","wordsRemaining","nextCount","source","nextSource","dest","nextDest","sourceRegion","destRegion","sourceBlock","destBlock","sourceView","destView","sourceMask","destMask","endPage","doIrq","nextIRQ","repeat","registers","adjustTimings","sram","ws0","ws0seq","ws1","ws1seq","ws2","ws2seq","prefetch","saveNeedsFlush","flushSave","GameBoyAdvanceInterruptHandler","FREQUENCY","IRQ_VBLANK","IRQ_HBLANK","IRQ_VCOUNTER","IRQ_TIMER0","IRQ_TIMER1","IRQ_TIMER2","IRQ_TIMER3","IRQ_SIO","IRQ_DMA0","IRQ_DMA1","IRQ_DMA2","IRQ_DMA3","IRQ_KEYPAD","IRQ_GAMEPAK","MASK_VBLANK","MASK_HBLANK","MASK_VCOUNTER","MASK_TIMER0","MASK_TIMER1","MASK_TIMER2","MASK_TIMER3","MASK_SIO","MASK_DMA0","MASK_DMA1","MASK_DMA2","MASK_DMA3","MASK_KEYPAD","MASK_GAMEPAK","enabledIRQs","interruptFlags","drq","timersEnabled","timers","reload","oldReload","prescaleBits","countUp","lastEvent","nextEvent","overflowInterval","springIRQ","resetSP","timer","TM0CNT_LO","enabled","enableChannelA","soundTimerA","dmaA","sampleFifoA","enableChannelB","soundTimerB","dmaB","sampleFifoB","TM1CNT_LO","TM2CNT_LO","TM3CNT_LO","pollNextEvent","flag","regions","renderPath","clearSubsets","STUB","halt","IME","dismissIRQs","mod","abs","root","sqrt","atan2","PI","wordsize","ox","oy","cx","cy","rx","ry","destination","sx","sy","theta","a","cos","sin","diff","lz77","huffman","rl","key","pow","masterEnable","setInterruptsEnabled","test","ASSERT","waitForIRQ","irqPending","hblankIRQ","vblankIRQ","vcounterIRQ","irqType","IF","irqMask","dmaSetSourceAddress","dmaSetDestAddress","dmaSetWordCount","dmaWriteControl","currentDma","wasEnabled","timerSetReload","timerWriteControl","currentTimer","oldPrescale","timerRead","unitsize","blockheader","block","disp","loaded","sPointer","dPointer","blocksRemaining","header","node","tree","treesize","bitsRemaining","readBits","bitsSeen","bitstream","l","lTerm","rTerm","GameBoyAdvanceIO","DISPCNT","GREENSWP","DISPSTAT","VCOUNT","BG0CNT","BG1CNT","BG2CNT","BG3CNT","BG0HOFS","BG0VOFS","BG1HOFS","BG1VOFS","BG2HOFS","BG2VOFS","BG3HOFS","BG3VOFS","BG2PA","BG2PB","BG2PC","BG2PD","BG2X_LO","BG2X_HI","BG2Y_LO","BG2Y_HI","BG3PA","BG3PB","BG3PC","BG3PD","BG3X_LO","BG3X_HI","BG3Y_LO","BG3Y_HI","WIN0H","WIN1H","WIN0V","WIN1V","WININ","WINOUT","MOSAIC","BLDCNT","BLDALPHA","BLDY","SOUND1CNT_LO","SOUND1CNT_HI","SOUND1CNT_X","SOUND2CNT_LO","SOUND2CNT_HI","SOUND3CNT_LO","SOUND3CNT_HI","SOUND3CNT_X","SOUND4CNT_LO","SOUND4CNT_HI","SOUNDCNT_LO","SOUNDCNT_HI","SOUNDCNT_X","SOUNDBIAS","WAVE_RAM0_LO","WAVE_RAM0_HI","WAVE_RAM1_LO","WAVE_RAM1_HI","WAVE_RAM2_LO","WAVE_RAM2_HI","WAVE_RAM3_LO","WAVE_RAM3_HI","FIFO_A_LO","FIFO_A_HI","FIFO_B_LO","FIFO_B_HI","DMA0SAD_LO","DMA0SAD_HI","DMA0DAD_LO","DMA0DAD_HI","DMA0CNT_LO","DMA1SAD_LO","DMA1SAD_HI","DMA1DAD_LO","DMA1DAD_HI","DMA1CNT_LO","DMA2SAD_LO","DMA2SAD_HI","DMA2DAD_LO","DMA2DAD_HI","DMA2CNT_LO","DMA3SAD_LO","DMA3SAD_HI","DMA3DAD_LO","DMA3DAD_HI","DMA3CNT_LO","TM0CNT_HI","TM1CNT_HI","TM2CNT_HI","TM3CNT_HI","SIODATA32_LO","SIOMULTI0","SIODATA32_HI","SIOMULTI1","SIOMULTI2","SIOMULTI3","SIOCNT","SIOMLT_SEND","SIODATA8","RCNT","JOYCNT","JOY_RECV","JOY_TRANS","JOYSTAT","KEYINPUT","KEYCNT","IE","WAITCNT","POSTFLG","HALTCNT","DEFAULT_DISPCNT","DEFAULT_SOUNDBIAS","DEFAULT_BGPA","DEFAULT_BGPD","DEFAULT_RCNT","Uint16Array","odd","readDisplayStat","vcount","sio","readSIOCNT","keypad","pollGamepads","currentDown","STUB_REG","writeDisplayControl","DISPSTAT_MASK","writeDisplayStat","writeBackgroundControl","writeBackgroundHOffset","writeBackgroundVOffset","writeBackgroundRefX","writeBackgroundRefY","writeBackgroundParamA","writeBackgroundParamB","writeBackgroundParamC","writeBackgroundParamD","writeWin0H","writeWin1H","writeWin0V","writeWin1V","writeWinIn","writeWinOut","writeBlendControl","writeBlendAlpha","writeBlendY","writeMosaic","writeSquareChannelSweep","writeSquareChannelDLE","writeSquareChannelFC","writeChannel3Lo","writeChannel3Hi","writeChannel3X","writeChannel4LE","writeChannel4FC","writeSoundControlLo","writeSoundControlHi","writeEnable","writeWaveData","setMode","writeRCNT","writeSIOCNT","appendToFifoA","appendToFifoB","GameBoyAdvanceAudio","masterVolume","SOUND_MAX","FIFO_MAX","PSG_MAX","AudioContext","webkitAudioContext","bufferSize","maxSamples","buffers","Float32Array","sampleMask","createScriptProcessor","jsAudio","createJavaScriptNode","audioProcess","audioProcessingEvent","left","outputBuffer","getChannelData","right","o","outputPointer","resampleRatio","samplePointer","backup","totalSamples","onaudioprocess","e","fifoA","fifoB","fifoASample","fifoBSample","disconnect","enableChannel3","enableChannel4","enableRightChannelA","enableLeftChannelA","enableRightChannelB","enableLeftChannelB","playingChannel3","playingChannel4","volumeLeft","volumeRight","ratioChannelA","ratioChannelB","enabledLeft","enabledRight","soundRatio","soundBias","squareChannels","playing","sample","duty","increment","initialVolume","volume","frequency","interval","sweepSteps","sweepIncrement","sweepInterval","doSweep","raise","lower","nextStep","timed","end","waveData","channel3Dimension","channel3Bank","channel3Volume","channel3Interval","channel3Next","channel3Length","channel3Timed","channel3End","channel3Pointer","channel3Sample","cpuFrequency","channel4","lfsr","nextSample","sampleRate","sampleInterval","pause","paused","connect","channel","Infinity","updateSquareChannel","channel3Write","updateEnvelope","masterVolumeLeft","masterVolumeRight","setSquareChannelEnabled","setChannel4Enabled","resetSquareChannel","channelId","nextSweep","writeChannelLE","resetChannel3","resetChannel4","sampleLeft","sampleRight","max","min","MemoryAligned16","GameBoyAdvanceVRAM","vram","GameBoyAdvanceOAM","oam","objs","GameBoyAdvanceOBJ","scalerot","GameBoyAdvancePalette","colors","adjustedColors","passthroughColors","blendY","TILE_OFFSET","doublesize","disable","mosaic","multipalette","shape","scalerotParam","hflip","vflip","tileBase","priority","palette","drawScanline","drawScanlineNormal","pushPixel","GameBoyAdvanceSoftwareRenderer","cachedWidth","cachedHeight","GameBoyAdvanceOBJLayer","bg","LAYER_OBJ","objwin","LAYER_BG0","LAYER_BG1","LAYER_BG2","LAYER_BG3","LAYER_BACKDROP","HORIZONTAL_PIXELS","VERTICAL_PIXELS","LAYER_MASK","BACKGROUND_MASK","TARGET2_MASK","TARGET1_MASK","OBJWIN_MASK","WRITTEN_MASK","PRIORITY_MASK","drawBackdrop","backing","layer","start","stencil","mix","blendB","accessColor","blendA","insert","set","overwrite","obj","wasScalerot","scalerotOam","recalcSize","drawScanlineAffine","adjustColor","convert16To32","input","g","aWeight","aColor","bWeight","bColor","ar","ag","ab","br","bb","makeDarkPalettes","layers","adjustColorDark","resetPalettes","resetPaletteLayers","makeBrightPalettes","adjustColorBright","makeNormalPalettes","makeSpecialPalette","makeNormalPalette","outPalette","inPalette","setBlendY","yOff","underflow","target2","blendMode","alphaEnabled","target1","localX","localY","totalWidth","mosaicX","tileOffset","localYLo","paletteShift","objCharacterMapping","objMosaicX","tileRow","accessTile","yDiff","totalHeight","drawWidth","objMosaicY","wrappedY","mosaicY","objComparator","objLayers","objwinLayer","backgroundMode","displayFrameSelect","hblankIntervalFree","forcedBlank","win0","win1","win0Left","win0Right","win1Left","win1Right","win0Top","win0Bottom","win1Top","win1Bottom","windows","special","bgMosaicX","bgMosaicY","lastHblank","nextHblank","HDRAW_LENGTH","nextHblankIRQ","nextVblankIRQ","nextVcounterIRQ","charBase","screenBase","refx","refy","dx","dmx","dy","dmy","drawScanlineBGMode0","bgModes","drawScanlineBGMode2","drawScanlineBGMode3","drawScanlineBGMode4","drawScanlineBGMode5","drawLayers","objwinActive","scanline","sharedColor","sharedMap","tile","SIZE_PALETTE","setBacking","pixelData","resetLayers","bgData","sort","layerComparator","writeWindow","setBlendEnabled","override","accessMapMode0","yBase","out","accessMapMode1","row","raw","oldStencil","blend","pixel","highPriority","identity","drawScanlineBlank","prepareScanline","localXLo","xOff","xMask","sizeAdjusted","firstStart","firstEnd","lastStart","lastEnd","finishScanline","bd","xx","isTarget2","startDraw","finishDraw","caller","GameBoyAdvanceVideo","CYCLES_PER_PIXEL","HBLANK_PIXELS","HBLANK_LENGTH","HORIZONTAL_LENGTH","VBLANK_PIXELS","VERTICAL_TOTAL_PIXELS","TOTAL_LENGTH","drawCallback","vblankCallback","inHblank","inVblank","vcounter","vcountSetting","encodeBase64","decodeBase64","GameBoyAdvanceKeypad","KEYCODE_LEFT","KEYCODE_UP","KEYCODE_RIGHT","KEYCODE_DOWN","KEYCODE_START","KEYCODE_SELECT","KEYCODE_A","KEYCODE_B","KEYCODE_L","KEYCODE_R","GAMEPAD_LEFT","GAMEPAD_UP","GAMEPAD_RIGHT","GAMEPAD_DOWN","GAMEPAD_START","GAMEPAD_SELECT","GAMEPAD_A","GAMEPAD_B","GAMEPAD_L","GAMEPAD_R","GAMEPAD_THRESHOLD","A","B","SELECT","START","RIGHT","LEFT","UP","DOWN","R","L","eatInput","gamepads","clickHandlerStart","toggle","clickedButton","clickHandlerEnd","keyboardHandler","keyCode","preventDefault","gamepadHandler","gamepad","buttons","gamepadConnectHandler","gamepadDisconnectHandler","self","filter","other","navigatorList","webkitGetGamepads","getGamepads","registerHandlers","addEventListener","bind","GameBoyAdvanceSIO","SIO_NORMAL_8","SIO_NORMAL_32","SIO_MULTI","SIO_UART","SIO_GPIO","SIO_JOYBUS","BAUD","sd","multiplayer","baud","si","busy","states","linkLayer","INFO","leading","usePrefix","string","toUpperCase","hex","setBaud","startMultiplayerTransfer","slot","GameBoyAdvance","LOG_ERROR","LOG_WARN","LOG_STUB","LOG_INFO","LOG_DEBUG","SYS_ID","logLevel","v","doStep","waitFrame","seenFrame","seenSave","lastVblank","queue","reportFPS","throttle","queueFrame","setTimeout","URL","webkitURL","setCanvas","offsetWidth","offsetHeight","indirectCanvas","targetCanvas","setCanvasDirect","targetContext","setBios","setRom","reset","retrieveSavedata","hasRom","loadRomFromFile","romFile","seen","clearTimeout","advanceFrame","storeSavedata","runStable","runFunc","frames","now","resume","exception","ERROR","logStackTrace","split","setSavedata","loadSavedataFromFile","storageRef","firebase","storage","ref","child","getDownloadURL","url","xhr","XMLHttpRequest","responseType","event","response","alert","open","send","decodeSavedata","atob","charCodeAt","triplet","wordstring","splice","btoa","downloadSavedata","put","snapshot","localStorage","level","message","setLogger","logger","warn","DEBUG","ASSERT_UNREACHED","err","THROTTLE_TO_STRING","16","12","8","4","NEXT_THROTTLE","commandToStr","parseInt","withStyles","screen","container","position","bottom","fullscreen","goFull","toogleSpeed","commands","requestFullscreen","mozRequestFullScreen","webkitRequestFullScreen","msRequestFullscreen","onClick","useStyle","maxWidth","margin","textShadow","paper","fontWeight","topPaper","GBAControlsHelper","Table","TableRow","TableCell","Paper","gba","WhiteCheckbox","checked","props","Checkbox","GBAScreen","isFull","dialogOpened","savedataFunction","initGBA","doc","docEl","documentElement","requestFullScreen","cancelFullScreen","exitFullscreen","mozCancelFullScreen","webkitExitFullscreen","msExitFullscreen","fullscreenElement","mozFullScreenElement","webkitFullscreenElement","msFullscreenElement","setState","installPrompt","matchMedia","matches","standalone","installButton","prompt","userChoice","outcome","runCommands","fadeOut","nextId","kill","getElementById","e2","removeSelf","parentElement","removeChild","dead","removeEventListener","hidden","removeAttribute","textContent","crash","screenWidth","clearRect","drawInterval","setInterval","xDiff","xFactor","yFactor","clearInterval","lcdFade","onclick","click","getAttribute","CrashImage","insertBefore","onblur","onfocus","Bios","soundbox","querySelector","file","run","files","togglePause","forEach","ontouchstart","ontouchend","isComposing","installApp","controls","noselect","button","accept","Dialog","onClose","aria-labelledby","DialogTitle","DialogContent","DialogContentText","TextField","autoFocus","label","fullWidth","DialogActions","Grid","spacing","item","xs","Slider","style","onChange","newValue","inputProps","React","Component","minHeight","fontFamily","BackgroundImage","marginBottom","imageRendering","borderTop","content","display","borderWidth","transform","transformOrigin","transition","fontSize","ReactDOM","render","store","path","exact","component","Page404","origin","fetch","contentType","headers","get","status","indexOf","ready","unregister","checkValidServiceWorker","module","exports"],"mappings":"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","file":"static/js/main.927d710d.chunk.js","sourcesContent":["import React from 'react';\r\nimport { Link } from 'react-router-dom';\r\nimport logo from './logo.svg';\r\nimport './App.css';\r\nimport Button from '@material-ui/core/Button';\r\nimport { styled } from '@material-ui/core/styles';\r\n\r\nconst MyButton = styled(Button)({\r\n  background: 'linear-gradient(45deg, #060508 30%, #805b9c 90%)',\r\n  border: 0,\r\n  borderRadius: 3,\r\n  boxShadow: '0 3px 5px 2px rgba(255, 105, 135, .3)',\r\n  color: 'white',\r\n  height: 48,\r\n  padding: '0 30px',\r\n  textTransform: 'none',\r\n});\r\n\r\nfunction App() {\r\n  return (\r\n    <div className=\"App\">\r\n      <header className=\"App-header\">\r\n        <img src={logo} className=\"App-logo\" alt=\"logo\" />\r\n        <p>\r\n        Inspired by the project <a href=\"https://github.com/endrift/gbajs\" target=\"_blank\">gbajs</a> which was descontinued.\r\n\r\n        This project intends to:\r\n          <ul>\r\n            <li>\r\n            Create a react component that can be used for playing GameBoy Advanced games in browser;\r\n            </li>\r\n            <li>\r\n            Refactor code from <a href=\"https://github.com/endrift/gbajs\" target=\"_blank\">gbajs</a>;\r\n            </li>\r\n            <li>\r\n            Include mobile gameplay support;\r\n            </li>\r\n            <li>\r\n            Develop a platform for playing GBA online.\r\n            </li>\r\n          </ul>\r\n        </p>\r\n        <p>          \r\n          <Link\r\n            to=\"/emulator\"\r\n            className=\"App-link\"\r\n          >\r\n            <MyButton variant=\"outlined\"> \r\n                Run Emulator\r\n            </MyButton>   \r\n          </Link>\r\n        </p>\r\n      </header>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default App;\r\n","import React from 'react';\r\nimport Typography from '@material-ui/core/Typography';\r\nimport { makeStyles, withTheme } from '@material-ui/styles';\r\nimport { Link } from 'react-router-dom';\r\nimport AlertIcon from '@material-ui/icons/ErrorOutline';\r\n\r\nconst useNonExistingPageStyle = makeStyles((theme) => ({\r\n  background: {\r\n    height: '100vh',\r\n    width: '100vw',\r\n    backgroundColor: '#aaf',\r\n    overflow: 'hidden',\r\n    textAlign: 'center',\r\n  },\r\n  alertIcon: {\r\n    width: '40vh',\r\n    height: '40vh',\r\n    marginTop: '5vh',\r\n    color: '#77f',\r\n  },\r\n  link: {\r\n    color: '#77f',\r\n    textDecorationColor: '#77f',\r\n    '&:visited, &:hover, &:active': {\r\n      color: '#55f',\r\n      textDecorationColor: '#55f',\r\n    },\r\n  },\r\n}));\r\n\r\nfunction Page404() {\r\n  const classes = useNonExistingPageStyle();\r\n\r\n  return (\r\n    <div className={classes.background}>\r\n      <AlertIcon className={classes.alertIcon} />\r\n      <Typography\r\n        variant=\"h2\"\r\n        color=\"primary\"\r\n      >\r\n        This page does not exist.\r\n      </Typography>\r\n      <br />\r\n      <Link to=\"/\" className={classes.link}>\r\n        Please follow to the main page.\r\n      </Link>\r\n    </div>\r\n  );\r\n}\r\n\r\nexport default withTheme(Page404);\r\n","// This optional code is used to register a service worker.\n// register() is not called by default.\n\n// This lets the app load faster on subsequent visits in production, and gives\n// it offline capabilities. However, it also means that developers (and users)\n// will only see deployed updates on subsequent visits to a page, after all the\n// existing tabs open on the page have been closed, since previously cached\n// resources are updated in the background.\n\n// To learn more about the benefits of this model and instructions on how to\n// opt-in, read https://bit.ly/CRA-PWA\n\nconst isLocalhost = Boolean(\n  window.location.hostname === 'localhost' ||\n    // [::1] is the IPv6 localhost address.\n    window.location.hostname === '[::1]' ||\n    // 127.0.0.1/8 is considered localhost for IPv4.\n    window.location.hostname.match(\n      /^127(?:\\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/\n    )\n);\n\nexport function register(config) {\n  if (process.env.NODE_ENV === 'production' && 'serviceWorker' in navigator) {\n    // The URL constructor is available in all browsers that support SW.\n    const publicUrl = new URL(process.env.PUBLIC_URL, window.location.href);\n    if (publicUrl.origin !== window.location.origin) {\n      // Our service worker won't work if PUBLIC_URL is on a different origin\n      // from what our page is served on. This might happen if a CDN is used to\n      // serve assets; see https://github.com/facebook/create-react-app/issues/2374\n      return;\n    }\n\n    window.addEventListener('load', () => {\n      const swUrl = `${process.env.PUBLIC_URL}/service-worker.js`;\n\n      if (isLocalhost) {\n        // This is running on localhost. Let's check if a service worker still exists or not.\n        checkValidServiceWorker(swUrl, config);\n\n        // Add some additional logging to localhost, pointing developers to the\n        // service worker/PWA documentation.\n        navigator.serviceWorker.ready.then(() => {\n          console.log(\n            'This web app is being served cache-first by a service ' +\n              'worker. To learn more, visit https://bit.ly/CRA-PWA'\n          );\n        });\n      } else {\n        // Is not localhost. Just register service worker\n        registerValidSW(swUrl, config);\n      }\n    });\n  }\n}\n\nfunction registerValidSW(swUrl, config) {\n  navigator.serviceWorker\n    .register(swUrl)\n    .then(registration => {\n      registration.onupdatefound = () => {\n        const installingWorker = registration.installing;\n        if (installingWorker == null) {\n          return;\n        }\n        installingWorker.onstatechange = () => {\n          if (installingWorker.state === 'installed') {\n            if (navigator.serviceWorker.controller) {\n              // At this point, the updated precached content has been fetched,\n              // but the previous service worker will still serve the older\n              // content until all client tabs are closed.\n              console.log(\n                'New content is available and will be used when all ' +\n                  'tabs for this page are closed. See https://bit.ly/CRA-PWA.'\n              );\n\n              // Execute callback\n              if (config && config.onUpdate) {\n                config.onUpdate(registration);\n              }\n            } else {\n              // At this point, everything has been precached.\n              // It's the perfect time to display a\n              // \"Content is cached for offline use.\" message.\n              console.log('Content is cached for offline use.');\n\n              // Execute callback\n              if (config && config.onSuccess) {\n                config.onSuccess(registration);\n              }\n            }\n          }\n        };\n      };\n    })\n    .catch(error => {\n      console.error('Error during service worker registration:', error);\n    });\n}\n\nfunction checkValidServiceWorker(swUrl, config) {\n  // Check if the service worker can be found. If it can't reload the page.\n  fetch(swUrl)\n    .then(response => {\n      // Ensure service worker exists, and that we really are getting a JS file.\n      const contentType = response.headers.get('content-type');\n      if (\n        response.status === 404 ||\n        (contentType != null && contentType.indexOf('javascript') === -1)\n      ) {\n        // No service worker found. Probably a different app. Reload the page.\n        navigator.serviceWorker.ready.then(registration => {\n          registration.unregister().then(() => {\n            window.location.reload();\n          });\n        });\n      } else {\n        // Service worker found. Proceed as normal.\n        registerValidSW(swUrl, config);\n      }\n    })\n    .catch(() => {\n      console.log(\n        'No internet connection found. App is running in offline mode.'\n      );\n    });\n}\n\nexport function unregister() {\n  if ('serviceWorker' in navigator) {\n    navigator.serviceWorker.ready.then(registration => {\n      registration.unregister();\n    });\n  }\n}\n","import { combineReducers } from 'redux';\r\n\r\nexport const Reducers = combineReducers({\r\n});\r\n","import { createStore } from 'redux';\r\nimport { Reducers } from '../reducers';\r\n\r\nexport const Store = createStore(Reducers);","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nconst ARMCoreArm = function (cpu) {\r\n\tthis.cpu = cpu;\r\n\r\n\tthis.addressingMode23Immediate = [\r\n\t\t// 000x0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] -= offset;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 000xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 00Ux0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] += offset;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 00UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 0P0x0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] - offset;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 0P0xW\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] - offset;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// 0PUx0\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] + offset;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// 0PUxW\r\n\t\tfunction(rn, offset, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + offset;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\t];\r\n\r\n\tthis.addressingMode23Register = [\r\n\t\t// I00x0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] -= gprs[rm];\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I00xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// I0Ux0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] += gprs[rm];\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I0UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IP0x0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\treturn gprs[rn] - gprs[rm];\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IP0xW\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] - gprs[rm];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IPUx0\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + gprs[rm];\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IPUxW\r\n\t\tfunction(rn, rm, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn] + gprs[rm];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull\r\n\t];\r\n\r\n\tthis.addressingMode2RegisterShifted = [\r\n\t\t// I00x0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tshiftOp();\r\n\t\t\t\t\tgprs[rn] -= cpu.shifterOperand;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// I00xW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// I0Ux0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tvar addr = gprs[rn];\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tshiftOp();\r\n\t\t\t\t\tgprs[rn] += cpu.shifterOperand;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\t\t// I0UxW\r\n\t\tnull,\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IP0x0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\treturn gprs[rn] - cpu.shifterOperand;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IP0xW\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\tvar addr = gprs[rn] - cpu.shifterOperand;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\r\n\t\t// IPUx0\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\treturn gprs[rn] + cpu.shifterOperand;\r\n\t\t\t};\r\n\t\t\taddress.writesPC = false;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\t// IPUxW\r\n\t\tfunction(rn, shiftOp, condOp) {\r\n\t\t\tvar gprs = cpu.gprs;\r\n\t\t\tvar address = function() {\r\n\t\t\t\tshiftOp();\r\n\t\t\t\tvar addr = gprs[rn] + cpu.shifterOperand;\r\n\t\t\t\tif (!condOp || condOp()) {\r\n\t\t\t\t\tgprs[rn] = addr;\r\n\t\t\t\t}\r\n\t\t\t\treturn addr;\r\n\t\t\t};\r\n\t\t\taddress.writePC = rn == cpu.PC;\r\n\t\t\treturn address;\r\n\t\t},\r\n\r\n\t\tnull,\r\n\t\tnull,\r\n\t];\r\n}\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ASR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal >> shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (shift - 1));\r\n\t\t} else if (gprs[rm] >> 31) {\r\n\t\t\tcpu.shifterOperand = 0xFFFFFFFF;\r\n\t\t\tcpu.shifterCarryOut = 0x80000000;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1Immediate = function(immediate) {\r\n\tvar cpu = this.cpu;\r\n\treturn function() {\r\n\t\tcpu.shifterOperand = immediate;\r\n\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ImmediateRotate = function(immediate, rotate) {\r\n\tvar cpu = this.cpu;\r\n\treturn function() {\r\n\t\tcpu.shifterOperand = (immediate >>> rotate) | (immediate << (32 - rotate));\r\n\t\tcpu.shifterCarryOut = cpu.shifterOperand >> 31;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1LSL = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal << shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (32 - shift));\r\n\t\t} else if (shift == 32) {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & 1;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1LSR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (shift < 32) {\r\n\t\t\tcpu.shifterOperand = shiftVal >>> shift;\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (shift - 1));\r\n\t\t} else if (shift == 32) {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = shiftVal >> 31;\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = 0;\r\n\t\t\tcpu.shifterCarryOut = 0;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode1ROR = function(rs, rm) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\t++cpu.cycles;\r\n\t\tvar shift = gprs[rs];\r\n\t\tif (rs == cpu.PC) {\r\n\t\t\tshift += 4;\r\n\t\t}\r\n\t\tshift &= 0xFF;\r\n\t\tvar shiftVal =  gprs[rm];\r\n\t\tif (rm == cpu.PC) {\r\n\t\t\tshiftVal += 4;\r\n\t\t}\r\n\t\tvar rotate = shift & 0x1F;\r\n\t\tif (shift == 0) {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\r\n\t\t} else if (rotate) {\r\n\t\t\tcpu.shifterOperand = (gprs[rm] >>> rotate) | (gprs[rm] << (32 - rotate));\r\n\t\t\tcpu.shifterCarryOut = shiftVal & (1 << (rotate - 1));\r\n\t\t} else {\r\n\t\t\tcpu.shifterOperand = shiftVal;\r\n\t\t\tcpu.shifterCarryOut = shiftVal >> 31;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode23Immediate = function(instruction, immediate, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode23Immediate[(instruction & 0x01A00000) >> 21](rn, immediate, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode23Register = function(instruction, rm, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode23Register[(instruction & 0x01A00000) >> 21](rn, rm, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode2RegisterShifted = function(instruction, shiftOp, condOp) {\r\n\tvar rn = (instruction & 0x000F0000) >> 16;\r\n\treturn this.addressingMode2RegisterShifted[(instruction & 0x01A00000) >> 21](rn, shiftOp, condOp);\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode4 = function(immediate, rn) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tvar addr = gprs[rn] + immediate;\r\n\t\treturn addr;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructAddressingMode4Writeback = function(immediate, offset, rn, overlap) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function(writeInitial) {\r\n\t\tvar addr = gprs[rn] + immediate;\r\n\t\tif (writeInitial && overlap) {\r\n\t\t\tcpu.mmu.store32(gprs[rn] + immediate - 4, gprs[rn]);\r\n\t\t}\r\n\t\tgprs[rn] += offset;\r\n\t\treturn addr;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructADC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !!cpu.cpsrC;\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) + shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !!cpu.cpsrC;\r\n\t\tvar d = (gprs[rn] >>> 0) + shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = d > 0xFFFFFFFF;\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) == (shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31) &&\r\n\t\t\t\t\t\t(shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADD = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructADDS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = d > 0xFFFFFFFF;\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) == (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructAND = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructANDS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructB = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tgprs[cpu.PC] += immediate;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBIC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & ~cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBICS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] & ~cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBL = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tgprs[cpu.LR] = gprs[cpu.PC] - 4;\r\n\t\tgprs[cpu.PC] += immediate;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructBX = function(rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tcpu.switchExecMode(gprs[rm] & 0x00000001);\r\n\t\tgprs[cpu.PC] = gprs[rm] & 0xFFFFFFFE;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructCMN = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = (gprs[rn] >>> 0) + (cpu.shifterOperand >>> 0);\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = aluOut > 0xFFFFFFFF;\r\n\t\tcpu.cpsrV = (gprs[rn] >> 31) == (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t(gprs[rn] >> 31) != (aluOut >> 31) &&\r\n\t\t\t\t\t(cpu.shifterOperand >> 31) != (aluOut >> 31);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructCMP = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] - cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (cpu.shifterOperand >>> 0);\r\n\t\tcpu.cpsrV = (gprs[rn] >> 31) != (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t(gprs[rn] >> 31) != (aluOut >> 31);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructEOR = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] ^ cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructEORS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] ^ cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDM = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address(false);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tgprs[i] = mmu.load32(addr & 0xFFFFFFFC);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDMS = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address(false);\r\n\t\tvar total = 0;\r\n\t\tvar mode = cpu.mode;\r\n\t\tcpu.switchMode(cpu.MODE_SYSTEM);\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tgprs[i] = mmu.load32(addr & 0xFFFFFFFC);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcpu.switchMode(mode);\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDR = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load32(addr);\r\n\t\tcpu.mmu.wait32(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.loadU8(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.loadU16(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRSB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load8(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructLDRSH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tgprs[rd] = cpu.mmu.load16(addr);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\t++cpu.cycles;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMLA = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tgprs[rd] = (hi + lo + gprs[rn]) & 0xFFFFFFFF;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs] + gprs[rn];\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMLAS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) & 0xFFFFFFFF;\r\n\t\t\tgprs[rd] = (hi + lo + gprs[rn]) & 0xFFFFFFFF;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs] + gprs[rn];\r\n\t\t}\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMOV = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMOVS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMRS = function(rd, r, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tif (r) {\r\n\t\t\tgprs[rd] = cpu.spsr;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = cpu.packCPSR();\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMSR = function(rm, r, instruction, immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar c = instruction & 0x00010000;\r\n\t//var x = instruction & 0x00020000;\r\n\t//var s = instruction & 0x00040000;\r\n\tvar f = instruction & 0x00080000;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar operand;\r\n\t\tif (instruction & 0x02000000) {\r\n\t\t\toperand = immediate;\r\n\t\t} else {\r\n\t\t\toperand = gprs[rm];\r\n\t\t}\r\n\t\tvar mask = (c ? 0x000000FF : 0x00000000) |\r\n\t\t\t\t   //(x ? 0x0000FF00 : 0x00000000) | // Irrelevant on ARMv4T\r\n\t\t\t\t   //(s ? 0x00FF0000 : 0x00000000) | // Irrelevant on ARMv4T\r\n\t\t\t\t   (f ? 0xFF000000 : 0x00000000);\r\n\r\n\t\tif (r) {\r\n\t\t\tmask &= cpu.USER_MASK | cpu.PRIV_MASK | cpu.STATE_MASK;\r\n\t\t\tcpu.spsr = (cpu.spsr & ~mask) | (operand & mask);\r\n\t\t} else {\r\n\t\t\tif (mask & cpu.USER_MASK) {\r\n\t\t\t\tcpu.cpsrN = operand >> 31;\r\n\t\t\t\tcpu.cpsrZ = operand & 0x40000000;\r\n\t\t\t\tcpu.cpsrC = operand & 0x20000000;\r\n\t\t\t\tcpu.cpsrV = operand & 0x10000000;\r\n\t\t\t}\r\n\t\t\tif (cpu.mode != cpu.MODE_USER && (mask & cpu.PRIV_MASK)) {\r\n\t\t\t\tcpu.switchMode((operand & 0x0000000F) | 0x00000010);\r\n\t\t\t\tcpu.cpsrI = operand & 0x00000080;\r\n\t\t\t\tcpu.cpsrF = operand & 0x00000040;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMUL = function(rd, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) | 0;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) | 0;\r\n\t\t\tgprs[rd] = hi + lo;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs];\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMULS = function(rd, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rs] & 0xFFFF0000)) {\r\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\r\n\t\t\tvar hi = ((gprs[rm] & 0xFFFF0000) * gprs[rs]) | 0;\r\n\t\t\tvar lo = ((gprs[rm] & 0x0000FFFF) * gprs[rs]) | 0;\r\n\t\t\tgprs[rd] = hi + lo;\r\n\t\t} else {\r\n\t\t\tgprs[rd] = gprs[rm] * gprs[rs];\r\n\t\t}\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMVN = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = ~cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructMVNS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = ~cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructORR = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] | cpu.shifterOperand;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructORRS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] | cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t\t}\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSB = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = cpu.shifterOperand - gprs[rn];\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSBS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = cpu.shifterOperand - gprs[rn];\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (cpu.shifterOperand >>> 0) >= (gprs[rn] >>> 0);\r\n\t\t\tcpu.cpsrV = (cpu.shifterOperand >> 31) != (gprs[rn] >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar n = (gprs[rn] >>> 0) + !cpu.cpsrC;\r\n\t\tgprs[rd] = (cpu.shifterOperand >>> 0) - n;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructRSCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar n = (gprs[rn] >>> 0) + !cpu.cpsrC;\r\n\t\tvar d = (cpu.shifterOperand >>> 0) - n;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (cpu.shifterOperand >>> 0) >= (d >>> 0);\r\n\t\t\tcpu.cpsrV = (cpu.shifterOperand >> 31) != (n >> 31) &&\r\n\t\t\t\t\t\t(cpu.shifterOperand >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSBC = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !cpu.cpsrC;\r\n\t\tgprs[rd] = (gprs[rn] >>> 0) - shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSBCS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar shifterOperand = (cpu.shifterOperand >>> 0) + !cpu.cpsrC;\r\n\t\tvar d = (gprs[rn] >>> 0) - shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (d >>> 0);\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) != (shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMLAL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = (gprs[rm] & 0xFFFF0000) * gprs[rs];\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * gprs[rs];\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += Math.floor(carry * SHIFT_32);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMLALS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = (gprs[rm] & 0xFFFF0000) * gprs[rs];\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * gprs[rs];\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += Math.floor(carry * SHIFT_32);\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMULL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >> 0) * (gprs[rs] >> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >> 0) * (gprs[rs] >> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = Math.floor(hi * SHIFT_32 + lo * SHIFT_32);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSMULLS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >> 0) * (gprs[rs] >> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >> 0) * (gprs[rs] >> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = Math.floor(hi * SHIFT_32 + lo * SHIFT_32);\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTM = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmmu.wait32(gprs[cpu.PC]);\r\n\t\tvar addr = address(true);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tmmu.store32(addr, gprs[i]);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTMS = function(rs, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\tvar mmu = cpu.mmu;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tmmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tmmu.wait32(gprs[cpu.PC]);\r\n\t\tvar mode = cpu.mode;\r\n\t\tvar addr = address(true);\r\n\t\tvar total = 0;\r\n\t\tvar m, i;\r\n\t\tcpu.switchMode(cpu.MODE_SYSTEM);\r\n\t\tfor (m = rs, i = 0; m; m >>= 1, ++i) {\r\n\t\t\tif (m & 1) {\r\n\t\t\t\tmmu.store32(addr, gprs[i]);\r\n\t\t\t\taddr += 4;\r\n\t\t\t\t++total;\r\n\t\t\t}\r\n\t\t}\r\n\t\tcpu.switchMode(mode);\r\n\t\tmmu.waitMulti32(addr, total);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTR = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store32(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait32(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTRB = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store8(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSTRH = function(rd, address, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tvar addr = address();\r\n\t\tcpu.mmu.store16(addr, gprs[rd]);\r\n\t\tcpu.mmu.wait(addr);\r\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSUB = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tgprs[rd] = gprs[rn] - cpu.shifterOperand;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSUBS = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar d = gprs[rn] - cpu.shifterOperand;\r\n\t\tif (rd == cpu.PC && cpu.hasSPSR()) {\r\n\t\t\tcpu.unpackCPSR(cpu.spsr);\r\n\t\t} else {\r\n\t\t\tcpu.cpsrN = d >> 31;\r\n\t\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\r\n\t\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (cpu.shifterOperand >>> 0);\r\n\t\t\tcpu.cpsrV = (gprs[rn] >> 31) != (cpu.shifterOperand >> 31) &&\r\n\t\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\r\n\t\t}\r\n\t\tgprs[rd] = d;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSWI = function(immediate, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.irq.swi32(immediate);\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructSWP = function(rd, rn, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.wait32(gprs[rn]);\r\n\t\tcpu.mmu.wait32(gprs[rn]);\r\n\t\tvar d = cpu.mmu.load32(gprs[rn]);\r\n\t\tcpu.mmu.store32(gprs[rn], gprs[rm]);\r\n\t\tgprs[rd] = d;\r\n\t\t++cpu.cycles;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructSWPB = function(rd, rn, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.mmu.wait(gprs[rn]);\r\n\t\tcpu.mmu.wait(gprs[rn]);\r\n\t\tvar d = cpu.mmu.load8(gprs[rn]);\r\n\t\tcpu.mmu.store8(gprs[rn], gprs[rm]);\r\n\t\tgprs[rd] = d;\r\n\t\t++cpu.cycles;\r\n\t}\r\n};\r\n\r\nARMCoreArm.prototype.constructTEQ = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] ^ cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructTST = function(rd, rn, shiftOp, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tshiftOp();\r\n\t\tvar aluOut = gprs[rn] & cpu.shifterOperand;\r\n\t\tcpu.cpsrN = aluOut >> 31;\r\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\r\n\t\tcpu.cpsrC = cpu.shifterCarryOut;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMLAL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * (gprs[rs] >>> 0);\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += carry * SHIFT_32;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMLALS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcpu.cycles += 2;\r\n\t\tcpu.mmu.waitMul(rs);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = (gprs[rm] & 0x0000FFFF) * (gprs[rs] >>> 0);\r\n\t\tvar carry = (gprs[rn] >>> 0) + hi + lo;\r\n\t\tgprs[rn] = carry;\r\n\t\tgprs[rd] += carry * SHIFT_32;\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMULL = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = (hi * SHIFT_32 + lo * SHIFT_32) >>> 0;\r\n\t};\r\n};\r\n\r\nARMCoreArm.prototype.constructUMULLS = function(rd, rn, rs, rm, condOp) {\r\n\tvar cpu = this.cpu;\r\n\tvar SHIFT_32 = 1/0x100000000;\r\n\tvar gprs = cpu.gprs;\r\n\treturn function() {\r\n\t\tcpu.mmu.waitPrefetch32(gprs[cpu.PC]);\r\n\t\tif (condOp && !condOp()) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t++cpu.cycles;\r\n\t\tcpu.mmu.waitMul(gprs[rs]);\r\n\t\tvar hi = ((gprs[rm] & 0xFFFF0000) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tvar lo = ((gprs[rm] & 0x0000FFFF) >>> 0) * (gprs[rs] >>> 0);\r\n\t\tgprs[rn] = ((hi & 0xFFFFFFFF) + (lo & 0xFFFFFFFF)) & 0xFFFFFFFF;\r\n\t\tgprs[rd] = (hi * SHIFT_32 + lo * SHIFT_32) >>> 0;\r\n\t\tcpu.cpsrN = gprs[rd] >> 31;\r\n\t\tcpu.cpsrZ = !((gprs[rd] & 0xFFFFFFFF) || (gprs[rn] & 0xFFFFFFFF));\r\n\t};\r\n};\r\n\r\nexport default ARMCoreArm;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nconst ARMCoreThumb = function (cpu) {\n\tthis.cpu = cpu;\n};\n\nARMCoreThumb.prototype.constructADC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar m = (gprs[rm] >>> 0) + !!cpu.cpsrC;\n\t\tvar oldD = gprs[rd];\n\t\tvar d = (oldD >>> 0) + m;\n\t\tvar oldDn = oldD >> 31;\n\t\tvar dn = d >> 31;\n\t\tvar mn = m >> 31;\n\t\tcpu.cpsrN = dn;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = oldDn == mn && oldDn != dn && mn != dn;\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !(gprs[rn] >> 31) && ((gprs[rn] >> 31 ^ d) >> 31) && (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD2 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !(gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31) && ((immediate ^ d) >> 31);\n\t\tgprs[rn] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD3 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = (gprs[rn] >>> 0) + (gprs[rm] >>> 0);\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = d > 0xFFFFFFFF;\n\t\tcpu.cpsrV = !((gprs[rn] ^ gprs[rm]) >> 31) && ((gprs[rn] ^ d) >> 31) && ((gprs[rm] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD4 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] += gprs[rm];\n\t};\n};\n\nARMCoreThumb.prototype.constructADD5 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = (gprs[cpu.PC] & 0xFFFFFFFC) + immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD6 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[cpu.SP] + immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructADD7 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.SP] += immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructAND = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] & gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructASR1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tcpu.cpsrC = gprs[rm] >> 31;\n\t\t\tif (cpu.cpsrC) {\n\t\t\t\tgprs[rd] = 0xFFFFFFFF;\n\t\t\t} else {\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (immediate - 1));\n\t\t\tgprs[rd] = gprs[rm] >> immediate;\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructASR2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (rs - 1));\n\t\t\t\tgprs[rd] >>= rs;\n\t\t\t} else {\n\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t\tif (cpu.cpsrC) {\n\t\t\t\t\tgprs[rd] = 0xFFFFFFFF;\n\t\t\t\t} else {\n\t\t\t\t\tgprs[rd] = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructB1 = function(immediate, condOp) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (condOp()) {\n\t\t\tgprs[cpu.PC] += immediate;\n\t\t}\n\t};\n};\n\nARMCoreThumb.prototype.constructB2 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.PC] += immediate;\n\t};\n};\n\nARMCoreThumb.prototype.constructBIC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] & ~gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructBL1 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[cpu.LR] = gprs[cpu.PC] + immediate;\n\t}\n};\n\nARMCoreThumb.prototype.constructBL2 = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar pc = gprs[cpu.PC];\n\t\tgprs[cpu.PC] = gprs[cpu.LR] + (immediate << 1);\n\t\tgprs[cpu.LR] = pc - 1;\n\t}\n};\n\nARMCoreThumb.prototype.constructBX = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tcpu.switchExecMode(gprs[rm] & 0x00000001);\n\t\tvar misalign = 0;\n\t\tif (rm == 15) {\n\t\t\tmisalign = gprs[rm] & 0x00000002;\n\t\t}\n\t\tgprs[cpu.PC] = gprs[rm] & 0xFFFFFFFE - misalign;\n\t};\n};\n\nARMCoreThumb.prototype.constructCMN = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = (gprs[rd] >>> 0) + (gprs[rm] >>> 0);\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = aluOut > 0xFFFFFFFF;\n\t\tcpu.cpsrV = (gprs[rd] >> 31) == (gprs[rm] >> 31) &&\n\t\t\t\t\t(gprs[rd] >> 31) != (aluOut >> 31) &&\n\t\t\t\t\t(gprs[rm] >> 31) != (aluOut >> 31);\n\t};\n};\n\nARMCoreThumb.prototype.constructCMP1 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rn] - immediate;\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ aluOut) >> 31);\n\t};\n}\n\nARMCoreThumb.prototype.constructCMP2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rd];\n\t\tvar m = gprs[rm];\n\t\tvar aluOut = d - m;\n\t\tvar an = aluOut >> 31;\n\t\tvar dn = d >> 31;\n\t\tcpu.cpsrN = an;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (d >>> 0) >= (m >>> 0);\n\t\tcpu.cpsrV = dn != (m >> 31) && dn != an;\n\t};\n};\n\nARMCoreThumb.prototype.constructCMP3 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rd] - gprs[rm];\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rd] >>> 0) >= (gprs[rm] >>> 0);\n\t\tcpu.cpsrV = ((gprs[rd] ^ gprs[rm]) >> 31) && ((gprs[rd] ^ aluOut) >> 31);\n\t};\n};\n\nARMCoreThumb.prototype.constructEOR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] ^ gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLDMIA = function(rn, rs) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar address = gprs[rn];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tgprs[i] = cpu.mmu.load32(address);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tif (!((1 << rn) & rs)) {\n\t\t\tgprs[rn] = address;\n\t\t}\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar n = gprs[rn] + immediate;\n\t\tgprs[rd] = cpu.mmu.load32(n);\n\t\tcpu.mmu.wait32(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait32(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t}\n};\n\nARMCoreThumb.prototype.constructLDR3 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32((gprs[cpu.PC] & 0xFFFFFFFC) + immediate);\n\t\tcpu.mmu.wait32(gprs[cpu.PC]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDR4 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load32(gprs[cpu.SP] + immediate);\n\t\tcpu.mmu.wait32(gprs[cpu.SP] + immediate);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU8(n);\n\t\tcpu.mmu.wait(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRB2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU8(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRH1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU16(n);\n\t\tcpu.mmu.wait(n);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRH2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.loadU16(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRSB = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load8(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLDRSH = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = cpu.mmu.load16(gprs[rn] + gprs[rm]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t\t++cpu.cycles;\n\t};\n};\n\nARMCoreThumb.prototype.constructLSL1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tgprs[rd] = gprs[rm];\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (32 - immediate));\n\t\t\tgprs[rd] = gprs[rm] << immediate;\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLSL2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (32 - rs));\n\t\t\t\tgprs[rd] <<= rs;\n\t\t\t} else {\n\t\t\t\tif (rs > 32) {\n\t\t\t\t\tcpu.cpsrC = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.cpsrC = gprs[rd] & 0x00000001;\n\t\t\t\t}\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructLSR1 = function(rd, rm, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (immediate == 0) {\n\t\t\tcpu.cpsrC = gprs[rm] >> 31;\n\t\t\tgprs[rd] = 0;\n\t\t} else {\n\t\t\tcpu.cpsrC = gprs[rm] & (1 << (immediate - 1));\n\t\t\tgprs[rd] = gprs[rm] >>> immediate;\n\t\t}\n\t\tcpu.cpsrN = 0;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n}\n\nARMCoreThumb.prototype.constructLSR2 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tif (rs < 32) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (rs - 1));\n\t\t\t\tgprs[rd] >>>= rs;\n\t\t\t} else {\n\t\t\t\tif (rs > 32) {\n\t\t\t\t\tcpu.cpsrC = 0;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t\t}\n\t\t\t\tgprs[rd] = 0;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV1 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rn] = immediate;\n\t\tcpu.cpsrN = immediate >> 31;\n\t\tcpu.cpsrZ = !(immediate & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = 0;\n\t\tcpu.cpsrV = 0;\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructMOV3 = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rm];\n\t};\n};\n\nARMCoreThumb.prototype.constructMUL = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tcpu.mmu.waitMul(gprs[rm]);\n\t\tif ((gprs[rm] & 0xFFFF0000) && (gprs[rd] & 0xFFFF0000)) {\n\t\t\t// Our data type is a double--we'll lose bits if we do it all at once!\n\t\t\tvar hi = ((gprs[rd] & 0xFFFF0000) * gprs[rm]) & 0xFFFFFFFF;\n\t\t\tvar lo = ((gprs[rd] & 0x0000FFFF) * gprs[rm]) & 0xFFFFFFFF;\n\t\t\tgprs[rd] = (hi + lo) & 0xFFFFFFFF;\n\t\t} else {\n\t\t\tgprs[rd] *= gprs[rm];\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructMVN = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = ~gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructNEG = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = -gprs[rm];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = 0 >= (d >>> 0);\n\t\tcpu.cpsrV = (gprs[rm] >> 31) && (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructORR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tgprs[rd] = gprs[rd] | gprs[rm];\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructPOP = function(rs, r) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\t++cpu.cycles;\n\t\tvar address = gprs[cpu.SP];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.waitSeq32(address);\n\t\t\t\tgprs[i] = cpu.mmu.load32(address);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tif (r) {\n\t\t\tgprs[cpu.PC] = cpu.mmu.load32(address) & 0xFFFFFFFE;\n\t\t\taddress += 4;\n\t\t\t++total;\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[cpu.SP] = address;\n\t};\n};\n\nARMCoreThumb.prototype.constructPUSH = function(rs, r) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar address = gprs[cpu.SP] - 4;\n\t\tvar total = 0;\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tif (r) {\n\t\t\tcpu.mmu.store32(address, gprs[cpu.LR]);\n\t\t\taddress -= 4;\n\t\t\t++total;\n\t\t}\n\t\tvar m, i;\n\t\tfor (m = 0x80, i = 7; m; m >>= 1, --i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress -= 4;\n\t\t\t\t++total;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (m >>= 1, --i; m; m >>= 1, --i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress -= 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[cpu.SP] = address + 4;\n\t};\n};\n\nARMCoreThumb.prototype.constructROR = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar rs = gprs[rm] & 0xFF;\n\t\tif (rs) {\n\t\t\tvar r4 = rs & 0x1F;\n\t\t\tif (r4 > 0) {\n\t\t\t\tcpu.cpsrC = gprs[rd] & (1 << (r4 - 1));\n\t\t\t\tgprs[rd] = (gprs[rd] >>> r4) | (gprs[rd] << (32 - r4));\n\t\t\t} else {\n\t\t\t\tcpu.cpsrC = gprs[rd] >> 31;\n\t\t\t}\n\t\t}\n\t\tcpu.cpsrN = gprs[rd] >> 31;\n\t\tcpu.cpsrZ = !(gprs[rd] & 0xFFFFFFFF);\n\t};\n};\n\nARMCoreThumb.prototype.constructSBC = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar m = (gprs[rm] >>> 0) + !cpu.cpsrC;\n\t\tvar d = (gprs[rd] >>> 0) - m;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rd] >>> 0) >= (d >>> 0);\n\t\tcpu.cpsrV = ((gprs[rd] ^ m) >> 31) && ((gprs[rd] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSTMIA = function(rn, rs) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tvar address = gprs[rn];\n\t\tvar total = 0;\n\t\tvar m, i;\n\t\tfor (m = 0x01, i = 0; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfor (m <<= 1, ++i; i < 8; m <<= 1, ++i) {\n\t\t\tif (rs & m) {\n\t\t\t\tcpu.mmu.store32(address, gprs[i]);\n\t\t\t\taddress += 4;\n\t\t\t\t++total;\n\t\t\t}\n\t\t}\n\t\tcpu.mmu.waitMulti32(address, total);\n\t\tgprs[rn] = address;\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store32(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store32(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(gprs[rn] + gprs[rm]);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTR3 = function(rd, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store32(gprs[cpu.SP] + immediate, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait32(gprs[cpu.SP] + immediate);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store8(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRB2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store8(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t}\n};\n\nARMCoreThumb.prototype.constructSTRH1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tvar n = gprs[rn] + immediate;\n\t\tcpu.mmu.store16(n, gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(n);\n\t};\n};\n\nARMCoreThumb.prototype.constructSTRH2 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.store16(gprs[rn] + gprs[rm], gprs[rd]);\n\t\tcpu.mmu.wait(gprs[cpu.PC]);\n\t\tcpu.mmu.wait(gprs[rn] + gprs[rm]);\n\t}\n};\n\nARMCoreThumb.prototype.constructSUB1 = function(rd, rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31);\n\t\tgprs[rd] = d;\n\t};\n}\n\nARMCoreThumb.prototype.constructSUB2 = function(rn, immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - immediate;\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= immediate;\n\t\tcpu.cpsrV = (gprs[rn] >> 31) && ((gprs[rn] ^ d) >> 31);\n\t\tgprs[rn] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSUB3 = function(rd, rn, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar d = gprs[rn] - gprs[rm];\n\t\tcpu.cpsrN = d >> 31;\n\t\tcpu.cpsrZ = !(d & 0xFFFFFFFF);\n\t\tcpu.cpsrC = (gprs[rn] >>> 0) >= (gprs[rm] >>> 0);\n\t\tcpu.cpsrV = (gprs[rn] >> 31) != (gprs[rm] >> 31) &&\n\t\t\t\t\t(gprs[rn] >> 31) != (d >> 31);\n\t\tgprs[rd] = d;\n\t};\n};\n\nARMCoreThumb.prototype.constructSWI = function(immediate) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.irq.swi(immediate);\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t}\n};\n\nARMCoreThumb.prototype.constructTST = function(rd, rm) {\n\tvar cpu = this.cpu;\n\tvar gprs = cpu.gprs;\n\treturn function() {\n\t\tcpu.mmu.waitPrefetch(gprs[cpu.PC]);\n\t\tvar aluOut = gprs[rd] & gprs[rm];\n\t\tcpu.cpsrN = aluOut >> 31;\n\t\tcpu.cpsrZ = !(aluOut & 0xFFFFFFFF);\n\t};\n};\n\nexport default ARMCoreThumb;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport ARMCoreArm from './arm';\nimport ARMCoreThumb from './thumb';\n\nfunction ARMCore() {\n\tthis.inherit();\n\tthis.SP = 13;\n\tthis.LR = 14;\n\tthis.PC = 15;\n\n\tthis.MODE_ARM = 0;\n\tthis.MODE_THUMB = 1;\n\n\tthis.MODE_USER = 0x10;\n\tthis.MODE_FIQ = 0x11;\n\tthis.MODE_IRQ = 0x12;\n\tthis.MODE_SUPERVISOR = 0x13;\n\tthis.MODE_ABORT = 0x17;\n\tthis.MODE_UNDEFINED = 0x1B;\n\tthis.MODE_SYSTEM = 0x1F;\n\n\tthis.BANK_NONE = 0\n\tthis.BANK_FIQ = 1;\n\tthis.BANK_IRQ = 2;\n\tthis.BANK_SUPERVISOR = 3;\n\tthis.BANK_ABORT = 4;\n\tthis.BANK_UNDEFINED = 5;\n\n\tthis.UNALLOC_MASK = 0x0FFFFF00;\n\tthis.USER_MASK = 0xF0000000;\n\tthis.PRIV_MASK = 0x000000CF; // This is out of spec, but it seems to be what's done in other implementations\n\tthis.STATE_MASK = 0x00000020;\n\n\tthis.WORD_SIZE_ARM = 4;\n\tthis.WORD_SIZE_THUMB = 2;\n\n\tthis.BASE_RESET = 0x00000000;\n\tthis.BASE_UNDEF = 0x00000004;\n\tthis.BASE_SWI = 0x00000008;\n\tthis.BASE_PABT = 0x0000000C;\n\tthis.BASE_DABT = 0x00000010;\n\tthis.BASE_IRQ = 0x00000018;\n\tthis.BASE_FIQ = 0x0000001C;\n\n\tthis.armCompiler = new ARMCoreArm(this);\n\tthis.thumbCompiler = new ARMCoreThumb(this);\n\tthis.generateConds();\n\n\tthis.gprs = new Int32Array(16);\n};\n\nARMCore.prototype.resetCPU = function(startOffset) {\n\tfor (var i = 0; i < this.PC; ++i) {\n\t\tthis.gprs[i] = 0;\n\t}\n\tthis.gprs[this.PC] = startOffset + this.WORD_SIZE_ARM;\n\n\tthis.loadInstruction = this.loadInstructionArm;\n\tthis.execMode = this.MODE_ARM;\n\tthis.instructionWidth = this.WORD_SIZE_ARM;\n\n\tthis.mode = this.MODE_SYSTEM;\n\n\tthis.cpsrI = false;\n\tthis.cpsrF = false;\n\n\tthis.cpsrV = false;\n\tthis.cpsrC = false;\n\tthis.cpsrZ = false;\n\tthis.cpsrN = false;\n\n\tthis.bankedRegisters = [\n\t\tnew Int32Array(7),\n\t\tnew Int32Array(7),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2),\n\t\tnew Int32Array(2)\n\t];\n\tthis.spsr = 0;\n\tthis.bankedSPSRs = new Int32Array(6);\n\n\tthis.cycles = 0;\n\n\tthis.shifterOperand = 0;\n\tthis.shifterCarryOut = 0;\n\n\tthis.page = null;\n\tthis.pageId = 0;\n\tthis.pageRegion = -1;\n\n\tthis.instruction = null;\n\n\tthis.irq.clear();\n\n\tvar gprs = this.gprs;\n\tvar mmu = this.mmu;\n\tthis.step = function() {\n\t\tvar instruction = this.instruction || (this.instruction = this.loadInstruction(gprs[this.PC] - this.instructionWidth));\n\t\tgprs[this.PC] += this.instructionWidth;\n\t\tthis.conditionPassed = true;\n\t\tinstruction();\n\n\t\tif (!instruction.writesPC) {\n\t\t\tif (this.instruction != null) { // We might have gotten an interrupt from the instruction\n\t\t\t\tif (instruction.next == null || instruction.next.page.invalid) {\n\t\t\t\t\tinstruction.next = this.loadInstruction(gprs[this.PC] - this.instructionWidth);\n\t\t\t\t}\n\t\t\t\tthis.instruction = instruction.next;\n\t\t\t}\n\t\t} else {\n\t\t\tif (this.conditionPassed) {\n\t\t\t\tvar pc = gprs[this.PC] &= 0xFFFFFFFE;\n\t\t\t\tif (this.execMode == this.MODE_ARM) {\n\t\t\t\t\tmmu.wait32(pc);\n\t\t\t\t\tmmu.waitPrefetch32(pc);\n\t\t\t\t} else {\n\t\t\t\t\tmmu.wait(pc);\n\t\t\t\t\tmmu.waitPrefetch(pc);\n\t\t\t\t}\n\t\t\t\tgprs[this.PC] += this.instructionWidth;\n\t\t\t\tif (!instruction.fixedJump) {\n\t\t\t\t\tthis.instruction = null;\n\t\t\t\t} else if  (this.instruction != null) {\n\t\t\t\t\tif (instruction.next == null || instruction.next.page.invalid) {\n\t\t\t\t\t\tinstruction.next = this.loadInstruction(gprs[this.PC] - this.instructionWidth);\n\t\t\t\t\t}\n\t\t\t\t\tthis.instruction = instruction.next;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tthis.instruction = null;\n\t\t\t}\n\t\t}\n\t\tthis.irq.updateTimers();\n\t};\n};\n\nARMCore.prototype.freeze = function() {\n\treturn {\n\t\t'gprs': [\n\t\t\tthis.gprs[0],\n\t\t\tthis.gprs[1],\n\t\t\tthis.gprs[2],\n\t\t\tthis.gprs[3],\n\t\t\tthis.gprs[4],\n\t\t\tthis.gprs[5],\n\t\t\tthis.gprs[6],\n\t\t\tthis.gprs[7],\n\t\t\tthis.gprs[8],\n\t\t\tthis.gprs[9],\n\t\t\tthis.gprs[10],\n\t\t\tthis.gprs[11],\n\t\t\tthis.gprs[12],\n\t\t\tthis.gprs[13],\n\t\t\tthis.gprs[14],\n\t\t\tthis.gprs[15],\n\t\t],\n\t\t'mode': this.mode,\n\t\t'cpsrI': this.cpsrI,\n\t\t'cpsrF': this.cpsrF,\n\t\t'cpsrV': this.cpsrV,\n\t\t'cpsrC': this.cpsrC,\n\t\t'cpsrZ': this.cpsrZ,\n\t\t'cpsrN': this.cpsrN,\n\t\t'bankedRegisters': [\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[0][0],\n\t\t\t\tthis.bankedRegisters[0][1],\n\t\t\t\tthis.bankedRegisters[0][2],\n\t\t\t\tthis.bankedRegisters[0][3],\n\t\t\t\tthis.bankedRegisters[0][4],\n\t\t\t\tthis.bankedRegisters[0][5],\n\t\t\t\tthis.bankedRegisters[0][6]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[1][0],\n\t\t\t\tthis.bankedRegisters[1][1],\n\t\t\t\tthis.bankedRegisters[1][2],\n\t\t\t\tthis.bankedRegisters[1][3],\n\t\t\t\tthis.bankedRegisters[1][4],\n\t\t\t\tthis.bankedRegisters[1][5],\n\t\t\t\tthis.bankedRegisters[1][6]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[2][0],\n\t\t\t\tthis.bankedRegisters[2][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[3][0],\n\t\t\t\tthis.bankedRegisters[3][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[4][0],\n\t\t\t\tthis.bankedRegisters[4][1]\n\t\t\t],\n\t\t\t[\n\t\t\t\tthis.bankedRegisters[5][0],\n\t\t\t\tthis.bankedRegisters[5][1]\n\t\t\t]\n\t\t],\n\t\t'spsr': this.spsr,\n\t\t'bankedSPSRs': [\n\t\t\tthis.bankedSPSRs[0],\n\t\t\tthis.bankedSPSRs[1],\n\t\t\tthis.bankedSPSRs[2],\n\t\t\tthis.bankedSPSRs[3],\n\t\t\tthis.bankedSPSRs[4],\n\t\t\tthis.bankedSPSRs[5]\n\t\t],\n\t\t'cycles': this.cycles\n\t};\n};\n\nARMCore.prototype.defrost = function(frost) {\n\tthis.instruction = null;\n\n\tthis.page = null;\n\tthis.pageId = 0;\n\tthis.pageRegion = -1;\n\n\tthis.gprs[0] = frost.gprs[0];\n\tthis.gprs[1] = frost.gprs[1];\n\tthis.gprs[2] = frost.gprs[2];\n\tthis.gprs[3] = frost.gprs[3];\n\tthis.gprs[4] = frost.gprs[4];\n\tthis.gprs[5] = frost.gprs[5];\n\tthis.gprs[6] = frost.gprs[6];\n\tthis.gprs[7] = frost.gprs[7];\n\tthis.gprs[8] = frost.gprs[8];\n\tthis.gprs[9] = frost.gprs[9];\n\tthis.gprs[10] = frost.gprs[10];\n\tthis.gprs[11] = frost.gprs[11];\n\tthis.gprs[12] = frost.gprs[12];\n\tthis.gprs[13] = frost.gprs[13];\n\tthis.gprs[14] = frost.gprs[14];\n\tthis.gprs[15] = frost.gprs[15];\n\n\tthis.mode = frost.mode;\n\tthis.cpsrI = frost.cpsrI;\n\tthis.cpsrF = frost.cpsrF;\n\tthis.cpsrV = frost.cpsrV;\n\tthis.cpsrC = frost.cpsrC;\n\tthis.cpsrZ = frost.cpsrZ;\n\tthis.cpsrN = frost.cpsrN;\n\n\tthis.bankedRegisters[0][0] = frost.bankedRegisters[0][0];\n\tthis.bankedRegisters[0][1] = frost.bankedRegisters[0][1];\n\tthis.bankedRegisters[0][2] = frost.bankedRegisters[0][2];\n\tthis.bankedRegisters[0][3] = frost.bankedRegisters[0][3];\n\tthis.bankedRegisters[0][4] = frost.bankedRegisters[0][4];\n\tthis.bankedRegisters[0][5] = frost.bankedRegisters[0][5];\n\tthis.bankedRegisters[0][6] = frost.bankedRegisters[0][6];\n\n\tthis.bankedRegisters[1][0] = frost.bankedRegisters[1][0];\n\tthis.bankedRegisters[1][1] = frost.bankedRegisters[1][1];\n\tthis.bankedRegisters[1][2] = frost.bankedRegisters[1][2];\n\tthis.bankedRegisters[1][3] = frost.bankedRegisters[1][3];\n\tthis.bankedRegisters[1][4] = frost.bankedRegisters[1][4];\n\tthis.bankedRegisters[1][5] = frost.bankedRegisters[1][5];\n\tthis.bankedRegisters[1][6] = frost.bankedRegisters[1][6];\n\n\tthis.bankedRegisters[2][0] = frost.bankedRegisters[2][0];\n\tthis.bankedRegisters[2][1] = frost.bankedRegisters[2][1];\n\n\tthis.bankedRegisters[3][0] = frost.bankedRegisters[3][0];\n\tthis.bankedRegisters[3][1] = frost.bankedRegisters[3][1];\n\n\tthis.bankedRegisters[4][0] = frost.bankedRegisters[4][0];\n\tthis.bankedRegisters[4][1] = frost.bankedRegisters[4][1];\n\n\tthis.bankedRegisters[5][0] = frost.bankedRegisters[5][0];\n\tthis.bankedRegisters[5][1] = frost.bankedRegisters[5][1];\n\n\tthis.spsr = frost.spsr;\n\tthis.bankedSPSRs[0] = frost.bankedSPSRs[0];\n\tthis.bankedSPSRs[1] = frost.bankedSPSRs[1];\n\tthis.bankedSPSRs[2] = frost.bankedSPSRs[2];\n\tthis.bankedSPSRs[3] = frost.bankedSPSRs[3];\n\tthis.bankedSPSRs[4] = frost.bankedSPSRs[4];\n\tthis.bankedSPSRs[5] = frost.bankedSPSRs[5];\n\n\tthis.cycles = frost.cycles;\n};\n\nARMCore.prototype.fetchPage = function(address) {\n\tvar region = address >> this.mmu.BASE_OFFSET;\n\tvar pageId = this.mmu.addressToPage(region, address & this.mmu.OFFSET_MASK);\n\tif (region == this.pageRegion) {\n\t\tif (pageId == this.pageId && !this.page.invalid) {\n\t\t\treturn;\n\t\t}\n\t\tthis.pageId = pageId;\n\t} else {\n\t\tthis.pageMask = this.mmu.memory[region].PAGE_MASK;\n\t\tthis.pageRegion = region;\n\t\tthis.pageId = pageId;\n\t}\n\n\tthis.page = this.mmu.accessPage(region, pageId);\n};\n\nARMCore.prototype.loadInstructionArm = function(address) {\n\tvar next = null;\n\tthis.fetchPage(address);\n\tvar offset = (address & this.pageMask) >> 2;\n\tnext = this.page.arm[offset];\n\tif (next) {\n\t\treturn next;\n\t}\n\tvar instruction = this.mmu.load32(address) >>> 0;\n\tnext = this.compileArm(instruction);\n\tnext.next = null;\n\tnext.page = this.page;\n\tnext.address = address;\n\tnext.opcode = instruction;\n\tthis.page.arm[offset] = next;\n\treturn next;\n};\n\nARMCore.prototype.loadInstructionThumb = function(address) {\n\tvar next = null;\n\tthis.fetchPage(address);\n\tvar offset = (address & this.pageMask) >> 1;\n\tnext = this.page.thumb[offset];\n\tif (next) {\n\t\treturn next;\n\t}\n\tvar instruction = this.mmu.load16(address);\n\tnext = this.compileThumb(instruction);\n\tnext.next = null;\n\tnext.page = this.page;\n\tnext.address = address;\n\tnext.opcode = instruction;\n\tthis.page.thumb[offset] = next;\n\treturn next;\n};\n\nARMCore.prototype.selectBank = function(mode) {\n\tswitch (mode) {\n\tcase this.MODE_USER:\n\tcase this.MODE_SYSTEM:\n\t\t// No banked registers\n\t\treturn this.BANK_NONE;\n\tcase this.MODE_FIQ:\n\t\treturn this.BANK_FIQ;\n\tcase this.MODE_IRQ:\n\t\treturn this.BANK_IRQ;\n\tcase this.MODE_SUPERVISOR:\n\t\treturn this.BANK_SUPERVISOR;\n\tcase this.MODE_ABORT:\n\t\treturn this.BANK_ABORT;\n\tcase this.MODE_UNDEFINED:\n\t\treturn this.BANK_UNDEFINED;\n\tdefault:\n\t\tthrow \"Invalid user mode passed to selectBank\";\n\t}\n};\n\nARMCore.prototype.switchExecMode = function(newMode) {\n\tif (this.execMode != newMode) {\n\t\tthis.execMode = newMode;\n\t\tif (newMode == this.MODE_ARM) {\n\t\t\tthis.instructionWidth = this.WORD_SIZE_ARM;\n\t\t\tthis.loadInstruction = this.loadInstructionArm;\n\t\t} else {\n\t\t\tthis.instructionWidth = this.WORD_SIZE_THUMB;\n\t\t\tthis.loadInstruction = this.loadInstructionThumb;\n\t\t}\n\t}\n\t\n};\n\nARMCore.prototype.switchMode = function(newMode) {\n\tif (newMode == this.mode) {\n\t\t// Not switching modes after all\n\t\treturn;\n\t}\n\tif (newMode != this.MODE_USER || newMode != this.MODE_SYSTEM) {\n\t\t// Switch banked registers\n\t\tvar newBank = this.selectBank(newMode);\n\t\tvar oldBank = this.selectBank(this.mode);\n\t\tif (newBank != oldBank) {\n\t\t\t// TODO: support FIQ\n\t\t\tif (newMode == this.MODE_FIQ || this.mode == this.MODE_FIQ) {\n\t\t\t\tvar oldFiqBank = (oldBank == this.BANK_FIQ) + 0;\n\t\t\t\tvar newFiqBank = (newBank == this.BANK_FIQ) + 0;\n\t\t\t\tthis.bankedRegisters[oldFiqBank][2] = this.gprs[8];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][3] = this.gprs[9];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][4] = this.gprs[10];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][5] = this.gprs[11];\n\t\t\t\tthis.bankedRegisters[oldFiqBank][6] = this.gprs[12];\n\t\t\t\tthis.gprs[8] = this.bankedRegisters[newFiqBank][2];\n\t\t\t\tthis.gprs[9] = this.bankedRegisters[newFiqBank][3];\n\t\t\t\tthis.gprs[10] = this.bankedRegisters[newFiqBank][4];\n\t\t\t\tthis.gprs[11] = this.bankedRegisters[newFiqBank][5];\n\t\t\t\tthis.gprs[12] = this.bankedRegisters[newFiqBank][6];\n\t\t\t}\n\t\t\tthis.bankedRegisters[oldBank][0] = this.gprs[this.SP];\n\t\t\tthis.bankedRegisters[oldBank][1] = this.gprs[this.LR];\n\t\t\tthis.gprs[this.SP] = this.bankedRegisters[newBank][0];\n\t\t\tthis.gprs[this.LR] = this.bankedRegisters[newBank][1];\n\n\t\t\tthis.bankedSPSRs[oldBank] = this.spsr;\n\t\t\tthis.spsr = this.bankedSPSRs[newBank];\n\t\t}\n\t}\n\tthis.mode = newMode;\n};\n\nARMCore.prototype.packCPSR = function() {\n\treturn this.mode | (!!this.execMode << 5) | (!!this.cpsrF << 6) | (!!this.cpsrI << 7) |\n\t       (!!this.cpsrN << 31) | (!!this.cpsrZ << 30) | (!!this.cpsrC << 29) | (!!this.cpsrV << 28);\n};\n\nARMCore.prototype.unpackCPSR = function(spsr) {\n\tthis.switchMode(spsr & 0x0000001F);\n\tthis.switchExecMode(!!(spsr & 0x00000020));\n\tthis.cpsrF = spsr & 0x00000040;\n\tthis.cpsrI = spsr & 0x00000080;\n\tthis.cpsrN = spsr & 0x80000000;\n\tthis.cpsrZ = spsr & 0x40000000;\n\tthis.cpsrC = spsr & 0x20000000;\n\tthis.cpsrV = spsr & 0x10000000;\n\n\tthis.irq.testIRQ();\n};\n\nARMCore.prototype.hasSPSR = function() {\n\treturn this.mode != this.MODE_SYSTEM && this.mode != this.MODE_USER;\n};\n\nARMCore.prototype.raiseIRQ = function() {\n\tif (this.cpsrI) {\n\t\treturn;\n\t}\n\tvar cpsr = this.packCPSR();\n\tvar instructionWidth = this.instructionWidth;\n\tthis.switchMode(this.MODE_IRQ);\n\tthis.spsr = cpsr;\n\tthis.gprs[this.LR] = this.gprs[this.PC] - instructionWidth + 4;\n\tthis.gprs[this.PC] = this.BASE_IRQ + this.WORD_SIZE_ARM;\n\tthis.instruction = null;\n\tthis.switchExecMode(this.MODE_ARM);\n\tthis.cpsrI = true;\n};\n\nARMCore.prototype.raiseTrap = function() {\n\tvar cpsr = this.packCPSR();\n\tvar instructionWidth = this.instructionWidth;\n\tthis.switchMode(this.MODE_SUPERVISOR);\n\tthis.spsr = cpsr;\n\tthis.gprs[this.LR] = this.gprs[this.PC] - instructionWidth;\n\tthis.gprs[this.PC] = this.BASE_SWI + this.WORD_SIZE_ARM;\n\tthis.instruction = null;\n\tthis.switchExecMode(this.MODE_ARM);\n\tthis.cpsrI = true;\n};\n\nARMCore.prototype.badOp = function(instruction) {\n\tvar func = function() {\n\t\tthrow \"Illegal instruction: 0x\" + instruction.toString(16);\n\t};\n\tfunc.writesPC = true;\n\tfunc.fixedJump = false;\n\treturn func;\n};\n\nARMCore.prototype.generateConds = function() {\n\tvar cpu = this;\n\tthis.conds = [\n\t\t// EQ\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrZ;\n\t\t},\n\t\t// NE\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrZ;\n\t\t},\n\t\t// CS\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrC;\n\t\t},\n\t\t// CC\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrC;\n\t\t},\n\t\t// MI\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrN;\n\t\t},\n\t\t// PL\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN;\n\t\t},\n\t\t// VS\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrV;\n\t\t},\n\t\t// VC\n\t\tfunction() {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrV;\n\t\t},\n\t\t// HI\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrC && !cpu.cpsrZ;\n\t\t},\n\t\t// LS\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrC || cpu.cpsrZ;\n\t\t},\n\t\t// GE\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN == !cpu.cpsrV;\n\t\t},\n\t\t// LT\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrN != !cpu.cpsrV;\n\t\t},\n\t\t// GT\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = !cpu.cpsrZ && !cpu.cpsrN == !cpu.cpsrV;\n\t\t},\n\t\t// LE\n\t\tfunction () {\n\t\t\treturn cpu.conditionPassed = cpu.cpsrZ || !cpu.cpsrN != !cpu.cpsrV;\n\t\t},\n\t\t// AL\n\t\tnull,\n\t\tnull\n\t]\n}\n\nARMCore.prototype.barrelShiftImmediate = function(shiftType, immediate, rm) {\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\tvar shiftOp = this.badOp;\n\tswitch (shiftType) {\n\tcase 0x00000000:\n\t\t// LSL\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] << immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (32 - immediate));\n\t\t\t};\n\t\t} else {\n\t\t\t// This boils down to no shift\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm];\n\t\t\t\tcpu.shifterCarryOut = cpu.cpsrC;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000020:\n\t\t// LSR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] >>> immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = 0;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & 0x80000000;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000040:\n\t\t// ASR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = gprs[rm] >> immediate;\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & 0x80000000;\n\t\t\t\tif (cpu.shifterCarryOut) {\n\t\t\t\t\tcpu.shifterOperand = 0xFFFFFFFF;\n\t\t\t\t} else {\n\t\t\t\t\tcpu.shifterOperand = 0;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t\tbreak;\n\tcase 0x00000060:\n\t\t// ROR\n\t\tif (immediate) {\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = (gprs[rm] >>> immediate) | (gprs[rm] << (32 - immediate));\n\t\t\t\tcpu.shifterCarryOut = gprs[rm] & (1 << (immediate - 1));\n\t\t\t};\n\t\t} else {\n\t\t\t// RRX\n\t\t\tshiftOp = function() {\n\t\t\t\tcpu.shifterOperand = (!!cpu.cpsrC << 31) | (gprs[rm] >>> 1);\n\t\t\t\tcpu.shifterCarryOut =  gprs[rm] & 0x00000001;\n\t\t\t};\n\t\t}\n\t\tbreak;\n\t}\n\treturn shiftOp;\n}\n\nARMCore.prototype.compileArm = function(instruction) {\n\tvar op = this.badOp(instruction);\n\tvar i = instruction & 0x0E000000;\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\n\tvar condOp = this.conds[(instruction & 0xF0000000) >>> 28];\n\tif ((instruction & 0x0FFFFFF0) == 0x012FFF10) {\n\t\t// BX\n\t\tvar rm = instruction & 0xF;\n\t\top = this.armCompiler.constructBX(rm, condOp);\n\t\top.writesPC = true;\n\t\top.fixedJump = false;\n\t} else if (!(instruction & 0x0C000000) && (i == 0x02000000 || (instruction & 0x00000090) != 0x00000090)) {\n\t\tvar opcode = instruction & 0x01E00000;\n\t\tvar s = instruction & 0x00100000;\n\t\tvar shiftsRs = false;\n\t\tif ((opcode & 0x01800000) == 0x01000000 && !s) {\n\t\t\tvar r = instruction & 0x00400000;\n\t\t\tif ((instruction & 0x00B0F000) == 0x0020F000) {\n\t\t\t\t// MSR\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tvar immediate = instruction & 0x000000FF;\n\t\t\t\tvar rotateImm = (instruction & 0x00000F00) >> 7;\n\t\t\t\timmediate = (immediate >>> rotateImm) | (immediate << (32 - rotateImm));\n\t\t\t\top = this.armCompiler.constructMSR(rm, r, instruction, immediate, condOp);\n\t\t\t\top.writesPC = false;\n\t\t\t} else if ((instruction & 0x00BF0000) == 0x000F0000) {\n\t\t\t\t// MRS\n\t\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\t\top = this.armCompiler.constructMRS(rd, r, condOp);\n\t\t\t\top.writesPC = rd == this.PC;\n\t\t\t}\n\t\t} else {\n\t\t\t// Data processing/FSR transfer\n\t\t\tvar rn = (instruction & 0x000F0000) >> 16;\n\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\n\t\t\t// Parse shifter operand\n\t\t\tvar shiftType = instruction & 0x00000060;\n\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\tvar shiftOp = function() {\n\t\t\t\tthrow 'BUG: invalid barrel shifter';\n\t\t\t};\n\t\t\tif (instruction & 0x02000000) {\n\t\t\t\tvar immediate = instruction & 0x000000FF;\n\t\t\t\tvar rotate = (instruction & 0x00000F00) >> 7;\n\t\t\t\tif (!rotate) {\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1Immediate(immediate);\n\t\t\t\t} else {\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ImmediateRotate(immediate, rotate);\n\t\t\t\t}\n\t\t\t} else if (instruction & 0x00000010) {\n\t\t\t\tvar rs = (instruction & 0x00000F00) >> 8;\n\t\t\t\tshiftsRs = true;\n\t\t\t\tswitch (shiftType) {\n\t\t\t\tcase 0x00000000:\n\t\t\t\t\t// LSL\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1LSL(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000020:\n\t\t\t\t\t// LSR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1LSR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000040:\n\t\t\t\t\t// ASR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ASR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00000060:\n\t\t\t\t\t// ROR\n\t\t\t\t\tshiftOp = this.armCompiler.constructAddressingMode1ROR(rs, rm);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tvar immediate = (instruction & 0x00000F80) >> 7;\n\t\t\t\tshiftOp = this.barrelShiftImmediate(shiftType, immediate, rm);\n\t\t\t}\n\n\t\t\tswitch (opcode) {\n\t\t\tcase 0x00000000:\n\t\t\t\t// AND\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructANDS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructAND(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00200000:\n\t\t\t\t// EOR\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructEORS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructEOR(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00400000:\n\t\t\t\t// SUB\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructSUBS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSUB(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00600000:\n\t\t\t\t// RSB\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructRSBS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructRSB(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00800000:\n\t\t\t\t// ADD\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructADDS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructADD(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00A00000:\n\t\t\t\t// ADC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructADCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructADC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00C00000:\n\t\t\t\t// SBC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructSBCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSBC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x00E00000:\n\t\t\t\t// RSC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructRSCS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructRSC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01000000:\n\t\t\t\t// TST\n\t\t\t\top = this.armCompiler.constructTST(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01200000:\n\t\t\t\t// TEQ\n\t\t\t\top = this.armCompiler.constructTEQ(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01400000:\n\t\t\t\t// CMP\n\t\t\t\top = this.armCompiler.constructCMP(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01600000:\n\t\t\t\t// CMN\n\t\t\t\top = this.armCompiler.constructCMN(rd, rn, shiftOp, condOp);\n\t\t\t\tbreak;\n\t\t\tcase 0x01800000:\n\t\t\t\t// ORR\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructORRS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructORR(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01A00000:\n\t\t\t\t// MOV\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructMOVS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructMOV(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01C00000:\n\t\t\t\t// BIC\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructBICS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructBIC(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\tcase 0x01E00000:\n\t\t\t\t// MVN\n\t\t\t\tif (s) {\n\t\t\t\t\top = this.armCompiler.constructMVNS(rd, rn, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructMVN(rd, rn, shiftOp, condOp);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\top.writesPC = rd == this.PC;\n\t\t}\n\t} else if ((instruction & 0x0FB00FF0) == 0x01000090) {\n\t\t// Single data swap\n\t\tvar rm = instruction & 0x0000000F;\n\t\tvar rd = (instruction >> 12) & 0x0000000F;\n\t\tvar rn = (instruction >> 16) & 0x0000000F;\n\t\tif (instruction & 0x00400000) {\n\t\t\top = this.armCompiler.constructSWPB(rd, rn, rm, condOp);\n\t\t} else {\n\t\t\top = this.armCompiler.constructSWP(rd, rn, rm, condOp);\n\t\t}\n\t\top.writesPC = rd == this.PC;\n\t} else {\n\t\tswitch (i) {\n\t\tcase 0x00000000:\n\t\t\tif ((instruction & 0x010000F0) == 0x00000090) {\n\t\t\t\t// Multiplies\n\t\t\t\tvar rd = (instruction & 0x000F0000) >> 16;\n\t\t\t\tvar rn = (instruction & 0x0000F000) >> 12;\n\t\t\t\tvar rs = (instruction & 0x00000F00) >> 8;\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tswitch (instruction & 0x00F00000) {\n\t\t\t\tcase 0x00000000:\n\t\t\t\t\t// MUL\n\t\t\t\t\top = this.armCompiler.constructMUL(rd, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00100000:\n\t\t\t\t\t// MULS\n\t\t\t\t\top = this.armCompiler.constructMULS(rd, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00200000:\n\t\t\t\t\t// MLA\n\t\t\t\t\top = this.armCompiler.constructMLA(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak\n\t\t\t\tcase 0x00300000:\n\t\t\t\t\t// MLAS\n\t\t\t\t\top = this.armCompiler.constructMLAS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00800000:\n\t\t\t\t\t// UMULL\n\t\t\t\t\top = this.armCompiler.constructUMULL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00900000:\n\t\t\t\t\t// UMULLS\n\t\t\t\t\top = this.armCompiler.constructUMULLS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00A00000:\n\t\t\t\t\t// UMLAL\n\t\t\t\t\top = this.armCompiler.constructUMLAL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00B00000:\n\t\t\t\t\t// UMLALS\n\t\t\t\t\top = this.armCompiler.constructUMLALS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00C00000:\n\t\t\t\t\t// SMULL\n\t\t\t\t\top = this.armCompiler.constructSMULL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00D00000:\n\t\t\t\t\t// SMULLS\n\t\t\t\t\top = this.armCompiler.constructSMULLS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00E00000:\n\t\t\t\t\t// SMLAL\n\t\t\t\t\top = this.armCompiler.constructSMLAL(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 0x00F00000:\n\t\t\t\t\t// SMLALS\n\t\t\t\t\top = this.armCompiler.constructSMLALS(rd, rn, rs, rm, condOp);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\top.writesPC = rd == this.PC;\n\t\t\t} else {\n\t\t\t\t// Halfword and signed byte data transfer\n\t\t\t\tvar load = instruction & 0x00100000;\n\t\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\t\tvar hiOffset = (instruction & 0x00000F00) >> 4;\n\t\t\t\tvar loOffset = rm = instruction & 0x0000000F;\n\t\t\t\tvar h = instruction & 0x00000020;\n\t\t\t\tvar s = instruction & 0x00000040;\n\t\t\t\tvar w = instruction & 0x00200000;\n\t\t\t\tvar i = instruction & 0x00400000;\n\n\t\t\t\tvar address;\n\t\t\t\tif (i) {\n\t\t\t\t\tvar immediate = loOffset | hiOffset;\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Immediate(instruction, immediate, condOp);\n\t\t\t\t} else {\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Register(instruction, rm, condOp);\n\t\t\t\t}\n\t\t\t\taddress.writesPC = !!w && rn == this.PC;\n\n\t\t\t\tif ((instruction & 0x00000090) == 0x00000090) {\n\t\t\t\t\tif (load) {\n\t\t\t\t\t\t// Load [signed] halfword/byte\n\t\t\t\t\t\tif (h) {\n\t\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\t\t// LDRSH\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRSH(rd, address, condOp);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t// LDRH\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRH(rd, address, condOp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\tif (s) {\n\t\t\t\t\t\t\t\t// LDRSB\n\t\t\t\t\t\t\t\top = this.armCompiler.constructLDRSB(rd, address, condOp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t} else if (!s && h) {\n\t\t\t\t\t\t// STRH\n\t\t\t\t\t\top = this.armCompiler.constructSTRH(rd, address, condOp);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\top.writesPC = rd == this.PC || address.writesPC;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x04000000:\n\t\tcase 0x06000000:\n\t\t\t// LDR/STR\n\t\t\tvar rd = (instruction & 0x0000F000) >> 12;\n\t\t\tvar load = instruction & 0x00100000;\n\t\t\tvar b = instruction & 0x00400000;\n\t\t\tvar i = instruction & 0x02000000;\n\n\t\t\tvar address = function() {\n\t\t\t\tthrow \"Unimplemented memory access: 0x\" + instruction.toString(16);\n\t\t\t};\n\t\t\tif (~instruction & 0x01000000) {\n\t\t\t\t// Clear the W bit if the P bit is clear--we don't support memory translation, so these turn into regular accesses\n\t\t\t\tinstruction &= 0xFFDFFFFF;\n\t\t\t}\n\t\t\tif (i) {\n\t\t\t\t// Register offset\n\t\t\t\tvar rm = instruction & 0x0000000F;\n\t\t\t\tvar shiftType = instruction & 0x00000060;\n\t\t\t\tvar shiftImmediate = (instruction & 0x00000F80) >> 7;\n\t\t\t\t\n\t\t\t\tif (shiftType || shiftImmediate) {\n\t\t\t\t\tvar shiftOp = this.barrelShiftImmediate(shiftType, shiftImmediate, rm);\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode2RegisterShifted(instruction, shiftOp, condOp);\n\t\t\t\t} else {\n\t\t\t\t\taddress = this.armCompiler.constructAddressingMode23Register(instruction, rm, condOp);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Immediate\n\t\t\t\tvar offset = instruction & 0x00000FFF;\n\t\t\t\taddress = this.armCompiler.constructAddressingMode23Immediate(instruction, offset, condOp);\n\t\t\t}\n\t\t\tif (load) {\n\t\t\t\tif (b) {\n\t\t\t\t\t// LDRB\n\t\t\t\t\top = this.armCompiler.constructLDRB(rd, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\t// LDR\n\t\t\t\t\top = this.armCompiler.constructLDR(rd, address, condOp);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (b) {\n\t\t\t\t\t// STRB\n\t\t\t\t\top = this.armCompiler.constructSTRB(rd, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\t// STR\n\t\t\t\t\top = this.armCompiler.constructSTR(rd, address, condOp);\n\t\t\t\t}\n\t\t\t}\n\t\t\top.writesPC = rd == this.PC || address.writesPC;\n\t\t\tbreak;\n\t\tcase 0x08000000:\n\t\t\t// Block data transfer\n\t\t\tvar load = instruction & 0x00100000;\n\t\t\tvar w = instruction & 0x00200000;\n\t\t\tvar user = instruction & 0x00400000;\n\t\t\tvar u = instruction & 0x00800000;\n\t\t\tvar p = instruction & 0x01000000;\n\t\t\tvar rs = instruction & 0x0000FFFF;\n\t\t\tvar rn = (instruction & 0x000F0000) >> 16;\n\n\t\t\tvar address;\n\t\t\tvar immediate = 0;\n\t\t\tvar offset = 0;\n\t\t\tvar overlap = false;\n\t\t\tif (u) {\n\t\t\t\tif (p) {\n\t\t\t\t\timmediate = 4;\n\t\t\t\t}\n\t\t\t\tfor (var m = 0x01, i = 0; i < 16; m <<= 1, ++i) {\n\t\t\t\t\tif (rs & m) {\n\t\t\t\t\t\tif (w && i == rn && !offset) {\n\t\t\t\t\t\t\trs &= ~m;\n\t\t\t\t\t\t\timmediate += 4;\n\t\t\t\t\t\t\toverlap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\toffset += 4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tif (!p) {\n\t\t\t\t\timmediate = 4;\n\t\t\t\t}\n\t\t\t\tfor (var m = 0x01, i = 0; i < 16; m <<= 1, ++i) {\n\t\t\t\t\tif (rs & m) {\n\t\t\t\t\t\tif (w && i == rn && !offset) {\n\t\t\t\t\t\t\trs &= ~m;\n\t\t\t\t\t\t\timmediate += 4;\n\t\t\t\t\t\t\toverlap = true;\n\t\t\t\t\t\t}\n\t\t\t\t\t\timmediate -= 4;\n\t\t\t\t\t\toffset -= 4;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tif (w) {\n\t\t\t\taddress = this.armCompiler.constructAddressingMode4Writeback(immediate, offset, rn, overlap);\n\t\t\t} else {\n\t\t\t\taddress = this.armCompiler.constructAddressingMode4(immediate, rn);\n\t\t\t}\n\t\t\tif (load) {\n\t\t\t\t// LDM\n\t\t\t\tif (user) {\n\t\t\t\t\top = this.armCompiler.constructLDMS(rs, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructLDM(rs, address, condOp);\n\t\t\t\t}\n\t\t\t\top.writesPC = !!(rs & (1 << 15));\n\t\t\t} else {\n\t\t\t\t// STM\n\t\t\t\tif (user) {\n\t\t\t\t\top = this.armCompiler.constructSTMS(rs, address, condOp);\n\t\t\t\t} else {\n\t\t\t\t\top = this.armCompiler.constructSTM(rs, address, condOp);\n\t\t\t\t}\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x0A000000:\n\t\t\t// Branch\n\t\t\tvar immediate = instruction & 0x00FFFFFF;\n\t\t\tif (immediate & 0x00800000) {\n\t\t\t\timmediate |= 0xFF000000;\n\t\t\t}\n\t\t\timmediate <<= 2;\n\t\t\tvar link = instruction & 0x01000000;\n\t\t\tif (link) {\n\t\t\t\top = this.armCompiler.constructBL(immediate, condOp);\n\t\t\t} else {\n\t\t\t\top = this.armCompiler.constructB(immediate, condOp);\n\t\t\t}\n\t\t\top.writesPC = true;\n\t\t\top.fixedJump = true;\n\t\t\tbreak;\n\t\tcase 0x0C000000:\n\t\t\t// Coprocessor data transfer\n\t\t\tbreak;\n\t\tcase 0x0E000000:\n\t\t\t// Coprocessor data operation/SWI\n\t\t\tif ((instruction & 0x0F000000) == 0x0F000000) {\n\t\t\t\t// SWI\n\t\t\t\tvar immediate = (instruction & 0x00FFFFFF);\n\t\t\t\top = this.armCompiler.constructSWI(immediate, condOp);\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthrow 'Bad opcode: 0x' + instruction.toString(16);\n\t\t}\n\t}\n\n\top.execMode = this.MODE_ARM;\n\top.fixedJump = op.fixedJump || false;\n\treturn op;\n};\n\nARMCore.prototype.compileThumb = function(instruction) {\n\tvar op = this.badOp(instruction & 0xFFFF);\n\tvar cpu = this;\n\tvar gprs = this.gprs;\n\tif ((instruction & 0xFC00) == 0x4000) {\n\t\t// Data-processing register\n\t\tvar rm = (instruction & 0x0038) >> 3;\n\t\tvar rd = instruction & 0x0007;\n\t\tswitch (instruction & 0x03C0) {\n\t\tcase 0x0000:\n\t\t\t// AND\n\t\t\top = this.thumbCompiler.constructAND(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0040:\n\t\t\t// EOR\n\t\t\top = this.thumbCompiler.constructEOR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0080:\n\t\t\t// LSL(2)\n\t\t\top = this.thumbCompiler.constructLSL2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x00C0:\n\t\t\t// LSR(2)\n\t\t\top = this.thumbCompiler.constructLSR2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0100:\n\t\t\t// ASR(2)\n\t\t\top = this.thumbCompiler.constructASR2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0140:\n\t\t\t// ADC\n\t\t\top = this.thumbCompiler.constructADC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0180:\n\t\t\t// SBC\n\t\t\top = this.thumbCompiler.constructSBC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x01C0:\n\t\t\t// ROR\n\t\t\top = this.thumbCompiler.constructROR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// TST\n\t\t\top = this.thumbCompiler.constructTST(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0240:\n\t\t\t// NEG\n\t\t\top = this.thumbCompiler.constructNEG(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0280:\n\t\t\t// CMP(2)\n\t\t\top = this.thumbCompiler.constructCMP2(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x02C0:\n\t\t\t// CMN\n\t\t\top = this.thumbCompiler.constructCMN(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0300:\n\t\t\t// ORR\n\t\t\top = this.thumbCompiler.constructORR(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0340:\n\t\t\t// MUL\n\t\t\top = this.thumbCompiler.constructMUL(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x0380:\n\t\t\t// BIC\n\t\t\top = this.thumbCompiler.constructBIC(rd, rm);\n\t\t\tbreak;\n\t\tcase 0x03C0:\n\t\t\t// MVN\n\t\t\top = this.thumbCompiler.constructMVN(rd, rm);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xFC00) == 0x4400) {\n\t\t// Special data processing / branch/exchange instruction set\n\t\tvar rm = (instruction & 0x0078) >> 3;\n\t\tvar rn = instruction & 0x0007;\n\t\tvar h1 = instruction & 0x0080;\n\t\tvar rd = rn | (h1 >> 4);\n\t\tswitch (instruction & 0x0300) {\n\t\tcase 0x0000:\n\t\t\t// ADD(4)\n\t\t\top = this.thumbCompiler.constructADD4(rd, rm)\n\t\t\top.writesPC = rd == this.PC;\n\t\t\tbreak;\n\t\tcase 0x0100:\n\t\t\t// CMP(3)\n\t\t\top = this.thumbCompiler.constructCMP3(rd, rm);\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// MOV(3)\n\t\t\top = this.thumbCompiler.constructMOV3(rd, rm);\n\t\t\top.writesPC = rd == this.PC;\n\t\t\tbreak;\n\t\tcase 0x0300:\n\t\t\t// BX\n\t\t\top = this.thumbCompiler.constructBX(rd, rm);\n\t\t\top.writesPC = true;\n\t\t\top.fixedJump = false;\n\t\t\tbreak;\n\t\t}\n\t} else if ((instruction & 0xF800) == 0x1800) {\n\t\t// Add/subtract\n\t\tvar rm = (instruction & 0x01C0) >> 6;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar rd = instruction & 0x0007;\n\t\tswitch (instruction & 0x0600) {\n\t\tcase 0x0000:\n\t\t\t// ADD(3)\n\t\t\top = this.thumbCompiler.constructADD3(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// SUB(3)\n\t\t\top = this.thumbCompiler.constructSUB3(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0400:\n\t\t\tvar immediate = (instruction & 0x01C0) >> 6;\n\t\t\tif (immediate) {\n\t\t\t\t// ADD(1)\n\t\t\t\top = this.thumbCompiler.constructADD1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// MOV(2)\n\t\t\t\top = this.thumbCompiler.constructMOV2(rd, rn, rm);\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x0600:\n\t\t\t// SUB(1)\n\t\t\tvar immediate = (instruction & 0x01C0) >> 6;\n\t\t\top = this.thumbCompiler.constructSUB1(rd, rn, immediate);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if (!(instruction & 0xE000)) {\n\t\t// Shift by immediate\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rm = (instruction & 0x0038) >> 3;\n\t\tvar immediate = (instruction & 0x07C0) >> 6;\n\t\tswitch (instruction & 0x1800) {\n\t\tcase 0x0000:\n\t\t\t// LSL(1)\n\t\t\top = this.thumbCompiler.constructLSL1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// LSR(1)\n\t\t\top = this.thumbCompiler.constructLSR1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// ASR(1)\n\t\t\top = this.thumbCompiler.constructASR1(rd, rm, immediate);\n\t\t\tbreak;\n\t\tcase 0x1800:\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xE000) == 0x2000) {\n\t\t// Add/subtract/compare/move immediate\n\t\tvar immediate = instruction & 0x00FF;\n\t\tvar rn = (instruction & 0x0700) >> 8;\n\t\tswitch (instruction & 0x1800) {\n\t\tcase 0x0000:\n\t\t\t// MOV(1)\n\t\t\top = this.thumbCompiler.constructMOV1(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// CMP(1)\n\t\t\top = this.thumbCompiler.constructCMP1(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// ADD(2)\n\t\t\top = this.thumbCompiler.constructADD2(rn, immediate);\n\t\t\tbreak;\n\t\tcase 0x1800:\n\t\t\t// SUB(2)\n\t\t\top = this.thumbCompiler.constructSUB2(rn, immediate);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF800) == 0x4800) {\n\t\t// LDR(3)\n\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\top = this.thumbCompiler.constructLDR3(rd, immediate);\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF000) == 0x5000) {\n\t\t// Load and store with relative offset\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar rm = (instruction & 0x01C0) >> 6;\n\t\tvar opcode = instruction & 0x0E00;\n\t\tswitch (opcode) {\n\t\tcase 0x0000:\n\t\t\t// STR(2)\n\t\t\top = this.thumbCompiler.constructSTR2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0200:\n\t\t\t// STRH(2)\n\t\t\top = this.thumbCompiler.constructSTRH2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0400:\n\t\t\t// STRB(2)\n\t\t\top = this.thumbCompiler.constructSTRB2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0600:\n\t\t\t// LDRSB\n\t\t\top = this.thumbCompiler.constructLDRSB(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0800:\n\t\t\t// LDR(2)\n\t\t\top = this.thumbCompiler.constructLDR2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0A00:\n\t\t\t// LDRH(2)\n\t\t\top = this.thumbCompiler.constructLDRH2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0C00:\n\t\t\t// LDRB(2)\n\t\t\top = this.thumbCompiler.constructLDRB2(rd, rn, rm);\n\t\t\tbreak;\n\t\tcase 0x0E00:\n\t\t\t// LDRSH\n\t\t\top = this.thumbCompiler.constructLDRSH(rd, rn, rm);\n\t\t\tbreak;\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xE000) == 0x6000) {\n\t\t// Load and store with immediate offset\n\t\tvar rd = instruction & 0x0007;\n\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\tvar immediate = (instruction & 0x07C0) >> 4;\n\t\tvar b = instruction & 0x1000;\n\t\tif (b) {\n\t\t\timmediate >>= 2;\n\t\t}\n\t\tvar load = instruction & 0x0800;\n\t\tif (load) {\n\t\t\tif (b) {\n\t\t\t\t// LDRB(1)\n\t\t\t\top = this.thumbCompiler.constructLDRB1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// LDR(1)\n\t\t\t\top = this.thumbCompiler.constructLDR1(rd, rn, immediate);\n\t\t\t}\n\t\t} else {\n\t\t\tif (b) {\n\t\t\t\t// STRB(1)\n\t\t\t\top = this.thumbCompiler.constructSTRB1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// STR(1)\n\t\t\t\top = this.thumbCompiler.constructSTR1(rd, rn, immediate);\n\t\t\t}\n\t\t}\n\t\top.writesPC = false;\n\t} else if ((instruction & 0xF600) == 0xB400) {\n\t\t// Push and pop registers\n\t\tvar r = !!(instruction & 0x0100);\n\t\tvar rs = instruction & 0x00FF;\n\t\tif (instruction & 0x0800) {\n\t\t\t// POP\n\t\t\top = this.thumbCompiler.constructPOP(rs, r);\n\t\t\top.writesPC = r;\n\t\t\top.fixedJump = false;\n\t\t} else {\n\t\t\t// PUSH\n\t\t\top = this.thumbCompiler.constructPUSH(rs, r);\n\t\t\top.writesPC = false;\n\t\t}\n\t} else if (instruction & 0x8000) {\n\t\tswitch (instruction & 0x7000) {\n\t\tcase 0x0000:\n\t\t\t// Load and store halfword\n\t\t\tvar rd = instruction & 0x0007;\n\t\t\tvar rn = (instruction & 0x0038) >> 3;\n\t\t\tvar immediate = (instruction & 0x07C0) >> 5;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// LDRH(1)\n\t\t\t\top = this.thumbCompiler.constructLDRH1(rd, rn, immediate);\n\t\t\t} else {\n\t\t\t\t// STRH(1)\n\t\t\t\top = this.thumbCompiler.constructSTRH1(rd, rn, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x1000:\n\t\t\t// SP-relative load and store\n\t\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\t\tvar load = instruction & 0x0800;\n\t\t\tif (load) {\n\t\t\t\t// LDR(4)\n\t\t\t\top = this.thumbCompiler.constructLDR4(rd, immediate);\n\t\t\t} else {\n\t\t\t\t// STR(3)\n\t\t\t\top = this.thumbCompiler.constructSTR3(rd, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x2000:\n\t\t\t// Load address\n\t\t\tvar rd = (instruction & 0x0700) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF) << 2;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// ADD(6)\n\t\t\t\top = this.thumbCompiler.constructADD6(rd, immediate);\n\t\t\t} else {\n\t\t\t\t// ADD(5)\n\t\t\t\top = this.thumbCompiler.constructADD5(rd, immediate);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x3000:\n\t\t\t// Miscellaneous\n\t\t\tif (!(instruction & 0x0F00)) {\n\t\t\t\t// Adjust stack pointer\n\t\t\t\t// ADD(7)/SUB(4)\n\t\t\t\tvar b = instruction & 0x0080;\n\t\t\t\tvar immediate = (instruction & 0x7F) << 2;\n\t\t\t\tif (b) {\n\t\t\t\t\timmediate = -immediate;\n\t\t\t\t}\n\t\t\t\top = this.thumbCompiler.constructADD7(immediate)\n\t\t\t\top.writesPC = false;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x4000:\n\t\t\t// Multiple load and store\n\t\t\tvar rn = (instruction & 0x0700) >> 8;\n\t\t\tvar rs = instruction & 0x00FF;\n\t\t\tif (instruction & 0x0800) {\n\t\t\t\t// LDMIA\n\t\t\t\top = this.thumbCompiler.constructLDMIA(rn, rs);\n\t\t\t} else {\n\t\t\t\t// STMIA\n\t\t\t\top = this.thumbCompiler.constructSTMIA(rn, rs);\n\t\t\t}\n\t\t\top.writesPC = false;\n\t\t\tbreak;\n\t\tcase 0x5000:\n\t\t\t// Conditional branch\n\t\t\tvar cond = (instruction & 0x0F00) >> 8;\n\t\t\tvar immediate = (instruction & 0x00FF);\n\t\t\tif (cond == 0xF) {\n\t\t\t\t// SWI\n\t\t\t\top = this.thumbCompiler.constructSWI(immediate);\n\t\t\t\top.writesPC = false;\n\t\t\t} else {\n\t\t\t\t// B(1)\n\t\t\t\tif (instruction & 0x0080) {\n\t\t\t\t\timmediate |= 0xFFFFFF00;\n\t\t\t\t}\n\t\t\t\timmediate <<= 1;\n\t\t\t\tvar condOp = this.conds[cond];\n\t\t\t\top = this.thumbCompiler.constructB1(immediate, condOp);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = true;\n\t\t\t}\n\t\t\tbreak;\n\t\tcase 0x6000:\n\t\tcase 0x7000:\n\t\t\t// BL(X)\n\t\t\tvar immediate = instruction & 0x07FF;\n\t\t\tvar h = instruction & 0x1800;\n\t\t\tswitch (h) {\n\t\t\tcase 0x0000:\n\t\t\t\t// B(2)\n\t\t\t\tif (immediate & 0x0400) {\n\t\t\t\t\timmediate |= 0xFFFFF800;\n\t\t\t\t}\n\t\t\t\timmediate <<= 1;\n\t\t\t\top = this.thumbCompiler.constructB2(immediate);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = true;\n\t\t\t\tbreak;\n\t\t\tcase 0x0800:\n\t\t\t\t// BLX (ARMv5T)\n\t\t\t\t/*op = function() {\n\t\t\t\t\tvar pc = gprs[cpu.PC];\n\t\t\t\t\tgprs[cpu.PC] = (gprs[cpu.LR] + (immediate << 1)) & 0xFFFFFFFC;\n\t\t\t\t\tgprs[cpu.LR] = pc - 1;\n\t\t\t\t\tcpu.switchExecMode(cpu.MODE_ARM);\n\t\t\t\t}*/\n\t\t\t\tbreak;\n\t\t\tcase 0x1000:\n\t\t\t\t// BL(1)\n\t\t\t\tif (immediate & 0x0400) {\n\t\t\t\t\timmediate |= 0xFFFFFC00;\n\t\t\t\t}\n\t\t\t\timmediate <<= 12;\n\t\t\t\top = this.thumbCompiler.constructBL1(immediate);\n\t\t\t\top.writesPC = false;\n\t\t\t\tbreak;\n\t\t\tcase 0x1800:\n\t\t\t\t// BL(2)\n\t\t\t\top = this.thumbCompiler.constructBL2(immediate);\n\t\t\t\top.writesPC = true;\n\t\t\t\top.fixedJump = false;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbreak;\n\t\tdefault:\n\t\t\tthis.WARN(\"Undefined instruction: 0x\" + instruction.toString(16));\n\t\t}\n\t} else {\n\t\tthrow 'Bad opcode: 0x' + instruction.toString(16);\n\t}\n\n\top.execMode = this.MODE_THUMB;\n\top.fixedJump = op.fixedJump || false;\n\treturn op;\n};\n\nexport default ARMCore;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nexport function hex(number, leading, usePrefix) {\n\tif (typeof(usePrefix) === 'undefined') {\n\t\tusePrefix = true;\n\t}\n\tif (typeof(leading) === 'undefined') {\n\t\tleading = 8;\n\t}\n\tvar string = (number >>> 0).toString(16).toUpperCase();\n\tleading -= string.length;\n\tif (leading < 0)\n\t\treturn string;\n\treturn (usePrefix ? '0x' : '') + new Array(leading + 1).join('0') + string;\n}\n\nconst Serializer = {\n\tTAG_INT: 1,\n\tTAG_STRING: 2,\n\tTAG_STRUCT: 3,\n\tTAG_BLOB: 4,\n\tTAG_BOOLEAN: 5,\n\tTYPE: 'application/octet-stream',\n\n\tpointer: function() {\n\t\tthis.index = 0;\n\t\tthis.top = 0;\n\t\tthis.stack = [];\n\t},\n\n\tpack: function(value) {\n\t\tvar object = new DataView(new ArrayBuffer(4));\n\t\tobject.setUint32(0, value, true);\n\t\treturn object.buffer;\n\t},\n\n\tpack8: function(value) {\n\t\tvar object = new DataView(new ArrayBuffer(1));\n\t\tobject.setUint8(0, value, true);\n\t\treturn object.buffer;\n\t},\n\n\tprefix: function(value) {\n\t\treturn new Blob([Serializer.pack(value.size || value.length || value.byteLength), value], { type: Serializer.TYPE });\n\t},\n\n\tserialize: function(stream) {\n\t\tvar parts = [];\n\t\tvar size = 4;\n\t\tfor (let i in stream) {\n\t\t\tif (stream.hasOwnProperty(i)) {\n\t\t\t\tvar tag;\n\t\t\t\tvar head = Serializer.prefix(i);\n\t\t\t\tvar body;\n\t\t\t\tswitch (typeof(stream[i])) {\n\t\t\t\tcase 'number':\n\t\t\t\t\ttag = Serializer.TAG_INT;\n\t\t\t\t\tbody = Serializer.pack(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'string':\n\t\t\t\t\ttag = Serializer.TAG_STRING;\n\t\t\t\t\tbody = Serializer.prefix(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'object':\n\t\t\t\t\tif (stream[i].type == Serializer.TYPE) {\n\t\t\t\t\t\ttag = Serializer.TAG_BLOB;\n\t\t\t\t\t\tbody = stream[i];\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttag = Serializer.TAG_STRUCT;\n\t\t\t\t\t\tbody = Serializer.serialize(stream[i]);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase 'boolean':\n\t\t\t\t\ttag = Serializer.TAG_BOOLEAN;\n\t\t\t\t\tbody = Serializer.pack8(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tconsole.log(stream[i]);\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tsize += 1 + head.size + (body.size || body.byteLength || body.length);\n\t\t\t\tparts.push(Serializer.pack8(tag));\n\t\t\t\tparts.push(head);\n\t\t\t\tparts.push(body);\n\t\t\t}\n\t\t}\n\t\tparts.unshift(Serializer.pack(size));\n\t\treturn new Blob(parts);\n\t},\n\n\tdeserialize: function(blob, callback) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tcallback(Serializer.deserealizeStream(new DataView(data.target.result), new Serializer.pointer));\n\t\t}\n\t\treader.readAsArrayBuffer(blob);\n\t},\n\n\tdeserealizeStream: function(view, pointer) {\n\t\tpointer.push();\n\t\tvar object = {};\n\t\tvar remaining = view.getUint32(pointer.advance(4), true);\n\t\twhile (pointer.mark() < remaining) {\n\t\t\tvar tag = view.getUint8(pointer.advance(1));\n\t\t\tvar head = pointer.readString(view);\n\t\t\tvar body;\n\t\t\tswitch (tag) {\n\t\t\tcase Serializer.TAG_INT:\n\t\t\t\tbody = view.getUint32(pointer.advance(4), true);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_STRING:\n\t\t\t\tbody = pointer.readString(view);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_STRUCT:\n\t\t\t\tbody = Serializer.deserealizeStream(view, pointer);\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_BLOB:\n\t\t\t\tvar size = view.getUint32(pointer.advance(4), true);\n\t\t\t\tbody = view.buffer.slice(pointer.advance(size), pointer.advance(0));\n\t\t\t\tbreak;\n\t\t\tcase Serializer.TAG_BOOLEAN:\n\t\t\t\tbody = !!view.getUint8(pointer.advance(1));\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tobject[head] = body;\n\t\t}\n\t\tif (pointer.mark() > remaining) {\n\t\t\tthrow \"Size of serialized data exceeded\";\n\t\t}\n\t\tpointer.pop();\n\t\treturn object;\n\t},\n\n\tserializePNG: function(blob, base, callback) {\n\t\tvar canvas = document.createElement('canvas');\n\t\tvar context = canvas.getContext('2d');\n\t\tvar pixels = base.getContext('2d').getImageData(0, 0, base.width, base.height);\n\t\tvar transparent = 0;\n\t\tfor (var y = 0; y < base.height; ++y) {\n\t\t\tfor (var x = 0; x < base.width; ++x) {\n\t\t\t\tif (!pixels.data[(x + y * base.width) * 4 + 3]) {\n\t\t\t\t\t++transparent;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tvar bytesInCanvas = transparent * 3 + (base.width * base.height - transparent);\n\t\tfor (var multiplier = 1; (bytesInCanvas * multiplier * multiplier) < blob.size; ++multiplier);\n\t\tvar edges = bytesInCanvas * multiplier * multiplier - blob.size;\n\t\tvar padding = Math.ceil(edges / (base.width * multiplier));\n\t\tcanvas.setAttribute('width', base.width * multiplier);\n\t\tcanvas.setAttribute('height', base.height * multiplier + padding);\n\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tvar view = new Uint8Array(data.target.result);\n\t\t\tvar pointer = 0;\n\t\t\tvar pixelPointer = 0;\n\t\t\tvar newPixels = context.createImageData(canvas.width, canvas.height + padding);\n\t\t\tfor (var y = 0; y < canvas.height; ++y) {\n\t\t\t\tfor (var x = 0; x < canvas.width; ++x) {\n\t\t\t\t\tvar oldY = (y / multiplier) | 0;\n\t\t\t\t\tvar oldX = (x / multiplier) | 0;\n\t\t\t\t\tif (oldY > base.height || !pixels.data[(oldX + oldY * base.width) * 4 + 3]) {\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = 0;\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar byte = view[pointer++];\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 0] | (byte & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 1] | ((byte >> 3) & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 2] | ((byte >> 6) & 7);\n\t\t\t\t\t\tnewPixels.data[pixelPointer++] = pixels.data[(oldX + oldY * base.width) * 4 + 3];\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tcontext.putImageData(newPixels, 0, 0);\n\t\t\tcallback(canvas.toDataURL('image/png'));\n\t\t}\n\t\treader.readAsArrayBuffer(blob);\n\t\treturn canvas;\n\t},\n\n\tdeserializePNG: function(blob, callback) {\n\t\tvar reader = new FileReader();\n\t\treader.onload = function(data) {\n\t\t\tvar image = document.createElement('img');\n\t\t\timage.setAttribute('src', data.target.result);\n\t\t\tvar canvas = document.createElement('canvas');\n\t\t\tcanvas.setAttribute('height', image.height);\n\t\t\tcanvas.setAttribute('width', image.width);\n\t\t\tvar context = canvas.getContext('2d');\n\t\t\tcontext.drawImage(image, 0, 0);\n\t\t\tvar pixels = context.getImageData(0, 0, canvas.width, canvas.height);\n\t\t\tvar data = [];\n\t\t\tfor (var y = 0; y < canvas.height; ++y) {\n\t\t\t\tfor (var x = 0; x < canvas.width; ++x) {\n\t\t\t\t\tif (!pixels.data[(x + y * canvas.width) * 4 + 3]) {\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 0]);\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 1]);\n\t\t\t\t\t\tdata.push(pixels.data[(x + y * canvas.width) * 4 + 2]);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tvar byte = 0;\n\t\t\t\t\t\tbyte |= pixels.data[(x + y * canvas.width) * 4 + 0] & 7;\n\t\t\t\t\t\tbyte |= (pixels.data[(x + y * canvas.width) * 4 + 1] & 7) << 3;\n\t\t\t\t\t\tbyte |= (pixels.data[(x + y * canvas.width) * 4 + 2] & 7) << 6;\n\t\t\t\t\t\tdata.push(byte);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tconst newBlob = new Blob(data.map(function (byte) {\n\t\t\t\tvar array = new Uint8Array(1);\n\t\t\t\tarray[0] = byte;\n\t\t\t\treturn array;\n\t\t\t}), { type: Serializer.TYPE});\n\t\t\tSerializer.deserialize(newBlob, callback);\n\t\t}\n\t\treader.readAsDataURL(blob);\n\t}\n};\n\nSerializer.pointer.prototype.advance = function(amount) {\n\tvar index = this.index;\n\tthis.index += amount;\n\treturn index;\n};\n\nSerializer.pointer.prototype.mark = function() {\n\treturn this.index - this.top;\n};\n\nSerializer.pointer.prototype.push = function() {\n\tthis.stack.push(this.top);\n\tthis.top = this.index;\n};\n\nSerializer.pointer.prototype.pop = function() {\n\tthis.top = this.stack.pop();\n};\n\nSerializer.pointer.prototype.readString = function(view) {\n\tvar length = view.getUint32(this.advance(4), true);\n\tvar bytes = [];\n\tfor (var i = 0; i < length; ++i) {\n\t\tbytes.push(String.fromCharCode(view.getUint8(this.advance(1))));\n\t}\n\treturn bytes.join('');\n};\n\nexport default Serializer;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { MemoryView } from './mmu';\n\nfunction SRAMSavedata(size) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.writePending = false;\n};\n\nSRAMSavedata.prototype = Object.create(MemoryView.prototype);\n\nSRAMSavedata.prototype.store8 = function(offset, value) {\n\tthis.view.setInt8(offset, value);\n\tthis.writePending = true;\n};\n\nSRAMSavedata.prototype.store16 = function(offset, value) {\n\tthis.view.setInt16(offset, value, true);\n\tthis.writePending = true;\n};\n\nSRAMSavedata.prototype.store32 = function(offset, value) {\n\tthis.view.setInt32(offset, value, true);\n\tthis.writePending = true;\n};\n\nfunction FlashSavedata(size) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.COMMAND_WIPE = 0x10;\n\tthis.COMMAND_ERASE_SECTOR = 0x30;\n\tthis.COMMAND_ERASE = 0x80;\n\tthis.COMMAND_ID = 0x90;\n\tthis.COMMAND_WRITE = 0xA0;\n\tthis.COMMAND_SWITCH_BANK = 0xB0;\n\tthis.COMMAND_TERMINATE_ID = 0xF0;\n\n\tthis.ID_PANASONIC = 0x1B32;\n\tthis.ID_SANYO = 0x1362;\n\n\tthis.bank0 = new DataView(this.buffer, 0, 0x00010000);\n\tif (size > 0x00010000) {\n\t\tthis.id = this.ID_SANYO;\n\t\tthis.bank1 = new DataView(this.buffer, 0x00010000);\n\t} else {\n\t\tthis.id = this.ID_PANASONIC;\n\t\tthis.bank1 = null;\n\t}\n\tthis.bank = this.bank0;\n\n\tthis.idMode = false;\n\tthis.writePending = false;\n\n\tthis.first = 0;\n\tthis.second = 0;\n\tthis.command = 0;\n\tthis.pendingCommand = 0;\n};\n\nFlashSavedata.prototype = Object.create(MemoryView.prototype);\n\nFlashSavedata.prototype.load8 = function(offset) {\n\tif (this.idMode && offset < 2) {\n\t\treturn (this.id >> (offset << 3)) & 0xFF;\n\t} else if (offset < 0x10000) {\n\t\treturn this.bank.getInt8(offset);\n\t} else {\n\t\treturn 0;\n\t}\n};\n\nFlashSavedata.prototype.load16 = function(offset) {\n\treturn (this.load8(offset) & 0xFF) | (this.load8(offset + 1) << 8);\n};\n\nFlashSavedata.prototype.load32 = function(offset) {\n\treturn (this.load8(offset) & 0xFF) | (this.load8(offset + 1) << 8) | (this.load8(offset + 2) << 16) | (this.load8(offset + 3) << 24);\n};\n\nFlashSavedata.prototype.loadU8 = function(offset) {\n\treturn this.load8(offset) & 0xFF;\n};\n\nFlashSavedata.prototype.loadU16 = function(offset) {\n\treturn (this.loadU8(offset) & 0xFF) | (this.loadU8(offset + 1) << 8);\n};\n\nFlashSavedata.prototype.store8 = function(offset, value) {\n\tswitch (this.command) {\n\tcase 0:\n\t\tif (offset == 0x5555) {\n\t\t\tif (this.second == 0x55) {\n\t\t\t\tswitch (value) {\n\t\t\t\tcase this.COMMAND_ERASE:\n\t\t\t\t\tthis.pendingCommand = value;\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.COMMAND_ID:\n\t\t\t\t\tthis.idMode = true;\n\t\t\t\t\tbreak;\n\t\t\t\tcase this.COMMAND_TERMINATE_ID:\n\t\t\t\t\tthis.idMode = false;\n\t\t\t\t\tbreak;\n\t\t\t\tdefault:\n\t\t\t\t\tthis.command = value;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\tthis.second = 0;\n\t\t\t\tthis.first = 0;\n\t\t\t} else {\n\t\t\t\tthis.command = 0;\n\t\t\t\tthis.first = value;\n\t\t\t\tthis.idMode = false;\n\t\t\t}\n\t\t} else if (offset == 0x2AAA && this.first == 0xAA) {\n\t\t\tthis.first = 0;\n\t\t\tif (this.pendingCommand) {\n\t\t\t\tthis.command = this.pendingCommand;\n\t\t\t} else {\n\t\t\t\tthis.second = value;\n\t\t\t}\n\t\t}\n\t\tbreak;\n\tcase this.COMMAND_ERASE:\n\t\tswitch (value) {\n\t\tcase this.COMMAND_WIPE:\n\t\t\tif (offset == 0x5555) {\n\t\t\t\tfor (var i = 0; i < this.view.byteLength; i += 4) {\n\t\t\t\t\tthis.view.setInt32(i, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\tcase this.COMMAND_ERASE_SECTOR:\n\t\t\tif ((offset & 0x0FFF) == 0) {\n\t\t\t\tfor (var i = offset; i < offset + 0x1000; i += 4) {\n\t\t\t\t\tthis.bank.setInt32(i, -1);\n\t\t\t\t}\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\tthis.pendingCommand = 0;\n\t\tthis.command = 0;\n\t\tbreak;\n\tcase this.COMMAND_WRITE:\n\t\tthis.bank.setInt8(offset, value);\n\t\tthis.command = 0;\n\n\t\tthis.writePending = true;\n\t\tbreak;\n\tcase this.COMMAND_SWITCH_BANK:\n\t\tif (this.bank1 && offset == 0) {\n\t\t\tif (value == 1) {\n\t\t\t\tthis.bank = this.bank1;\n\t\t\t} else {\n\t\t\t\tthis.bank = this.bank0;\n\t\t\t}\n\t\t}\n\t\tthis.command = 0;\n\t\tbreak;\n\t}\n};\n\nFlashSavedata.prototype.store16 = function(offset, value) {\n\tthrow new Error(\"Unaligned save to flash!\");\n};\n\nFlashSavedata.prototype.store32 = function(offset, value) {\n\tthrow new Error(\"Unaligned save to flash!\");\n};\n\nFlashSavedata.prototype.replaceData = function(memory) {\n\tvar bank = this.view === this.bank1;\n\tMemoryView.prototype.replaceData.call(this, memory, 0);\n\n\tthis.bank0 = new DataView(this.buffer, 0, 0x00010000);\n\tif (memory.byteLength > 0x00010000) {\n\t\tthis.bank1 = new DataView(this.buffer, 0x00010000);\n\t} else {\n\t\tthis.bank1 = null;\n\t}\n\tthis.bank = bank ? this.bank1 : this.bank0;\n};\n\nfunction EEPROMSavedata(size, mmu) {\n\tMemoryView.call(this, new ArrayBuffer(size), 0);\n\n\tthis.writeAddress = 0;\n\tthis.readBitsRemaining = 0;\n\tthis.readAddress = 0;\n\n\tthis.command = 0;\n\tthis.commandBitsRemaining = 0;\n\n\tthis.realSize = 0;\n\tthis.addressBits = 0;\n\tthis.writePending = false;\n\n\tthis.dma = mmu.core.irq.dma[3];\n\n\tthis.COMMAND_NULL = 0;\n\tthis.COMMAND_PENDING = 1;\n\tthis.COMMAND_WRITE = 2;\n\tthis.COMMAND_READ_PENDING = 3;\n\tthis.COMMAND_READ = 4;\n};\n\nEEPROMSavedata.prototype = Object.create(MemoryView.prototype);\n\nEEPROMSavedata.prototype.load8 = function(offset) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.load16 = function(offset) {\n\treturn this.loadU16(offset);\n};\n\nEEPROMSavedata.prototype.loadU8 = function(offset) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.loadU16 = function(offset) {\n\tif (this.command != this.COMMAND_READ || !this.dma.enable) {\n\t\treturn 1;\n\t}\n\t--this.readBitsRemaining;\n\tif (this.readBitsRemaining < 64) {\n\t\tvar step = 63 - this.readBitsRemaining;\n\t\tvar data = this.view.getUint8((this.readAddress + step) >> 3, false) >> (0x7 - (step & 0x7));\n\t\tif (!this.readBitsRemaining) {\n\t\t\tthis.command = this.COMMAND_NULL;\n\t\t}\n\t\treturn data & 0x1;\n\t}\n\treturn 0;\n};\n\nEEPROMSavedata.prototype.load32 = function(offset) {\n\tthrow new Error(\"Unsupported 32-bit access!\");\n};\n\nEEPROMSavedata.prototype.store8 = function(offset, value) {\n\tthrow new Error(\"Unsupported 8-bit access!\");\n};\n\nEEPROMSavedata.prototype.store16 = function(offset, value) {\n\tswitch (this.command) {\n\t// Read header\n\tcase this.COMMAND_NULL:\n\tdefault:\n\t\tthis.command = value & 0x1;\n\t\tbreak;\n\tcase this.COMMAND_PENDING:\n\t\tthis.command <<= 1;\n\t\tthis.command |= value & 0x1;\n\t\tif (this.command == this.COMMAND_WRITE) {\n\t\t\tif (!this.realSize) {\n\t\t\t\tvar bits = this.dma.count - 67;\n\t\t\t\tthis.realSize = 8 << bits;\n\t\t\t\tthis.addressBits = bits;\n\t\t\t}\n\t\t\tthis.commandBitsRemaining = this.addressBits + 64 + 1;\n\t\t\tthis.writeAddress = 0;\n\t\t} else {\n\t\t\tif (!this.realSize) {\n\t\t\t\tvar bits = this.dma.count - 3;\n\t\t\t\tthis.realSize = 8 << bits;\n\t\t\t\tthis.addressBits = bits;\n\t\t\t}\n\t\t\tthis.commandBitsRemaining = this.addressBits + 1;\n\t\t\tthis.readAddress = 0;\n\t\t}\n\t\tbreak;\n\t// Do commands\n\tcase this.COMMAND_WRITE:\n\t\t// Write\n\t\tif (--this.commandBitsRemaining > 64) {\n\t\t\tthis.writeAddress <<= 1;\n\t\t\tthis.writeAddress |= (value & 0x1) << 6;\n\t\t} else if (this.commandBitsRemaining <= 0) {\n\t\t\tthis.command = this.COMMAND_NULL;\n\t\t\tthis.writePending = true;\n\t\t} else {\n\t\t\tvar current = this.view.getUint8(this.writeAddress >> 3);\n\t\t\tcurrent &= ~(1 << (0x7 - (this.writeAddress & 0x7)));\n\t\t\tcurrent |= (value & 0x1) << (0x7 - (this.writeAddress & 0x7));\n\t\t\tthis.view.setUint8(this.writeAddress >> 3, current);\n\t\t\t++this.writeAddress;\n\t\t}\n\t\tbreak;\n\tcase this.COMMAND_READ_PENDING:\n\t\t// Read\n\t\tif (--this.commandBitsRemaining > 0) {\n\t\t\tthis.readAddress <<= 1;\n\t\t\tif (value & 0x1) {\n\t\t\t\tthis.readAddress |= 0x40;\n\t\t\t}\n\t\t} else {\n\t\t\tthis.readBitsRemaining = 68;\n\t\t\tthis.command = this.COMMAND_READ;\n\t\t}\n\t\tbreak;\n\t}\n};\n\nEEPROMSavedata.prototype.store32 = function(offset, value) {\n\tthrow new Error(\"Unsupported 32-bit access!\");\n};\n\nEEPROMSavedata.prototype.replaceData = function(memory) {\n\tMemoryView.prototype.replaceData.call(this, memory, 0);\n};\n\nexport {\n\tEEPROMSavedata,\n\tFlashSavedata,\n\tSRAMSavedata,\n};\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nfunction GameBoyAdvanceGPIO(core, rom) {\r\n\tthis.core = core;\r\n\tthis.rom = rom;\r\n\r\n\tthis.readWrite = 0;\r\n\tthis.direction = 0;\r\n\r\n\tthis.device = new GameBoyAdvanceRTC(this); // TODO: Support more devices\r\n};\r\n\r\nGameBoyAdvanceGPIO.prototype.store16 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase 0xC4:\r\n\t\tthis.device.setPins(value & 0xF);\r\n\t\tbreak;\r\n\tcase 0xC6:\r\n\t\tthis.direction = value & 0xF;\r\n\t\tthis.device.setDirection(this.direction);\r\n\t\tbreak;\r\n\tcase 0xC8:\r\n\t\tthis.readWrite = value & 1;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthrow new Error('BUG: Bad offset passed to GPIO: ' + offset.toString(16));\r\n\t}\r\n\tif (this.readWrite) {\r\n\t\tvar old = this.rom.view.getUint16(offset, true);\r\n\t\told &= ~this.direction;\r\n\t\tthis.rom.view.setUint16(offset, old | (value & this.direction), true);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceGPIO.prototype.outputPins = function(nybble) {\r\n\tif (this.readWrite) {\r\n\t\tvar old = this.rom.view.getUint16(0xC4, true);\r\n\t\told &= this.direction;\r\n\t\tthis.rom.view.setUint16(0xC4, old | (nybble & ~this.direction & 0xF), true);\r\n\t}\r\n};\r\n\r\nfunction GameBoyAdvanceRTC(gpio) {\r\n\tthis.gpio = gpio;\r\n\r\n\t// PINOUT: SCK | SIO | CS | -\r\n\tthis.pins = 0;\r\n\tthis.direction = 0;\r\n\r\n\tthis.totalBytes = [\r\n\t\t0, // Force reset\r\n\t\t0, // Empty\r\n\t\t7, // Date/Time\r\n\t\t0, // Force IRQ\r\n\t\t1, // Control register\r\n\t\t0, // Empty\r\n\t\t3, // Time\r\n\t\t0 // Empty\r\n\t];\r\n\tthis.bytesRemaining = 0;\r\n\r\n\t// Transfer sequence:\r\n\t// == Initiate\r\n\t// > HI | - | LO | -\r\n\t// > HI | - | HI | -\r\n\t// == Transfer bit (x8)\r\n\t// > LO | x | HI | -\r\n\t// > HI | - | HI | -\r\n\t// < ?? | x | ?? | -\r\n\t// == Terminate\r\n\t// >  - | - | LO | -\r\n\tthis.transferStep = 0;\r\n\r\n\tthis.reading = 0;\r\n\tthis.bitsRead = 0;\r\n\tthis.bits = 0;\r\n\tthis.command = -1;\r\n\r\n\tthis.control = 0x40;\r\n\tthis.time = [\r\n\t\t0, // Year\r\n\t\t0, // Month\r\n\t\t0, // Day\r\n\t\t0, // Day of week\r\n\t\t0, // Hour\r\n\t\t0, // Minute\r\n\t\t0 // Second\r\n\t];\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.setPins = function(nybble) {\r\n\tswitch (this.transferStep) {\r\n\tcase 0:\r\n\t\tif ((nybble & 5) == 1) {\r\n\t\t\tthis.transferStep = 1;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tif (nybble & 4) {\r\n\t\t\tthis.transferStep = 2;\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tif (!(nybble & 1)) {\r\n\t\t\tthis.bits &= ~(1 << this.bitsRead);\r\n\t\t\tthis.bits |= ((nybble & 2) >> 1) << this.bitsRead;\r\n\t\t} else {\r\n\t\t\tif (nybble & 4) {\r\n\t\t\t\t// SIO direction should always != this.read\r\n\t\t\t\tif ((this.direction & 2) && !this.read) {\r\n\t\t\t\t\t++this.bitsRead;\r\n\t\t\t\t\tif (this.bitsRead == 8) {\r\n\t\t\t\t\t\tthis.processByte();\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.gpio.outputPins(5 | (this.sioOutputPin() << 1));\r\n\t\t\t\t\t++this.bitsRead;\r\n\t\t\t\t\tif (this.bitsRead == 8) {\r\n\t\t\t\t\t\t--this.bytesRemaining;\r\n\t\t\t\t\t\tif (this.bytesRemaining <= 0) {\r\n\t\t\t\t\t\t\tthis.command = -1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tthis.bitsRead = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\tthis.bitsRead = 0;\r\n\t\t\t\tthis.bytesRemaining = 0;\r\n\t\t\t\tthis.command = -1;\r\n\t\t\t\tthis.transferStep = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\tbreak;\r\n\t}\r\n\r\n\tthis.pins = nybble & 7;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.setDirection = function(direction) {\r\n\tthis.direction = direction;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.processByte = function() {\r\n\t--this.bytesRemaining;\r\n\tswitch (this.command) {\r\n\tcase -1:\r\n\t\tif ((this.bits & 0x0F) == 0x06) {\r\n\t\t\tthis.command = (this.bits >> 4) & 7;\r\n\t\t\tthis.reading = this.bits & 0x80;\r\n\r\n\t\t\tthis.bytesRemaining = this.totalBytes[this.command];\r\n\t\t\tswitch (this.command) {\r\n\t\t\tcase 0:\r\n\t\t\t\tthis.control = 0;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2:\r\n\t\t\tcase 6:\r\n\t\t\t\tthis.updateClock();\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tthis.gpio.core.WARN('Invalid RTC command byte: ' + this.bits.toString(16));\r\n\t\t}\r\n\t\tbreak;\r\n\tcase 4:\r\n\t\t// Control\r\n\t\tthis.control = this.bits & 0x40;\r\n\t\tbreak;\r\n\t}\t\r\n\tthis.bits = 0;\r\n\tthis.bitsRead = 0;\r\n\tif (!this.bytesRemaining) {\r\n\t\tthis.command = -1;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.sioOutputPin = function() {\r\n\tvar outputByte = 0;\r\n\tswitch (this.command) {\r\n\tcase 4:\r\n\t\toutputByte = this.control;\r\n\t\tbreak;\r\n\tcase 2:\r\n\tcase 6:\r\n\t\toutputByte = this.time[7 - this.bytesRemaining];\r\n\t\tbreak;\r\n\t}\r\n\tvar output = (outputByte >> this.bitsRead) & 1;\r\n\treturn output;\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.updateClock = function() {\r\n\tvar date = new Date();\r\n\tthis.time[0] = this.bcd(date.getFullYear());\r\n\tthis.time[1] = this.bcd(date.getMonth() + 1);\r\n\tthis.time[2] = this.bcd(date.getDate());\r\n\tthis.time[3] = date.getDay() - 1;\r\n\tif (this.time[3] < 0) {\r\n\t\tthis.time[3] = 6;\r\n\t}\r\n\tif (this.control & 0x40) {\r\n\t\t// 24 hour\r\n\t\tthis.time[4] = this.bcd(date.getHours());\r\n\t} else {\r\n\t\tthis.time[4] = this.bcd(date.getHours() % 2);\r\n\t\tif (date.getHours() >= 12) {\r\n\t\t\tthis.time[4] |= 0x80;\r\n\t\t}\r\n\t}\r\n\tthis.time[5] = this.bcd(date.getMinutes());\r\n\tthis.time[6] = this.bcd(date.getSeconds());\r\n};\r\n\r\nGameBoyAdvanceRTC.prototype.bcd = function(binary) {\r\n\tvar counter = binary % 10;\r\n\tbinary /= 10;\r\n\tcounter += (binary % 10) << 4;\r\n\treturn counter;\r\n};\r\n\r\nexport default GameBoyAdvanceGPIO;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport Serializer from './util';\nimport {\n\tFlashSavedata,\n\tEEPROMSavedata,\n\tSRAMSavedata,\n} from './savedata';\nimport GameBoyAdvanceGPIO from './gpio';\n\nfunction MemoryView(memory, offset) {\n\tthis.inherit();\n\tthis.buffer = memory;\n\tthis.view = new DataView(this.buffer, typeof(offset) === \"number\" ? offset : 0);\n\tthis.mask = memory.byteLength - 1;\n\tthis.resetMask();\n};\n\nMemoryView.prototype.resetMask = function() {\n\tthis.mask8 = this.mask & 0xFFFFFFFF;\n\tthis.mask16 = this.mask & 0xFFFFFFFE;\n\tthis.mask32 = this.mask & 0xFFFFFFFC;\n};\n\nMemoryView.prototype.load8 = function(offset) {\n\treturn this.view.getInt8(offset & this.mask8);\n};\n\nMemoryView.prototype.load16 = function(offset) {\n\t// Unaligned 16-bit loads are unpredictable...let's just pretend they work\n\treturn this.view.getInt16(offset & this.mask, true);\n};\n\nMemoryView.prototype.loadU8 = function(offset) {\n\treturn this.view.getUint8(offset & this.mask8);\n};\n\nMemoryView.prototype.loadU16 = function(offset) {\n\t// Unaligned 16-bit loads are unpredictable...let's just pretend they work\n\treturn this.view.getUint16(offset & this.mask, true);\n};\n\nMemoryView.prototype.load32 = function(offset) {\n\t// Unaligned 32-bit loads are \"rotated\" so they make some semblance of sense\n\tvar rotate = (offset & 3) << 3;\n\tvar mem = this.view.getInt32(offset & this.mask32, true);\n\treturn (mem >>> rotate) | (mem << (32 - rotate));\n};\n\nMemoryView.prototype.store8 = function(offset, value) {\n\tthis.view.setInt8(offset & this.mask8, value);\n};\n\nMemoryView.prototype.store16 = function(offset, value) {\n\tthis.view.setInt16(offset & this.mask16, value, true);\n};\n\nMemoryView.prototype.store32 = function(offset, value) {\n\tthis.view.setInt32(offset & this.mask32, value, true);\n};\n\nMemoryView.prototype.invalidatePage = function(address) {};\n\nMemoryView.prototype.replaceData = function(memory, offset) {\n\tthis.buffer = memory;\n\tthis.view = new DataView(this.buffer, typeof(offset) === \"number\" ? offset : 0);\n\tif (this.icache) {\n\t\tthis.icache = new Array(this.icache.length);\n\t}\n};\n\nfunction MemoryBlock(size, cacheBits) {\n\tMemoryView.call(this, new ArrayBuffer(size));\n\tthis.ICACHE_PAGE_BITS = cacheBits;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(size >> (this.ICACHE_PAGE_BITS + 1));\n};\n\nMemoryBlock.prototype = Object.create(MemoryView.prototype);\n\nMemoryBlock.prototype.invalidatePage = function(address) {\n\tvar page = this.icache[(address & this.mask) >> this.ICACHE_PAGE_BITS];\n\tif (page) {\n\t\tpage.invalid = true;\n\t}\n};\n\nfunction ROMView(rom, offset) {\n\tMemoryView.call(this, rom, offset);\n\tthis.ICACHE_PAGE_BITS = 10;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(rom.byteLength >> (this.ICACHE_PAGE_BITS + 1));\n\tthis.mask = 0x01FFFFFF;\n\tthis.resetMask();\n};\n\nROMView.prototype = Object.create(MemoryView.prototype);\n\nROMView.prototype.store8 = function(offset, value) {};\n\nROMView.prototype.store16 = function(offset, value) {\n\tif (offset < 0xCA && offset >= 0xC4) {\n\t\tif (!this.gpio) {\n\t\t\tthis.gpio = this.mmu.allocGPIO(this);\n\t\t}\n\t\tthis.gpio.store16(offset, value);\n\t}\n};\n\nROMView.prototype.store32 = function(offset, value) {\n\tif (offset < 0xCA && offset >= 0xC4) {\n\t\tif (!this.gpio) {\n\t\t\tthis.gpio = this.mmu.allocGPIO(this);\n\t\t}\n\t\tthis.gpio.store32(offset, value);\n\t}\n};\n\nfunction BIOSView(rom, offset) {\n\tMemoryView.call(this, rom, offset);\n\tthis.ICACHE_PAGE_BITS = 16;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\tthis.icache = new Array(1);\n};\n\nBIOSView.prototype = Object.create(MemoryView.prototype);\n\nBIOSView.prototype.load8 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt8(offset);\n};\n\nBIOSView.prototype.load16 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt16(offset, true);\n};\n\nBIOSView.prototype.loadU8 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getUint8(offset);\n};\n\nBIOSView.prototype.loadU16 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getUint16(offset, true);\n};\n\nBIOSView.prototype.load32 = function(offset) {\n\tif (offset >= this.buffer.byteLength) {\n\t\treturn -1;\n\t}\n\treturn this.view.getInt32(offset, true);\n};\n\nBIOSView.prototype.store8 = function(offset, value) {};\n\nBIOSView.prototype.store16 = function(offset, value) {};\n\nBIOSView.prototype.store32 = function(offset, value) {};\n\nfunction BadMemory(mmu, cpu) {\n\tthis.inherit();\n\tthis.cpu = cpu;\n\tthis.mmu = mmu\n};\n\nBadMemory.prototype.load8 = function(offset) {\n\treturn this.mmu.load8(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x3));\n};\n\nBadMemory.prototype.load16 = function(offset) {\n\treturn this.mmu.load16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x2));\n};\n\nBadMemory.prototype.loadU8 = function(offset) {\n\treturn this.mmu.loadU8(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x3));\n};\n\nBadMemory.prototype.loadU16 = function(offset) {\n\treturn this.mmu.loadU16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth + (offset & 0x2));\n};\n\nBadMemory.prototype.load32 = function(offset) {\n\tif (this.cpu.execMode == this.cpu.MODE_ARM) {\n\t\treturn this.mmu.load32(this.cpu.gprs[this.cpu.gprs.PC] - this.cpu.instructionWidth);\n\t} else {\n\t\tvar halfword = this.mmu.loadU16(this.cpu.gprs[this.cpu.PC] - this.cpu.instructionWidth);\n\t\treturn halfword | (halfword << 16);\n\t}\n};\n\nBadMemory.prototype.store8 = function(offset, value) {};\n\nBadMemory.prototype.store16 = function(offset, value) {};\n\nBadMemory.prototype.store32 = function(offset, value) {};\n\nBadMemory.prototype.invalidatePage = function(address) {};\n\nfunction GameBoyAdvanceMMU() {\n\tthis.inherit();\n\tthis.REGION_BIOS = 0x0;\n\tthis.REGION_WORKING_RAM = 0x2;\n\tthis.REGION_WORKING_IRAM = 0x3;\n\tthis.REGION_IO = 0x4;\n\tthis.REGION_PALETTE_RAM = 0x5;\n\tthis.REGION_VRAM = 0x6;\n\tthis.REGION_OAM = 0x7;\n\tthis.REGION_CART0 = 0x8;\n\tthis.REGION_CART1 = 0xA;\n\tthis.REGION_CART2 = 0xC;\n\tthis.REGION_CART_SRAM = 0xE;\n\n\tthis.BASE_BIOS = 0x00000000;\n\tthis.BASE_WORKING_RAM = 0x02000000;\n\tthis.BASE_WORKING_IRAM = 0x03000000;\n\tthis.BASE_IO = 0x04000000;\n\tthis.BASE_PALETTE_RAM = 0x05000000;\n\tthis.BASE_VRAM = 0x06000000;\n\tthis.BASE_OAM = 0x07000000;\n\tthis.BASE_CART0 = 0x08000000;\n\tthis.BASE_CART1 = 0x0A000000;\n\tthis.BASE_CART2 = 0x0C000000;\n\tthis.BASE_CART_SRAM = 0x0E000000;\n\n\tthis.BASE_MASK = 0x0F000000;\n\tthis.BASE_OFFSET = 24;\n\tthis.OFFSET_MASK = 0x00FFFFFF;\n\n\tthis.SIZE_BIOS = 0x00004000;\n\tthis.SIZE_WORKING_RAM = 0x00040000;\n\tthis.SIZE_WORKING_IRAM = 0x00008000;\n\tthis.SIZE_IO = 0x00000400;\n\tthis.SIZE_PALETTE_RAM = 0x00000400;\n\tthis.SIZE_VRAM = 0x00018000;\n\tthis.SIZE_OAM = 0x00000400;\n\tthis.SIZE_CART0 = 0x02000000;\n\tthis.SIZE_CART1 = 0x02000000;\n\tthis.SIZE_CART2 = 0x02000000;\n\tthis.SIZE_CART_SRAM = 0x00008000;\n\tthis.SIZE_CART_FLASH512 = 0x00010000;\n\tthis.SIZE_CART_FLASH1M = 0x00020000;\n\tthis.SIZE_CART_EEPROM = 0x00002000;\n\n\tthis.DMA_TIMING_NOW = 0;\n\tthis.DMA_TIMING_VBLANK = 1;\n\tthis.DMA_TIMING_HBLANK = 2;\n\tthis.DMA_TIMING_CUSTOM = 3;\n\n\tthis.DMA_INCREMENT = 0;\n\tthis.DMA_DECREMENT = 1;\n\tthis.DMA_FIXED = 2;\n\tthis.DMA_INCREMENT_RELOAD = 3;\n\n\tthis.DMA_OFFSET = [ 1, -1, 0, 1 ];\n\n\tthis.WAITSTATES = [ 0, 0, 2, 0, 0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4 ];\n\tthis.WAITSTATES_32 = [ 0, 0, 5, 0, 0, 1, 0, 1, 7, 7, 9, 9, 13, 13, 8 ];\n\tthis.WAITSTATES_SEQ = [ 0, 0, 2, 0, 0, 0, 0, 0, 2, 2, 4, 4, 8, 8, 4 ];\n\tthis.WAITSTATES_SEQ_32 = [ 0, 0, 5, 0, 0, 1, 0, 1, 5, 5, 9, 9, 17, 17, 8 ];\n\tthis.NULLWAIT = [ 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0 ];\n\n\tfor (var i = 15; i < 256; ++i) {\n\t\tthis.WAITSTATES[i] = 0;\n\t\tthis.WAITSTATES_32[i] = 0;\n\t\tthis.WAITSTATES_SEQ[i] = 0;\n\t\tthis.WAITSTATES_SEQ_32[i] = 0;\n\t\tthis.NULLWAIT[i] = 0;\n\t}\n\n\tthis.ROM_WS = [ 4, 3, 2, 8 ];\n\tthis.ROM_WS_SEQ = [\n\t\t[ 2, 1 ],\n\t\t[ 4, 1 ],\n\t\t[ 8, 1 ]\n\t];\n\n\tthis.ICACHE_PAGE_BITS = 8;\n\tthis.PAGE_MASK = (2 << this.ICACHE_PAGE_BITS) - 1;\n\n\tthis.bios = null;\n};\n\nGameBoyAdvanceMMU.prototype.mmap = function(region, object) {\n\tthis.memory[region] = object;\n}\n\nGameBoyAdvanceMMU.prototype.clear = function() {\n\tthis.badMemory = new BadMemory(this, this.cpu);\n\tthis.memory = [\n\t\tthis.bios,\n\t\tthis.badMemory, // Unused\n\t\tnew MemoryBlock(this.SIZE_WORKING_RAM, 9),\n\t\tnew MemoryBlock(this.SIZE_WORKING_IRAM, 7),\n\t\tnull, // This is owned by GameBoyAdvanceIO\n\t\tnull, // This is owned by GameBoyAdvancePalette\n\t\tnull, // This is owned by GameBoyAdvanceVRAM\n\t\tnull, // This is owned by GameBoyAdvanceOAM\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory,\n\t\tthis.badMemory // Unused\n\t];\n\tfor (var i = 16; i < 256; ++i) {\n\t\tthis.memory[i] = this.badMemory;\n\t}\n\n\tthis.waitstates = this.WAITSTATES.slice(0);\n\tthis.waitstatesSeq = this.WAITSTATES_SEQ.slice(0);\n\tthis.waitstates32 = this.WAITSTATES_32.slice(0);\n\tthis.waitstatesSeq32 = this.WAITSTATES_SEQ_32.slice(0);\n\tthis.waitstatesPrefetch = this.WAITSTATES_SEQ.slice(0);\n\tthis.waitstatesPrefetch32 = this.WAITSTATES_SEQ_32.slice(0);\n\n\tthis.cart = null;\n\tthis.save = null;\n\n\tthis.DMA_REGISTER = [\n\t\tthis.core.io.DMA0CNT_HI >> 1,\n\t\tthis.core.io.DMA1CNT_HI >> 1,\n\t\tthis.core.io.DMA2CNT_HI >> 1,\n\t\tthis.core.io.DMA3CNT_HI >> 1\n\t];\n};\n\nGameBoyAdvanceMMU.prototype.freeze = function() {\n\treturn {\n\t\t'ram': Serializer.prefix(this.memory[this.REGION_WORKING_RAM].buffer),\n\t\t'iram': Serializer.prefix(this.memory[this.REGION_WORKING_IRAM].buffer),\n\t};\n};\n\nGameBoyAdvanceMMU.prototype.defrost = function(frost) {\n\tthis.memory[this.REGION_WORKING_RAM].replaceData(frost.ram);\n\tthis.memory[this.REGION_WORKING_IRAM].replaceData(frost.iram);\n};\n\nGameBoyAdvanceMMU.prototype.loadBios = function(bios, real) {\n\tthis.bios = new BIOSView(bios);\n\tthis.bios.real = !!real;\n};\n\nGameBoyAdvanceMMU.prototype.loadRom = function(rom, process) {\n\tvar cart = {\n\t\ttitle: null,\n\t\tcode: null,\n\t\tmaker: null,\n\t\tmemory: rom,\n\t\tsaveType: null,\n\t};\n\n\tvar lo = new ROMView(rom);\n\tif (lo.view.getUint8(0xB2) != 0x96) {\n\t\t// Not a valid ROM\n\t\treturn null;\n\t}\n\tlo.mmu = this; // Needed for GPIO\n\tthis.memory[this.REGION_CART0] = lo;\n\tthis.memory[this.REGION_CART1] = lo;\n\tthis.memory[this.REGION_CART2] = lo;\n\n\tif (rom.byteLength > 0x01000000) {\n\t\tvar hi = new ROMView(rom, 0x01000000);\n\t\tthis.memory[this.REGION_CART0 + 1] = hi;\n\t\tthis.memory[this.REGION_CART1 + 1] = hi;\n\t\tthis.memory[this.REGION_CART2 + 1] = hi;\n\t}\n\n\tif (process) {\n\t\tvar name = '';\n\t\tfor (var i = 0; i < 12; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xA0);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tname += String.fromCharCode(c);\n\t\t}\n\t\tcart.title = name;\n\n\t\tvar code = '';\n\t\tfor (var i = 0; i < 4; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xAC);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tcode += String.fromCharCode(c);\n\t\t}\n\t\tcart.code = code;\n\n\t\tvar maker = '';\n\t\tfor (var i = 0; i < 2; ++i) {\n\t\t\tvar c = lo.loadU8(i + 0xB0);\n\t\t\tif (!c) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tmaker += String.fromCharCode(c);\n\t\t}\n\t\tcart.maker = maker;\n\n\t\t// Find savedata type\n\t\tvar state = '';\n\t\tvar next;\n\t\tvar terminal = false;\n\t\tfor (var i = 0xE4; i < rom.byteLength && !terminal; ++i) {\n\t\t\tnext = String.fromCharCode(lo.loadU8(i));\n\t\t\tstate += next;\n\t\t\tswitch (state) {\n\t\t\tcase 'F':\n\t\t\tcase 'FL':\n\t\t\tcase 'FLA':\n\t\t\tcase 'FLAS':\n\t\t\tcase 'FLASH':\n\t\t\tcase 'FLASH_':\n\t\t\tcase 'FLASH5':\n\t\t\tcase 'FLASH51':\n\t\t\tcase 'FLASH512':\n\t\t\tcase 'FLASH512_':\n\t\t\tcase 'FLASH1':\n\t\t\tcase 'FLASH1M':\n\t\t\tcase 'FLASH1M_':\n\t\t\tcase 'S':\n\t\t\tcase 'SR':\n\t\t\tcase 'SRA':\n\t\t\tcase 'SRAM':\n\t\t\tcase 'SRAM_':\n\t\t\tcase 'E':\n\t\t\tcase 'EE':\n\t\t\tcase 'EEP':\n\t\t\tcase 'EEPR':\n\t\t\tcase 'EEPRO':\n\t\t\tcase 'EEPROM':\n\t\t\tcase 'EEPROM_':\n\t\t\t\tbreak;\n\t\t\tcase 'FLASH_V':\n\t\t\tcase 'FLASH512_V':\n\t\t\tcase 'FLASH1M_V':\n\t\t\tcase 'SRAM_V':\n\t\t\tcase 'EEPROM_V':\n\t\t\t\tterminal = true;\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tstate = next;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (terminal) {\n\t\t\tcart.saveType = state;\n\t\t\tswitch (state) {\n\t\t\tcase 'FLASH_V':\n\t\t\tcase 'FLASH512_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new FlashSavedata(this.SIZE_CART_FLASH512);\n\t\t\t\tbreak;\n\t\t\tcase 'FLASH1M_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new FlashSavedata(this.SIZE_CART_FLASH1M);\n\t\t\t\tbreak;\n\t\t\tcase 'SRAM_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new SRAMSavedata(this.SIZE_CART_SRAM);\n\t\t\t\tbreak;\n\t\t\tcase 'EEPROM_V':\n\t\t\t\tthis.save = this.memory[this.REGION_CART2 + 1] = new EEPROMSavedata(this.SIZE_CART_EEPROM, this);\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tif (!this.save) {\n\t\t\t// Assume we have SRAM\n\t\t\tthis.save = this.memory[this.REGION_CART_SRAM] = new SRAMSavedata(this.SIZE_CART_SRAM);\n\t\t}\n\t}\n\n\tthis.cart = cart;\n\treturn cart;\n};\n\nGameBoyAdvanceMMU.prototype.loadSavedata = function(save) {\n\tthis.save.replaceData(save);\n};\n\nGameBoyAdvanceMMU.prototype.load8 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load8(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.load16 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load16(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.load32 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].load32(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.loadU8 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].loadU8(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.loadU16 = function(offset) {\n\treturn this.memory[offset >>> this.BASE_OFFSET].loadU16(offset & 0x00FFFFFF);\n};\n\nGameBoyAdvanceMMU.prototype.store8 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFF;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store8(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n};\n\nGameBoyAdvanceMMU.prototype.store16 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFE;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store16(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n};\n\nGameBoyAdvanceMMU.prototype.store32 = function(offset, value) {\n\tvar maskedOffset = offset & 0x00FFFFFC;\n\tvar memory = this.memory[offset >>> this.BASE_OFFSET];\n\tmemory.store32(maskedOffset, value);\n\tmemory.invalidatePage(maskedOffset);\n\tmemory.invalidatePage(maskedOffset + 2);\n};\n\nGameBoyAdvanceMMU.prototype.waitPrefetch = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesPrefetch[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitPrefetch32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesPrefetch32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.wait = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstates[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.wait32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstates32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitSeq = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesSeq[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitSeq32 = function(memory) {\n\tthis.cpu.cycles += 1 + this.waitstatesSeq32[memory >>> this.BASE_OFFSET];\n};\n\nGameBoyAdvanceMMU.prototype.waitMul = function(rs) {\n\tif ((rs & 0xFFFFFF00 == 0xFFFFFF00) || !(rs & 0xFFFFFF00)) {\n\t\tthis.cpu.cycles += 1;\n\t} else if ((rs & 0xFFFF0000 == 0xFFFF0000) || !(rs & 0xFFFF0000)) {\n\t\tthis.cpu.cycles += 2;\n\t} else if ((rs & 0xFF000000 == 0xFF000000) || !(rs & 0xFF000000)) {\n\t\tthis.cpu.cycles += 3;\n\t} else {\n\t\tthis.cpu.cycles += 4;\n\t}\n}\n\nGameBoyAdvanceMMU.prototype.waitMulti32 = function(memory, seq) {\n\tthis.cpu.cycles += 1 + this.waitstates32[memory >>> this.BASE_OFFSET];\n\tthis.cpu.cycles += (1 + this.waitstatesSeq32[memory >>> this.BASE_OFFSET]) * (seq - 1);\n};\n\nGameBoyAdvanceMMU.prototype.addressToPage = function(region, address) {\n\treturn address >> this.memory[region].ICACHE_PAGE_BITS;\n};\n\nGameBoyAdvanceMMU.prototype.accessPage = function(region, pageId) {\n\tvar memory = this.memory[region];\n\tvar page = memory.icache[pageId];\n\tif (!page || page.invalid) {\n\t\tpage = {\n\t\t\tthumb: new Array(1 << (memory.ICACHE_PAGE_BITS)),\n\t\t\tarm: new Array(1 << memory.ICACHE_PAGE_BITS - 1),\n\t\t\tinvalid: false\n\t\t}\n\t\tmemory.icache[pageId] = page;\n\t}\n\treturn page;\n};\n\nGameBoyAdvanceMMU.prototype.scheduleDma = function(number, info) {\n\tswitch (info.timing) {\n\tcase this.DMA_TIMING_NOW:\n\t\tthis.serviceDma(number, info);\n\t\tbreak;\n\tcase this.DMA_TIMING_HBLANK:\n\t\t// Handled implicitly\n\t\tbreak;\n\tcase this.DMA_TIMING_VBLANK:\n\t\t// Handled implicitly\n\t\tbreak;\n\tcase this.DMA_TIMING_CUSTOM:\n\t\tswitch (number) {\n\t\tcase 0:\n\t\t\tthis.core.WARN('Discarding invalid DMA0 scheduling');\n\t\t\tbreak;\n\t\tcase 1:\n\t\tcase 2:\n\t\t\tthis.cpu.irq.audio.scheduleFIFODma(number, info);\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\t// Check if something happens\n\t\t\tthis.cpu.irq.video.scheduleVCaptureDma(number, info);\n\t\t\tbreak;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.runHblankDmas = function() {\n\tvar dma;\n\tfor (var i = 0; i < this.cpu.irq.dma.length; ++i) {\n\t\tdma = this.cpu.irq.dma[i];\n\t\tif (dma.enable && dma.timing == this.DMA_TIMING_HBLANK) {\n\t\t\tthis.serviceDma(i, dma);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.runVblankDmas = function() {\n\tvar dma;\n\tfor (var i = 0; i < this.cpu.irq.dma.length; ++i) {\n\t\tdma = this.cpu.irq.dma[i];\n\t\tif (dma.enable && dma.timing == this.DMA_TIMING_VBLANK) {\n\t\t\tthis.serviceDma(i, dma);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.serviceDma = function(number, info) {\n\tif (!info.enable) {\n\t\t// There was a DMA scheduled that got canceled\n\t\treturn;\n\t}\n\n\tvar width = info.width;\n\tvar sourceOffset = this.DMA_OFFSET[info.srcControl] * width;\n\tvar destOffset = this.DMA_OFFSET[info.dstControl] * width;\n\tvar wordsRemaining = info.nextCount;\n\tvar source = info.nextSource & this.OFFSET_MASK;\n\tvar dest = info.nextDest & this.OFFSET_MASK;\n\tvar sourceRegion = info.nextSource >>> this.BASE_OFFSET;\n\tvar destRegion = info.nextDest >>> this.BASE_OFFSET;\n\tvar sourceBlock = this.memory[sourceRegion];\n\tvar destBlock = this.memory[destRegion];\n\tvar sourceView = null;\n\tvar destView = null;\n\tvar sourceMask = 0xFFFFFFFF;\n\tvar destMask = 0xFFFFFFFF;\n\tvar word;\n\n\tif (destBlock.ICACHE_PAGE_BITS) {\n\t\tvar endPage = (dest + wordsRemaining * width) >> destBlock.ICACHE_PAGE_BITS;\n\t\tfor (var i = dest >> destBlock.ICACHE_PAGE_BITS; i <= endPage; ++i) {\n\t\t\tdestBlock.invalidatePage(i << destBlock.ICACHE_PAGE_BITS);\n\t\t}\n\t}\n\n\tif (destRegion == this.REGION_WORKING_RAM || destRegion == this.REGION_WORKING_IRAM) {\n\t\tdestView = destBlock.view;\n\t\tdestMask = destBlock.mask;\n\t}\n\n\tif (sourceRegion == this.REGION_WORKING_RAM || sourceRegion == this.REGION_WORKING_IRAM || sourceRegion == this.REGION_CART0 || sourceRegion == this.REGION_CART1) {\n\t\tsourceView = sourceBlock.view;\n\t\tsourceMask = sourceBlock.mask;\n\t}\n\n\tif (sourceBlock && destBlock) {\n\t\tif (sourceView && destView) {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getInt32(source & sourceMask);\n\t\t\t\t\tdestView.setInt32(dest & destMask, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getUint16(source & sourceMask);\n\t\t\t\t\tdestView.setUint16(dest & destMask, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t} else if (sourceView) {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getInt32(source & sourceMask, true);\n\t\t\t\t\tdestBlock.store32(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceView.getUint16(source & sourceMask, true);\n\t\t\t\t\tdestBlock.store16(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (width == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceBlock.load32(source);\n\t\t\t\t\tdestBlock.store32(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\twhile (wordsRemaining--) {\n\t\t\t\t\tword = sourceBlock.loadU16(source);\n\t\t\t\t\tdestBlock.store16(dest, word);\n\t\t\t\t\tsource += sourceOffset;\n\t\t\t\t\tdest += destOffset;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t} else {\n\t\tthis.core.WARN('Invalid DMA');\n\t}\n\n\tif (info.doIrq) {\n\t\tinfo.nextIRQ = this.cpu.cycles + 2;\n\t\tinfo.nextIRQ += (width == 4 ? this.waitstates32[sourceRegion] + this.waitstates32[destRegion]\n\t\t                            : this.waitstates[sourceRegion] + this.waitstates[destRegion]);\n\t\tinfo.nextIRQ += (info.count - 1) * (width == 4 ? this.waitstatesSeq32[sourceRegion] + this.waitstatesSeq32[destRegion]\n\t\t                                               : this.waitstatesSeq[sourceRegion] + this.waitstatesSeq[destRegion]);\n\t}\n\n\tinfo.nextSource = source | (sourceRegion << this.BASE_OFFSET);\n\tinfo.nextDest = dest | (destRegion << this.BASE_OFFSET);\n\tinfo.nextCount = wordsRemaining;\n\n\tif (!info.repeat) {\n\t\tinfo.enable = false;\n\n\t\t// Clear the enable bit in memory\n\t\tvar io = this.memory[this.REGION_IO];\n\t\tio.registers[this.DMA_REGISTER[number]] &= 0x7FE0;\n\t} else {\n\t\tinfo.nextCount = info.count;\n\t\tif (info.dstControl == this.DMA_INCREMENT_RELOAD) {\n\t\t\tinfo.nextDest = info.dest;\n\t\t}\n\t\tthis.scheduleDma(number, info);\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.adjustTimings = function(word) {\n\tvar sram = word & 0x0003;\n\tvar ws0 = (word & 0x000C) >> 2;\n\tvar ws0seq = (word & 0x0010) >> 4;\n\tvar ws1 = (word & 0x0060) >> 5;\n\tvar ws1seq = (word & 0x0080) >> 7;\n\tvar ws2 = (word & 0x0300) >> 8;\n\tvar ws2seq = (word & 0x0400) >> 10;\n\tvar prefetch = word & 0x4000;\n\n\tthis.waitstates[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstatesSeq[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstates32[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\tthis.waitstatesSeq32[this.REGION_CART_SRAM] = this.ROM_WS[sram];\n\n\tthis.waitstates[this.REGION_CART0] = this.waitstates[this.REGION_CART0 + 1] = this.ROM_WS[ws0];\n\tthis.waitstates[this.REGION_CART1] = this.waitstates[this.REGION_CART1 + 1] = this.ROM_WS[ws1];\n\tthis.waitstates[this.REGION_CART2] = this.waitstates[this.REGION_CART2 + 1] = this.ROM_WS[ws2];\n\n\tthis.waitstatesSeq[this.REGION_CART0] = this.waitstatesSeq[this.REGION_CART0 + 1] = this.ROM_WS_SEQ[0][ws0seq];\n\tthis.waitstatesSeq[this.REGION_CART1] = this.waitstatesSeq[this.REGION_CART1 + 1] = this.ROM_WS_SEQ[1][ws1seq];\n\tthis.waitstatesSeq[this.REGION_CART2] = this.waitstatesSeq[this.REGION_CART2 + 1] = this.ROM_WS_SEQ[2][ws2seq];\n\n\tthis.waitstates32[this.REGION_CART0] = this.waitstates32[this.REGION_CART0 + 1] = this.waitstates[this.REGION_CART0] + 1 + this.waitstatesSeq[this.REGION_CART0];\n\tthis.waitstates32[this.REGION_CART1] = this.waitstates32[this.REGION_CART1 + 1] = this.waitstates[this.REGION_CART1] + 1 + this.waitstatesSeq[this.REGION_CART1];\n\tthis.waitstates32[this.REGION_CART2] = this.waitstates32[this.REGION_CART2 + 1] = this.waitstates[this.REGION_CART2] + 1 + this.waitstatesSeq[this.REGION_CART2];\n\n\tthis.waitstatesSeq32[this.REGION_CART0] = this.waitstatesSeq32[this.REGION_CART0 + 1] = 2 * this.waitstatesSeq[this.REGION_CART0] + 1;\n\tthis.waitstatesSeq32[this.REGION_CART1] = this.waitstatesSeq32[this.REGION_CART1 + 1] = 2 * this.waitstatesSeq[this.REGION_CART1] + 1;\n\tthis.waitstatesSeq32[this.REGION_CART2] = this.waitstatesSeq32[this.REGION_CART2 + 1] = 2 * this.waitstatesSeq[this.REGION_CART2] + 1;\n\n\tif (prefetch) {\n\t\tthis.waitstatesPrefetch[this.REGION_CART0] = this.waitstatesPrefetch[this.REGION_CART0 + 1] = 0;\n\t\tthis.waitstatesPrefetch[this.REGION_CART1] = this.waitstatesPrefetch[this.REGION_CART1 + 1] = 0;\n\t\tthis.waitstatesPrefetch[this.REGION_CART2] = this.waitstatesPrefetch[this.REGION_CART2 + 1] = 0;\n\n\t\tthis.waitstatesPrefetch32[this.REGION_CART0] = this.waitstatesPrefetch32[this.REGION_CART0 + 1] = 0;\n\t\tthis.waitstatesPrefetch32[this.REGION_CART1] = this.waitstatesPrefetch32[this.REGION_CART1 + 1] = 0;\n\t\tthis.waitstatesPrefetch32[this.REGION_CART2] = this.waitstatesPrefetch32[this.REGION_CART2 + 1] = 0;\n\t} else {\n\t\tthis.waitstatesPrefetch[this.REGION_CART0] = this.waitstatesPrefetch[this.REGION_CART0 + 1] = this.waitstatesSeq[this.REGION_CART0];\n\t\tthis.waitstatesPrefetch[this.REGION_CART1] = this.waitstatesPrefetch[this.REGION_CART1 + 1] = this.waitstatesSeq[this.REGION_CART1];\n\t\tthis.waitstatesPrefetch[this.REGION_CART2] = this.waitstatesPrefetch[this.REGION_CART2 + 1] = this.waitstatesSeq[this.REGION_CART2];\n\n\t\tthis.waitstatesPrefetch32[this.REGION_CART0] = this.waitstatesPrefetch32[this.REGION_CART0 + 1] = this.waitstatesSeq32[this.REGION_CART0];\n\t\tthis.waitstatesPrefetch32[this.REGION_CART1] = this.waitstatesPrefetch32[this.REGION_CART1 + 1] = this.waitstatesSeq32[this.REGION_CART1];\n\t\tthis.waitstatesPrefetch32[this.REGION_CART2] = this.waitstatesPrefetch32[this.REGION_CART2 + 1] = this.waitstatesSeq32[this.REGION_CART2];\n\t}\n};\n\nGameBoyAdvanceMMU.prototype.saveNeedsFlush = function() {\n\treturn this.save.writePending;\n};\n\nGameBoyAdvanceMMU.prototype.flushSave = function() {\n\tthis.save.writePending = false;\n};\n\nGameBoyAdvanceMMU.prototype.allocGPIO = function(rom) {\n\treturn new GameBoyAdvanceGPIO(this.core, rom);\n};\n\nexport {\n\tGameBoyAdvanceMMU,\n\tMemoryView,\n\tMemoryBlock,\n\tBadMemory,\n\tROMView,\n\tBIOSView,\n};\nexport default GameBoyAdvanceMMU;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { MemoryBlock } from './mmu';\n\nfunction GameBoyAdvanceInterruptHandler() {\n\tthis.inherit();\n\tthis.FREQUENCY = 0x1000000;\n\n\tthis.cpu = null;\n\tthis.enable = false;\n\n\tthis.IRQ_VBLANK = 0x0;\n\tthis.IRQ_HBLANK = 0x1;\n\tthis.IRQ_VCOUNTER = 0x2;\n\tthis.IRQ_TIMER0 = 0x3;\n\tthis.IRQ_TIMER1 = 0x4;\n\tthis.IRQ_TIMER2 = 0x5;\n\tthis.IRQ_TIMER3 = 0x6;\n\tthis.IRQ_SIO = 0x7;\n\tthis.IRQ_DMA0 = 0x8;\n\tthis.IRQ_DMA1 = 0x9;\n\tthis.IRQ_DMA2 = 0xA;\n\tthis.IRQ_DMA3 = 0xB;\n\tthis.IRQ_KEYPAD = 0xC;\n\tthis.IRQ_GAMEPAK = 0xD;\n\n\tthis.MASK_VBLANK = 0x0001;\n\tthis.MASK_HBLANK = 0x0002;\n\tthis.MASK_VCOUNTER = 0x0004;\n\tthis.MASK_TIMER0 = 0x0008;\n\tthis.MASK_TIMER1 = 0x0010;\n\tthis.MASK_TIMER2 = 0x0020;\n\tthis.MASK_TIMER3 = 0x0040;\n\tthis.MASK_SIO = 0x0080;\n\tthis.MASK_DMA0 = 0x0100;\n\tthis.MASK_DMA1 = 0x0200;\n\tthis.MASK_DMA2 = 0x0400;\n\tthis.MASK_DMA3 = 0x0800;\n\tthis.MASK_KEYPAD = 0x1000;\n\tthis.MASK_GAMEPAK = 0x2000;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.clear = function() {\n\tthis.enable = false;\n\tthis.enabledIRQs = 0;\n\tthis.interruptFlags = 0;\n\n\tthis.dma = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.dma.push({\n\t\t\tsource: 0,\n\t\t\tdest: 0,\n\t\t\tcount: 0,\n\t\t\tnextSource: 0,\n\t\t\tnextDest: 0,\n\t\t\tnextCount: 0,\n\t\t\tsrcControl: 0,\n\t\t\tdstControl: 0,\n\t\t\trepeat: false,\n\t\t\twidth: 0,\n\t\t\tdrq: false,\n\t\t\ttiming: 0,\n\t\t\tdoIrq: false,\n\t\t\tenable: false,\n\t\t\tnextIRQ: 0\n\t\t});\n\t}\n\n\tthis.timersEnabled = 0;\n\tthis.timers = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.timers.push({\n\t\t\treload: 0,\n\t\t\toldReload: 0,\n\t\t\tprescaleBits: 0,\n\t\t\tcountUp: false,\n\t\t\tdoIrq: false,\n\t\t\tenable: false,\n\t\t\tlastEvent: 0,\n\t\t\tnextEvent: 0,\n\t\t\toverflowInterval: 1\n\t\t});\n\t}\n\n\tthis.nextEvent = 0;\n\tthis.springIRQ = false;\n\tthis.resetSP();\n};\n\nGameBoyAdvanceInterruptHandler.prototype.freeze = function() {\n\treturn {\n\t\t'enable': this.enable,\n\t\t'enabledIRQs': this.enabledIRQs,\n\t\t'interruptFlags': this.interruptFlags,\n\t\t'dma': this.dma,\n\t\t'timers': this.timers,\n\t\t'nextEvent': this.nextEvent,\n\t\t'springIRQ': this.springIRQ\n\t};\n};\n\nGameBoyAdvanceInterruptHandler.prototype.defrost = function(frost) {\n\tthis.enable = frost.enable;\n\tthis.enabledIRQs = frost.enabledIRQs;\n\tthis.interruptFlags = frost.interruptFlags;\n\tthis.dma = frost.dma;\n\tthis.timers = frost.timers;\n\tthis.timersEnabled = 0;\n\tif (this.timers[0].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[1].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[2].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tif (this.timers[3].enable) {\n\t\t++this.timersEnabled;\n\t}\n\tthis.nextEvent = frost.nextEvent;\n\tthis.springIRQ = frost.springIRQ;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.updateTimers = function() {\n\tif (this.nextEvent > this.cpu.cycles) {\n\t\treturn;\n\t}\n\n\tif (this.springIRQ) {\n\t\tthis.cpu.raiseIRQ();\n\t\tthis.springIRQ = false;\n\t}\n\n\tthis.video.updateTimers(this.cpu);\n\tthis.audio.updateTimers();\n\tif (this.timersEnabled) {\n\t\tvar timer = this.timers[0];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tthis.io.registers[this.io.TM0CNT_LO >> 1] = timer.reload;\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER0);\n\t\t\t\t}\n\n\t\t\t\tif (this.audio.enabled) {\n\t\t\t\t\tif (this.audio.enableChannelA && !this.audio.soundTimerA && this.audio.dmaA >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoA();\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (this.audio.enableChannelB && !this.audio.soundTimerB && this.audio.dmaB >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoB();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[1];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM1CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[1];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM1CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM1CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER1);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\n\t\t\t\tif (this.audio.enabled) {\n\t\t\t\t\tif (this.audio.enableChannelA && this.audio.soundTimerA && this.audio.dmaA >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoA();\n\t\t\t\t\t}\n\t\n\t\t\t\t\tif (this.audio.enableChannelB && this.audio.soundTimerB && this.audio.dmaB >= 0) {\n\t\t\t\t\t\tthis.audio.sampleFifoB();\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[2];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM2CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[2];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM2CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM2CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER2);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\n\t\t\t\ttimer = this.timers[3];\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\tif (++this.io.registers[this.io.TM3CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\t\ttimer.nextEvent = this.cpu.cycles;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\ttimer = this.timers[3];\n\t\tif (timer.enable) {\n\t\t\tif (this.cpu.cycles >= timer.nextEvent) {\n\t\t\t\ttimer.lastEvent = timer.nextEvent;\n\t\t\t\ttimer.nextEvent += timer.overflowInterval;\n\t\t\t\tif (!timer.countUp || this.io.registers[this.io.TM3CNT_LO >> 1] == 0x10000) {\n\t\t\t\t\tthis.io.registers[this.io.TM3CNT_LO >> 1] = timer.reload;\n\t\t\t\t}\n\t\t\t\ttimer.oldReload = timer.reload;\n\n\t\t\t\tif (timer.doIrq) {\n\t\t\t\t\tthis.raiseIRQ(this.IRQ_TIMER3);\n\t\t\t\t}\n\n\t\t\t\tif (timer.countUp) {\n\t\t\t\t\ttimer.nextEvent = 0;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\n\tvar dma = this.dma[0];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA0);\n\t}\n\n\tdma = this.dma[1];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA1);\n\t}\n\n\tdma = this.dma[2];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA2);\n\t}\n\n\tdma = this.dma[3];\n\tif (dma.enable && dma.doIrq && dma.nextIRQ && this.cpu.cycles >= dma.nextIRQ) {\n\t\tdma.nextIRQ = 0;\n\t\tthis.raiseIRQ(this.IRQ_DMA3);\n\t}\n\n\tthis.pollNextEvent();\n}\n\nGameBoyAdvanceInterruptHandler.prototype.resetSP = function() {\n\tthis.cpu.switchMode(this.cpu.MODE_SUPERVISOR);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007FE0;\n\tthis.cpu.switchMode(this.cpu.MODE_IRQ);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007FA0;\n\tthis.cpu.switchMode(this.cpu.MODE_SYSTEM);\n\tthis.cpu.gprs[this.cpu.SP] = 0x3007F00;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.swi32 = function(opcode) {\n\tthis.swi(opcode >> 16);\n};\n\nGameBoyAdvanceInterruptHandler.prototype.swi = function(opcode) {\n\tif (this.core.mmu.bios.real) {\n\t\tthis.cpu.raiseTrap();\n\t\treturn;\n\t}\n\n\tswitch (opcode) {\n\tcase 0x00:\n\t\t// SoftReset\n\t\tvar mem = this.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM];\n\t\tvar flag = mem.loadU8(0x7FFA);\n\t\tfor (var i = 0x7E00; i < 0x8000; i += 4) {\n\t\t\tmem.store32(i, 0);\n\t\t}\n\t\tthis.resetSP();\n\t\tif (!flag) {\n\t\t\tthis.cpu.gprs[this.cpu.LR] = 0x08000000;\n\t\t} else {\n\t\t\tthis.cpu.gprs[this.cpu.LR] = 0x02000000;\n\t\t}\n\t\tthis.cpu.switchExecMode(this.cpu.MODE_ARM);\n\t\tthis.cpu.instruction.writesPC = true;\n\t\tthis.cpu.gprs[this.cpu.PC] = this.cpu.gprs[this.cpu.LR];\n\t\tbreak;\n\tcase 0x01:\n\t\t// RegisterRamReset\n\t\tvar regions = this.cpu.gprs[0];\n\t\tif (regions & 0x01) {\n\t\t\tthis.core.mmu.memory[this.core.mmu.REGION_WORKING_RAM] = new MemoryBlock(this.core.mmu.SIZE_WORKING_RAM, 9);\n\t\t}\n\t\tif (regions & 0x02) {\n\t\t\tfor (var i = 0; i < this.core.mmu.SIZE_WORKING_IRAM - 0x200; i += 4) {\n\t\t\t\tthis.core.mmu.memory[this.core.mmu.REGION_WORKING_IRAM].store32(i, 0);\n\t\t\t}\n\t\t}\n\t\tif (regions & 0x1C) {\n\t\t\tthis.video.renderPath.clearSubsets(this.core.mmu, regions);\n\t\t}\n\t\tif (regions & 0xE0) {\n\t\t\tthis.core.STUB('Unimplemented RegisterRamReset');\n\t\t}\n\t\tbreak;\n\tcase 0x02:\n\t\t// Halt\n\t\tthis.halt();\n\t\tbreak;\n\tcase 0x05:\n\t\t// VBlankIntrWait\n\t\tthis.cpu.gprs[0] = 1;\n\t\tthis.cpu.gprs[1] = 1;\n\t\t// Fall through:\n\tcase 0x04:\n\t\t// IntrWait\n\t\tif (!this.enable) {\n\t\t\tthis.io.store16(this.io.IME, 1);\n\t\t}\n\t\tif (!this.cpu.gprs[0] && this.interruptFlags & this.cpu.gprs[1]) {\n\t\t\treturn;\n\t\t}\n\t\tthis.dismissIRQs(0xFFFFFFFF);\n\t\tthis.cpu.raiseTrap();\n\t\tbreak;\n\tcase 0x06:\n\t\t// Div\n\t\tvar result = (this.cpu.gprs[0] | 0) / (this.cpu.gprs[1] | 0);\n\t\tvar mod = (this.cpu.gprs[0] | 0) % (this.cpu.gprs[1] | 0);\n\t\tthis.cpu.gprs[0] = result | 0;\n\t\tthis.cpu.gprs[1] = mod | 0;\n\t\tthis.cpu.gprs[3] = Math.abs(result | 0);\n\t\tbreak;\n\tcase 0x07:\n\t\t// DivArm\n\t\tvar result = (this.cpu.gprs[1] | 0) / (this.cpu.gprs[0] | 0);\n\t\tvar mod = (this.cpu.gprs[1] | 0) % (this.cpu.gprs[0] | 0);\n\t\tthis.cpu.gprs[0] = result | 0;\n\t\tthis.cpu.gprs[1] = mod | 0;\n\t\tthis.cpu.gprs[3] = Math.abs(result | 0);\n\t\tbreak;\n\tcase 0x08:\n\t\t// Sqrt\n\t\tvar root = Math.sqrt(this.cpu.gprs[0]);\n\t\tthis.cpu.gprs[0] = root | 0; // Coerce down to int\n\t\tbreak;\n\tcase 0x0A:\n\t\t// ArcTan2\n\t\tvar x = this.cpu.gprs[0] / 16384;\n\t\tvar y = this.cpu.gprs[1] / 16384;\n\t\tthis.cpu.gprs[0] = (Math.atan2(y, x) / (2 * Math.PI)) * 0x10000;\n\t\tbreak;\n\tcase 0x0B:\n\t\t// CpuSet\n\t\tvar source = this.cpu.gprs[0];\n\t\tvar dest = this.cpu.gprs[1];\n\t\tvar mode = this.cpu.gprs[2];\n\t\tvar count = mode & 0x000FFFFF;\n\t\tvar fill = mode & 0x01000000;\n\t\tvar wordsize = (mode & 0x04000000) ? 4 : 2;\n\t\tif (fill) {\n\t\t\tif (wordsize == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\tvar word = this.cpu.mmu.load32(source);\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsource &= 0xFFFFFFFE;\n\t\t\t\tdest &= 0xFFFFFFFE;\n\t\t\t\tvar word = this.cpu.mmu.load16(source);\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tthis.cpu.mmu.store16(dest + (i << 1), word);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (wordsize == 4) {\n\t\t\t\tsource &= 0xFFFFFFFC;\n\t\t\t\tdest &= 0xFFFFFFFC;\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tvar word = this.cpu.mmu.load32(source + (i << 2));\n\t\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\tsource &= 0xFFFFFFFE;\n\t\t\t\tdest &= 0xFFFFFFFE;\n\t\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\t\tvar word = this.cpu.mmu.load16(source + (i << 1));\n\t\t\t\t\tthis.cpu.mmu.store16(dest + (i << 1), word);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn;\n\tcase 0x0C:\n\t\t// FastCpuSet\n\t\tvar source = this.cpu.gprs[0] & 0xFFFFFFFC;\n\t\tvar dest = this.cpu.gprs[1] & 0xFFFFFFFC;\n\t\tvar mode = this.cpu.gprs[2];\n\t\tvar count = mode & 0x000FFFFF;\n\t\tcount = ((count + 7) >> 3) << 3;\n\t\tvar fill = mode & 0x01000000;\n\t\tif (fill) {\n\t\t\tvar word = this.cpu.mmu.load32(source);\n\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t}\n\t\t} else {\n\t\t\tfor (var i = 0; i < count; ++i) {\n\t\t\t\tvar word = this.cpu.mmu.load32(source + (i << 2));\n\t\t\t\tthis.cpu.mmu.store32(dest + (i << 2), word);\n\t\t\t}\n\t\t}\n\t\treturn;\n\tcase 0x0E:\n\t\t// BgAffineSet\n\t\tvar i = this.cpu.gprs[2];\n\t\tvar ox, oy;\n\t\tvar cx, cy;\n\t\tvar sx, sy;\n\t\tvar theta;\n\t\tvar offset = this.cpu.gprs[0];\n\t\tvar destination = this.cpu.gprs[1];\n\t\tvar a, b, c, d;\n\t\tvar rx, ry;\n\t\twhile (i--) {\n\t\t\t// [ sx   0  0 ]   [ cos(theta)  -sin(theta)  0 ]   [ 1  0  cx - ox ]   [ A B rx ]\n\t\t\t// [  0  sy  0 ] * [ sin(theta)   cos(theta)  0 ] * [ 0  1  cy - oy ] = [ C D ry ]\n\t\t\t// [  0   0  1 ]   [     0            0       1 ]   [ 0  0     1    ]   [ 0 0  1 ]\n\t\t\tox = this.core.mmu.load32(offset) / 256;\n\t\t\toy = this.core.mmu.load32(offset + 4) / 256;\n\t\t\tcx = this.core.mmu.load16(offset + 8);\n\t\t\tcy = this.core.mmu.load16(offset + 10);\n\t\t\tsx = this.core.mmu.load16(offset + 12) / 256;\n\t\t\tsy = this.core.mmu.load16(offset + 14) / 256;\n\t\t\ttheta = (this.core.mmu.loadU16(offset + 16) >> 8) / 128 * Math.PI;\n\t\t\toffset += 20;\n\t\t\t// Rotation\n\t\t\ta = d = Math.cos(theta);\n\t\t\tb = c = Math.sin(theta);\n\t\t\t// Scale\n\t\t\ta *= sx;\n\t\t\tb *= -sx;\n\t\t\tc *= sy;\n\t\t\td *= sy;\n\t\t\t// Translate\n\t\t\trx = ox - (a * cx + b * cy);\n\t\t\try = oy - (c * cx + d * cy);\n\t\t\tthis.core.mmu.store16(destination, (a * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 2, (b * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 4, (c * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + 6, (d * 256) | 0);\n\t\t\tthis.core.mmu.store32(destination + 8, (rx * 256) | 0);\n\t\t\tthis.core.mmu.store32(destination + 12, (ry * 256) | 0);\n\t\t\tdestination += 16;\n\t\t}\n\t\tbreak;\n\tcase 0x0F:\n\t\t// ObjAffineSet\n\t\tvar i = this.cpu.gprs[2];\n\t\tvar sx, sy;\n\t\tvar theta;\n\t\tvar offset = this.cpu.gprs[0];\n\t\tvar destination = this.cpu.gprs[1]\n\t\tvar diff = this.cpu.gprs[3];\n\t\tvar a, b, c, d;\n\t\twhile (i--) {\n\t\t\t// [ sx   0 ]   [ cos(theta)  -sin(theta) ]   [ A B ]\n\t\t\t// [  0  sy ] * [ sin(theta)   cos(theta) ] = [ C D ]\n\t\t\tsx = this.core.mmu.load16(offset) / 256;\n\t\t\tsy = this.core.mmu.load16(offset + 2) / 256;\n\t\t\ttheta = (this.core.mmu.loadU16(offset + 4) >> 8) / 128 * Math.PI;\n\t\t\toffset += 6;\n\t\t\t// Rotation\n\t\t\ta = d = Math.cos(theta);\n\t\t\tb = c = Math.sin(theta);\n\t\t\t// Scale\n\t\t\ta *= sx;\n\t\t\tb *= -sx;\n\t\t\tc *= sy;\n\t\t\td *= sy;\n\t\t\tthis.core.mmu.store16(destination, (a * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff, (b * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff * 2, (c * 256) | 0);\n\t\t\tthis.core.mmu.store16(destination + diff * 3, (d * 256) | 0);\n\t\t\tdestination += diff * 4;\n\t\t}\n\t\tbreak;\n\tcase 0x11:\n\t\t// LZ77UnCompWram\n\t\tthis.lz77(this.cpu.gprs[0], this.cpu.gprs[1], 1);\n\t\tbreak;\n\tcase 0x12:\n\t\t// LZ77UnCompVram\n\t\tthis.lz77(this.cpu.gprs[0], this.cpu.gprs[1], 2);\n\t\tbreak;\n\tcase 0x13:\n\t\t// HuffUnComp\n\t\tthis.huffman(this.cpu.gprs[0], this.cpu.gprs[1]);\n\t\tbreak;\n\tcase 0x14:\n\t\t// RlUnCompWram\n\t\tthis.rl(this.cpu.gprs[0], this.cpu.gprs[1], 1);\n\t\tbreak;\n\tcase 0x15:\n\t\t// RlUnCompVram\n\t\tthis.rl(this.cpu.gprs[0], this.cpu.gprs[1], 2);\n\t\tbreak;\n\tcase 0x1F:\n\t\t// MidiKey2Freq\n\t\tvar key = this.cpu.mmu.load32(this.cpu.gprs[0] + 4);\n\t\tthis.cpu.gprs[0] = key / Math.pow(2, (180 - this.cpu.gprs[1] - this.cpu.gprs[2] / 256) / 12) >>> 0;\n\t\tbreak;\n\tdefault:\n\t\tthrow \"Unimplemented software interrupt: 0x\" + opcode.toString(16);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.masterEnable = function(value) {\n\tthis.enable = value;\n\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.setInterruptsEnabled = function(value) {\n\tthis.enabledIRQs = value;\n\n\tif (this.enabledIRQs & this.MASK_SIO) {\n\t\tthis.core.STUB('Serial I/O interrupts not implemented');\n\t}\n\n\tif (this.enabledIRQs & this.MASK_KEYPAD) {\n\t\tthis.core.STUB('Keypad interrupts not implemented');\n\t}\n\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.pollNextEvent = function() {\n\tvar nextEvent = this.video.nextEvent;\n\tvar test;\n\n\tif (this.audio.enabled) {\n\t\ttest = this.audio.nextEvent;\n\t\tif (!nextEvent || test < nextEvent) {\n\t\t\tnextEvent = test;\n\t\t}\n\t}\n\n\tif (this.timersEnabled) {\n\t\tvar timer = this.timers[0];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\n\t\ttimer = this.timers[1];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t\ttimer = this.timers[2];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t\ttimer = this.timers[3];\n\t\ttest = timer.nextEvent;\n\t\tif (timer.enable && test && (!nextEvent || test < nextEvent)) {\n\t\t\tnextEvent = test;\n\t\t}\n\t}\n\n\tvar dma = this.dma[0];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[1];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[2];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tdma = this.dma[3];\n\ttest = dma.nextIRQ;\n\tif (dma.enable && dma.doIrq && test && (!nextEvent || test < nextEvent)) {\n\t\tnextEvent = test;\n\t}\n\n\tthis.core.ASSERT(nextEvent >= this.cpu.cycles, \"Next event is before present\");\n\tthis.nextEvent = nextEvent;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.waitForIRQ = function() {\n\tvar timer;\n\tvar irqPending = this.testIRQ() || this.video.hblankIRQ || this.video.vblankIRQ || this.video.vcounterIRQ;\n\tif (this.timersEnabled) {\n\t\ttimer = this.timers[0];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[1];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[2];\n\t\tirqPending = irqPending || timer.doIrq;\n\t\ttimer = this.timers[3];\n\t\tirqPending = irqPending || timer.doIrq;\n\t}\n\tif (!irqPending) {\n\t\treturn false;\n\t}\n\n\tfor (;;) {\n\t\tthis.pollNextEvent();\n\n\t\tif (!this.nextEvent) {\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.cpu.cycles = this.nextEvent;\n\t\t\tthis.updateTimers();\n\t\t\tif (this.interruptFlags) {\n\t\t\t\treturn true;\n\t\t\t}\n\t\t}\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.testIRQ = function() {\n\tif (this.enable && this.enabledIRQs & this.interruptFlags) {\n\t\tthis.springIRQ = true;\n\t\tthis.nextEvent = this.cpu.cycles;\n\t\treturn true;\n\t}\n\treturn false;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.raiseIRQ = function(irqType) {\n\tthis.interruptFlags |= 1 << irqType;\n\tthis.io.registers[this.io.IF >> 1] = this.interruptFlags;\n\n\tif (this.enable && (this.enabledIRQs & 1 << irqType)) {\n\t\tthis.cpu.raiseIRQ();\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dismissIRQs = function(irqMask) {\n\tthis.interruptFlags &= ~irqMask;\n\tthis.io.registers[this.io.IF >> 1] = this.interruptFlags;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetSourceAddress = function(dma, address) {\n\tthis.dma[dma].source = address & 0xFFFFFFFE;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetDestAddress = function(dma, address) {\n\tthis.dma[dma].dest = address & 0xFFFFFFFE;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaSetWordCount = function(dma, count) {\n\tthis.dma[dma].count = count ? count : (dma == 3 ? 0x10000 : 0x4000);\n};\n\nGameBoyAdvanceInterruptHandler.prototype.dmaWriteControl = function(dma, control) {\n\tvar currentDma = this.dma[dma];\n\tvar wasEnabled = currentDma.enable;\n\tcurrentDma.dstControl = (control & 0x0060) >> 5;\n\tcurrentDma.srcControl = (control & 0x0180) >> 7;\n\tcurrentDma.repeat = !!(control & 0x0200);\n\tcurrentDma.width = (control & 0x0400) ? 4 : 2;\n\tcurrentDma.drq = !!(control & 0x0800);\n\tcurrentDma.timing = (control & 0x3000) >> 12;\n\tcurrentDma.doIrq = !!(control & 0x4000);\n\tcurrentDma.enable = !!(control & 0x8000);\n\tcurrentDma.nextIRQ = 0;\n\n\tif (currentDma.drq) {\n\t\tthis.core.WARN('DRQ not implemented');\n\t}\n\n\tif (!wasEnabled && currentDma.enable) {\n\t\tcurrentDma.nextSource = currentDma.source;\n\t\tcurrentDma.nextDest = currentDma.dest;\n\t\tcurrentDma.nextCount = currentDma.count;\n\t\tthis.cpu.mmu.scheduleDma(dma, currentDma);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerSetReload = function(timer, reload) {\n\tthis.timers[timer].reload = reload & 0xFFFF;\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerWriteControl = function(timer, control) {\n\tvar currentTimer = this.timers[timer];\n\tvar oldPrescale = currentTimer.prescaleBits;\n\tswitch (control & 0x0003) {\n\tcase 0x0000:\n\t\tcurrentTimer.prescaleBits = 0;\n\t\tbreak;\n\tcase 0x0001:\n\t\tcurrentTimer.prescaleBits = 6;\n\t\tbreak;\n\tcase 0x0002:\n\t\tcurrentTimer.prescaleBits = 8;\n\t\tbreak;\n\tcase 0x0003:\n\t\tcurrentTimer.prescaleBits = 10;\n\t\tbreak;\n\t}\n\tcurrentTimer.countUp = !!(control & 0x0004);\n\tcurrentTimer.doIrq = !!(control & 0x0040);\n\tcurrentTimer.overflowInterval = (0x10000 - currentTimer.reload) << currentTimer.prescaleBits;\n\tvar wasEnabled = currentTimer.enable;\n\tcurrentTimer.enable = !!(((control & 0x0080) >> 7) << timer);\n\tif (!wasEnabled && currentTimer.enable) {\n\t\tif (!currentTimer.countUp) {\n\t\t\tcurrentTimer.lastEvent = this.cpu.cycles;\n\t\t\tcurrentTimer.nextEvent = this.cpu.cycles + currentTimer.overflowInterval;\n\t\t} else {\n\t\t\tcurrentTimer.nextEvent = 0;\n\t\t}\n\t\tthis.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1] = currentTimer.reload;\n\t\tcurrentTimer.oldReload = currentTimer.reload;\n\t\t++this.timersEnabled;\n\t} else if (wasEnabled && !currentTimer.enable) {\n\t\tif (!currentTimer.countUp) {\n\t\t\tthis.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1] = currentTimer.oldReload + (this.cpu.cycles - currentTimer.lastEvent) >> oldPrescale;\n\t\t}\n\t\t--this.timersEnabled;\n\t} else if (currentTimer.prescaleBits != oldPrescale && !currentTimer.countUp) {\n\t\t// FIXME: this might be before present\n\t\tcurrentTimer.nextEvent = currentTimer.lastEvent + currentTimer.overflowInterval;\n\t}\n\n\t// We've changed the timers somehow...we need to reset the next event\n\tthis.pollNextEvent();\n};\n\nGameBoyAdvanceInterruptHandler.prototype.timerRead = function(timer) {\n\tvar currentTimer = this.timers[timer];\n\tif (currentTimer.enable && !currentTimer.countUp) {\n\t\treturn currentTimer.oldReload + (this.cpu.cycles - currentTimer.lastEvent) >> currentTimer.prescaleBits;\n\t} else {\n\t\treturn this.io.registers[(this.io.TM0CNT_LO + (timer << 2)) >> 1];\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.halt = function() {\n\tif (!this.enable) {\n\t\tthrow \"Requested HALT when interrupts were disabled!\";\n\t}\n\tif (!this.waitForIRQ()) {\n\t\tthrow \"Waiting on interrupt forever.\";\n\t}\n}\n\nGameBoyAdvanceInterruptHandler.prototype.lz77 = function(source, dest, unitsize) {\n\t// TODO: move to a different file\n\tvar remaining = (this.cpu.mmu.load32(source) & 0xFFFFFF00) >> 8;\n\t// We assume the signature byte (0x10) is correct\n\tvar blockheader;\n\tvar sPointer = source + 4;\n\tvar dPointer = dest;\n\tvar blocksRemaining = 0;\n\tvar block;\n\tvar disp;\n\tvar bytes;\n\tvar buffer = 0;\n\tvar loaded;\n\twhile (remaining > 0) {\n\t\tif (blocksRemaining) {\n\t\t\tif (blockheader & 0x80) {\n\t\t\t\t// Compressed\n\t\t\t\tblock = this.cpu.mmu.loadU8(sPointer) | (this.cpu.mmu.loadU8(sPointer + 1) << 8);\n\t\t\t\tsPointer += 2;\n\t\t\t\tdisp = dPointer - (((block & 0x000F) << 8) | ((block & 0xFF00) >> 8)) - 1;\n\t\t\t\tbytes = ((block & 0x00F0) >> 4) + 3;\n\t\t\t\twhile (bytes-- && remaining) {\n\t\t\t\t\tloaded = this.cpu.mmu.loadU8(disp++);\n\t\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\t\tbuffer |= loaded << 8;\n\t\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cpu.mmu.store8(dPointer, loaded);\n\t\t\t\t\t}\n\t\t\t\t\t--remaining;\n\t\t\t\t\t++dPointer;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Uncompressed\n\t\t\t\tloaded = this.cpu.mmu.loadU8(sPointer++);\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= loaded << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, loaded);\n\t\t\t\t}\n\t\t\t\t--remaining;\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t\tblockheader <<= 1;\n\t\t\t--blocksRemaining;\n\t\t} else {\n\t\t\tblockheader = this.cpu.mmu.loadU8(sPointer++);\n\t\t\tblocksRemaining = 8;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.huffman = function(source, dest) {\n\tsource = source & 0xFFFFFFFC;\n\tvar header = this.cpu.mmu.load32(source);\n\tvar remaining = header >> 8;\n\tvar bits = header & 0xF;\n\tif (32 % bits) {\n\t\tthrow 'Unimplemented unaligned Huffman';\n\t}\n\tvar padding = (4 - remaining) & 0x3;\n\tremaining &= 0xFFFFFFFC;\n\t// We assume the signature byte (0x20) is correct\n\tvar tree = [];\n\tvar treesize = (this.cpu.mmu.loadU8(source + 4) << 1) + 1;\n\tvar block;\n\tvar sPointer = source + 5 + treesize;\n\tvar dPointer = dest & 0xFFFFFFFC;\n\tvar i;\n\tfor (i = 0; i < treesize; ++i) {\n\t\ttree.push(this.cpu.mmu.loadU8(source + 5 + i));\n\t}\n\tvar node;\n\tvar offset = 0;\n\tvar bitsRemaining;\n\tvar readBits;\n\tvar bitsSeen = 0;\n\tnode = tree[0];\n\twhile (remaining > 0) {\n\t\tvar bitstream = this.cpu.mmu.load32(sPointer);\n\t\tsPointer += 4;\n\t\tfor (bitsRemaining = 32; bitsRemaining > 0; --bitsRemaining, bitstream <<= 1) {\n\t\t\tif (typeof (node) === 'number') {\n\t\t\t\t// Lazily construct tree\n\t\t\t\tvar next = (offset - 1 | 1) + ((node & 0x3F) << 1) + 2;\n\t\t\t\tnode = {\n\t\t\t\t\tl: next,\n\t\t\t\t\tr: next + 1,\n\t\t\t\t\tlTerm: node & 0x80,\n\t\t\t\t\trTerm: node & 0x40\n\t\t\t\t};\n\t\t\t\ttree[offset] = node;\n\t\t\t}\n\n\t\t\tif (bitstream & 0x80000000) {\n\t\t\t\t// Go right\n\t\t\t\tif (node.rTerm) {\n\t\t\t\t\treadBits = tree[node.r];\n\t\t\t\t} else {\n\t\t\t\t\toffset = node.r;\n\t\t\t\t\tnode = tree[node.r];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\t// Go left\n\t\t\t\tif (node.lTerm) {\n\t\t\t\t\treadBits = tree[node.l];\n\t\t\t\t} else {\n\t\t\t\t\toffset = node.l;\n\t\t\t\t\tnode = tree[offset];\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tblock |= (readBits & ((1 << bits) - 1)) << bitsSeen;\n\t\t\tbitsSeen += bits;\n\t\t\toffset = 0;\n\t\t\tnode = tree[0];\n\t\t\tif (bitsSeen == 32) {\n\t\t\t\tbitsSeen = 0;\n\t\t\t\tthis.cpu.mmu.store32(dPointer, block);\n\t\t\t\tdPointer += 4;\n\t\t\t\tremaining -= 4;\n\t\t\t\tblock = 0;\n\t\t\t}\n\t\t}\n\n\t}\n\tif (padding) {\n\t\tthis.cpu.mmu.store32(dPointer, block);\n\t}\n};\n\nGameBoyAdvanceInterruptHandler.prototype.rl = function(source, dest, unitsize) {\n\tsource = source & 0xFFFFFFFC;\n\tvar remaining = (this.cpu.mmu.load32(source) & 0xFFFFFF00) >> 8;\n\tvar padding = (4 - remaining) & 0x3;\n\t// We assume the signature byte (0x30) is correct\n\tvar blockheader;\n\tvar block;\n\tvar sPointer = source + 4;\n\tvar dPointer = dest;\n\tvar buffer = 0;\n\twhile (remaining > 0) {\n\t\tblockheader = this.cpu.mmu.loadU8(sPointer++);\n\t\tif (blockheader & 0x80) {\n\t\t\t// Compressed\n\t\t\tblockheader &= 0x7F;\n\t\t\tblockheader += 3;\n\t\t\tblock = this.cpu.mmu.loadU8(sPointer++);\n\t\t\twhile (blockheader-- && remaining) {\n\t\t\t\t--remaining;\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= block << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, block);\n\t\t\t\t}\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t} else {\n\t\t\t// Uncompressed\n\t\t\tblockheader++;\n\t\t\twhile (blockheader-- && remaining) {\n\t\t\t\t--remaining;\n\t\t\t\tblock = this.cpu.mmu.loadU8(sPointer++);\n\t\t\t\tif (unitsize == 2) {\n\t\t\t\t\tbuffer >>= 8;\n\t\t\t\t\tbuffer |= block << 8;\n\t\t\t\t\tif (dPointer & 1) {\n\t\t\t\t\t\tthis.cpu.mmu.store16(dPointer - 1, buffer);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tthis.cpu.mmu.store8(dPointer, block);\n\t\t\t\t}\n\t\t\t\t++dPointer;\n\t\t\t}\n\t\t}\n\t}\n\twhile (padding--) {\n\t\tthis.cpu.mmu.store8(dPointer++, 0);\n\t}\n};\n\nexport default GameBoyAdvanceInterruptHandler;\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nimport Serializer from './util';\r\n\r\nfunction GameBoyAdvanceIO() {\r\n\t// Video\r\n\tthis.DISPCNT = 0x000;\r\n\tthis.GREENSWP = 0x002;\r\n\tthis.DISPSTAT = 0x004;\r\n\tthis.VCOUNT = 0x006;\r\n\tthis.BG0CNT = 0x008;\r\n\tthis.BG1CNT = 0x00A;\r\n\tthis.BG2CNT = 0x00C;\r\n\tthis.BG3CNT = 0x00E;\r\n\tthis.BG0HOFS = 0x010;\r\n\tthis.BG0VOFS = 0x012;\r\n\tthis.BG1HOFS = 0x014;\r\n\tthis.BG1VOFS = 0x016;\r\n\tthis.BG2HOFS = 0x018;\r\n\tthis.BG2VOFS = 0x01A;\r\n\tthis.BG3HOFS = 0x01C;\r\n\tthis.BG3VOFS = 0x01E;\r\n\tthis.BG2PA = 0x020;\r\n\tthis.BG2PB = 0x022;\r\n\tthis.BG2PC = 0x024;\r\n\tthis.BG2PD = 0x026;\r\n\tthis.BG2X_LO = 0x028;\r\n\tthis.BG2X_HI = 0x02A;\r\n\tthis.BG2Y_LO = 0x02C;\r\n\tthis.BG2Y_HI = 0x02E;\r\n\tthis.BG3PA = 0x030;\r\n\tthis.BG3PB = 0x032;\r\n\tthis.BG3PC = 0x034;\r\n\tthis.BG3PD = 0x036;\r\n\tthis.BG3X_LO = 0x038;\r\n\tthis.BG3X_HI = 0x03A;\r\n\tthis.BG3Y_LO = 0x03C;\r\n\tthis.BG3Y_HI = 0x03E;\r\n\tthis.WIN0H = 0x040;\r\n\tthis.WIN1H = 0x042;\r\n\tthis.WIN0V = 0x044;\r\n\tthis.WIN1V = 0x046;\r\n\tthis.WININ = 0x048;\r\n\tthis.WINOUT = 0x04A;\r\n\tthis.MOSAIC = 0x04C;\r\n\tthis.BLDCNT = 0x050;\r\n\tthis.BLDALPHA = 0x052;\r\n\tthis.BLDY = 0x054;\r\n\r\n\t// Sound\r\n\tthis.SOUND1CNT_LO = 0x060;\r\n\tthis.SOUND1CNT_HI = 0x062;\r\n\tthis.SOUND1CNT_X = 0x064;\r\n\tthis.SOUND2CNT_LO = 0x068;\r\n\tthis.SOUND2CNT_HI = 0x06C;\r\n\tthis.SOUND3CNT_LO = 0x070;\r\n\tthis.SOUND3CNT_HI = 0x072;\r\n\tthis.SOUND3CNT_X = 0x074;\r\n\tthis.SOUND4CNT_LO = 0x078;\r\n\tthis.SOUND4CNT_HI = 0x07C;\r\n\tthis.SOUNDCNT_LO = 0x080;\r\n\tthis.SOUNDCNT_HI = 0x082;\r\n\tthis.SOUNDCNT_X = 0x084;\r\n\tthis.SOUNDBIAS = 0x088;\r\n\tthis.WAVE_RAM0_LO = 0x090;\r\n\tthis.WAVE_RAM0_HI = 0x092;\r\n\tthis.WAVE_RAM1_LO = 0x094;\r\n\tthis.WAVE_RAM1_HI = 0x096;\r\n\tthis.WAVE_RAM2_LO = 0x098;\r\n\tthis.WAVE_RAM2_HI = 0x09A;\r\n\tthis.WAVE_RAM3_LO = 0x09C;\r\n\tthis.WAVE_RAM3_HI = 0x09E;\r\n\tthis.FIFO_A_LO = 0x0A0;\r\n\tthis.FIFO_A_HI = 0x0A2;\r\n\tthis.FIFO_B_LO = 0x0A4;\r\n\tthis.FIFO_B_HI = 0x0A6;\r\n\r\n\t// DMA\r\n\tthis.DMA0SAD_LO = 0x0B0;\r\n\tthis.DMA0SAD_HI = 0x0B2;\r\n\tthis.DMA0DAD_LO = 0x0B4;\r\n\tthis.DMA0DAD_HI = 0x0B6;\r\n\tthis.DMA0CNT_LO = 0x0B8;\r\n\tthis.DMA0CNT_HI = 0x0BA;\r\n\tthis.DMA1SAD_LO = 0x0BC;\r\n\tthis.DMA1SAD_HI = 0x0BE;\r\n\tthis.DMA1DAD_LO = 0x0C0;\r\n\tthis.DMA1DAD_HI = 0x0C2;\r\n\tthis.DMA1CNT_LO = 0x0C4;\r\n\tthis.DMA1CNT_HI = 0x0C6;\r\n\tthis.DMA2SAD_LO = 0x0C8;\r\n\tthis.DMA2SAD_HI = 0x0CA;\r\n\tthis.DMA2DAD_LO = 0x0CC;\r\n\tthis.DMA2DAD_HI = 0x0CE;\r\n\tthis.DMA2CNT_LO = 0x0D0;\r\n\tthis.DMA2CNT_HI = 0x0D2;\r\n\tthis.DMA3SAD_LO = 0x0D4;\r\n\tthis.DMA3SAD_HI = 0x0D6;\r\n\tthis.DMA3DAD_LO = 0x0D8;\r\n\tthis.DMA3DAD_HI = 0x0DA;\r\n\tthis.DMA3CNT_LO = 0x0DC;\r\n\tthis.DMA3CNT_HI = 0x0DE;\r\n\r\n\t// Timers\r\n\tthis.TM0CNT_LO = 0x100;\r\n\tthis.TM0CNT_HI = 0x102;\r\n\tthis.TM1CNT_LO = 0x104;\r\n\tthis.TM1CNT_HI = 0x106;\r\n\tthis.TM2CNT_LO = 0x108;\r\n\tthis.TM2CNT_HI = 0x10A;\r\n\tthis.TM3CNT_LO = 0x10C;\r\n\tthis.TM3CNT_HI = 0x10E;\r\n\r\n\t// SIO (note: some of these are repeated)\r\n\tthis.SIODATA32_LO = 0x120;\r\n\tthis.SIOMULTI0 = 0x120;\r\n\tthis.SIODATA32_HI = 0x122;\r\n\tthis.SIOMULTI1 = 0x122;\r\n\tthis.SIOMULTI2 = 0x124;\r\n\tthis.SIOMULTI3 = 0x126;\r\n\tthis.SIOCNT = 0x128;\r\n\tthis.SIOMLT_SEND = 0x12A;\r\n\tthis.SIODATA8 = 0x12A;\r\n\tthis.RCNT = 0x134;\r\n\tthis.JOYCNT = 0x140;\r\n\tthis.JOY_RECV = 0x150;\r\n\tthis.JOY_TRANS = 0x154;\r\n\tthis.JOYSTAT = 0x158;\r\n\r\n\t// Keypad\r\n\tthis.KEYINPUT = 0x130;\r\n\tthis.KEYCNT = 0x132;\r\n\r\n\t// Interrupts, etc\r\n\tthis.IE = 0x200;\r\n\tthis.IF = 0x202;\r\n\tthis.WAITCNT = 0x204;\r\n\tthis.IME = 0x208;\r\n\r\n\tthis.POSTFLG = 0x300;\r\n\tthis.HALTCNT = 0x301;\r\n\r\n\tthis.DEFAULT_DISPCNT = 0x0080;\r\n\tthis.DEFAULT_SOUNDBIAS = 0x200;\r\n\tthis.DEFAULT_BGPA = 1;\r\n\tthis.DEFAULT_BGPD = 1;\r\n\tthis.DEFAULT_RCNT = 0x8000;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.clear = function() {\r\n\tthis.registers = new Uint16Array(this.cpu.mmu.SIZE_IO);\r\n\r\n\tthis.registers[this.DISPCNT >> 1] = this.DEFAULT_DISPCNT;\r\n\tthis.registers[this.SOUNDBIAS >> 1] = this.DEFAULT_SOUNDBIAS;\r\n\tthis.registers[this.BG2PA >> 1] = this.DEFAULT_BGPA;\r\n\tthis.registers[this.BG2PD >> 1] = this.DEFAULT_BGPD;\r\n\tthis.registers[this.BG3PA >> 1] = this.DEFAULT_BGPA;\r\n\tthis.registers[this.BG3PD >> 1] = this.DEFAULT_BGPD;\r\n\tthis.registers[this.RCNT >> 1] = this.DEFAULT_RCNT;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.freeze = function() {\r\n\treturn {\r\n\t\t'registers': Serializer.prefix(this.registers.buffer)\r\n\t};\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.defrost = function(frost) {\r\n\tthis.registers = new Uint16Array(frost.registers);\r\n\t// Video registers don't serialize themselves\r\n\tfor (var i = 0; i <= this.BLDY; i += 2) {\r\n\t\tthis.store16(this.registers[i >> 1]);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.load8 = function(offset) {\r\n\tthrow 'Unimplmeneted unaligned I/O access';\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.load16 = function(offset) {\r\n\treturn (this.loadU16(offset) << 16) >> 16;\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.load32 = function(offset) {\r\n\toffset &= 0xFFFFFFFC;\r\n\tswitch (offset) {\r\n\tcase this.DMA0CNT_LO:\r\n\tcase this.DMA1CNT_LO:\r\n\tcase this.DMA2CNT_LO:\r\n\tcase this.DMA3CNT_LO:\r\n\t\treturn this.loadU16(offset | 2) << 16;\r\n\tcase this.IME:\r\n\t\treturn this.loadU16(offset) & 0xFFFF;\r\n\tcase this.JOY_RECV:\r\n\tcase this.JOY_TRANS:\r\n \t\tthis.core.STUB('Unimplemented JOY register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\t}\r\n\r\n\treturn this.loadU16(offset) | (this.loadU16(offset | 2) << 16);\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.loadU8 = function(offset) {\r\n\tvar odd = offset & 0x0001;\r\n\tvar value = this.loadU16(offset & 0xFFFE);\r\n\treturn (value >>> (odd << 3)) & 0xFF;\r\n}\r\n\r\nGameBoyAdvanceIO.prototype.loadU16 = function(offset) {\r\n\tswitch (offset) {\r\n\tcase this.DISPCNT:\r\n\tcase this.BG0CNT:\r\n\tcase this.BG1CNT:\r\n\tcase this.BG2CNT:\r\n\tcase this.BG3CNT:\r\n\tcase this.WININ:\r\n\tcase this.WINOUT:\r\n\tcase this.SOUND1CNT_LO:\r\n\tcase this.SOUND3CNT_LO:\r\n\tcase this.SOUNDCNT_LO:\r\n\tcase this.SOUNDCNT_HI:\r\n\tcase this.SOUNDBIAS:\r\n\tcase this.BLDCNT:\r\n\tcase this.BLDALPHA:\r\n\r\n\tcase this.TM0CNT_HI:\r\n\tcase this.TM1CNT_HI:\r\n\tcase this.TM2CNT_HI:\r\n\tcase this.TM3CNT_HI:\r\n\tcase this.DMA0CNT_HI:\r\n\tcase this.DMA1CNT_HI:\r\n\tcase this.DMA2CNT_HI:\r\n\tcase this.DMA3CNT_HI:\r\n\tcase this.RCNT:\r\n\tcase this.WAITCNT:\r\n\tcase this.IE:\r\n\tcase this.IF:\r\n\tcase this.IME:\r\n\tcase this.POSTFLG:\r\n\t\t// Handled transparently by the written registers\r\n\t\tbreak;\r\n\r\n\t// Video\r\n\tcase this.DISPSTAT:\r\n\t\treturn this.registers[offset >> 1] | this.video.readDisplayStat();\r\n\tcase this.VCOUNT:\r\n\t\treturn this.video.vcount;\r\n\r\n\t// Sound\r\n\tcase this.SOUND1CNT_HI:\r\n\tcase this.SOUND2CNT_LO:\r\n\t\treturn this.registers[offset >> 1] & 0xFFC0;\r\n\tcase this.SOUND1CNT_X:\r\n\tcase this.SOUND2CNT_HI:\r\n\tcase this.SOUND3CNT_X:\r\n\t\treturn this.registers[offset >> 1] & 0x4000;\r\n\tcase this.SOUND3CNT_HI:\r\n\t\treturn this.registers[offset >> 1] & 0xE000;\r\n\tcase this.SOUND4CNT_LO:\r\n\t\treturn this.registers[offset >> 1] & 0xFF00;\r\n\tcase this.SOUND4CNT_HI:\r\n\t\treturn this.registers[offset >> 1] & 0x40FF;\r\n\tcase this.SOUNDCNT_X:\r\n\t\tthis.core.STUB('Unimplemented sound register read: SOUNDCNT_X');\r\n\t\treturn this.registers[offset >> 1] | 0x0000;\r\n\r\n\t// Timers\r\n\tcase this.TM0CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(0);\r\n\tcase this.TM1CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(1);\r\n\tcase this.TM2CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(2);\r\n\tcase this.TM3CNT_LO:\r\n\t\treturn this.cpu.irq.timerRead(3);\r\n\r\n\t// SIO\r\n\tcase this.SIOCNT:\r\n\t\treturn this.sio.readSIOCNT();\r\n\r\n\tcase this.KEYINPUT:\r\n\t\tthis.keypad.pollGamepads();\r\n\t\treturn this.keypad.currentDown;\r\n\tcase this.KEYCNT:\r\n\t\tthis.core.STUB('Unimplemented I/O register read: KEYCNT');\r\n\t\treturn 0;\r\n\r\n\tcase this.BG0HOFS:\r\n\tcase this.BG0VOFS:\r\n\tcase this.BG1HOFS:\r\n\tcase this.BG1VOFS:\r\n\tcase this.BG2HOFS:\r\n\tcase this.BG2VOFS:\r\n\tcase this.BG3HOFS:\r\n\tcase this.BG3VOFS:\r\n\tcase this.BG2PA:\r\n\tcase this.BG2PB:\r\n\tcase this.BG2PC:\r\n\tcase this.BG2PD:\r\n\tcase this.BG3PA:\r\n\tcase this.BG3PB:\r\n\tcase this.BG3PC:\r\n\tcase this.BG3PD:\r\n\tcase this.BG2X_LO:\r\n\tcase this.BG2X_HI:\r\n\tcase this.BG2Y_LO:\r\n\tcase this.BG2Y_HI:\r\n\tcase this.BG3X_LO:\r\n\tcase this.BG3X_HI:\r\n\tcase this.BG3Y_LO:\r\n\tcase this.BG3Y_HI:\r\n\tcase this.WIN0H:\r\n\tcase this.WIN1H:\r\n\tcase this.WIN0V:\r\n\tcase this.WIN1V:\r\n\tcase this.BLDY:\r\n\tcase this.DMA0SAD_LO:\r\n\tcase this.DMA0SAD_HI:\r\n\tcase this.DMA0DAD_LO:\r\n\tcase this.DMA0DAD_HI:\r\n\tcase this.DMA0CNT_LO:\r\n\tcase this.DMA1SAD_LO:\r\n\tcase this.DMA1SAD_HI:\r\n\tcase this.DMA1DAD_LO:\r\n\tcase this.DMA1DAD_HI:\r\n\tcase this.DMA1CNT_LO:\r\n\tcase this.DMA2SAD_LO:\r\n\tcase this.DMA2SAD_HI:\r\n\tcase this.DMA2DAD_LO:\r\n\tcase this.DMA2DAD_HI:\r\n\tcase this.DMA2CNT_LO:\r\n\tcase this.DMA3SAD_LO:\r\n\tcase this.DMA3SAD_HI:\r\n\tcase this.DMA3DAD_LO:\r\n\tcase this.DMA3DAD_HI:\r\n\tcase this.DMA3CNT_LO:\r\n\tcase this.FIFO_A_LO:\r\n\tcase this.FIFO_A_HI:\r\n\tcase this.FIFO_B_LO:\r\n\tcase this.FIFO_B_HI:\r\n\t\tthis.core.WARN('Read for write-only register: 0x' + offset.toString(16));\r\n\t\treturn this.core.mmu.badMemory.loadU16(0);\r\n\r\n\tcase this.MOSAIC:\r\n\t\tthis.core.WARN('Read for write-only register: 0x' + offset.toString(16));\r\n\t\treturn 0;\r\n\r\n\tcase this.SIOMULTI0:\r\n \tcase this.SIOMULTI1:\r\n \tcase this.SIOMULTI2:\r\n \tcase this.SIOMULTI3:\r\n \t\treturn this.sio.read((offset - this.SIOMULTI0) >> 1);\r\n\r\n \tcase this.SIODATA8:\r\n \t\tthis.core.STUB('Unimplemented SIO register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\tcase this.JOYCNT:\r\n\tcase this.JOYSTAT:\r\n \t\tthis.core.STUB('Unimplemented JOY register read: 0x' + offset.toString(16));\r\n \t\treturn 0;\r\n\r\n\tdefault:\r\n\t\tthis.core.WARN('Bad I/O register read: 0x' + offset.toString(16));\r\n\t\treturn this.core.mmu.badMemory.loadU16(0);\r\n\t}\r\n\treturn this.registers[offset >> 1];\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store8 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase this.WININ:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WININ | 1:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WINOUT:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.WINOUT | 1:\r\n\t\tthis.value &= 0x3F;\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_LO:\r\n\tcase this.SOUND1CNT_LO | 1:\r\n\tcase this.SOUND1CNT_HI:\r\n\tcase this.SOUND1CNT_HI | 1:\r\n\tcase this.SOUND1CNT_X:\r\n\tcase this.SOUND1CNT_X | 1:\r\n\tcase this.SOUND2CNT_LO:\r\n\tcase this.SOUND2CNT_LO | 1:\r\n\tcase this.SOUND2CNT_HI:\r\n\tcase this.SOUND2CNT_HI | 1:\r\n\tcase this.SOUND3CNT_LO:\r\n\tcase this.SOUND3CNT_LO | 1:\r\n\tcase this.SOUND3CNT_HI:\r\n\tcase this.SOUND3CNT_HI | 1:\r\n\tcase this.SOUND3CNT_X:\r\n\tcase this.SOUND3CNT_X | 1:\r\n\tcase this.SOUND4CNT_LO:\r\n\tcase this.SOUND4CNT_LO | 1:\r\n\tcase this.SOUND4CNT_HI:\r\n\tcase this.SOUND4CNT_HI | 1:\r\n\tcase this.SOUNDCNT_LO:\r\n\tcase this.SOUNDCNT_LO | 1:\r\n\tcase this.SOUNDCNT_X:\r\n\tcase this.IF:\r\n\tcase this.IME:\r\n\t\tbreak;\r\n\tcase this.SOUNDBIAS | 1:\r\n\t\tthis.STUB_REG('sound', offset);\r\n\t\tbreak;\r\n\tcase this.HALTCNT:\r\n\t\tvalue &= 0x80;\r\n\t\tif (!value) {\r\n\t\t\tthis.core.irq.halt();\r\n\t\t} else {\r\n\t\t\tthis.core.STUB('Stop');\r\n\t\t}\r\n\t\treturn;\r\n\tdefault:\r\n\t\tthis.STUB_REG('8-bit I/O', offset);\r\n\t\tbreak;\r\n\t}\r\n\r\n\tif (offset & 1) {\r\n\t\tvalue <<= 8;\r\n\t\tvalue |= (this.registers[offset >> 1] & 0x00FF);\r\n\t} else {\r\n\t\tvalue &= 0x00FF;\r\n\t\tvalue |= (this.registers[offset >> 1] & 0xFF00);\r\n\t}\r\n\tthis.store16(offset & 0xFFFFFFE, value);\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store16 = function(offset, value) {\r\n\tswitch (offset) {\r\n\t// Video\r\n\tcase this.DISPCNT:\r\n\t\tthis.video.renderPath.writeDisplayControl(value);\r\n\t\tbreak;\r\n\tcase this.DISPSTAT:\r\n\t\tvalue &= this.video.DISPSTAT_MASK;\r\n\t\tthis.video.writeDisplayStat(value);\r\n\t\tbreak;\r\n\tcase this.BG0CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(0, value);\r\n\t\tbreak;\r\n\tcase this.BG1CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(1, value);\r\n\t\tbreak;\r\n\tcase this.BG2CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3CNT:\r\n\t\tthis.video.renderPath.writeBackgroundControl(3, value);\r\n\t\tbreak;\r\n\tcase this.BG0HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(0, value);\r\n\t\tbreak;\r\n\tcase this.BG0VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(0, value);\r\n\t\tbreak;\r\n\tcase this.BG1HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(1, value);\r\n\t\tbreak;\r\n\tcase this.BG1VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(1, value);\r\n\t\tbreak;\r\n\tcase this.BG2HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3HOFS:\r\n\t\tthis.video.renderPath.writeBackgroundHOffset(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3VOFS:\r\n\t\tthis.video.renderPath.writeBackgroundVOffset(3, value);\r\n\t\tbreak;\r\n\tcase this.BG2X_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG2X_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG2Y_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG2Y_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG2PA:\r\n\t\tthis.video.renderPath.writeBackgroundParamA(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PB:\r\n\t\tthis.video.renderPath.writeBackgroundParamB(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PC:\r\n\t\tthis.video.renderPath.writeBackgroundParamC(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2PD:\r\n\t\tthis.video.renderPath.writeBackgroundParamD(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3X_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG3X_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG3Y_LO:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, (this.registers[(offset >> 1) | 1] << 16) | value);\r\n\t\tbreak;\r\n\tcase this.BG3Y_HI:\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, this.registers[(offset >> 1) ^ 1] | (value << 16));\r\n\t\tbreak;\r\n\tcase this.BG3PA:\r\n\t\tthis.video.renderPath.writeBackgroundParamA(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PB:\r\n\t\tthis.video.renderPath.writeBackgroundParamB(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PC:\r\n\t\tthis.video.renderPath.writeBackgroundParamC(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3PD:\r\n\t\tthis.video.renderPath.writeBackgroundParamD(3, value);\r\n\t\tbreak;\r\n\tcase this.WIN0H:\r\n\t\tthis.video.renderPath.writeWin0H(value);\r\n\t\tbreak;\r\n\tcase this.WIN1H:\r\n\t\tthis.video.renderPath.writeWin1H(value);\r\n\t\tbreak;\r\n\tcase this.WIN0V:\r\n\t\tthis.video.renderPath.writeWin0V(value);\r\n\t\tbreak;\r\n\tcase this.WIN1V:\r\n\t\tthis.video.renderPath.writeWin1V(value);\r\n\t\tbreak;\r\n\tcase this.WININ:\r\n\t\tvalue &= 0x3F3F;\r\n\t\tthis.video.renderPath.writeWinIn(value);\r\n\t\tbreak;\r\n\tcase this.WINOUT:\r\n\t\tvalue &= 0x3F3F;\r\n\t\tthis.video.renderPath.writeWinOut(value);\r\n\t\tbreak;\r\n\tcase this.BLDCNT:\r\n\t\tvalue &= 0x7FFF;\r\n\t\tthis.video.renderPath.writeBlendControl(value);\r\n\t\tbreak;\r\n\tcase this.BLDALPHA:\r\n\t\tvalue &= 0x1F1F;\r\n\t\tthis.video.renderPath.writeBlendAlpha(value);\r\n\t\tbreak;\r\n\tcase this.BLDY:\r\n\t\tvalue &= 0x001F;\r\n\t\tthis.video.renderPath.writeBlendY(value);\r\n\t\tbreak;\r\n\tcase this.MOSAIC:\r\n\t\tthis.video.renderPath.writeMosaic(value);\r\n\t\tbreak;\r\n\r\n\t// Sound\r\n\tcase this.SOUND1CNT_LO:\r\n\t\tvalue &= 0x007F;\r\n\t\tthis.audio.writeSquareChannelSweep(0, value);\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_HI:\r\n\t\tthis.audio.writeSquareChannelDLE(0, value);\r\n\t\tbreak;\r\n\tcase this.SOUND1CNT_X:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeSquareChannelFC(0, value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND2CNT_LO:\r\n\t\tthis.audio.writeSquareChannelDLE(1, value);\r\n\t\tbreak;\r\n\tcase this.SOUND2CNT_HI:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeSquareChannelFC(1, value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_LO:\r\n\t\tvalue &= 0x00E0;\r\n\t\tthis.audio.writeChannel3Lo(value);\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_HI:\r\n\t\tvalue &= 0xE0FF;\r\n\t\tthis.audio.writeChannel3Hi(value);\r\n\t\tbreak;\r\n\tcase this.SOUND3CNT_X:\r\n\t\tvalue &= 0xC7FF;\r\n\t\tthis.audio.writeChannel3X(value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUND4CNT_LO:\r\n\t\tvalue &= 0xFF3F;\r\n\t\tthis.audio.writeChannel4LE(value);\r\n\t\tbreak;\r\n\tcase this.SOUND4CNT_HI:\r\n\t\tvalue &= 0xC0FF;\r\n\t\tthis.audio.writeChannel4FC(value);\r\n\t\tvalue &= ~0x8000;\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_LO:\r\n\t\tvalue &= 0xFF77;\r\n\t\tthis.audio.writeSoundControlLo(value);\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_HI:\r\n\t\tvalue &= 0xFF0F;\r\n\t\tthis.audio.writeSoundControlHi(value);\r\n\t\tbreak;\r\n\tcase this.SOUNDCNT_X:\r\n\t\tvalue &= 0x0080;\r\n\t\tthis.audio.writeEnable(value);\r\n\t\tbreak;\r\n\tcase this.WAVE_RAM0_LO:\r\n\tcase this.WAVE_RAM0_HI:\r\n\tcase this.WAVE_RAM1_LO:\r\n\tcase this.WAVE_RAM1_HI:\r\n\tcase this.WAVE_RAM2_LO:\r\n\tcase this.WAVE_RAM2_HI:\r\n\tcase this.WAVE_RAM3_LO:\r\n\tcase this.WAVE_RAM3_HI:\r\n\t\tthis.audio.writeWaveData(offset - this.WAVE_RAM0_LO, value, 2);\r\n\t\tbreak;\r\n\r\n\t// DMA\r\n\tcase this.DMA0SAD_LO:\r\n\tcase this.DMA0DAD_LO:\r\n\tcase this.DMA1SAD_LO:\r\n\tcase this.DMA1DAD_LO:\r\n\tcase this.DMA2SAD_LO:\r\n\tcase this.DMA2DAD_LO:\r\n\tcase this.DMA3SAD_LO:\r\n\tcase this.DMA3DAD_LO:\r\n\t\tthis.store32(offset, (this.registers[(offset >> 1) + 1] << 16) | value);\r\n\t\treturn;\r\n\r\n\tcase this.DMA0SAD_HI:\r\n\tcase this.DMA0DAD_HI:\r\n\tcase this.DMA1SAD_HI:\r\n\tcase this.DMA1DAD_HI:\r\n\tcase this.DMA2SAD_HI:\r\n\tcase this.DMA2DAD_HI:\r\n\tcase this.DMA3SAD_HI:\r\n\tcase this.DMA3DAD_HI:\r\n\t\tthis.store32(offset - 2, this.registers[(offset >> 1) - 1] | (value << 16));\r\n\t\treturn;\r\n\r\n\tcase this.DMA0CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA0CNT_HI:\r\n\t\t// The DMA registers need to set the values before writing the control, as writing the\r\n\t\t// control can synchronously trigger a DMA transfer\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(0, value);\r\n\t\treturn;\r\n\tcase this.DMA1CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA1CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(1, value);\r\n\t\treturn;\r\n\tcase this.DMA2CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA2CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(2, value);\r\n\t\treturn;\r\n\tcase this.DMA3CNT_LO:\r\n\t\tthis.cpu.irq.dmaSetWordCount(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA3CNT_HI:\r\n\t\tthis.registers[offset >> 1] = value & 0xFFE0;\r\n\t\tthis.cpu.irq.dmaWriteControl(3, value);\r\n\t\treturn;\r\n\r\n\t// Timers\r\n\tcase this.TM0CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(0, value);\r\n\t\treturn;\r\n\tcase this.TM1CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(1, value);\r\n\t\treturn;\r\n\tcase this.TM2CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(2, value);\r\n\t\treturn;\r\n\tcase this.TM3CNT_LO:\r\n\t\tthis.cpu.irq.timerSetReload(3, value);\r\n\t\treturn;\r\n\r\n\tcase this.TM0CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(0, value);\r\n\t\tbreak;\r\n\tcase this.TM1CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(1, value);\r\n\t\tbreak;\r\n\tcase this.TM2CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(2, value);\r\n\t\tbreak;\r\n\tcase this.TM3CNT_HI:\r\n\t\tvalue &= 0x00C7\r\n\t\tthis.cpu.irq.timerWriteControl(3, value);\r\n\t\tbreak;\r\n\r\n\t// SIO\r\n\tcase this.SIOMULTI0:\r\n \tcase this.SIOMULTI1:\r\n \tcase this.SIOMULTI2:\r\n \tcase this.SIOMULTI3:\r\n \tcase this.SIODATA8:\r\n \t\tthis.STUB_REG('SIO', offset);\r\n \t\tbreak;\r\n\tcase this.RCNT:\r\n\t\tthis.sio.setMode(((value >> 12) & 0xC) | ((this.registers[this.SIOCNT >> 1] >> 12) & 0x3));\r\n\t\tthis.sio.writeRCNT(value);\r\n\t\tbreak;\r\n\tcase this.SIOCNT:\r\n\t\tthis.sio.setMode(((value >> 12) & 0x3) | ((this.registers[this.RCNT >> 1] >> 12) & 0xC));\r\n\t\tthis.sio.writeSIOCNT(value);\r\n\t\treturn;\r\n\tcase this.JOYCNT:\r\n\tcase this.JOYSTAT:\r\n\t\tthis.STUB_REG('JOY', offset);\r\n\t\tbreak;\r\n\r\n\t// Misc\r\n\tcase this.IE:\r\n\t\tvalue &= 0x3FFF;\r\n\t\tthis.cpu.irq.setInterruptsEnabled(value);\r\n\t\tbreak;\r\n\tcase this.IF:\r\n\t\tthis.cpu.irq.dismissIRQs(value);\r\n\t\treturn;\r\n\tcase this.WAITCNT:\r\n\t\tvalue &= 0xDFFF;\r\n\t\tthis.cpu.mmu.adjustTimings(value);\r\n\t\tbreak;\r\n\tcase this.IME:\r\n\t\tvalue &= 0x0001;\r\n\t\tthis.cpu.irq.masterEnable(value);\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.STUB_REG('I/O', offset);\r\n\t}\r\n\tthis.registers[offset >> 1] = value;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.store32 = function(offset, value) {\r\n\tswitch (offset) {\r\n\tcase this.BG2X_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefX(2, value);\r\n\t\tbreak;\r\n\tcase this.BG2Y_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefY(2, value);\r\n\t\tbreak;\r\n\tcase this.BG3X_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefX(3, value);\r\n\t\tbreak;\r\n\tcase this.BG3Y_LO:\r\n\t\tvalue &= 0x0FFFFFFF;\r\n\t\tthis.video.renderPath.writeBackgroundRefY(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA0SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA0DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(0, value);\r\n\t\tbreak;\r\n\tcase this.DMA1SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA1DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(1, value);\r\n\t\tbreak;\r\n\tcase this.DMA2SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA2DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(2, value);\r\n\t\tbreak;\r\n\tcase this.DMA3SAD_LO:\r\n\t\tthis.cpu.irq.dmaSetSourceAddress(3, value);\r\n\t\tbreak;\r\n\tcase this.DMA3DAD_LO:\r\n\t\tthis.cpu.irq.dmaSetDestAddress(3, value);\r\n\t\tbreak;\r\n\tcase this.FIFO_A_LO:\r\n\t\tthis.audio.appendToFifoA(value);\r\n\t\treturn;\r\n\tcase this.FIFO_B_LO:\r\n\t\tthis.audio.appendToFifoB(value);\r\n\t\treturn;\r\n\r\n\t// High bits of this write should be ignored\r\n\tcase this.IME:\r\n\t\tthis.store16(offset, value & 0xFFFF);\r\n\t\treturn;\r\n\tcase this.JOY_RECV:\r\n\tcase this.JOY_TRANS:\r\n\t\tthis.STUB_REG('JOY', offset);\r\n\t\treturn;\r\n\tdefault:\r\n\t\tthis.store16(offset, value & 0xFFFF);\r\n\t\tthis.store16(offset | 2, value >>> 16);\r\n\t\treturn;\r\n\t}\r\n\r\n\tthis.registers[offset >> 1] = value & 0xFFFF;\r\n\tthis.registers[(offset >> 1) + 1] = value >>> 16;\r\n};\r\n\r\nGameBoyAdvanceIO.prototype.invalidatePage = function(address) {};\r\n\r\nGameBoyAdvanceIO.prototype.STUB_REG = function(type, offset) {\r\n\tthis.core.STUB('Unimplemented ' + type + ' register write: ' + offset.toString(16));\r\n};\r\n\r\nexport default GameBoyAdvanceIO;\r\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nfunction GameBoyAdvanceAudio() {\r\n\tthis.masterEnable = false;\r\n\tthis.masterVolume = 0;\r\n\r\n\tthis.SOUND_MAX = 0x400;\r\n\tthis.FIFO_MAX = 0x200;\r\n\tthis.PSG_MAX = 0x080;\r\n\r\n\twindow.AudioContext = window.AudioContext || window.webkitAudioContext;\r\n\tif (window.AudioContext) {\r\n\t\tthis.context = new AudioContext();\r\n\t\tthis.bufferSize = 0;\r\n\t\tthis.bufferSize = 4096;\r\n\t\tthis.maxSamples = this.bufferSize << 2;\r\n\t\tthis.buffers = [new Float32Array(this.maxSamples), new Float32Array(this.maxSamples)];\r\n\t\tthis.sampleMask = this.maxSamples - 1;\r\n\t\tif (this.context.createScriptProcessor) {\r\n\t\t\tthis.jsAudio = this.context.createScriptProcessor(this.bufferSize);\r\n\t\t} else {\r\n\t\t\tthis.jsAudio = this.context.createJavaScriptNode(this.bufferSize);\r\n\t\t}\r\n\r\n\t\tthis.audioProcess = function(audioProcessingEvent) {\r\n\t\t\tvar left = audioProcessingEvent.outputBuffer.getChannelData(0);\r\n\t\t\tvar right = audioProcessingEvent.outputBuffer.getChannelData(1);\r\n\t\t\tif (this.masterEnable) {\r\n\t\t\t\tvar i;\r\n\t\t\t\tvar o = this.outputPointer;\r\n\t\t\t\tfor (i = 0; i < this.bufferSize; ++i, o += this.resampleRatio) {\r\n\t\t\t\t\tif (o >= this.maxSamples) {\r\n\t\t\t\t\t\to -= this.maxSamples;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif ((o | 0) == this.samplePointer) {\r\n\t\t\t\t\t\t++this.backup;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tleft[i] = this.buffers[0][o | 0];\r\n\t\t\t\t\tright[i] = this.buffers[1][o | 0];\r\n\t\t\t\t}\r\n\t\t\t\tfor (; i < this.bufferSize; ++i) {\r\n\t\t\t\t\tleft[i] = 0;\r\n\t\t\t\t\tright[i] = 0;\r\n\t\t\t\t}\r\n\t\t\t\tthis.outputPointer = o;\r\n\t\t\t\t++this.totalSamples;\r\n\t\t\t} else {\r\n\t\t\t\tfor (i = 0; i < this.bufferSize; ++i) {\r\n\t\t\t\t\tleft[i] = 0;\r\n\t\t\t\t\tright[i] = 0;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tthis.jsAudio.onaudioprocess = (e) => {\r\n\t\t\tthis.audioProcess(e);\r\n\t\t};\r\n\t} else {\r\n\t\tthis.context = null;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.clear = function() {\r\n\tthis.fifoA = [];\r\n\tthis.fifoB = [];\r\n\tthis.fifoASample = 0;\r\n\tthis.fifoBSample = 0;\r\n\r\n\tthis.enabled = false;\r\n\tif (this.context) {\r\n\t\ttry {\r\n\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t} catch (e) {\r\n\t\t}\r\n\t}\r\n\r\n\tthis.enableChannel3 = false;\r\n\tthis.enableChannel4 = false;\r\n\tthis.enableChannelA = false;\r\n\tthis.enableChannelB = false;\r\n\tthis.enableRightChannelA = false;\r\n\tthis.enableLeftChannelA = false;\r\n\tthis.enableRightChannelB = false;\r\n\tthis.enableLeftChannelB = false;\r\n\r\n\tthis.playingChannel3 = false;\r\n\tthis.playingChannel4 = false;\r\n\r\n\tthis.volumeLeft = 0;\r\n\tthis.volumeRight = 0;\r\n\tthis.ratioChannelA = 1;\r\n\tthis.ratioChannelB = 1;\r\n\tthis.enabledLeft = 0;\r\n\tthis.enabledRight = 0;\r\n\r\n\tthis.dmaA = -1;\r\n\tthis.dmaB = -1;\r\n\tthis.soundTimerA = 0;\r\n\tthis.soundTimerB = 0;\r\n\r\n\tthis.soundRatio = 1;\r\n\tthis.soundBias = 0x200;\r\n\r\n\tthis.squareChannels = new Array();\r\n\tfor (var i = 0; i < 2; ++i) {\r\n\t\tthis.squareChannels[i] = {\r\n\t\t\tenabled: false,\r\n\t\t\tplaying: false,\r\n\t\t\tsample: 0,\r\n\t\t\tduty: 0.5,\r\n\t\t\tincrement: 0,\r\n\t\t\tstep: 0,\r\n\t\t\tinitialVolume: 0,\r\n\t\t\tvolume: 0,\r\n\t\t\tfrequency: 0,\r\n\t\t\tinterval: 0,\r\n\t\t\tsweepSteps: 0,\r\n\t\t\tsweepIncrement: 0,\r\n\t\t\tsweepInterval: 0,\r\n\t\t\tdoSweep: false,\r\n\t\t\traise: 0,\r\n\t\t\tlower: 0,\r\n\t\t\tnextStep: 0,\r\n\t\t\ttimed: false,\r\n\t\t\tlength: 0,\r\n\t\t\tend: 0\r\n\t\t}\r\n\t}\r\n\r\n\tthis.waveData = new Uint8Array(32);\r\n\tthis.channel3Dimension = 0;\r\n\tthis.channel3Bank = 0;\r\n\tthis.channel3Volume = 0;\r\n\tthis.channel3Interval = 0;\r\n\tthis.channel3Next = 0;\r\n\tthis.channel3Length = 0;\r\n\tthis.channel3Timed = false;\r\n\tthis.channel3End = 0;\r\n\tthis.channel3Pointer =0;\r\n\tthis.channel3Sample = 0;\r\n\r\n\tthis.cpuFrequency = this.core.irq.FREQUENCY;\r\n\r\n\tthis.channel4 = {\r\n\t\tsample: 0,\r\n\t\tlfsr: 0,\r\n\t\twidth: 15,\r\n\t\tinterval: this.cpuFrequency / 524288,\r\n\t\tincrement: 0,\r\n\t\tstep: 0,\r\n\t\tinitialVolume: 0,\r\n\t\tvolume: 0,\r\n\t\tnextStep: 0,\r\n\t\ttimed: false,\r\n\t\tlength: 0,\r\n\t\tend: 0\r\n\t};\r\n\r\n\tthis.nextEvent = 0;\r\n\r\n\tthis.nextSample = 0;\r\n\tthis.outputPointer = 0;\r\n\tthis.samplePointer = 0;\r\n\r\n\tthis.backup = 0;\r\n\tthis.totalSamples = 0;\r\n\r\n\tthis.sampleRate = 32768;\r\n\tthis.sampleInterval = this.cpuFrequency / this.sampleRate;\r\n\tthis.resampleRatio = 1;\r\n\tif (this.context) {\r\n\t\tthis.resampleRatio = this.sampleRate / this.context.sampleRate;\r\n\t}\r\n\r\n\tthis.writeSquareChannelFC(0, 0);\r\n\tthis.writeSquareChannelFC(1, 0);\r\n\tthis.writeChannel4FC(0);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.freeze = function() {\r\n\treturn {\r\n\t\tnextSample: this.nextSample\r\n\t};\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.defrost = function(frost) {\r\n\tthis.nextSample = frost.nextSample;\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.pause = function(paused) {\r\n\tif (this.context) {\r\n\t\tif (paused) {\r\n\t\t\ttry {\r\n\t\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t\t} catch (e) {\r\n\t\t\t\t// Sigh\r\n\t\t\t}\r\n\t\t} else if (this.enabled) {\r\n\t\t\tthis.jsAudio.connect(this.context.destination);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateTimers = function() {\r\n\tvar cycles = this.cpu.cycles;\r\n\tif (!this.enabled || (cycles < this.nextEvent && cycles < this.nextSample)) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (cycles >= this.nextEvent) {\r\n\t\tvar channel = this.squareChannels[0];\r\n\t\tthis.nextEvent = Infinity;\r\n\t\tif (channel.playing) {\r\n\t\t\tthis.updateSquareChannel(channel, cycles);\r\n\t\t}\r\n\r\n\t\tchannel = this.squareChannels[1];\r\n\t\tif (channel.playing) {\r\n\t\t\tthis.updateSquareChannel(channel, cycles);\r\n\t\t}\r\n\r\n\t\tif (this.enableChannel3 && this.playingChannel3) {\r\n\t\t\tif (cycles >= this.channel3Next) {\r\n\t\t\t\tif (this.channel3Write) {\r\n\t\t\t\t\tvar sample = this.waveData[this.channel3Pointer >> 1];\r\n\t\t\t\t\tthis.channel3Sample = (((sample >> ((this.channel3Pointer & 1) << 2)) & 0xF) - 0x8) / 8;\r\n\t\t\t\t\tthis.channel3Pointer = (this.channel3Pointer + 1);\r\n\t\t\t\t\tif (this.channel3Dimension && this.channel3Pointer >= 64) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 64;\r\n\t\t\t\t\t} else if (!this.channel3Bank && this.channel3Pointer >= 32) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 32;\r\n\t\t\t\t\t} else if (this.channel3Pointer >= 64) {\r\n\t\t\t\t\t\tthis.channel3Pointer -= 32;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tthis.channel3Next += this.channel3Interval;\r\n\t\t\t\tif (this.channel3Interval && this.nextEvent > this.channel3Next) {\r\n\t\t\t\t\tthis.nextEvent = this.channel3Next;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (this.channel3Timed && cycles >= this.channel3End) {\r\n\t\t\t\tthis.playingChannel3 = false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.enableChannel4 && this.playingChannel4) {\r\n\t\t\tif (this.channel4.timed && cycles >= this.channel4.end) {\r\n\t\t\t\tthis.playingChannel4 = false;\r\n\t\t\t} else {\r\n\t\t\t\tif (cycles >= this.channel4.next) {\r\n\t\t\t\t\tthis.channel4.lfsr >>= 1;\r\n\t\t\t\t\tvar sample = this.channel4.lfsr & 1;\r\n\t\t\t\t\tthis.channel4.lfsr |= (((this.channel4.lfsr >> 1) & 1) ^ sample) << (this.channel4.width - 1);\r\n\t\t\t\t\tthis.channel4.next += this.channel4.interval;\r\n\t\t\t\t\tthis.channel4.sample = (sample - 0.5) * 2 * this.channel4.volume;\r\n\t\t\t\t}\r\n\t\t\t\tthis.updateEnvelope(this.channel4, cycles);\r\n\t\t\t\tif (this.nextEvent > this.channel4.next) {\r\n\t\t\t\t\tthis.nextEvent = this.channel4.next;\r\n\t\t\t\t}\r\n\t\t\t\tif (this.channel4.timed && this.nextEvent > this.channel4.end) {\r\n\t\t\t\t\tthis.nextEvent = this.channel4.end;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif (cycles >= this.nextSample) {\r\n\t\tthis.sample();\r\n\t\tthis.nextSample += this.sampleInterval;\r\n\t}\r\n\r\n\tthis.nextEvent = Math.ceil(this.nextEvent);\r\n\tif ((this.nextEvent < cycles) || (this.nextSample < cycles)) {\r\n\t\t// STM instructions may take a long time\r\n\t\tthis.updateTimers();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeEnable = function(value) {\r\n\tthis.enabled = !!value;\r\n\tthis.nextEvent = this.cpu.cycles;\r\n\tthis.nextSample = this.nextEvent;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n\tif (this.context) {\r\n\t\tif (value) {\r\n\t\t\tthis.jsAudio.connect(this.context.destination);\r\n\t\t} else {\r\n\t\t\ttry {\r\n\t\t\t\tthis.jsAudio.disconnect(this.context.destination);\r\n\t\t\t} catch (e) {\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSoundControlLo = function(value) {\r\n\tthis.masterVolumeLeft = value & 0x7;\r\n\tthis.masterVolumeRight = (value >> 4) & 0x7;\r\n\tthis.enabledLeft = (value >> 8) & 0xF;\r\n\tthis.enabledRight = (value >> 12) & 0xF;\r\n\r\n\tthis.setSquareChannelEnabled(this.squareChannels[0], (this.enabledLeft | this.enabledRight) & 0x1);\r\n\tthis.setSquareChannelEnabled(this.squareChannels[1], (this.enabledLeft | this.enabledRight) & 0x2);\r\n\tthis.enableChannel3 = (this.enabledLeft | this.enabledRight) & 0x4;\r\n\tthis.setChannel4Enabled((this.enabledLeft | this.enabledRight) & 0x8);\r\n\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSoundControlHi = function(value) {\r\n\tswitch (value & 0x0003) {\r\n\tcase 0:\r\n\t\tthis.soundRatio = 0.25;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tthis.soundRatio = 0.50;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tthis.soundRatio = 1;\r\n\t\tbreak;\r\n\t}\r\n\tthis.ratioChannelA = (((value & 0x0004) >> 2) + 1) * 0.5;\r\n\tthis.ratioChannelB = (((value & 0x0008) >> 3) + 1) * 0.5;\r\n\r\n\tthis.enableRightChannelA = value & 0x0100;\r\n\tthis.enableLeftChannelA = value & 0x0200;\r\n\tthis.enableChannelA  = value & 0x0300;\r\n\tthis.soundTimerA = value & 0x0400;\r\n\tif (value & 0x0800) {\r\n\t\tthis.fifoA = [];\r\n\t}\r\n\tthis.enableRightChannelB = value & 0x1000;\r\n\tthis.enableLeftChannelB = value & 0x2000;\r\n\tthis.enableChannelB  = value & 0x3000;\r\n\tthis.soundTimerB = value & 0x4000;\r\n\tif (value & 0x8000) {\r\n\t\tthis.fifoB = [];\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetSquareChannel = function(channel) {\r\n\tif (channel.step) {\r\n\t\tchannel.nextStep = this.cpu.cycles + channel.step;\r\n\t}\r\n\tif (channel.enabled && !channel.playing) {\r\n\t\tchannel.raise = this.cpu.cycles;\r\n\t\tchannel.lower = channel.raise + channel.duty * channel.interval;\r\n\t\tchannel.end = this.cpu.cycles + channel.length;\r\n\t\tthis.nextEvent = this.cpu.cycles;\r\n\t}\r\n\tchannel.playing = channel.enabled;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.setSquareChannelEnabled = function(channel, enable) {\r\n\tif (!(channel.enabled && channel.playing) && enable) {\r\n\t\tchannel.enabled = !!enable;\r\n\t\tthis.updateTimers();\r\n\t\tthis.core.irq.pollNextEvent();\r\n\t} else {\r\n\t\tchannel.enabled = !!enable;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelSweep = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tchannel.sweepSteps = value & 0x07;\r\n\tchannel.sweepIncrement = (value & 0x08) ? -1 : 1;\r\n\tchannel.sweepInterval = ((value >> 4) & 0x7) * this.cpuFrequency / 128;\r\n\tchannel.doSweep = !!channel.sweepInterval;\r\n\tchannel.nextSweep = this.cpu.cycles + channel.sweepInterval;\r\n\tthis.resetSquareChannel(channel);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelDLE = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tvar duty = (value >> 6) & 0x3;\r\n\tswitch (duty) {\r\n\tcase 0:\r\n\t\tchannel.duty = 0.125;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tchannel.duty = 0.25;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tchannel.duty = 0.5;\r\n\t\tbreak;\r\n\tcase 3:\r\n\t\tchannel.duty = 0.75;\r\n\t\tbreak;\r\n\t}\r\n\tthis.writeChannelLE(channel, value);\r\n\tthis.resetSquareChannel(channel);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeSquareChannelFC = function(channelId, value) {\r\n\tvar channel = this.squareChannels[channelId];\r\n\tvar frequency = value & 2047;\r\n\tchannel.frequency = frequency;\r\n\tchannel.interval = this.cpuFrequency * (2048 - frequency) / 131072;\r\n\tchannel.timed = !!(value & 0x4000);\r\n\r\n\tif (value & 0x8000) {\r\n\t\tthis.resetSquareChannel(channel);\r\n\t\tchannel.volume = channel.initialVolume;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateSquareChannel = function(channel, cycles) {\r\n\tif (channel.timed && cycles >= channel.end) {\r\n\t\tchannel.playing = false;\r\n\t\treturn;\r\n\t}\r\n\r\n\tif (channel.doSweep && cycles >= channel.nextSweep) {\r\n\t\tchannel.frequency += channel.sweepIncrement * (channel.frequency >> channel.sweepSteps);\r\n\t\tif (channel.frequency < 0) {\r\n\t\t\tchannel.frequency = 0;\r\n\t\t} else if (channel.frequency > 2047) {\r\n\t\t\tchannel.frequency = 2047;\r\n\t\t\tchannel.playing = false;\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tchannel.interval = this.cpuFrequency * (2048 - channel.frequency) / 131072;\r\n\t\tchannel.nextSweep += channel.sweepInterval;\r\n\t}\r\n\r\n\tif (cycles >= channel.raise) {\r\n\t\tchannel.sample = channel.volume;\r\n\t\tchannel.lower = channel.raise + channel.duty * channel.interval;\r\n\t\tchannel.raise += channel.interval;\r\n\t} else if (cycles >= channel.lower) {\r\n\t\tchannel.sample = -channel.volume;\r\n\t\tchannel.lower += channel.interval;\r\n\t}\r\n\r\n\tthis.updateEnvelope(channel, cycles);\r\n\r\n\tif (this.nextEvent > channel.raise) {\r\n\t\tthis.nextEvent = channel.raise;\r\n\t}\r\n\tif (this.nextEvent > channel.lower) {\r\n\t\tthis.nextEvent = channel.lower;\r\n\t}\r\n\tif (channel.timed && this.nextEvent > channel.end) {\r\n\t\tthis.nextEvent = channel.end;\r\n\t}\r\n\tif (channel.doSweep && this.nextEvent > channel.nextSweep) {\r\n\t\tthis.nextEvent = channel.nextSweep;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3Lo = function(value) {\r\n\tthis.channel3Dimension = value & 0x20;\r\n\tthis.channel3Bank = value & 0x40;\r\n\tvar enable = value & 0x80;\r\n\tif (!this.channel3Write && enable) {\r\n\t\tthis.channel3Write = enable;\r\n\t\tthis.resetChannel3();\r\n\t} else {\r\n\t\tthis.channel3Write = enable;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3Hi = function(value) {\r\n\tthis.channel3Length = this.cpuFrequency * (0x100 - (value & 0xFF)) / 256;\r\n\tvar volume = (value >> 13) & 0x7;\r\n\tswitch (volume) {\r\n\tcase 0:\r\n\t\tthis.channel3Volume = 0;\r\n\t\tbreak;\r\n\tcase 1:\r\n\t\tthis.channel3Volume = 1;\r\n\t\tbreak;\r\n\tcase 2:\r\n\t\tthis.channel3Volume = 0.5;\r\n\t\tbreak;\r\n\tcase 3:\r\n\t\tthis.channel3Volume = 0.25;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.channel3Volume = 0.75;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel3X = function(value) {\r\n\tthis.channel3Interval = this.cpuFrequency * (2048 - (value & 0x7FF)) / 2097152;\r\n\tthis.channel3Timed = !!(value & 0x4000);\r\n\tif (this.channel3Write) {\r\n\t\tthis.resetChannel3();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetChannel3 = function() {\r\n\tthis.channel3Next = this.cpu.cycles;\r\n\tthis.nextEvent = this.channel3Next;\r\n\tthis.channel3End = this.cpu.cycles + this.channel3Length;\r\n\tthis.playingChannel3 = this.channel3Write;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeWaveData = function(offset, data, width) {\r\n\tif (!this.channel3Bank) {\r\n\t\toffset += 16;\r\n\t}\r\n\tif (width == 2) {\r\n\t\tthis.waveData[offset] = data & 0xFF;\r\n\t\tdata >>= 8;\r\n\t\t++offset;\r\n\t}\r\n\tthis.waveData[offset] = data & 0xFF;\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.setChannel4Enabled = function(enable) {\r\n\tif (!this.enableChannel4 && enable) {\r\n\t\tthis.channel4.next = this.cpu.cycles;\r\n\t\tthis.channel4.end = this.cpu.cycles + this.channel4.length;\r\n\t\tthis.enableChannel4 = true;\r\n\t\tthis.playingChannel4 = true;\r\n\t\tthis.nextEvent = this.cpu.cycles;\r\n\t\tthis.updateEnvelope(this.channel4);\r\n\t\tthis.updateTimers();\r\n\t\tthis.core.irq.pollNextEvent();\r\n\t} else {\r\n\t\tthis.enableChannel4 = enable;\r\n\t}\r\n}\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel4LE = function(value) {\r\n\tthis.writeChannelLE(this.channel4, value);\r\n\tthis.resetChannel4();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannel4FC = function(value) {\r\n\tthis.channel4.timed = !!(value & 0x4000);\r\n\r\n\tvar r = value & 0x7;\r\n\tif (!r) {\r\n\t\tr = 0.5;\r\n\t}\r\n\tvar s = (value >> 4) & 0xF;\r\n\tvar interval = this.cpuFrequency * (r * (2 << s)) / 524288;\r\n\tif (interval != this.channel4.interval) {\r\n\t\tthis.channel4.interval = interval;\r\n\t\tthis.resetChannel4();\r\n\t}\r\n\r\n\tvar width = (value & 0x8) ? 7 : 15;\r\n\tif (width != this.channel4.width) {\r\n\t\tthis.channel4.width = width;\r\n\t\tthis.resetChannel4();\r\n\t}\r\n\r\n\tif (value & 0x8000) {\r\n\t\tthis.resetChannel4();\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.resetChannel4 = function() {\r\n\tif (this.channel4.width == 15) {\r\n\t\tthis.channel4.lfsr = 0x4000;\r\n\t} else {\r\n\t\tthis.channel4.lfsr = 0x40;\r\n\t}\r\n\tthis.channel4.volume = this.channel4.initialVolume;\r\n\tif (this.channel4.step) {\r\n\t\tthis.channel4.nextStep = this.cpu.cycles + this.channel4.step;\r\n\t}\r\n\tthis.channel4.end = this.cpu.cycles + this.channel4.length;\r\n\tthis.channel4.next = this.cpu.cycles;\r\n\tthis.nextEvent = this.channel4.next;\r\n\r\n\tthis.playingChannel4 = this.enableChannel4;\r\n\tthis.updateTimers();\r\n\tthis.core.irq.pollNextEvent();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.writeChannelLE = function(channel, value) {\r\n\tchannel.length = this.cpuFrequency * ((0x40 - (value & 0x3F)) / 256);\r\n\r\n\tif (value & 0x0800) {\r\n\t\tchannel.increment = 1 / 16;\r\n\t} else {\r\n\t\tchannel.increment = -1 / 16;\r\n\t}\r\n\tchannel.initialVolume = ((value >> 12) & 0xF) / 16;\r\n\r\n\tchannel.step = this.cpuFrequency * (((value >> 8) & 0x7) / 64);\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.updateEnvelope = function(channel, cycles) {\r\n\tif (channel.step) {\r\n\t\tif (cycles >= channel.nextStep) {\r\n\t\t\tchannel.volume += channel.increment;\r\n\t\t\tif (channel.volume > 1) {\r\n\t\t\t\tchannel.volume = 1;\r\n\t\t\t} else if (channel.volume < 0) {\r\n\t\t\t\tchannel.volume = 0;\r\n\t\t\t}\r\n\t\t\tchannel.nextStep += channel.step;\r\n\t\t}\r\n\r\n\t\tif (this.nextEvent > channel.nextStep) {\r\n\t\t\tthis.nextEvent = channel.nextStep;\r\n\t\t}\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.appendToFifoA = function(value) {\r\n\tvar b;\r\n\tif (this.fifoA.length > 28) {\r\n\t\tthis.fifoA = this.fifoA.slice(-28);\r\n\t}\r\n\tfor (var i = 0; i < 4; ++i) {\r\n\t\tb = (value & 0xFF) << 24;\r\n\t\tvalue >>= 8;\r\n\t\tthis.fifoA.push(b / 0x80000000);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.appendToFifoB = function(value) {\r\n\tvar b;\r\n\tif (this.fifoB.length > 28) {\r\n\t\tthis.fifoB = this.fifoB.slice(-28);\r\n\t}\r\n\tfor (var i = 0; i < 4; ++i) {\r\n\t\tb = (value & 0xFF) << 24;\r\n\t\tvalue >>= 8;\r\n\t\tthis.fifoB.push(b / 0x80000000);\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sampleFifoA = function() {\r\n\tif (this.fifoA.length <= 16) {\r\n\t\tvar dma = this.core.irq.dma[this.dmaA];\r\n\t\tdma.nextCount = 4;\r\n\t\tthis.core.mmu.serviceDma(this.dmaA, dma);\r\n\t}\r\n\tthis.fifoASample = this.fifoA.shift();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sampleFifoB = function() {\r\n\tif (this.fifoB.length <= 16) {\r\n\t\tvar dma = this.core.irq.dma[this.dmaB];\r\n\t\tdma.nextCount = 4;\r\n\t\tthis.core.mmu.serviceDma(this.dmaB, dma);\r\n\t}\r\n\tthis.fifoBSample = this.fifoB.shift();\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.scheduleFIFODma = function(number, info) {\r\n\tswitch (info.dest) {\r\n\tcase this.cpu.mmu.BASE_IO | this.cpu.irq.io.FIFO_A_LO:\r\n\t\t// FIXME: is this needed or a hack?\r\n\t\tinfo.dstControl = 2;\r\n\t\tthis.dmaA = number;\r\n\t\tbreak;\r\n\tcase this.cpu.mmu.BASE_IO | this.cpu.irq.io.FIFO_B_LO:\r\n\t\tinfo.dstControl = 2;\r\n\t\tthis.dmaB = number;\r\n\t\tbreak;\r\n\tdefault:\r\n\t\tthis.core.WARN('Tried to schedule FIFO DMA for non-FIFO destination');\r\n\t\tbreak;\r\n\t}\r\n};\r\n\r\nGameBoyAdvanceAudio.prototype.sample = function() {\r\n\tvar sampleLeft = 0;\r\n\tvar sampleRight = 0;\r\n\tvar sample;\r\n\tvar channel;\r\n\r\n\tchannel = this.squareChannels[0];\r\n\tif (channel.playing) {\r\n\t\tsample = channel.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x1) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x1) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tchannel = this.squareChannels[1];\r\n\tif (channel.playing) {\r\n\t\tsample = channel.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x2) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x2) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.playingChannel3) {\r\n\t\tsample = this.channel3Sample * this.soundRatio * this.channel3Volume * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x4) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x4) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.playingChannel4) {\r\n\t\tsample = this.channel4.sample * this.soundRatio * this.PSG_MAX;\r\n\t\tif (this.enabledLeft & 0x8) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enabledRight & 0x8) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.enableChannelA) {\r\n\t\tsample = this.fifoASample * this.FIFO_MAX * this.ratioChannelA;\r\n\t\tif (this.enableLeftChannelA) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enableRightChannelA) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tif (this.enableChannelB) {\r\n\t\tsample = this.fifoBSample * this.FIFO_MAX * this.ratioChannelB;\r\n\t\tif (this.enableLeftChannelB) {\r\n\t\t\tsampleLeft += sample;\r\n\t\t}\r\n\t\tif (this.enableRightChannelB) {\r\n\t\t\tsampleRight += sample;\r\n\t\t}\r\n\t}\r\n\r\n\tvar samplePointer = this.samplePointer;\r\n\tsampleLeft *= this.masterVolume / this.SOUND_MAX;\r\n\tsampleLeft = Math.max(Math.min(sampleLeft, 1), -1);\r\n\tsampleRight *= this.masterVolume / this.SOUND_MAX;\r\n\tsampleRight = Math.max(Math.min(sampleRight, 1), -1);\r\n\tif (this.buffers) {\r\n\t\tthis.buffers[0][samplePointer] = sampleLeft;\r\n\t\tthis.buffers[1][samplePointer] = sampleRight;\r\n\t}\r\n\tthis.samplePointer = (samplePointer + 1) & this.sampleMask;\r\n};\r\n\r\nexport default GameBoyAdvanceAudio;\r\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nfunction MemoryAligned16(size) {\n\tthis.buffer = new Uint16Array(size >> 1);\n};\n\nMemoryAligned16.prototype.load8 = function(offset) {\n\treturn (this.loadU8(offset) << 24) >> 24;\n};\n\nMemoryAligned16.prototype.load16 = function(offset) {\n\treturn (this.loadU16(offset) << 16) >> 16;\n};\n\nMemoryAligned16.prototype.loadU8 = function(offset) {\n\tvar index = offset >> 1;\n\tif (offset & 1) {\n\t\treturn (this.buffer[index] & 0xFF00) >>> 8;\n\t} else {\n\t\treturn this.buffer[index] & 0x00FF;\n\t}\n};\n\nMemoryAligned16.prototype.loadU16 = function(offset) {\n\treturn this.buffer[offset >> 1];\n};\n\nMemoryAligned16.prototype.load32 = function(offset) {\n\treturn this.buffer[(offset >> 1) & ~1] | (this.buffer[(offset >> 1) | 1] << 16);\n};\n\nMemoryAligned16.prototype.store8 = function(offset, value) {\n\tvar index = offset >> 1;\n\tthis.store16(offset, (value << 8) | value);\n};\n\nMemoryAligned16.prototype.store16 = function(offset, value) {\n\tthis.buffer[offset >> 1] = value;\n};\n\nMemoryAligned16.prototype.store32 = function(offset, value) {\n\tvar index = offset >> 1;\n\tthis.store16(offset, this.buffer[index] = value & 0xFFFF);\n\tthis.store16(offset + 2, this.buffer[index + 1] = value >>> 16);\n};\n\nMemoryAligned16.prototype.insert = function(start, data) {\n\tthis.buffer.set(data, start);\n};\n\nMemoryAligned16.prototype.invalidatePage = function(address) {};\n\nfunction GameBoyAdvanceVRAM(size) {\n\tMemoryAligned16.call(this, size);\n\tthis.vram = this.buffer;\n};\n\nGameBoyAdvanceVRAM.prototype = Object.create(MemoryAligned16.prototype);\n\nfunction GameBoyAdvanceOAM(size) {\n\tMemoryAligned16.call(this, size);\n\tthis.oam = this.buffer;\n\tthis.objs = new Array(128);\n\tfor (var i = 0; i < 128; ++i) {\n\t\tthis.objs[i] = new GameBoyAdvanceOBJ(this, i);\n\t}\n\tthis.scalerot = new Array(32);\n\tfor (var i = 0; i < 32; ++i) {\n\t\tthis.scalerot[i] = {\n\t\t\ta: 1,\n\t\t\tb: 0,\n\t\t\tc: 0,\n\t\t\td: 1\n\t\t};\n\t}\n};\n\nGameBoyAdvanceOAM.prototype = Object.create(MemoryAligned16.prototype);\n\nGameBoyAdvanceOAM.prototype.overwrite = function(memory) {\n\tfor (var i = 0; i < (this.buffer.byteLength >> 1); ++i) {\n\t\tthis.store16(i << 1, memory[i]);\n\t}\n};\n\nGameBoyAdvanceOAM.prototype.store16 = function(offset, value) {\n\tvar index = (offset & 0x3F8) >> 3;\n\tvar obj = this.objs[index];\n\tvar scalerot = this.scalerot[index >> 2];\n\tvar layer = obj.priority;\n\tvar disable = obj.disable;\n\tvar y = obj.y;\n\tswitch (offset & 0x00000006) {\n\tcase 0:\n\t\t// Attribute 0\n\t\tobj.y = value & 0x00FF;\n\t\tvar wasScalerot = obj.scalerot;\n\t\tobj.scalerot = value & 0x0100;\n\t\tif (obj.scalerot) {\n\t\t\tobj.scalerotOam = this.scalerot[obj.scalerotParam];\n\t\t\tobj.doublesize = !!(value & 0x0200);\n\t\t\tobj.disable = 0;\n\t\t\tobj.hflip = 0;\n\t\t\tobj.vflip = 0;\n\t\t} else {\n\t\t\tobj.doublesize = false;\n\t\t\tobj.disable = value & 0x0200;\n\t\t\tif (wasScalerot) {\n\t\t\t\tobj.hflip = obj.scalerotParam & 0x0008;\n\t\t\t\tobj.vflip = obj.scalerotParam & 0x0010;\n\t\t\t}\n\t\t}\n\t\tobj.mode = (value & 0x0C00) >> 6; // This lines up with the stencil format\n\t\tobj.mosaic = value & 0x1000;\n\t\tobj.multipalette = value & 0x2000;\n\t\tobj.shape = (value & 0xC000) >> 14;\n\n\t\tobj.recalcSize();\n\t\tbreak;\n\tcase 2:\n\t\t// Attribute 1\n\t\tobj.x = value & 0x01FF;\n\t\tif (obj.scalerot) {\n\t\t\tobj.scalerotParam = (value & 0x3E00) >> 9;\n\t\t\tobj.scalerotOam = this.scalerot[obj.scalerotParam];\n\t\t\tobj.hflip = 0;\n\t\t\tobj.vflip = 0;\n\t\t\tobj.drawScanline = obj.drawScanlineAffine;\n\t\t} else {\n\t\t\tobj.hflip = value & 0x1000;\n\t\t\tobj.vflip = value & 0x2000;\n\t\t\tobj.drawScanline = obj.drawScanlineNormal;\n\t\t}\n\t\tobj.size = (value & 0xC000) >> 14;\n\n\t\tobj.recalcSize();\n\t\tbreak;\n\tcase 4:\n\t\t// Attribute 2\n\t\tobj.tileBase = value & 0x03FF;\n\t\tobj.priority = (value & 0x0C00) >> 10;\n\t\tobj.palette = (value & 0xF000) >> 8; // This is shifted up 4 to make pushPixel faster\n\t\tbreak;\n\tcase 6:\n\t\t// Scaling/rotation parameter\n\t\tswitch (index & 0x3) {\n\t\tcase 0:\n\t\t\tscalerot.a = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tscalerot.b = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tscalerot.c = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tscalerot.d = (value << 16) / 0x1000000;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\t}\n\n\tMemoryAligned16.prototype.store16.call(this, offset, value);\n};\n\nfunction GameBoyAdvancePalette() {\n\tthis.colors = [ new Array(0x100), new Array(0x100) ];\n\tthis.adjustedColors = [ new Array(0x100), new Array(0x100) ];\n\tthis.passthroughColors = [\n\t\tthis.colors[0], // BG0\n\t\tthis.colors[0], // BG1\n\t\tthis.colors[0], // BG2\n\t\tthis.colors[0], // BG3\n\t\tthis.colors[1], // OBJ\n\t\tthis.colors[0] // Backdrop\n\t];\n\tthis.blendY = 1;\n};\n\nGameBoyAdvancePalette.prototype.overwrite = function(memory) {\n\tfor (var i = 0; i < 512; ++i) {\n\t\tthis.store16(i << 1, memory[i]);\n\t}\n};\n\nGameBoyAdvancePalette.prototype.loadU8 = function(offset) {\n\treturn (this.loadU16(offset) >> (8 * (offset & 1))) & 0xFF;\n};\n\nGameBoyAdvancePalette.prototype.loadU16 = function(offset) {\n\treturn this.colors[(offset & 0x200) >> 9][(offset & 0x1FF) >> 1];\n};\n\nGameBoyAdvancePalette.prototype.load16 = function(offset) {\n\treturn (this.loadU16(offset) << 16) >> 16;\n};\n\nGameBoyAdvancePalette.prototype.load32 = function(offset) {\n\treturn this.loadU16(offset) | (this.loadU16(offset + 2) << 16);\n};\n\nGameBoyAdvancePalette.prototype.store16 = function(offset, value) {\n\tvar type = (offset & 0x200) >> 9;\n\tvar index = (offset & 0x1FF) >> 1;\n\tthis.colors[type][index] = value;\n\tthis.adjustedColors[type][index] = this.adjustColor(value);\n};\n\nGameBoyAdvancePalette.prototype.store32 = function(offset, value) {\n\tthis.store16(offset, value & 0xFFFF);\n\tthis.store16(offset + 2, value >> 16);\n};\n\nGameBoyAdvancePalette.prototype.invalidatePage = function(address) {};\n\nGameBoyAdvancePalette.prototype.convert16To32 = function(value, input) {\n\tvar r = (value & 0x001F) << 3;\n\tvar g = (value & 0x03E0) >> 2;\n\tvar b = (value & 0x7C00) >> 7;\n\n\tinput[0] = r;\n\tinput[1] = g;\n\tinput[2] = b;\n};\n\nGameBoyAdvancePalette.prototype.mix = function(aWeight, aColor, bWeight, bColor) {\n\tvar ar = (aColor & 0x001F);\n\tvar ag = (aColor & 0x03E0) >> 5;\n\tvar ab = (aColor & 0x7C00) >> 10;\n\n\tvar br = (bColor & 0x001F);\n\tvar bg = (bColor & 0x03E0) >> 5;\n\tvar bb = (bColor & 0x7C00) >> 10;\n\n\tvar r = Math.min(aWeight * ar + bWeight * br, 0x1F);\n\tvar g = Math.min(aWeight * ag + bWeight * bg, 0x1F);\n\tvar b = Math.min(aWeight * ab + bWeight * bb, 0x1F);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.makeDarkPalettes = function(layers) {\n\tif (this.adjustColor != this.adjustColorDark) {\n\t\tthis.adjustColor = this.adjustColorDark;\n\t\tthis.resetPalettes();\n\t}\n\tthis.resetPaletteLayers(layers);\n};\n\nGameBoyAdvancePalette.prototype.makeBrightPalettes = function(layers) {\n\tif (this.adjustColor != this.adjustColorBright) {\n\t\tthis.adjustColor = this.adjustColorBright;\n\t\tthis.resetPalettes();\n\t}\n\tthis.resetPaletteLayers(layers);\n};\n\nGameBoyAdvancePalette.prototype.makeNormalPalettes = function() {\n\tthis.passthroughColors[0] = this.colors[0];\n\tthis.passthroughColors[1] = this.colors[0];\n\tthis.passthroughColors[2] = this.colors[0];\n\tthis.passthroughColors[3] = this.colors[0];\n\tthis.passthroughColors[4] = this.colors[1];\n\tthis.passthroughColors[5] = this.colors[0];\n};\n\nGameBoyAdvancePalette.prototype.makeSpecialPalette = function(layer) {\n\tthis.passthroughColors[layer] = this.adjustedColors[layer == 4 ? 1 : 0];\n};\n\nGameBoyAdvancePalette.prototype.makeNormalPalette = function(layer) {\n\tthis.passthroughColors[layer] = this.colors[layer == 4 ? 1 : 0];\n};\n\nGameBoyAdvancePalette.prototype.resetPaletteLayers = function(layers) {\n\tif (layers & 0x01) {\n\t\tthis.passthroughColors[0] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[0] = this.colors[0];\n\t}\n\tif (layers & 0x02) {\n\t\tthis.passthroughColors[1] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[1] = this.colors[0];\n\t}\n\tif (layers & 0x04) {\n\t\tthis.passthroughColors[2] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[2] = this.colors[0];\n\t}\n\tif (layers & 0x08) {\n\t\tthis.passthroughColors[3] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[3] = this.colors[0];\n\t}\n\tif (layers & 0x10) {\n\t\tthis.passthroughColors[4] = this.adjustedColors[1];\n\t} else {\n\t\tthis.passthroughColors[4] = this.colors[1];\n\t}\n\tif (layers & 0x20) {\n\t\tthis.passthroughColors[5] = this.adjustedColors[0];\n\t} else {\n\t\tthis.passthroughColors[5] = this.colors[0];\n\t}\n};\n\nGameBoyAdvancePalette.prototype.resetPalettes = function() {\n\tvar i;\n\tvar outPalette = this.adjustedColors[0];\n\tvar inPalette = this.colors[0];\n\tfor (i = 0; i < 256; ++i) {\n\t\toutPalette[i] = this.adjustColor(inPalette[i]);\n\t}\n\n\toutPalette = this.adjustedColors[1];\n\tinPalette = this.colors[1];\n\tfor (i = 0; i < 256; ++i) {\n\t\toutPalette[i] = this.adjustColor(inPalette[i]);\n\t}\n}\n\nGameBoyAdvancePalette.prototype.accessColor = function(layer, index) {\n\treturn this.passthroughColors[layer][index];\n};\n\nGameBoyAdvancePalette.prototype.adjustColorDark = function(color) {\n\tvar r = (color & 0x001F);\n\tvar g = (color & 0x03E0) >> 5;\n\tvar b = (color & 0x7C00) >> 10;\n\n\tr = r - (r * this.blendY);\n\tg = g - (g * this.blendY);\n\tb = b - (b * this.blendY);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.adjustColorBright = function(color) {\n\tvar r = (color & 0x001F);\n\tvar g = (color & 0x03E0) >> 5;\n\tvar b = (color & 0x7C00) >> 10;\n\n\tr = r + ((31 - r) * this.blendY);\n\tg = g + ((31 - g) * this.blendY);\n\tb = b + ((31 - b) * this.blendY);\n\n\treturn r | (g << 5) | (b << 10);\n};\n\nGameBoyAdvancePalette.prototype.adjustColor = GameBoyAdvancePalette.prototype.adjustColorBright;\n\nGameBoyAdvancePalette.prototype.setBlendY = function(y) {\n\tif (this.blendY != y) {\n\t\tthis.blendY = y;\n\t\tthis.resetPalettes();\n\t}\n};\n\nfunction GameBoyAdvanceOBJ(oam, index) {\n\tthis.TILE_OFFSET = 0x10000;\n\tthis.oam = oam;\n\n\tthis.index = index;\n\tthis.x = 0;\n\tthis.y = 0;\n\tthis.scalerot = 0;\n\tthis.doublesize = false;\n\tthis.disable = 1;\n\tthis.mode = 0;\n\tthis.mosaic = false;\n\tthis.multipalette = false;\n\tthis.shape = 0;\n\tthis.scalerotParam = 0;\n\tthis.hflip = 0;\n\tthis.vflip = 0;\n\tthis.tileBase = 0;\n\tthis.priority = 0;\n\tthis.palette = 0;\n\tthis.drawScanline = this.drawScanlineNormal;\n\tthis.pushPixel = GameBoyAdvanceSoftwareRenderer.pushPixel;\n\tthis.cachedWidth = 8;\n\tthis.cachedHeight = 8;\n};\n\nGameBoyAdvanceOBJ.prototype.drawScanlineNormal = function(backing, y, yOff, start, end) {\n\tvar video = this.oam.video;\n\tvar x;\n\tvar underflow;\n\tvar offset;\n\tvar mask = this.mode | video.target2[video.LAYER_OBJ] | (this.priority << 1);\n\tif (this.mode == 0x10) {\n\t\tmask |= video.TARGET1_MASK;\n\t}\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[video.LAYER_OBJ];\n\t}\n\n\tvar totalWidth = this.cachedWidth;\n\tif (this.x < video.HORIZONTAL_PIXELS) {\n\t\tif (this.x < start) {\n\t\t\tunderflow = start - this.x;\n\t\t\toffset = start;\n\t\t} else {\n\t\t\tunderflow = 0;\n\t\t\toffset = this.x;\n\t\t}\n\t\tif (end < this.cachedWidth + this.x) {\n\t\t\ttotalWidth = end - this.x;\n\t\t}\n\t} else {\n\t\tunderflow = start + 512 - this.x;\n\t\toffset = start;\n\t\tif (end < this.cachedWidth - underflow) {\n\t\t\ttotalWidth = end;\n\t\t}\n\t}\n\t\n\tvar localX;\n\tvar localY;\n\tif (!this.vflip) {\n\t\tlocalY = y - yOff;\n\t} else {\n\t\tlocalY = this.cachedHeight - y + yOff - 1;\n\t}\n\tvar localYLo = localY & 0x7;\n\tvar mosaicX;\n\tvar tileOffset;\n\n\tvar paletteShift = this.multipalette ? 1 : 0;\n\n\tif (video.objCharacterMapping) {\n\t\ttileOffset = ((localY & 0x01F8) * this.cachedWidth) >> 6;\n\t} else {\n\t\ttileOffset = (localY & 0x01F8) << (2 - paletteShift);\n\t}\n\n\tif (this.mosaic) {\n\t\tmosaicX = video.objMosaicX - 1 - (video.objMosaicX + offset - 1) % video.objMosaicX;\n\t\toffset += mosaicX;\n\t\tunderflow += mosaicX;\n\t}\n\tif (!this.hflip) {\n\t\tlocalX = underflow;\n\t} else {\n\t\tlocalX = this.cachedWidth - underflow - 1;\n\t}\n\n\tvar tileRow = video.accessTile(this.TILE_OFFSET + (x & 0x4) * paletteShift, this.tileBase + (tileOffset << paletteShift) + ((localX & 0x01F8) >> (3 - paletteShift)), localYLo << paletteShift);\n\tfor (x = underflow; x < totalWidth; ++x) {\n\t\tmosaicX = this.mosaic ? offset % video.objMosaicX : 0;\n\t\tif (!this.hflip) {\n\t\t\tlocalX = x - mosaicX;\n\t\t} else {\n\t\t\tlocalX = this.cachedWidth - (x - mosaicX) - 1;\n\t\t}\n\t\tif (!paletteShift) {\n\t\t\tif (!(x & 0x7) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(this.TILE_OFFSET, this.tileBase + tileOffset + (localX >> 3), localYLo);\n\t\t\t}\n\t\t} else {\n\t\t\tif (!(x & 0x3) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(this.TILE_OFFSET + (localX & 0x4), this.tileBase + (tileOffset << 1) + ((localX & 0x01F8) >> 2), localYLo << 1);\n\t\t\t}\n\t\t}\n\t\tthis.pushPixel(video.LAYER_OBJ, this, video, tileRow, localX & 0x7, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceOBJ.prototype.drawScanlineAffine = function(backing, y, yOff, start, end) {\n\tvar video = this.oam.video;\n\tvar x;\n\tvar underflow;\n\tvar offset;\n\tvar mask = this.mode | video.target2[video.LAYER_OBJ] | (this.priority << 1);\n\tif (this.mode == 0x10) {\n\t\tmask |= video.TARGET1_MASK;\n\t}\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[video.LAYER_OBJ];\n\t}\n\n\tvar localX;\n\tvar localY;\n\tvar yDiff = y - yOff;\n\tvar tileOffset;\n\n\tvar paletteShift = this.multipalette ? 1 : 0;\n\tvar totalWidth = this.cachedWidth << this.doublesize;\n\tvar totalHeight = this.cachedHeight << this.doublesize;\n\tvar drawWidth = totalWidth;\n\tif (drawWidth > video.HORIZONTAL_PIXELS) {\n\t\ttotalWidth = video.HORIZONTAL_PIXELS;\n\t}\n\n\tif (this.x < video.HORIZONTAL_PIXELS) {\n\t\tif (this.x < start) {\n\t\t\tunderflow = start - this.x;\n\t\t\toffset = start;\n\t\t} else {\n\t\t\tunderflow = 0;\n\t\t\toffset = this.x;\n\t\t}\n\t\tif (end < drawWidth + this.x) {\n\t\t\tdrawWidth = end - this.x;\n\t\t}\n\t} else {\n\t\tunderflow = start + 512 - this.x;\n\t\toffset = start;\n\t\tif (end < drawWidth - underflow) {\n\t\t\tdrawWidth = end;\n\t\t}\n\t}\n\n\tfor (x = underflow; x < drawWidth; ++x) {\n\t\tlocalX = this.scalerotOam.a * (x - (totalWidth >> 1)) + this.scalerotOam.b * (yDiff - (totalHeight >> 1)) + (this.cachedWidth >> 1);\n\t\tlocalY = this.scalerotOam.c * (x - (totalWidth >> 1)) + this.scalerotOam.d * (yDiff - (totalHeight >> 1)) + (this.cachedHeight >> 1);\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.objMosaicX) * this.scalerotOam.a + (y % video.objMosaicY) * this.scalerotOam.b;\n\t\t\tlocalY -= (x % video.objMosaicX) * this.scalerotOam.c + (y % video.objMosaicY) * this.scalerotOam.d;\n\t\t}\n\n\t\tif (localX < 0 || localX >= this.cachedWidth || localY < 0 || localY >= this.cachedHeight) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\n\t\tif (video.objCharacterMapping) {\n\t\t\ttileOffset = ((localY & 0x01F8) * this.cachedWidth) >> 6;\n\t\t} else {\n\t\t\ttileOffset = (localY & 0x01F8) << (2 - paletteShift);\n\t\t}\n\t\tvar tileRow = video.accessTile(this.TILE_OFFSET + (localX & 0x4) * paletteShift, this.tileBase + (tileOffset << paletteShift) + ((localX & 0x01F8) >> (3 - paletteShift)), (localY & 0x7) << paletteShift);\n\t\tthis.pushPixel(video.LAYER_OBJ, this, video, tileRow, localX & 0x7, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceOBJ.prototype.recalcSize = function() {\n\tswitch (this.shape) {\n\tcase 0:\n\t\t// Square\n\t\tthis.cachedHeight = this.cachedWidth = 8 << this.size;\n\t\tbreak;\n\tcase 1:\n\t\t// Horizontal\n\t\tswitch (this.size) {\n\t\tcase 0:\n\t\t\tthis.cachedHeight = 8;\n\t\t\tthis.cachedWidth = 16;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tthis.cachedHeight = 8;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tthis.cachedHeight = 16;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 64;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tcase 2:\n\t\t// Vertical\n\t\tswitch (this.size) {\n\t\tcase 0:\n\t\t\tthis.cachedHeight = 16;\n\t\t\tthis.cachedWidth = 8;\n\t\t\tbreak;\n\t\tcase 1:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 8;\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\tthis.cachedHeight = 32;\n\t\t\tthis.cachedWidth = 16;\n\t\t\tbreak;\n\t\tcase 3:\n\t\t\tthis.cachedHeight = 64;\n\t\t\tthis.cachedWidth = 32;\n\t\t\tbreak;\n\t\t}\n\t\tbreak;\n\tdefault:\n\t\t// Bad!\n\t}\n};\n\nfunction GameBoyAdvanceOBJLayer(video, index) {\n\tthis.video = video;\n\tthis.bg = false;\n\tthis.index = video.LAYER_OBJ;\n\tthis.priority = index;\n\tthis.enabled = false;\n\tthis.objwin = 0;\n};\n\nGameBoyAdvanceOBJLayer.prototype.drawScanline = function(backing, layer, start, end) {\n\tvar y = this.video.vcount;\n\tvar wrappedY;\n\tvar mosaicY;\n\tvar obj;\n\tif (start >= end) {\n\t\treturn;\n\t}\n\tvar objs = this.video.oam.objs;\n\tfor (var i = 0; i < objs.length; ++i) {\n\t\tobj = objs[i];\n\t\tif (obj.disable) {\n\t\t\tcontinue;\n\t\t}\n\t\tif ((obj.mode & this.video.OBJWIN_MASK) != this.objwin) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (!(obj.mode & this.video.OBJWIN_MASK) && this.priority != obj.priority) {\n\t\t\tcontinue;\n\t\t}\n\t\tif (obj.y < this.video.VERTICAL_PIXELS) {\n\t\t\twrappedY = obj.y;\n\t\t} else {\n\t\t\twrappedY = obj.y - 256;\n\t\t}\n\t\tvar totalHeight;\n\t\tif (!obj.scalerot) {\n\t\t\ttotalHeight = obj.cachedHeight;\n\t\t} else {\n\t\t\ttotalHeight = obj.cachedHeight << obj.doublesize;\n\t\t}\n\t\tif (!obj.mosaic) {\n\t\t\tmosaicY = y;\n\t\t} else {\n\t\t\tmosaicY = y - y % this.video.objMosaicY;\n\t\t}\n\t\tif (wrappedY <= y && (wrappedY + totalHeight) > y) {\n\t\t\tobj.drawScanline(backing, mosaicY, wrappedY, start, end);\n\t\t}\n\t}\n};\n\nGameBoyAdvanceOBJLayer.prototype.objComparator = function(a, b) {\n\treturn a.index - b.index;\n};\n\nfunction GameBoyAdvanceSoftwareRenderer() {\n\tthis.LAYER_BG0 = 0;\n\tthis.LAYER_BG1 = 1;\n\tthis.LAYER_BG2 = 2;\n\tthis.LAYER_BG3 = 3;\n\tthis.LAYER_OBJ = 4;\n\tthis.LAYER_BACKDROP = 5;\n\n\tthis.HORIZONTAL_PIXELS = 240;\n\tthis.VERTICAL_PIXELS = 160;\n\n\tthis.LAYER_MASK = 0x06;\n\tthis.BACKGROUND_MASK = 0x01;\n\tthis.TARGET2_MASK = 0x08;\n\tthis.TARGET1_MASK = 0x10;\n\tthis.OBJWIN_MASK = 0x20;\n\tthis.WRITTEN_MASK = 0x80;\n\n\tthis.PRIORITY_MASK = this.LAYER_MASK | this.BACKGROUND_MASK;\n\n\tthis.drawBackdrop = new (function(video) {\n\t\tthis.bg = true;\n\t\tthis.priority = -1;\n\t\tthis.index = video.LAYER_BACKDROP;\n\t\tthis.enabled = true;\n\n\t\tthis.drawScanline = function(backing, layer, start, end) {\n\t\t\t// TODO: interactions with blend modes and OBJWIN\n\t\t\tfor (var x = start; x < end; ++x) {\n\t\t\t\tif (!(backing.stencil[x] & video.WRITTEN_MASK)) {\n\t\t\t\t\tbacking.color[x] = video.palette.accessColor(this.index, 0);\n\t\t\t\t\tbacking.stencil[x] = video.WRITTEN_MASK;\n\t\t\t\t} else if (backing.stencil[x] & video.TARGET1_MASK) {\n\t\t\t\t\tbacking.color[x] = video.palette.mix(video.blendB, video.palette.accessColor(this.index, 0), video.blendA, backing.color[x]);\n\t\t\t\t\tbacking.stencil[x] = video.WRITTEN_MASK;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t})(this);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.clear = function(mmu) {\n\tthis.palette = new GameBoyAdvancePalette();\n\tthis.vram = new GameBoyAdvanceVRAM(mmu.SIZE_VRAM);\n\tthis.oam = new GameBoyAdvanceOAM(mmu.SIZE_OAM);\n\tthis.oam.video = this;\n\tthis.objLayers = [\n\t\tnew GameBoyAdvanceOBJLayer(this, 0),\n\t\tnew GameBoyAdvanceOBJLayer(this, 1),\n\t\tnew GameBoyAdvanceOBJLayer(this, 2),\n\t\tnew GameBoyAdvanceOBJLayer(this, 3)\n\t];\n\tthis.objwinLayer = new GameBoyAdvanceOBJLayer(this, 4);\n\tthis.objwinLayer.objwin = this.OBJWIN_MASK;\n\n\t// DISPCNT\n\tthis.backgroundMode = 0;\n\tthis.displayFrameSelect = 0;\n\tthis.hblankIntervalFree = 0;\n\tthis.objCharacterMapping = 0;\n\tthis.forcedBlank = 1;\n\tthis.win0 = 0;\n\tthis.win1 = 0;\n\tthis.objwin = 0;\n\n\t// VCOUNT\n\tthis.vcount = -1;\n\n\t// WIN0H\n\tthis.win0Left = 0;\n\tthis.win0Right = 240;\n\n\t// WIN1H\n\tthis.win1Left = 0;\n\tthis.win1Right = 240;\n\n\t// WIN0V\n\tthis.win0Top = 0;\n\tthis.win0Bottom = 160;\n\n\t// WIN1V\n\tthis.win1Top = 0;\n\tthis.win1Bottom = 160;\n\n\t// WININ/WINOUT\n\tthis.windows = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.windows.push({\n\t\t\tenabled: [ false, false, false, false, false, true ],\n\t\t\tspecial: 0\n\t\t});\n\t};\n\n\t// BLDCNT\n\tthis.target1 = new Array(5);\n\tthis.target2 = new Array(5);\n\tthis.blendMode = 0;\n\n\t// BLDALPHA\n\tthis.blendA = 0;\n\tthis.blendB = 0;\n\n\t// BLDY\n\tthis.blendY = 0;\n\n\t// MOSAIC\n\tthis.bgMosaicX = 1;\n\tthis.bgMosaicY = 1;\n\tthis.objMosaicX = 1;\n\tthis.objMosaicY = 1;\n\n\tthis.lastHblank = 0;\n\tthis.nextHblank = this.HDRAW_LENGTH;\n\tthis.nextEvent = this.nextHblank;\n\n\tthis.nextHblankIRQ = 0;\n\tthis.nextVblankIRQ = 0;\n\tthis.nextVcounterIRQ = 0;\n\n\tthis.bg = new Array();\n\tfor (var i = 0; i < 4; ++i) {\n\t\tthis.bg.push({\n\t\t\tbg: true,\n\t\t\tindex: i,\n\t\t\tenabled: false,\n\t\t\tvideo: this,\n\t\t\tvram: this.vram,\n\t\t\tpriority: 0,\n\t\t\tcharBase: 0,\n\t\t\tmosaic: false,\n\t\t\tmultipalette: false,\n\t\t\tscreenBase: 0,\n\t\t\toverflow: 0,\n\t\t\tsize: 0,\n\t\t\tx: 0,\n\t\t\ty: 0,\n\t\t\trefx: 0,\n\t\t\trefy: 0,\n\t\t\tdx: 1,\n\t\t\tdmx: 0,\n\t\t\tdy: 0,\n\t\t\tdmy: 1,\n\t\t\tsx: 0,\n\t\t\tsy: 0,\n\t\t\tpushPixel: GameBoyAdvanceSoftwareRenderer.pushPixel,\n\t\t\tdrawScanline: this.drawScanlineBGMode0\n\t\t});\n\t}\n\n\tthis.bgModes = [\n\t\tthis.drawScanlineBGMode0,\n\t\tthis.drawScanlineBGMode2, // Modes 1 and 2 are identical for layers 2 and 3\n\t\tthis.drawScanlineBGMode2,\n\t\tthis.drawScanlineBGMode3,\n\t\tthis.drawScanlineBGMode4,\n\t\tthis.drawScanlineBGMode5\n\t];\n\n\tthis.drawLayers = [\n\t\tthis.bg[0],\n\t\tthis.bg[1],\n\t\tthis.bg[2],\n\t\tthis.bg[3],\n\t\tthis.objLayers[0],\n\t\tthis.objLayers[1],\n\t\tthis.objLayers[2],\n\t\tthis.objLayers[3],\n\t\tthis.objwinLayer,\n\t\tthis.drawBackdrop\n\t];\n\n\tthis.objwinActive = false;\n\tthis.alphaEnabled = false;\n\n\tthis.scanline = {\n\t\tcolor: new Uint16Array(this.HORIZONTAL_PIXELS),\n\t\t// Stencil format:\n\t\t// Bits 0-1: Layer\n\t\t// Bit 2: Is background\n\t\t// Bit 3: Is Target 2\n\t\t// Bit 4: Is Target 1\n\t\t// Bit 5: Is OBJ Window\n\t\t// Bit 6: Reserved\n\t\t// Bit 7: Has been written\n\t\tstencil: new Uint8Array(this.HORIZONTAL_PIXELS)\n\t};\n\tthis.sharedColor = [ 0, 0, 0 ];\n\tthis.sharedMap = {\n\t\ttile: 0,\n\t\thflip: false,\n\t\tvflip: false,\n\t\tpalette: 0\n\t};\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.clearSubsets = function(mmu, regions) {\n\tif (regions & 0x04) {\n\t\tthis.palette.overwrite(new Uint16Array(mmu.SIZE_PALETTE >> 1));\n\t}\n\n\tif (regions & 0x08) {\n\t\tthis.vram.insert(0, new Uint16Array(mmu.SIZE_VRAM >> 1));\n\t}\n\n\tif (regions & 0x10) {\n\t\tthis.oam.overwrite(new Uint16Array(mmu.SIZE_OAM >> 1));\n\t\tthis.oam.video = this;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.freeze = function() {\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.defrost = function(frost) {\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.setBacking = function(backing) {\n\tthis.pixelData = backing;\n\n\t// Clear backing first\n\tfor (var offset = 0; offset < this.HORIZONTAL_PIXELS * this.VERTICAL_PIXELS * 4;) {\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t\tthis.pixelData.data[offset++] = 0xFF;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeDisplayControl = function(value) {\n\tthis.backgroundMode = value & 0x0007;\n\tthis.displayFrameSelect = value & 0x0010;\n\tthis.hblankIntervalFree = value & 0x0020;\n\tthis.objCharacterMapping = value & 0x0040;\n\tthis.forcedBlank = value & 0x0080;\n\tthis.bg[0].enabled = value & 0x0100;\n\tthis.bg[1].enabled = value & 0x0200;\n\tthis.bg[2].enabled = value & 0x0400;\n\tthis.bg[3].enabled = value & 0x0800;\n\tthis.objLayers[0].enabled = value & 0x1000;\n\tthis.objLayers[1].enabled = value & 0x1000;\n\tthis.objLayers[2].enabled = value & 0x1000;\n\tthis.objLayers[3].enabled = value & 0x1000;\n\tthis.win0 = value & 0x2000;\n\tthis.win1 = value & 0x4000;\n\tthis.objwin = value & 0x8000;\n\tthis.objwinLayer.enabled = value & 0x1000 && value & 0x8000;\n\n\t// Total hack so we can store both things that would set it to 256-color mode in the same variable\n\tthis.bg[2].multipalette &= ~0x0001;\n\tthis.bg[3].multipalette &= ~0x0001;\n\tif (this.backgroundMode > 0) {\n\t\tthis.bg[2].multipalette |= 0x0001;\n\t}\n\tif (this.backgroundMode == 2) {\n\t\tthis.bg[3].multipalette |= 0x0001;\n\t}\n\t\n\tthis.resetLayers();\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundControl = function(bg, value) {\n\tvar bgData = this.bg[bg];\n\tbgData.priority = value & 0x0003;\n\tbgData.charBase = (value & 0x000C) << 12;\n\tbgData.mosaic = value & 0x0040;\n\tbgData.multipalette &= ~0x0080;\n\tif (bg < 2 || this.backgroundMode == 0) {\n\t\tbgData.multipalette |= value & 0x0080;\n\t}\n\tbgData.screenBase = (value & 0x1F00) << 3;\n\tbgData.overflow = value & 0x2000;\n\tbgData.size = (value & 0xC000) >> 14;\n\n\tthis.drawLayers.sort(this.layerComparator);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundHOffset = function(bg, value) {\n\tthis.bg[bg].x = value & 0x1FF;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundVOffset = function(bg, value) {\n\tthis.bg[bg].y = value & 0x1FF;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundRefX = function(bg, value) {\n\tthis.bg[bg].refx = (value << 4) / 0x1000;\n\tthis.bg[bg].sx = this.bg[bg].refx;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundRefY = function(bg, value) {\n\tthis.bg[bg].refy = (value << 4) / 0x1000;\n\tthis.bg[bg].sy = this.bg[bg].refy;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamA = function(bg, value) {\n\tthis.bg[bg].dx = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamB = function(bg, value) {\n\tthis.bg[bg].dmx = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamC = function(bg, value) {\n\tthis.bg[bg].dy = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBackgroundParamD = function(bg, value) {\n\tthis.bg[bg].dmy = (value << 16) / 0x1000000;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin0H = function(value) {\n\tthis.win0Left = (value & 0xFF00) >> 8;\n\tthis.win0Right = Math.min(this.HORIZONTAL_PIXELS, value & 0x00FF);\n\tif (this.win0Left > this.win0Right) {\n\t\tthis.win0Right = this.HORIZONTAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin1H = function(value) {\n\tthis.win1Left = (value & 0xFF00) >> 8;\n\tthis.win1Right = Math.min(this.HORIZONTAL_PIXELS, value & 0x00FF);\n\tif (this.win1Left > this.win1Right) {\n\t\tthis.win1Right = this.HORIZONTAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin0V = function(value) {\n\tthis.win0Top = (value & 0xFF00) >> 8;\n\tthis.win0Bottom = Math.min(this.VERTICAL_PIXELS, value & 0x00FF);\n\tif (this.win0Top > this.win0Bottom) {\n\t\tthis.win0Bottom = this.VERTICAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWin1V = function(value) {\n\tthis.win1Top = (value & 0xFF00) >> 8;\n\tthis.win1Bottom = Math.min(this.VERTICAL_PIXELS, value & 0x00FF);\n\tif (this.win1Top > this.win1Bottom) {\n\t\tthis.win1Bottom = this.VERTICAL_PIXELS;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWindow = function(index, value) {\n\tvar window = this.windows[index];\n\twindow.enabled[0] = value & 0x01;\n\twindow.enabled[1] = value & 0x02;\n\twindow.enabled[2] = value & 0x04;\n\twindow.enabled[3] = value & 0x08;\n\twindow.enabled[4] = value & 0x10;\n\twindow.special = value & 0x20;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWinIn = function(value) {\n\tthis.writeWindow(0, value);\n\tthis.writeWindow(1, value >> 8);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeWinOut = function(value) {\n\tthis.writeWindow(2, value);\n\tthis.writeWindow(3, value >> 8);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendControl = function(value) {\n\tthis.target1[0] = !!(value & 0x0001) * this.TARGET1_MASK;\n\tthis.target1[1] = !!(value & 0x0002) * this.TARGET1_MASK;\n\tthis.target1[2] = !!(value & 0x0004) * this.TARGET1_MASK;\n\tthis.target1[3] = !!(value & 0x0008) * this.TARGET1_MASK;\n\tthis.target1[4] = !!(value & 0x0010) * this.TARGET1_MASK;\n\tthis.target1[5] = !!(value & 0x0020) * this.TARGET1_MASK;\n\tthis.target2[0] = !!(value & 0x0100) * this.TARGET2_MASK;\n\tthis.target2[1] = !!(value & 0x0200) * this.TARGET2_MASK;\n\tthis.target2[2] = !!(value & 0x0400) * this.TARGET2_MASK;\n\tthis.target2[3] = !!(value & 0x0800) * this.TARGET2_MASK;\n\tthis.target2[4] = !!(value & 0x1000) * this.TARGET2_MASK;\n\tthis.target2[5] = !!(value & 0x2000) * this.TARGET2_MASK;\n\tthis.blendMode = (value & 0x00C0) >> 6;\n\n\tswitch (this.blendMode) {\n\tcase 1:\n\t\t// Alpha\n\t\t// Fall through\n\tcase 0:\n\t\t// Normal\n\t\tthis.palette.makeNormalPalettes();\n\t\tbreak;\n\tcase 2:\n\t\t// Brighter\n\t\tthis.palette.makeBrightPalettes(value & 0x3F);\n\t\tbreak;\n\tcase 3:\n\t\t// Darker\n\t\tthis.palette.makeDarkPalettes(value & 0x3F);\n\t\tbreak;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.setBlendEnabled = function(layer, enabled, override) {\n\tthis.alphaEnabled = enabled && override == 1;\n\tif (enabled) {\n\t\tswitch (override) {\n\t\tcase 1:\n\t\t\t// Alpha\n\t\t\t// Fall through\n\t\tcase 0:\n\t\t\t// Normal\n\t\t\tthis.palette.makeNormalPalette(layer);\n\t\t\tbreak;\n\t\tcase 2:\n\t\t\t// Brighter\n\t\tcase 3:\n\t\t\t// Darker\n\t\t\tthis.palette.makeSpecialPalette(layer);\n\t\t\tbreak;\n\t\t}\n\t} else {\n\t\tthis.palette.makeNormalPalette(layer);\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendAlpha = function(value) {\n\tthis.blendA = (value & 0x001F) / 16;\n\tif (this.blendA > 1) {\n\t\tthis.blendA = 1;\n\t}\n\tthis.blendB = ((value & 0x1F00) >> 8) / 16;\n\tif (this.blendB > 1) {\n\t\tthis.blendB = 1;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeBlendY = function(value) {\n\tthis.blendY = value;\n\tthis.palette.setBlendY(value >= 16 ? 1 : (value / 16));\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.writeMosaic = function(value) {\n\tthis.bgMosaicX = (value & 0xF) + 1;\n\tthis.bgMosaicY = ((value >> 4) & 0xF) + 1;\n\tthis.objMosaicX = ((value >> 8) & 0xF) + 1;\n\tthis.objMosaicY = ((value >> 12) & 0xF) + 1;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.resetLayers = function() {\n\tif (this.backgroundMode > 1) {\n\t\tthis.bg[0].enabled = false;\n\t\tthis.bg[1].enabled = false;\n\t}\n\tif (this.bg[2].enabled) {\n\t\tthis.bg[2].drawScanline = this.bgModes[this.backgroundMode];\n\t}\n\tif ((this.backgroundMode == 0 || this.backgroundMode == 2)) {\n\t\tif (this.bg[3].enabled) {\n\t\t\tthis.bg[3].drawScanline = this.bgModes[this.backgroundMode];\n\t\t}\n\t} else {\n\t\tthis.bg[3].enabled = false;\n\t}\n\tthis.drawLayers.sort(this.layerComparator);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.layerComparator = function(a, b) {\n\tvar diff = b.priority - a.priority;\n\tif (!diff) {\n\t\tif (a.bg && !b.bg) {\n\t\t\treturn -1;\n\t\t} else if (!a.bg && b.bg) {\n\t\t\treturn 1;\n\t\t}\n\n\t\treturn b.index - a.index;\n\t}\n\treturn diff;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessMapMode0 = function(base, size, x, yBase, out) {\n\tvar offset = base + ((x >> 2) & 0x3E) + yBase;\n\n\tif (size & 1) {\n\t\toffset += (x & 0x100) << 3;\n\t}\n\n\tvar mem = this.vram.loadU16(offset);\n\tout.tile = mem & 0x03FF;\n\tout.hflip = mem & 0x0400;\n\tout.vflip = mem & 0x0800;\n\tout.palette = (mem & 0xF000) >> 8 // This is shifted up 4 to make pushPixel faster\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessMapMode1 = function(base, size, x, yBase, out) {\n\tvar offset = base + (x >> 3) + yBase;\n\n\tout.tile = this.vram.loadU8(offset);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.accessTile = function(base, tile, y) {\n\tvar offset = base + (tile << 5);\n\toffset |= y << 2;\n\n\treturn this.vram.load32(offset);\n}\n\nGameBoyAdvanceSoftwareRenderer.pushPixel = function(layer, map, video, row, x, offset, backing, mask, raw) {\n\tvar index;\n\tif (!raw) {\n\t\tif (this.multipalette) {\n\t\t\tindex = (row >> (x << 3)) & 0xFF;\n\t\t} else {\n\t\t\tindex = (row >> (x << 2)) & 0xF;\n\t\t}\n\t\t// Index 0 is transparent\n\t\tif (!index) {\n\t\t\treturn;\n\t\t} else if (!this.multipalette) {\n\t\t\tindex |= map.palette;\n\t\t}\n\t}\n\n\tvar stencil = video.WRITTEN_MASK;\n\tvar oldStencil = backing.stencil[offset];\n\tvar blend = video.blendMode;\n\tif (video.objwinActive) {\n\t\tif (oldStencil & video.OBJWIN_MASK) {\n\t\t\tif (video.windows[3].enabled[layer]) {\n\t\t\t\tvideo.setBlendEnabled(layer, video.windows[3].special && video.target1[layer], blend);\n\t\t\t\tif (video.windows[3].special && video.alphaEnabled) {\n\t\t\t\t\tmask |= video.target1[layer];\n\t\t\t\t}\n\t\t\t\tstencil |= video.OBJWIN_MASK;\n\t\t\t} else {\n\t\t\t\treturn;\n\t\t\t}\n\t\t} else if (video.windows[2].enabled[layer]) {\n\t\t\tvideo.setBlendEnabled(layer, video.windows[2].special && video.target1[layer], blend);\n\t\t\tif (video.windows[2].special && video.alphaEnabled) {\n\t\t\t\tmask |= video.target1[layer];\n\t\t\t}\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t}\n\n\tif ((mask & video.TARGET1_MASK) && (oldStencil & video.TARGET2_MASK)) {\n\t\tvideo.setBlendEnabled(layer, true, 1);\n\t}\n\n\tvar pixel = raw ? row : video.palette.accessColor(layer, index);\n\n\tif (mask & video.TARGET1_MASK) {\n\t\tvideo.setBlendEnabled(layer, !!blend, blend);\n\t}\n\tvar highPriority = (mask & video.PRIORITY_MASK) < (oldStencil & video.PRIORITY_MASK);\n\t// Backgrounds can draw over each other, too.\n\tif ((mask & video.PRIORITY_MASK) == (oldStencil & video.PRIORITY_MASK)) {\n\t\thighPriority = mask & video.BACKGROUND_MASK;\n\t}\n\n\tif (!(oldStencil & video.WRITTEN_MASK)) {\n\t\t// Nothing here yet, just continue\n\t\tstencil |= mask;\n\t} else if (highPriority) {\n\t\t// We are higher priority\n\t\tif (mask & video.TARGET1_MASK && oldStencil & video.TARGET2_MASK) {\n\t\t\tpixel = video.palette.mix(video.blendA, pixel, video.blendB, backing.color[offset]);\n\t\t}\n\t\t// We just drew over something, so it doesn't make sense for us to be a TARGET1 anymore...\n\t\tstencil |= mask & ~video.TARGET1_MASK;\n\t} else if ((mask & video.PRIORITY_MASK) > (oldStencil & video.PRIORITY_MASK)) {\n\t\t// We're below another layer, but might be the blend target for it\n\t\tstencil = oldStencil & ~(video.TARGET1_MASK | video.TARGET2_MASK);\n\t\tif (mask & video.TARGET2_MASK && oldStencil & video.TARGET1_MASK) {\n\t\t\tpixel = video.palette.mix(video.blendB, pixel, video.blendA, backing.color[offset]);\n\t\t} else {\n\t\t\treturn;\n\t\t}\n\t} else {\n\t\treturn;\n\t}\n\n\tif (mask & video.OBJWIN_MASK) {\n\t\t// We ARE the object window, don't draw pixels!\n\t\tbacking.stencil[offset] |= video.OBJWIN_MASK;\n\t\treturn;\n\t}\n\tbacking.color[offset] = pixel;\n\tbacking.stencil[offset] = stencil;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.identity = function(x) {\n\treturn x;\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBlank = function(backing) {\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tbacking.color[x] = 0xFFFF;\n\t\tbacking.stencil[x] = 0;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.prepareScanline = function(backing) {\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tbacking.stencil[x] = this.target2[this.LAYER_BACKDROP];\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode0 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar xOff = bg.x;\n\tvar yOff = bg.y;\n\tvar localX;\n\tvar localXLo;\n\tvar localY = y + yOff;\n\tif (this.mosaic) {\n\t\tlocalY -= y % video.bgMosaicY;\n\t}\n\tvar localYLo = localY & 0x7;\n\tvar mosaicX;\n\tvar screenBase = bg.screenBase;\n\tvar charBase = bg.charBase;\n\tvar size = bg.size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar paletteShift = bg.multipalette ? 1 : 0;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase = (localY << 3) & 0x7C0;\n\tif (size == 2) {\n\t\tyBase += (localY << 3) & 0x800;\n\t} else if (size == 3) {\n\t\tyBase += (localY << 4) & 0x1000;\n\t}\n\n\tvar xMask;\n\tif (size & 1) {\n\t\txMask = 0x1FF;\n\t} else {\n\t\txMask = 0xFF;\n\t}\n\n\tvideo.accessMapMode0(screenBase, size, (start + xOff) & xMask, yBase, map);\n\tvar tileRow = video.accessTile(charBase, map.tile << paletteShift, (!map.vflip ? localYLo : 7 - localYLo) << paletteShift);\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = (x + xOff) & xMask;\n\t\tmosaicX = this.mosaic ? offset % video.bgMosaicX : 0;\n\t\tlocalX -= mosaicX;\n\t\tlocalXLo = localX & 0x7;\n\t\tif (!paletteShift) {\n\t\t\tif (!localXLo || (this.mosaic && !mosaicX)) {\n\t\t\t\tvideo.accessMapMode0(screenBase, size, localX, yBase, map);\n\t\t\t\ttileRow = video.accessTile(charBase, map.tile, !map.vflip ? localYLo : 7 - localYLo);\n\t\t\t\tif (!tileRow && !localXLo) {\n\t\t\t\t\tx += 7;\n\t\t\t\t\toffset += 8;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\tif (!localXLo || (this.mosaic && !mosaicX)) {\n\t\t\t\tvideo.accessMapMode0(screenBase, size, localX, yBase, map);\n\t\t\t}\n\t\t\tif (!(localXLo & 0x3) || (this.mosaic && !mosaicX)) {\n\t\t\t\ttileRow = video.accessTile(charBase + (!!(localX & 0x4) == !map.hflip ? 4 : 0), map.tile << 1, (!map.vflip ? localYLo : 7 - localYLo) << 1);\n\t\t\t\tif (!tileRow && !(localXLo & 0x3)) {\n\t\t\t\t\tx += 3;\n\t\t\t\t\toffset += 4;\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tif (map.hflip) {\n\t\t\tlocalXLo = 7 - localXLo;\n\t\t}\n\t\tbg.pushPixel(index, map, video, tileRow, localXLo, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode2 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar screenBase = bg.screenBase;\n\tvar charBase = bg.charBase;\n\tvar size = bg.size;\n\tvar sizeAdjusted = 128 << size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (bg.overflow) {\n\t\t\tlocalX &= sizeAdjusted - 1;\n\t\t\tif (localX < 0) {\n\t\t\t\tlocalX += sizeAdjusted;\n\t\t\t}\n\t\t\tlocalY &= sizeAdjusted - 1;\n\t\t\tif (localY < 0) {\n\t\t\t\tlocalY += sizeAdjusted;\n\t\t\t}\n\t\t} else if (localX < 0 || localY < 0 || localX >= sizeAdjusted || localY >= sizeAdjusted) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tyBase = ((localY << 1) & 0x7F0) << size;\n\t\tvideo.accessMapMode1(screenBase, size, localX, yBase, map);\n\t\tcolor = this.vram.loadU8(charBase + (map.tile << 6) + ((localY & 0x7) << 3) + (localX & 0x7));\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode3 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (localX < 0 || localY < 0 || localX >= video.HORIZONTAL_PIXELS || localY >= video.VERTICAL_PIXELS) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU16(((localY * video.HORIZONTAL_PIXELS) + localX) << 1);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, true);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode4 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar charBase = 0;\n\tif (video.displayFrameSelect) {\n\t\tcharBase += 0xA000;\n\t}\n\tvar size = bg.size;\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = 0 | bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tyBase = (localY << 2) & 0x7E0;\n\t\tif (localX < 0 || localY < 0 || localX >= video.HORIZONTAL_PIXELS || localY >= video.VERTICAL_PIXELS) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU8(charBase + (localY * video.HORIZONTAL_PIXELS) + localX);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, false);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanlineBGMode5 = function(backing, bg, start, end) {\n\tvar video = this.video;\n\tvar x;\n\tvar y = video.vcount;\n\tvar offset = start;\n\tvar localX;\n\tvar localY;\n\tvar charBase = 0;\n\tif (video.displayFrameSelect) {\n\t\tcharBase += 0xA000;\n\t}\n\tvar index = bg.index;\n\tvar map = video.sharedMap;\n\tvar color;\n\tvar mask = video.target2[index] | (bg.priority << 1) | video.BACKGROUND_MASK;\n\tif (video.blendMode == 1 && video.alphaEnabled) {\n\t\tmask |= video.target1[index];\n\t}\n\n\tvar yBase;\n\n\tfor (x = start; x < end; ++x) {\n\t\tlocalX = bg.dx * x + bg.sx;\n\t\tlocalY = bg.dy * x + bg.sy;\n\t\tif (this.mosaic) {\n\t\t\tlocalX -= (x % video.bgMosaicX) * bg.dx + (y % video.bgMosaicY) * bg.dmx;\n\t\t\tlocalY -= (x % video.bgMosaicX) * bg.dy + (y % video.bgMosaicY) * bg.dmy;\n\t\t}\n\t\tif (localX < 0 || localY < 0 || localX >= 160 || localY >= 128) {\n\t\t\toffset++;\n\t\t\tcontinue;\n\t\t}\n\t\tcolor = this.vram.loadU16(charBase + ((localY * 160) + localX) << 1);\n\t\tbg.pushPixel(index, map, video, color, 0, offset, backing, mask, true);\n\t\toffset++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.drawScanline = function(y) {\n\tvar backing = this.scanline;\n\tif (this.forcedBlank) {\n\t\tthis.drawScanlineBlank(backing);\n\t\treturn;\n\t}\n\tthis.prepareScanline(backing);\n\tvar layer;\n\tvar firstStart;\n\tvar firstEnd;\n\tvar lastStart;\n\tvar lastEnd;\n\tthis.vcount = y;\n\t// Draw lower priority first and then draw over them\n\tfor (var i = 0; i < this.drawLayers.length; ++i) {\n\t\tlayer = this.drawLayers[i];\n\t\tif (!layer.enabled) {\n\t\t\tcontinue;\n\t\t}\n\t\tthis.objwinActive = false;\n\t\tif (!(this.win0 || this.win1 || this.objwin)) {\n\t\t\tthis.setBlendEnabled(layer.index, this.target1[layer.index], this.blendMode);\n\t\t\tlayer.drawScanline(backing, layer, 0, this.HORIZONTAL_PIXELS);\n\t\t} else {\n\t\t\tfirstStart = 0;\n\t\t\tfirstEnd = this.HORIZONTAL_PIXELS;\n\t\t\tlastStart = 0;\n\t\t\tlastEnd = this.HORIZONTAL_PIXELS;\n\t\t\tif (this.win0 && y >= this.win0Top && y < this.win0Bottom) {\n\t\t\t\tif (this.windows[0].enabled[layer.index]) {\n\t\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[0].special && this.target1[layer.index], this.blendMode);\n\t\t\t\t\tlayer.drawScanline(backing, layer, this.win0Left, this.win0Right);\n\t\t\t\t}\n\t\t\t\tfirstStart = Math.max(firstStart, this.win0Left);\n\t\t\t\tfirstEnd = Math.min(firstEnd, this.win0Left);\n\t\t\t\tlastStart = Math.max(lastStart, this.win0Right);\n\t\t\t\tlastEnd = Math.min(lastEnd, this.win0Right);\n\t\t\t}\n\t\t\tif (this.win1 && y >= this.win1Top && y < this.win1Bottom) {\n\t\t\t\tif (this.windows[1].enabled[layer.index]) {\n\t\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[1].special && this.target1[layer.index], this.blendMode);\n\t\t\t\t\tif (!this.windows[0].enabled[layer.index] && (this.win1Left < firstStart || this.win1Right < lastStart)) {\n\t\t\t\t\t\t// We've been cut in two by window 0!\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, this.win1Left, firstStart);\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastEnd, this.win1Right);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, this.win1Left, this.win1Right);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tfirstStart = Math.max(firstStart, this.win1Left);\n\t\t\t\tfirstEnd = Math.min(firstEnd, this.win1Left);\n\t\t\t\tlastStart = Math.max(lastStart, this.win1Right);\n\t\t\t\tlastEnd = Math.min(lastEnd, this.win1Right);\n\t\t\t}\n\t\t\t// Do last two\n\t\t\tif (this.windows[2].enabled[layer.index] || (this.objwin && this.windows[3].enabled[layer.index])) {\n\t\t\t\t// WINOUT/OBJWIN\n\t\t\t\tthis.objwinActive = this.objwin;\n\t\t\t\tthis.setBlendEnabled(layer.index, this.windows[2].special && this.target1[layer.index], this.blendMode); // Window 3 handled in pushPixel\n\t\t\t\tif (firstEnd > lastStart) {\n\t\t\t\t\tlayer.drawScanline(backing, layer, 0, this.HORIZONTAL_PIXELS);\n\t\t\t\t} else {\n\t\t\t\t\tif (firstEnd) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, 0, firstEnd);\n\t\t\t\t\t}\n\t\t\t\t\tif (lastStart < this.HORIZONTAL_PIXELS) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastStart, this.HORIZONTAL_PIXELS);\n\t\t\t\t\t}\n\t\t\t\t\tif (lastEnd < firstStart) {\n\t\t\t\t\t\tlayer.drawScanline(backing, layer, lastEnd, firstStart);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tthis.setBlendEnabled(this.LAYER_BACKDROP, this.target1[this.LAYER_BACKDROP] && this.windows[2].special, this.blendMode);\n\t\t}\n\t\tif (layer.bg) {\n\t\t\tlayer.sx += layer.dmx;\n\t\t\tlayer.sy += layer.dmy;\n\t\t}\n\t}\n\n\tthis.finishScanline(backing);\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.finishScanline = function(backing) {\n\tvar color;\n\tvar bd = this.palette.accessColor(this.LAYER_BACKDROP, 0);\n\tvar xx = this.vcount * this.HORIZONTAL_PIXELS * 4;\n\tvar isTarget2 = this.target2[this.LAYER_BACKDROP];\n\tfor (var x = 0; x < this.HORIZONTAL_PIXELS; ++x) {\n\t\tif (backing.stencil[x] & this.WRITTEN_MASK) {\n\t\t\tcolor = backing.color[x];\n\t\t\tif (isTarget2 && backing.stencil[x] & this.TARGET1_MASK) {\n\t\t\t\tcolor = this.palette.mix(this.blendA, color, this.blendB, bd);\n\t\t\t}\n\t\t\tthis.palette.convert16To32(color, this.sharedColor);\n\t\t} else {\n\t\t\tthis.palette.convert16To32(bd, this.sharedColor);\n\t\t}\n\t\tthis.pixelData.data[xx++] = this.sharedColor[0];\n\t\tthis.pixelData.data[xx++] = this.sharedColor[1];\n\t\tthis.pixelData.data[xx++] = this.sharedColor[2];\n\t\txx++;\n\t}\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.startDraw = function() {\n\t// Nothing to do\n};\n\nGameBoyAdvanceSoftwareRenderer.prototype.finishDraw = function(caller) {\n\tthis.bg[2].sx = this.bg[2].refx;\n\tthis.bg[2].sy = this.bg[2].refy;\n\tthis.bg[3].sx = this.bg[3].refx;\n\tthis.bg[3].sy = this.bg[3].refy;\n\tcaller.finishDraw(this.pixelData);\n};\n\nexport default GameBoyAdvanceSoftwareRenderer;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport GameBoyAdvanceSoftwareRenderer from './video/software';\n\nfunction GameBoyAdvanceVideo() {\n\tthis.renderPath = new GameBoyAdvanceSoftwareRenderer();\n\n\tthis.CYCLES_PER_PIXEL = 4;\n\n\tthis.HORIZONTAL_PIXELS = 240;\n\tthis.HBLANK_PIXELS = 68;\n\tthis.HDRAW_LENGTH = 1006;\n\tthis.HBLANK_LENGTH = 226;\n\tthis.HORIZONTAL_LENGTH = 1232;\n\n\tthis.VERTICAL_PIXELS = 160;\n\tthis.VBLANK_PIXELS = 68;\n\tthis.VERTICAL_TOTAL_PIXELS = 228;\n\n\tthis.TOTAL_LENGTH = 280896;\n\n\tthis.drawCallback = function() {};\n\tthis.vblankCallback = function() {};\n};\n\nGameBoyAdvanceVideo.prototype.clear = function() {\n\tthis.renderPath.clear(this.cpu.mmu);\n\n\t// DISPSTAT\n\tthis.DISPSTAT_MASK = 0xFF38;\n\tthis.inHblank = false;\n\tthis.inVblank = false;\n\tthis.vcounter = 0;\n\tthis.vblankIRQ = 0;\n\tthis.hblankIRQ = 0;\n\tthis.vcounterIRQ = 0;\n\tthis.vcountSetting = 0;\n\n\t// VCOUNT\n\tthis.vcount = -1;\n\n\tthis.lastHblank = 0;\n\tthis.nextHblank = this.HDRAW_LENGTH;\n\tthis.nextEvent = this.nextHblank;\n\n\tthis.nextHblankIRQ = 0;\n\tthis.nextVblankIRQ = 0;\n\tthis.nextVcounterIRQ = 0;\n};\n\nGameBoyAdvanceVideo.prototype.freeze = function() {\n\treturn {\n\t\t'inHblank': this.inHblank,\n\t\t'inVblank': this.inVblank,\n\t\t'vcounter': this.vcounter,\n\t\t'vblankIRQ': this.vblankIRQ,\n\t\t'hblankIRQ': this.hblankIRQ,\n\t\t'vcounterIRQ': this.vcounterIRQ,\n\t\t'vcountSetting': this.vcountSetting,\n\t\t'vcount': this.vcount,\n\t\t'lastHblank': this.lastHblank,\n\t\t'nextHblank': this.nextHblank,\n\t\t'nextEvent': this.nextEvent,\n\t\t'nextHblankIRQ': this.nextHblankIRQ,\n\t\t'nextVblankIRQ': this.nextVblankIRQ,\n\t\t'nextVcounterIRQ': this.nextVcounterIRQ,\n\t\t'renderPath': this.renderPath.freeze(this.core.encodeBase64)\n\t};\n};\n\nGameBoyAdvanceVideo.prototype.defrost = function(frost) {\n\tthis.inHblank = frost.inHblank;\n\tthis.inVblank = frost.inVblank;\n\tthis.vcounter = frost.vcounter;\n\tthis.vblankIRQ = frost.vblankIRQ;\n\tthis.hblankIRQ = frost.hblankIRQ;\n\tthis.vcounterIRQ = frost.vcounterIRQ;\n\tthis.vcountSetting = frost.vcountSetting;\n\tthis.vcount = frost.vcount;\n\tthis.lastHblank = frost.lastHblank;\n\tthis.nextHblank = frost.nextHblank;\n\tthis.nextEvent = frost.nextEvent;\n\tthis.nextHblankIRQ = frost.nextHblankIRQ;\n\tthis.nextVblankIRQ = frost.nextVblankIRQ;\n\tthis.nextVcounterIRQ = frost.nextVcounterIRQ;\n\tthis.renderPath.defrost(frost.renderPath, this.core.decodeBase64);\n};\n\nGameBoyAdvanceVideo.prototype.setBacking = function(backing) {\n\tvar pixelData = backing.createImageData(this.HORIZONTAL_PIXELS, this.VERTICAL_PIXELS);\n\tthis.context = backing;\n\n\t// Clear backing first\n\tfor (var offset = 0; offset < this.HORIZONTAL_PIXELS * this.VERTICAL_PIXELS * 4;) {\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t\tpixelData.data[offset++] = 0xFF;\n\t}\n\n\tthis.renderPath.setBacking(pixelData);\n}\n\nGameBoyAdvanceVideo.prototype.updateTimers = function(cpu) {\n\tvar cycles = cpu.cycles;\n\n\tif (this.nextEvent <= cycles) {\n\t\tif (this.inHblank) {\n\t\t\t// End Hblank\n\t\t\tthis.inHblank = false;\n\t\t\tthis.nextEvent = this.nextHblank;\n\n\t\t\t++this.vcount;\n\n\t\t\tswitch (this.vcount) {\n\t\t\tcase this.VERTICAL_PIXELS:\n\t\t\t\tthis.inVblank = true;\n\t\t\t\tthis.renderPath.finishDraw(this);\n\t\t\t\tthis.nextVblankIRQ = this.nextEvent + this.TOTAL_LENGTH;\n\t\t\t\tthis.cpu.mmu.runVblankDmas();\n\t\t\t\tif (this.vblankIRQ) {\n\t\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VBLANK);\n\t\t\t\t}\n\t\t\t\tthis.vblankCallback();\n\t\t\t\tbreak;\n\t\t\tcase this.VERTICAL_TOTAL_PIXELS - 1:\n\t\t\t\tthis.inVblank = false;\n\t\t\t\tbreak;\n\t\t\tcase this.VERTICAL_TOTAL_PIXELS:\n\t\t\t\tthis.vcount = 0;\n\t\t\t\tthis.renderPath.startDraw();\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tthis.vcounter = this.vcount == this.vcountSetting;\n\t\t\tif (this.vcounter && this.vcounterIRQ) {\n\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_VCOUNTER);\n\t\t\t\tthis.nextVcounterIRQ += this.TOTAL_LENGTH;\n\t\t\t}\n\n\t\t\tif (this.vcount < this.VERTICAL_PIXELS) {\n\t\t\t\tthis.renderPath.drawScanline(this.vcount);\n\t\t\t}\n\t\t} else {\n\t\t\t// Begin Hblank\n\t\t\tthis.inHblank = true;\n\t\t\tthis.lastHblank = this.nextHblank;\n\t\t\tthis.nextEvent = this.lastHblank + this.HBLANK_LENGTH;\n\t\t\tthis.nextHblank = this.nextEvent + this.HDRAW_LENGTH;\n\t\t\tthis.nextHblankIRQ = this.nextHblank;\n\n\t\t\tif (this.vcount < this.VERTICAL_PIXELS) {\n\t\t\t\tthis.cpu.mmu.runHblankDmas();\n\t\t\t}\n\t\t\tif (this.hblankIRQ) {\n\t\t\t\tthis.cpu.irq.raiseIRQ(this.cpu.irq.IRQ_HBLANK);\n\t\t\t}\n\t\t}\n\t}\n};\n\nGameBoyAdvanceVideo.prototype.writeDisplayStat = function(value) {\n\tthis.vblankIRQ = value & 0x0008;\n\tthis.hblankIRQ = value & 0x0010;\n\tthis.vcounterIRQ = value & 0x0020;\n\tthis.vcountSetting = (value & 0xFF00) >> 8;\n\n\tif (this.vcounterIRQ) {\n\t\t// FIXME: this can be too late if we're in the middle of an Hblank\n\t\tthis.nextVcounterIRQ = this.nextHblank + this.HBLANK_LENGTH + (this.vcountSetting - this.vcount) * this.HORIZONTAL_LENGTH;\n\t\tif (this.nextVcounterIRQ < this.nextEvent) {\n\t\t\tthis.nextVcounterIRQ += this.TOTAL_LENGTH;\n\t\t}\n\t}\n};\n\nGameBoyAdvanceVideo.prototype.readDisplayStat = function() {\n\treturn (this.inVblank) | (this.inHblank << 1) | (this.vcounter << 2);\n};\n\nGameBoyAdvanceVideo.prototype.finishDraw = function(pixelData) {\n\tthis.context.putImageData(pixelData, 0, 0);\n\tthis.drawCallback();\n};\n\nexport default GameBoyAdvanceVideo;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nfunction GameBoyAdvanceKeypad() {\n\tthis.KEYCODE_LEFT = 37;\n\tthis.KEYCODE_UP = 38;\n\tthis.KEYCODE_RIGHT = 39;\n\tthis.KEYCODE_DOWN = 40;\n\tthis.KEYCODE_START = 13;\n\tthis.KEYCODE_SELECT = 220;\n\tthis.KEYCODE_A = 90;\n\tthis.KEYCODE_B = 88;\n\tthis.KEYCODE_L = 65;\n\tthis.KEYCODE_R = 83;\n\n\tthis.GAMEPAD_LEFT = 14;\n\tthis.GAMEPAD_UP = 12;\n\tthis.GAMEPAD_RIGHT = 15;\n\tthis.GAMEPAD_DOWN = 13;\n\tthis.GAMEPAD_START = 9;\n\tthis.GAMEPAD_SELECT = 8;\n\tthis.GAMEPAD_A = 1;\n\tthis.GAMEPAD_B = 0;\n\tthis.GAMEPAD_L = 4;\n\tthis.GAMEPAD_R = 5;\n\tthis.GAMEPAD_THRESHOLD = 0.2;\n\n\tthis.A = 0;\n\tthis.B = 1;\n\tthis.SELECT = 2;\n\tthis.START = 3;\n\tthis.RIGHT = 4;\n\tthis.LEFT = 5;\n\tthis.UP = 6;\n\tthis.DOWN = 7;\n\tthis.R = 8;\n\tthis.L = 9;\n\n\tthis.currentDown = 0x03FF;\n\tthis.eatInput = false;\n\n\tthis.gamepads = [];\n};\n\nGameBoyAdvanceKeypad.prototype.clickHandlerStart = function(e) {\n\tvar toggle = e.clickedButton || 0;\n\ttoggle = 1 << toggle;\n\tthis.currentDown &= ~toggle;\n}\n\nGameBoyAdvanceKeypad.prototype.clickHandlerEnd = function(e) {\n\tvar toggle = e.clickedButton || 0;\n\ttoggle = 1 << toggle;\n\tthis.currentDown |= toggle;\n}\n\nGameBoyAdvanceKeypad.prototype.keyboardHandler = function(e) {\n\tvar toggle = 0;\n\tswitch (e.keyCode) {\n\tcase this.KEYCODE_START:\n\t\ttoggle = this.START;\n\t\tbreak;\n\tcase this.KEYCODE_SELECT:\n\t\ttoggle = this.SELECT;\n\t\tbreak;\n\tcase this.KEYCODE_A:\n\t\ttoggle = this.A;\n\t\tbreak;\n\tcase this.KEYCODE_B:\n\t\ttoggle = this.B;\n\t\tbreak;\n\tcase this.KEYCODE_L:\n\t\ttoggle = this.L;\n\t\tbreak;\n\tcase this.KEYCODE_R:\n\t\ttoggle = this.R;\n\t\tbreak;\n\tcase this.KEYCODE_UP:\n\t\ttoggle = this.UP;\n\t\tbreak;\n\tcase this.KEYCODE_RIGHT:\n\t\ttoggle = this.RIGHT;\n\t\tbreak;\n\tcase this.KEYCODE_DOWN:\n\t\ttoggle = this.DOWN;\n\t\tbreak;\n\tcase this.KEYCODE_LEFT:\n\t\ttoggle = this.LEFT;\n\t\tbreak;\n\tdefault:\n\t\treturn;\n\t}\n\n\ttoggle = 1 << toggle;\n\tif (e.type == \"keydown\") {\n\t\tthis.currentDown &= ~toggle;\n\t} else {\n\t\tthis.currentDown |= toggle;\n\t}\n\n\tif (this.eatInput) {\n\t\te.preventDefault();\n\t}\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadHandler = function(gamepad) {\n\tvar value = 0;\n\tif (gamepad.buttons[this.GAMEPAD_LEFT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.LEFT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_UP] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.UP;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_RIGHT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.RIGHT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_DOWN] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.DOWN;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_START] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.START;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_SELECT] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.SELECT;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_A] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.A;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_B] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.B;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_L] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.L;\n\t}\n\tif (gamepad.buttons[this.GAMEPAD_R] > this.GAMEPAD_THRESHOLD) {\n\t\tvalue |= 1 << this.R;\n\t}\n\n\tthis.currentDown = ~value & 0x3FF;\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadConnectHandler = function(gamepad) {\n\tthis.gamepads.push(gamepad);\n};\n\nGameBoyAdvanceKeypad.prototype.gamepadDisconnectHandler = function(gamepad) {\n\tthis.gamepads = window.self.gamepads.filter(function(other) { return other != gamepad });\n};\n\nGameBoyAdvanceKeypad.prototype.pollGamepads = function() {\n\tvar navigatorList = [];\n\tif (navigator.webkitGetGamepads) {\n\t\tnavigatorList = navigator.webkitGetGamepads();\n\t} else if (navigator.getGamepads) {\n\t\tnavigatorList = navigator.getGamepads();\n\t}\n\n\t// Let's all give a shout out to Chrome for making us get the gamepads EVERY FRAME\n\tif (navigatorList.length) {\n\t\tthis.gamepads = [];\n\t}\n\tfor (var i = 0; i < navigatorList.length; ++i) {\n\t\tif (navigatorList[i]) {\n\t\t\tthis.gamepads.push(navigatorList[i]);\n\t\t}\n\t}\n\tif (this.gamepads.length > 0) {\n\t\tthis.gamepadHandler(this.gamepads[0]);\n\t}\n\n};\n\nGameBoyAdvanceKeypad.prototype.registerHandlers = function() {\n\twindow.addEventListener(\"keydown\", this.keyboardHandler.bind(this), true);\n\twindow.addEventListener(\"keyup\", this.keyboardHandler.bind(this), true);\n\n\twindow.addEventListener(\"gamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\twindow.addEventListener(\"mozgamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\twindow.addEventListener(\"webkitgamepadconnected\", this.gamepadConnectHandler.bind(this), true);\n\n\twindow.addEventListener(\"gamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n\twindow.addEventListener(\"mozgamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n\twindow.addEventListener(\"webkitgamepaddisconnected\", this.gamepadDisconnectHandler.bind(this), true);\n};\n\nexport default GameBoyAdvanceKeypad;\n","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nimport { hex } from './util';\n\nfunction GameBoyAdvanceSIO() {\n\tthis.SIO_NORMAL_8 = 0;\n\tthis.SIO_NORMAL_32 = 1;\n\tthis.SIO_MULTI = 2;\n\tthis.SIO_UART = 3;\n\tthis.SIO_GPIO = 8;\n\tthis.SIO_JOYBUS = 12;\n\n\tthis.BAUD = [ 9600, 38400, 57600, 115200 ];\n}\n\nGameBoyAdvanceSIO.prototype.clear = function() {\n\tthis.mode = this.SIO_GPIO;\n\tthis.sd = false;\n\n\tthis.irq = false;\n\tthis.multiplayer = {\n\t\tbaud: 0,\n\t\tsi: 0,\n\t\tid: 0,\n\t\terror: 0,\n\t\tbusy: 0,\n\n\t\tstates: [ 0xFFFF, 0xFFFF, 0xFFFF, 0xFFFF ]\n\t};\n\n\tthis.linkLayer = null;\n};\n\nGameBoyAdvanceSIO.prototype.setMode = function(mode) {\n\tif (mode & 0x8) {\n\t\tmode &= 0xC;\n\t} else {\n\t\tmode &= 0x3;\n\t}\n\tthis.mode = mode;\n\n\tthis.core.INFO('Setting SIO mode to ' + hex(mode, 1));\n};\n\nGameBoyAdvanceSIO.prototype.writeRCNT = function(value) {\n\tif (this.mode != this.SIO_GPIO) {\n\t\treturn;\n\t}\n\n\tthis.core.STUB('General purpose serial not supported');\n};\n\nGameBoyAdvanceSIO.prototype.writeSIOCNT = function(value) {\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_8:\n\t\tthis.core.STUB('8-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\tthis.multiplayer.baud = value & 0x0003;\n\t\tif (this.linkLayer) {\n\t\t\tthis.linkLayer.setBaud(this.BAUD[this.multiplayer.baud]);\n\t\t}\n\n\t\tif (!this.multiplayer.si) {\n\t\t\tthis.multiplayer.busy = value & 0x0080;\n\t\t\tif (this.linkLayer && this.multiplayer.busy) {\n\t\t\t\tthis.linkLayer.startMultiplayerTransfer();\n\t\t\t}\n\t\t}\n\t\tthis.irq = value & 0x4000;\n\t\tbreak;\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tcase this.SIO_GPIO:\n\t\t// This register isn't used in general-purpose mode\n\t\tbreak;\n\tcase this.SIO_JOYBUS:\n\t\tthis.core.STUB('JOY BUS unsupported');\n\t\tbreak;\n\t}\n};\n\nGameBoyAdvanceSIO.prototype.readSIOCNT = function() {\n\tvar value = (this.mode << 12) & 0xFFFF;\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_8:\n\t\tthis.core.STUB('8-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\tvalue |= this.multiplayer.baud;\n\t\tvalue |= this.multiplayer.si;\n\t\tvalue |= (!!this.sd) << 3;\n\t\tvalue |= this.multiplayer.id << 4;\n\t\tvalue |= this.multiplayer.error;\n\t\tvalue |= this.multiplayer.busy;\n\t\tvalue |= (!!this.multiplayer.irq) << 14;\n\t\tbreak;\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tcase this.SIO_GPIO:\n\t\t// This register isn't used in general-purpose mode\n\t\tbreak;\n\tcase this.SIO_JOYBUS:\n\t\tthis.core.STUB('JOY BUS unsupported');\n\t\tbreak;\n\t}\n\treturn value;\n};\n\nGameBoyAdvanceSIO.prototype.read = function(slot) {\n\tswitch (this.mode) {\n\tcase this.SIO_NORMAL_32:\n\t\tthis.core.STUB('32-bit transfer unsupported');\n\t\tbreak;\n\tcase this.SIO_MULTI:\n\t\treturn this.multiplayer.states[slot];\n\tcase this.SIO_UART:\n\t\tthis.core.STUB('UART unsupported');\n\t\tbreak;\n\tdefault:\n\t\tthis.core.WARN('Reading from transfer register in unsupported mode');\n\t\tbreak;\n\t}\n\treturn 0;\n};\n\nexport default GameBoyAdvanceSIO;\n","/*\r\n\tCopyright (c) 2012, Jeffrey Pfau\r\n\tAll rights reserved.\r\n\r\n\tAdapted code for React context by @mateuscoelho2009\r\n*/\r\n\r\nimport ARMCore from './core';\r\nimport GameBoyAdvanceMMU from './mmu';\r\nimport GameBoyAdvanceInterruptHandler from './irq';\r\nimport GameBoyAdvanceIO from './io';\r\nimport GameBoyAdvanceAudio from './audio';\r\nimport GameBoyAdvanceVideo from './video';\r\nimport GameBoyAdvanceKeypad from './keypad';\r\nimport GameBoyAdvanceSIO from './sio';\r\n\r\nfunction GameBoyAdvance() {\r\n\tthis.LOG_ERROR = 1;\r\n\tthis.LOG_WARN = 2;\r\n\tthis.LOG_STUB = 4;\r\n\tthis.LOG_INFO = 8;\r\n\tthis.LOG_DEBUG = 16;\r\n\r\n\tthis.SYS_ID = 'com.endrift.gbajs';\r\n\r\n\tthis.logLevel = this.LOG_ERROR | this.LOG_WARN;\r\n\r\n\tthis.rom = null;\r\n\r\n\tObject.prototype.inherit = function() {\r\n\t\tfor (var v in this) {\r\n\t\t\tthis[v] = this[v];\r\n\t\t}\r\n\t};\r\n\r\n\tthis.cpu = new ARMCore();\r\n\tthis.mmu = new GameBoyAdvanceMMU()\r\n\tthis.irq = new GameBoyAdvanceInterruptHandler();\r\n\tthis.io = new GameBoyAdvanceIO();\r\n\tthis.audio = new GameBoyAdvanceAudio();\r\n\tthis.video = new GameBoyAdvanceVideo();\r\n\tthis.keypad = new GameBoyAdvanceKeypad();\r\n\tthis.sio = new GameBoyAdvanceSIO();\r\n\r\n\t// TODO: simplify this graph\r\n\tthis.cpu.mmu = this.mmu;\r\n\tthis.cpu.irq = this.irq;\r\n\r\n\tthis.mmu.cpu = this.cpu;\r\n\tthis.mmu.core = this;\r\n\r\n\tthis.irq.cpu = this.cpu;\r\n\tthis.irq.io = this.io;\r\n\tthis.irq.audio = this.audio;\r\n\tthis.irq.video = this.video;\r\n\tthis.irq.core = this;\r\n\r\n\tthis.io.cpu = this.cpu;\r\n\tthis.io.audio = this.audio;\r\n\tthis.io.video = this.video;\r\n\tthis.io.keypad = this.keypad;\r\n\tthis.io.sio = this.sio;\r\n\tthis.io.core = this;\r\n\r\n\tthis.audio.cpu = this.cpu;\r\n\tthis.audio.core = this;\r\n\r\n\tthis.video.cpu = this.cpu;\r\n\tthis.video.core = this;\r\n\r\n\tthis.keypad.core = this;\r\n\r\n\tthis.sio.core = this;\r\n\r\n\tthis.keypad.registerHandlers();\r\n\tthis.doStep = this.waitFrame;\r\n\tthis.paused = false;\r\n\r\n\tthis.seenFrame = false;\r\n\tthis.seenSave = false;\r\n\tthis.lastVblank = 0;\r\n\r\n\tthis.queue = null;\r\n\tthis.reportFPS = null;\r\n\tthis.throttle = 16; // This is rough, but the 2/3ms difference gives us a good overhead\r\n\r\n\tvar self = this;\r\n\twindow.queueFrame = function (f) {\r\n\t\tself.queue = window.setTimeout(f, self.throttle);\r\n\t};\r\n\r\n\twindow.URL = window.URL || window.webkitURL;\r\n\r\n\tthis.video.vblankCallback = function() {\r\n\t\tself.seenFrame = true;\r\n\t};\r\n};\r\n\r\nGameBoyAdvance.prototype.setCanvas = function(canvas) {\r\n\tvar self = this;\r\n\tif (canvas.offsetWidth != 240 || canvas.offsetHeight != 160) {\r\n\t\tthis.indirectCanvas = document.createElement(\"canvas\");\r\n\t\tthis.indirectCanvas.setAttribute(\"height\", \"160\");\r\n\t\tthis.indirectCanvas.setAttribute(\"width\", \"240\");\r\n\t\tthis.targetCanvas = canvas;\r\n\t\tthis.setCanvasDirect(this.indirectCanvas);\r\n\t\tvar targetContext = canvas.getContext('2d');\r\n\t\tthis.video.drawCallback = function() {\r\n\t\t\ttargetContext.drawImage(self.indirectCanvas, 0, 0, canvas.offsetWidth, canvas.offsetHeight);\r\n\t\t}\r\n\t} else {\r\n\t\tthis.setCanvasDirect(canvas);\r\n\t\tvar self = this;\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.setCanvasDirect = function(canvas) {\r\n\tthis.context = canvas.getContext('2d');\r\n\tthis.video.setBacking(this.context);\r\n};\r\n\r\nGameBoyAdvance.prototype.setBios = function(bios, real) {\r\n\tthis.mmu.loadBios(bios, real);\r\n};\r\n\r\nGameBoyAdvance.prototype.setRom = function(rom) {\r\n\tthis.reset();\r\n\r\n\tthis.rom = this.mmu.loadRom(rom, true);\r\n\tif (!this.rom) {\r\n\t\treturn false;\r\n\t}\r\n\tthis.retrieveSavedata();\r\n\treturn true;\r\n};\r\n\r\nGameBoyAdvance.prototype.hasRom = function() {\r\n\treturn !!this.rom;\r\n};\r\n\r\nGameBoyAdvance.prototype.loadRomFromFile = function(romFile, callback) {\r\n\tvar reader = new FileReader();\r\n\tvar self = this;\r\n\treader.onload = function(e) {\r\n\t\tvar result = self.setRom(e.target.result);\r\n\t\tif (callback) {\r\n\t\t\tcallback(result);\r\n\t\t}\r\n\t}\r\n\treader.readAsArrayBuffer(romFile);\r\n};\r\n\r\nGameBoyAdvance.prototype.reset = function() {\r\n\tthis.audio.pause(true);\r\n\r\n\tthis.mmu.clear();\r\n\tthis.io.clear();\r\n\tthis.audio.clear();\r\n\tthis.video.clear();\r\n\tthis.sio.clear();\r\n\r\n\tthis.mmu.mmap(this.mmu.REGION_IO, this.io);\r\n\tthis.mmu.mmap(this.mmu.REGION_PALETTE_RAM, this.video.renderPath.palette);\r\n\tthis.mmu.mmap(this.mmu.REGION_VRAM, this.video.renderPath.vram);\r\n\tthis.mmu.mmap(this.mmu.REGION_OAM, this.video.renderPath.oam);\r\n\r\n\tthis.cpu.resetCPU(0);\r\n};\r\n\r\nGameBoyAdvance.prototype.step = function() {\r\n\twhile (this.doStep()) {\r\n\t\tthis.cpu.step();\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.waitFrame = function() {\r\n\tvar seen = this.seenFrame;\r\n\tthis.seenFrame = false;\r\n\treturn !seen;\r\n};\r\n\r\nGameBoyAdvance.prototype.pause = function() {\r\n\tthis.paused = true;\r\n\tthis.audio.pause(true);\r\n\tif (this.queue) {\r\n\t\tclearTimeout(this.queue);\r\n\t\tthis.queue = null;\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.advanceFrame = function() {\r\n\tthis.step();\r\n\tif (this.seenSave) {\r\n\t\tif (!this.mmu.saveNeedsFlush()) {\r\n\t\t\tthis.storeSavedata();\r\n\t\t\tthis.seenSave = false;\r\n\t\t} else {\r\n\t\t\tthis.mmu.flushSave();\r\n\t\t}\r\n\t} else if (this.mmu.saveNeedsFlush()) {\r\n\t\tthis.seenSave = true;\r\n\t\tthis.mmu.flushSave();\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.runStable = function() {\r\n\tif (this.interval) {\r\n\t\treturn; // Already running\r\n\t}\r\n\tvar self = this;\r\n\tvar timer = 0;\r\n\tvar frames = 0;\r\n\tvar runFunc;\r\n\tvar start = Date.now();\r\n\tthis.paused = false;\r\n\tthis.audio.context.resume();\r\n\tthis.audio.pause(false);\r\n\r\n\tif (this.reportFPS) {\r\n\t\trunFunc = function() {\r\n\t\t\ttry {\r\n\t\t\t\ttimer += Date.now() - start;\r\n\t\t\t\tif (self.paused) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.queueFrame(runFunc);\r\n\t\t\t\t}\r\n\t\t\t\tstart = Date.now();\r\n\t\t\t\tself.advanceFrame();\r\n\t\t\t\t++frames;\r\n\t\t\t\tif (frames == 60) {\r\n\t\t\t\t\tself.reportFPS((frames * 1000) / timer);\r\n\t\t\t\t\tframes = 0;\r\n\t\t\t\t\ttimer = 0;\r\n\t\t\t\t}\r\n\t\t\t} catch(exception) {\r\n\t\t\t\tself.ERROR(exception);\r\n\t\t\t\tif (exception.stack) {\r\n\t\t\t\t\tself.logStackTrace(exception.stack.split('\\n'));\r\n\t\t\t\t}\r\n\t\t\t\tthrow exception;\r\n\t\t\t}\r\n\t\t};\r\n\t} else {\r\n\t\trunFunc = function() {\r\n\t\t\ttry {\r\n\t\t\t\tif (self.paused) {\r\n\t\t\t\t\treturn;\r\n\t\t\t\t} else {\r\n\t\t\t\t\twindow.queueFrame(runFunc);\r\n\t\t\t\t}\r\n\t\t\t\tself.advanceFrame();\r\n\t\t\t} catch(exception) {\r\n\t\t\t\tself.ERROR(exception);\r\n\t\t\t\tif (exception.stack) {\r\n\t\t\t\t\tself.logStackTrace(exception.stack.split('\\n'));\r\n\t\t\t\t}\r\n\t\t\t\tthrow exception;\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\twindow.queueFrame(runFunc);\r\n};\r\n\r\nGameBoyAdvance.prototype.setSavedata = function(data) {\r\n\tthis.mmu.loadSavedata(data);\r\n};\r\n\r\n/* OBJECTIVE TODO */\r\nGameBoyAdvance.prototype.loadSavedataFromFile = function() {\r\n\tvar storageRef = window.firebase.storage().ref().child('epa.sav');\r\n\tvar self = this;\r\n\r\n\tstorageRef.getDownloadURL().then(function(url) {\r\n\t\t// This can be downloaded directly:\r\n\t\tvar xhr = new XMLHttpRequest();\r\n\t\txhr.responseType = 'arraybuffer';\r\n\t\txhr.onload = function(event) {\r\n\t\t\tself.setSavedata(xhr.response);\r\n\t\t\talert(\"Saved game loaded\");\r\n\t\t};\r\n\t\txhr.open('GET', url);\r\n\t\txhr.send();\r\n\t}).catch(function(error) {\r\n\t\t// Handle any errors\r\n\t\talert(\"Error while loading saved game.\");\r\n\t});\r\n\r\n\t/*var reader = new FileReader();\r\n\tvar self = this;\r\n\treader.onload = function(e) { self.setSavedata(e.target.result); }\r\n\treader.readAsArrayBuffer(saveFile);*/\r\n};\r\n\r\nGameBoyAdvance.prototype.decodeSavedata = function(string) {\r\n\tthis.setSavedata(this.decodeBase64(string));\r\n};\r\n\r\nGameBoyAdvance.prototype.decodeBase64 = function(string) {\r\n\tvar length = (string.length * 3 / 4);\r\n\tif (string[string.length - 2] == '=') {\r\n\t\tlength -= 2;\r\n\t} else if (string[string.length - 1] == '=') {\r\n\t\tlength -= 1;\r\n\t}\r\n\tvar buffer = new ArrayBuffer(length);\r\n\tvar view = new Uint8Array(buffer);\r\n\tvar bits = string.match(/..../g);\r\n\tfor (var i = 0; i + 2 < length; i += 3) {\r\n\t\tvar s = atob(bits.shift());\r\n\t\tview[i] = s.charCodeAt(0);\r\n\t\tview[i + 1] = s.charCodeAt(1);\r\n\t\tview[i + 2] = s.charCodeAt(2);\r\n\t}\r\n\tif (i < length) {\r\n\t\tvar s = atob(bits.shift());\r\n\t\tview[i++] = s.charCodeAt(0);\r\n\t\tif (s.length > 1) {\r\n\t\t\tview[i++] = s.charCodeAt(1);\r\n\t\t}\r\n\t}\r\n\r\n\treturn buffer;\r\n};\r\n\r\nGameBoyAdvance.prototype.encodeBase64 = function(view) {\r\n\tvar data = [];\r\n\tvar b;\r\n\tvar wordstring = [];\r\n\tvar triplet;\r\n\tfor (var i = 0; i < view.byteLength; ++i) {\r\n\t\tb = view.getUint8(i, true);\r\n\t\twordstring.push(String.fromCharCode(b));\r\n\t\twhile (wordstring.length >= 3) {\r\n\t\t\ttriplet = wordstring.splice(0, 3);\r\n\t\t\tdata.push(btoa(triplet.join('')));\r\n\t\t}\r\n\t};\r\n\tif (wordstring.length) {\r\n\t\tdata.push(btoa(wordstring.join('')));\r\n\t}\r\n\treturn data.join('');\r\n};\r\n\r\n/* OBJECTIVE TODO */\r\nGameBoyAdvance.prototype.downloadSavedata = function() {\r\n\tvar sram = this.mmu.save;\r\n\tconsole.log(sram);\r\n\tif (!sram) {\r\n\t\tthis.WARN(\"No save data available\");\r\n\t\treturn null;\r\n\t}\r\n\tif (window.URL) {\r\n\t\t//var url = window.URL.createObjectURL(new Blob([sram.buffer], { type: 'application/octet-stream' }));\r\n\t\t//console.log(url);\r\n\t\t//window.open(url);\r\n\r\n\t\t// Your web app's Firebase configuration\r\n\t\t//var db = window.firebase.firestore();\r\n\t\tvar storageRef = window.firebase.storage().ref().child('epa.sav');\r\n\t\t/*db.collection(\"saved-games\").add({\r\n\t\t\tepa: \"name\",\r\n\t\t})\r\n\t\t.then(function(docRef) {\r\n\t\t\tconsole.log(\"Document written with ID: \", docRef.id);\r\n\t\t})\r\n\t\t.catch(function(error) {\r\n\t\t\tconsole.error(\"Error adding document: \", error);\r\n\t\t});*/\r\n\t\tstorageRef.put(new Blob([sram.buffer], { type: 'application/octet-stream' })).then(function(snapshot) {\r\n\t\t\tconsole.log('Uploaded a blob or file!');\r\n\t\t});\r\n\t} else {\r\n\t\tvar data = this.encodeBase64(sram.view);\r\n\t\twindow.open('data:application/octet-stream;base64,' + data, this.rom.code + '.sav');\r\n\t}\r\n};\r\n\r\n\r\nGameBoyAdvance.prototype.storeSavedata = function() {\r\n\tvar sram = this.mmu.save;\r\n\ttry {\r\n\t\tvar storage = window.localStorage;\r\n\t\tstorage[this.SYS_ID + '.' + this.mmu.cart.code] = this.encodeBase64(sram.view);\r\n\t} catch (e) {\r\n\t\tthis.WARN('Could not store savedata! ' + e);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.retrieveSavedata = function() {\r\n\ttry {\r\n\t\tvar storage = window.localStorage;\r\n\t\tvar data = storage[this.SYS_ID + '.' + this.mmu.cart.code];\r\n\t\tif (data) {\r\n\t\t\tthis.decodeSavedata(data);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t} catch (e) {\r\n\t\tthis.WARN('Could not retrieve savedata! ' + e);\r\n\t}\r\n\treturn false;\r\n};\r\n\r\nGameBoyAdvance.prototype.freeze = function() {\r\n\treturn {\r\n\t\t'cpu': this.cpu.freeze(),\r\n\t\t'mmu': this.mmu.freeze(),\r\n\t\t'irq': this.irq.freeze(),\r\n\t\t'io': this.io.freeze(),\r\n\t\t'audio': this.audio.freeze(),\r\n\t\t'video': this.video.freeze()\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.defrost = function(frost) {\r\n\tthis.cpu.defrost(frost.cpu);\r\n\tthis.mmu.defrost(frost.mmu);\r\n\tthis.audio.defrost(frost.audio);\r\n\tthis.video.defrost(frost.video);\r\n\tthis.irq.defrost(frost.irq);\r\n\tthis.io.defrost(frost.io);\r\n};\r\n\r\nGameBoyAdvance.prototype.log = function(level, message) {};\r\n\r\nGameBoyAdvance.prototype.setLogger = function(logger) {\r\n\tthis.log = logger;\r\n};\r\n\r\nGameBoyAdvance.prototype.logStackTrace = function(stack) {\r\n\tvar overflow = stack.length - 32;\r\n\tthis.ERROR('Stack trace follows:');\r\n\tif (overflow > 0) {\r\n\t\tthis.log(-1, '> (Too many frames)');\r\n\t}\r\n\tfor (var i = Math.max(overflow, 0); i < stack.length; ++i) {\r\n\t\tthis.log(-1, '> ' + stack[i]);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.ERROR = function(error) {\r\n\tif (this.logLevel & this.LOG_ERROR) {\r\n\t\tthis.log(this.LOG_ERROR, error);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.WARN = function(warn) {\r\n\tif (this.logLevel & this.LOG_WARN) {\r\n\t\tthis.log(this.LOG_WARN, warn);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.STUB = function(func) {\r\n\tif (this.logLevel & this.LOG_STUB) {\r\n\t\tthis.log(this.LOG_STUB, func);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.INFO = function(info) {\r\n\tif (this.logLevel & this.LOG_INFO) {\r\n\t\tthis.log(this.LOG_INFO, info);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.DEBUG = function(info) {\r\n\tif (this.logLevel & this.LOG_DEBUG) {\r\n\t\tthis.log(this.LOG_DEBUG, info);\r\n\t}\r\n};\r\n\r\nGameBoyAdvance.prototype.ASSERT_UNREACHED = function(err) {\r\n\tthrow new Error(\"Should be unreached: \" + err);\r\n};\r\n\r\nGameBoyAdvance.prototype.ASSERT = function(test, err) {\r\n\tif (!test) {\r\n\t\tthrow new Error(\"Assertion failed: \" + err);\r\n\t}\r\n};\r\n\r\nexport default GameBoyAdvance;\r\n","import React from 'react';\r\nimport { Button, withStyles } from '@material-ui/core';\r\nimport { commands } from './GBAScreen';\r\n\r\nexport const THROTTLE_TO_STRING = {\r\n    16: '1x',\r\n    12: '1.5x',\r\n    8: '2x',\r\n    4: '2.5x',\r\n};\r\n\r\nexport const NEXT_THROTTLE = {\r\n    16: 12,\r\n    12: 8,\r\n    8: 4,\r\n    4: 16,\r\n};\r\n\r\nconst styles = () => {\r\n    const width = window.screen.width;\r\n\r\n    return {\r\n        container: {\r\n            position: 'relative',\r\n            height: 300,\r\n        },\r\n        \"LEFT\": {\r\n            position: 'absolute',\r\n            left: 8,\r\n            top: 150,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"RIGHT\": {\r\n            position: 'absolute',\r\n            left: 108,\r\n            top: 150,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"UP\": {\r\n            position: 'absolute',\r\n            left: 58,\r\n            top: 100,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"DOWN\": {\r\n            position: 'absolute',\r\n            left: 58,\r\n            top: 200,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"A\": {\r\n            position: 'absolute',\r\n            right: 8,\r\n            top: 110,\r\n            color: 'white',\r\n            padding: '16px 0',\r\n            border: '1px solid white',\r\n            borderRadius: '50%',\r\n        },\r\n        \"B\": {\r\n            position: 'absolute',\r\n            right: 68,\r\n            top: 170,\r\n            color: 'white',\r\n            padding: '16px 0',\r\n            border: '1px solid white',\r\n            borderRadius: '50%',\r\n        },\r\n        \"R\": {\r\n            position: 'absolute',\r\n            right: 8,\r\n            top: 30,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"L\": {\r\n            position: 'absolute',\r\n            left: 8,\r\n            top: 30,\r\n            color: 'white',\r\n            border: '1px solid white',\r\n        },\r\n        \"START\": {\r\n            position: 'absolute',\r\n            right: 70,\r\n            bottom: 8,\r\n            color: 'white',\r\n        },\r\n        \"SELECT\": {\r\n            position: 'absolute',\r\n            left: 70,\r\n            bottom: 8,\r\n            color: 'white',\r\n        },\r\n        fullscreen: {\r\n            color: 'white',\r\n        }\r\n    };\r\n};\r\n\r\nconst commandToStr = {\r\n    \"LEFT\": String.fromCharCode(parseInt(\"+2190\", 16)),\r\n    \"RIGHT\": String.fromCharCode(parseInt(\"+2192\", 16)),\r\n    \"UP\": String.fromCharCode(parseInt(\"+2191\", 16)),\r\n    \"DOWN\": String.fromCharCode(parseInt(\"+2193\", 16)),\r\n    \"A\": \"A\",\r\n    \"B\": \"B\",\r\n    \"R\": \"R\",\r\n    \"L\": \"L\",\r\n    \"START\": \"START\",\r\n    \"SELECT\": \"SELECT\",\r\n}\r\n\r\nconst GBAMobileController = ({ classes, goFull, toogleSpeed, throttle }) => {\r\n    // COmented for PWA reasons\r\n    // <Button className={classes.fullscreen} onClick={goFull}>Fullscreen</Button>\r\n    return (\r\n        <div className={classes.container}>\r\n            {commands.map(command => (\r\n                <Button id={command} className={classes[command]}>{commandToStr[command]}</Button>\r\n            ))}\r\n            {(document.body.requestFullscreen ||\r\n                document.body.mozRequestFullScreen ||\r\n                document.body.webkitRequestFullScreen ||\r\n                document.body.msRequestFullscreen) &&\r\n                <Button className={classes.fullscreen} onClick={goFull}>Fullscreen</Button>}\r\n            {throttle && <Button className={classes.fullscreen} onClick={toogleSpeed}>{THROTTLE_TO_STRING[throttle]}</Button>}\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default withStyles(styles)(GBAMobileController);\r\n","import React from 'react';\r\nimport { Table, Paper, makeStyles, TableCell, TableRow } from '@material-ui/core';\r\nimport { THROTTLE_TO_STRING } from './GBAMobileController';\r\n\r\nconst useStyle = makeStyles((theme) => ({\r\n    container: {\r\n        width: '100%',\r\n        maxWidth: 700,\r\n        margin: '16px auto',\r\n        height: 150,\r\n        textShadow: 'none',\r\n\r\n        '& td': {\r\n            padding: 0,\r\n        },\r\n    },\r\n    paper: {\r\n        textAlign: 'center',\r\n        margin: 0,\r\n        borderRadius: 0,\r\n        background: '#759',\r\n        color: 'white',\r\n        fontWeight: 'bold',\r\n    },\r\n    topPaper: {\r\n        background: '#648',\r\n    },\r\n}));\r\n\r\nfunction GBAControlsHelper ({ throttle }) {\r\n    const classes = useStyle();\r\n\r\n    return (\r\n        <Table className={classes.container}>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={`${classes.paper} ${classes.topPaper}`}>GBA Buttons</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={`${classes.paper} ${classes.topPaper}`}>Respective Keyboard</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>A</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Z</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>B</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>X</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>L</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>A</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>R</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>S</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Start</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Enter</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Select</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>\\</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>{`Accelerate (Current Speed ${THROTTLE_TO_STRING[throttle]})`}</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>+</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n            <TableRow>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Arrows</Paper>\r\n                </TableCell>\r\n                <TableCell>\r\n                    <Paper className={classes.paper}>Arrows</Paper>\r\n                </TableCell>\r\n            </TableRow>\r\n        </Table>\r\n    );\r\n}\r\n\r\nexport default GBAControlsHelper;","import React from 'react';\r\nimport GameBoyAdvance from '../libs/js/gba';\r\nimport loadRom from '../libs/resources/xhr';\r\nimport '../libs/resources/main.css';\r\nimport CrashImage from '../libs/resources/crash.png';\r\nimport BackgroundImage from '../libs/resources/bg.png';\r\nimport Bios from '../libs/resources/bios.bin';\r\nimport { withStyles, Button } from '@material-ui/core';\r\nimport GBAControlsHelper from './GBAControlsHelper';\r\nimport GBAMobileController, { NEXT_THROTTLE } from './GBAMobileController';\r\nimport Checkbox from '@material-ui/core/Checkbox';\r\nimport Grid from '@material-ui/core/Grid';\r\nimport Slider from '@material-ui/core/Slider';\r\nimport VolumeDown from '@material-ui/icons/VolumeDown';\r\nimport VolumeUp from '@material-ui/icons/VolumeUp';\r\nimport TextField from '@material-ui/core/TextField';\r\nimport Dialog from '@material-ui/core/Dialog';\r\nimport DialogActions from '@material-ui/core/DialogActions';\r\nimport DialogContent from '@material-ui/core/DialogContent';\r\nimport DialogContentText from '@material-ui/core/DialogContentText';\r\nimport DialogTitle from '@material-ui/core/DialogTitle';\r\n\r\nconst WhiteCheckbox = withStyles({\r\n    root: {\r\n      color: 'white',\r\n      '&$checked': {\r\n        color: 'white',\r\n      },\r\n    },\r\n    checked: {},\r\n})(props => <Checkbox color=\"default\" {...props} />);\r\n\r\nconst styles = () => {\r\n    const screenWidth = window.screen.width;\r\n    const width = screenWidth > 480 ? 480 : screenWidth;\r\n    const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n    const noselect = {\r\n        '-webkit-touch-callout': 'none', /* iOS Safari */\r\n        '-webkit-user-select': 'none', /* Safari */\r\n        '-khtml-user-select': 'none', /* Konqueror HTML */\r\n        '-moz-user-select': 'none',/* Old versions of Firefox */\r\n        '-ms-user-select': 'none', /* Internet Explorer/Edge */\r\n        'user-select': 'none', /* Non-prefixed version, currently\r\n                                    supported by Chrome, Opera and Firefox */\r\n    }\r\n\r\n    return ({\r\n        container: {\r\n            ...noselect,\r\n            width: '100%',\r\n            height: '100%',\r\n            overflow: 'hidden',\r\n            '-webkit-overflow-scrolling': 'touch',\r\n            minHeight: '100vh',\r\n            background: '-webkit-linear-gradient(#765490 560px, #6A4883 620px, #433061 900px)',\r\n            textAlign: 'center',\r\n            fontFamily: '\"Calibri\", \"Verdana\", sans-serif',\r\n            color: 'white',\r\n            textShadow: '0 2px rgba(0, 0, 0, 0.6)',\r\n        },\r\n        screen: {\r\n            ...noselect,\r\n            background: `url('${BackgroundImage}') no-repeat top center`,\r\n\r\n            '@media (max-width:480px)': {\r\n                background: 'none',\r\n            },\r\n        },\r\n        canvas: {\r\n            ...noselect,\r\n            marginTop: 85,\r\n            marginBottom: 150,\r\n            \r\n            '&[width=\"240\"]': {\r\n                marginTop: 42.5,\r\n                marginBottom: -363, /* Take up no height */\r\n                imageRendering: '-webkit-optimize-contrast',\r\n                imageRendering: '-moz-crisp-edges',\r\n                imageRendering: '-o-crisp-edges',\r\n                zoom: 2,\r\n                transform: 'scale(2)',\r\n            },\r\n            '@media (max-width:480px)': {\r\n                background: 'gray',\r\n                marginTop: 0,\r\n                marginBottom: 0,\r\n            },\r\n        },\r\n        controls: {\r\n            ...noselect,\r\n            borderRadius: 20,\r\n            border: '1px solid rgba(0, 0, 0, 0.4)',\r\n            borderTop: 'none',\r\n            boxShadow: '0 4px 4px -2px rgba(0, 0, 0, 0.9), 0 -40px 2px -1px #433061 inset',\r\n            width: '100vw',\r\n            maxWidth: 700,\r\n            margin: 'auto',\r\n            height: 200,\r\n            overflow: 'hidden',\r\n            backgroundColor: '#765490',\r\n            position: 'relative',\r\n\r\n            '&::before': {\r\n                content: '\"\"',\r\n                display: 'block',\r\n                height: 30,\r\n                width: 'calc(100vw + 7px)',\r\n                maxWidth: 707,\r\n                borderRadius: '5px / 15px',\r\n                border: '1px solid rgba(0, 0, 0, 0.4)',\r\n                borderWidth: '0 1px',\r\n                margin: '0 -5px 20px',\r\n                background: '-moz-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)',\r\n                background: '-webkit-linear-gradient(top, #8769A0, #9578B9 15%, #6A4883 50%, #433061)',\r\n                boxShadow: '0 5px 4px -3px rgba(0, 0, 0, 0.6)',\r\n                position: 'absolute',\r\n            },\r\n            '& > div': {\r\n                // marginTop: 30,\r\n                marginTop: -15,\r\n                transform: 'rotateX(0deg)',\r\n                transformOrigin: '50% 0',\r\n                transition: 'transform linear 0.5s',\r\n                '-moz-transform-origin': '50% 0',\r\n                '-moz-transform': 'rotateX(0deg)',\r\n                '-moz-transition': '-moz-transform linear 0.5s',\r\n                '-webkit-transform-origin-y': 2,\r\n                '-webkit-transform': 'rotateX(0deg)',\r\n                '-webkit-transition': '-webkit-transform linear 0.5s',\r\n            },\r\n        },\r\n        hidden: {\r\n            transform: 'rotateX(90deg) !important',\r\n            // -moz-transform: 'rotateX(90deg) !important';\r\n            // -webkit-transform: 'rotateX(90deg) !important';\r\n        },\r\n        dead: {\r\n            display: 'none',\r\n        },\r\n        button: {\r\n            fontFamily: '\"Calibri\", \"Verdana\", sans-serif',\r\n            backgroundColor: '#6A4883',\r\n            fontWeight: 'bold',\r\n            fontSize: 18,\r\n            color: 'white',\r\n            textShadow: '0 3px #433061',\r\n            padding: '2px 10px 5px',\r\n            borderRadius: '0 0 10px 10px',\r\n            border: '0 solid rgba(0, 0, 0, 0.4)',\r\n            borderWidth: '3px 1px 0px',\r\n            display: 'inline',\r\n            boxShadow: '0 2px 6px -1px rgba(0, 0, 0, 0.2) inset',\r\n            margin: '0 0 20px',\r\n        },\r\n        noselect,\r\n    });\r\n};\r\n\r\nexport const commands = [\r\n    \"LEFT\",\r\n    \"RIGHT\",\r\n    \"UP\",\r\n    \"DOWN\",\r\n    \"A\",\r\n    \"B\",\r\n    \"R\",\r\n    \"L\",\r\n    \"START\",\r\n    \"SELECT\",\r\n];\r\n\r\nvar gba;\r\n\r\nclass GBAScreen extends React.Component {\r\n    constructor(props) {\r\n        super(props);\r\n\r\n        this.state = {\r\n            isFull: false,\r\n            throttle: 16,\r\n            dialogOpened: false,\r\n            savedataFunction: null,\r\n        };\r\n\r\n        this.initGBA = this.initGBA.bind(this);\r\n        this.toogleSpeed = this.toogleSpeed.bind(this);\r\n        // this.goFull = this.goFull.bind(this);\r\n    }\r\n\r\n    goFull() {\r\n        // this.setState({ isFull: true });\r\n        var doc = window.document;\r\n        var docEl = doc.documentElement;\r\n        \r\n        var requestFullScreen = docEl.requestFullscreen || docEl.mozRequestFullScreen || docEl.webkitRequestFullScreen || docEl.msRequestFullscreen;\r\n        var cancelFullScreen = doc.exitFullscreen || doc.mozCancelFullScreen || doc.webkitExitFullscreen || doc.msExitFullscreen;\r\n        \r\n        if(!doc.fullscreenElement && !doc.mozFullScreenElement && !doc.webkitFullscreenElement && !doc.msFullscreenElement) {\r\n            requestFullScreen.call(docEl);\r\n        }\r\n        else {\r\n            cancelFullScreen.call(doc);\r\n        }\r\n    }\r\n\r\n    toogleSpeed() {\r\n        if (gba) {\r\n            var throttle = gba.throttle;\r\n\r\n            gba.throttle = NEXT_THROTTLE[throttle];\r\n\r\n            this.setState({\r\n                throttle: gba.throttle,\r\n            });\r\n        }\r\n    }\r\n\r\n    componentDidMount() {\r\n        this.initGBA();\r\n\r\n        window.addEventListener('beforeinstallprompt',e=>{\r\n            // For older browsers\r\n            e.preventDefault();\r\n            console.log(\"Install Prompt fired\");\r\n            this.installPrompt = e;\r\n            // See if the app is already installed, in that case, do nothing\r\n            if((window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone === true){\r\n              return false;\r\n            }\r\n            // Set the state variable to make button visible\r\n            this.setState({\r\n                installButton:true,\r\n            });\r\n        });\r\n    }\r\n\r\n    async installApp () {\r\n        if(!this.installPrompt) return false;\r\n        this.installPrompt.prompt();\r\n        let outcome = await this.installPrompt.userChoice;\r\n        if(outcome.outcome=='accepted'){\r\n          console.log(\"App Installed\")\r\n        }\r\n        else{\r\n          console.log(\"App not installed\");\r\n        }\r\n        // Remove the event reference\r\n        this.installPrompt=null;\r\n        // Hide the button\r\n        this.setState({\r\n          installButton:false\r\n        })\r\n    }\r\n\r\n    initGBA() {\r\n        var runCommands = [];\r\n        const {\r\n            classes,\r\n        } = this.props;  \r\n\r\n        document.addEventListener('gesturestart', function (e) {\r\n            e.preventDefault();\r\n        });\r\n\r\n        // Initialize emulator once the browser loads\r\n        window.onload = function () {\r\n            // Setup the emulator\r\n            try {\r\n                gba = new GameBoyAdvance();\r\n                gba.keypad.eatInput = true;\r\n\r\n                gba.setLogger(function (level, error) {\r\n                    console.error(error);\r\n                    \r\n                    gba.pause();\r\n                    \r\n                    var screen = document.getElementById('screen');\r\n                    \r\n                    if (screen.getAttribute('class') === classes.dead) {\r\n                        console.log('We appear to have crashed multiple times without reseting.');\r\n                        return;\r\n                    }\r\n\r\n                    // Show error image in the emulator screen\r\n                    // The image can be retrieven from the repository\r\n                    var crash = document.createElement('img');\r\n                    crash.setAttribute('id', 'crash');\r\n                    crash.setAttribute('src', CrashImage);\r\n                    screen.parentElement.insertBefore(crash, screen);\r\n                    screen.setAttribute('class', classes.dead);\r\n                });\r\n\r\n                // In order to pause/resume the game when the user changes the website tab in the browser\r\n                // add the 2 following listeners to the window !\r\n                // \r\n                // This feature is problematic/tricky to handle, so you can make it better if you need to\r\n                window.onblur = function () {\r\n                    if(gba.hasRom()){\r\n                        var e = document.getElementById('pause');\r\n\r\n                        if (!gba.paused) {\r\n                            gba.pause();\r\n                            e.textContent = \"UNPAUSE\";\r\n\r\n                            console.log(\"Window Focused: the game has been paused\");\r\n                        }\r\n                    }\r\n                };\r\n\r\n                window.onfocus = function () {\r\n                    if(gba.hasRom()){\r\n                        var e = document.getElementById('pause');\r\n\r\n                        if (gba.paused) {\r\n                            gba.runStable();\r\n                            e.textContent = \"PAUSE\";\r\n\r\n                            console.log(\"Window Focused: the game has been resumed\");\r\n                        }\r\n                    }\r\n                };\r\n            } catch (exception) {\r\n                gba = null;\r\n            }\r\n\r\n            if (gba && FileReader) {\r\n                var canvas = document.getElementById('screen');\r\n                gba.setCanvas(canvas);\r\n\r\n                gba.logLevel = gba.LOG_ERROR;\r\n\r\n                // Load the BIOS file of GBA (change the path according to yours)\r\n                loadRom(Bios, function (bios) {\r\n                    gba.setBios(bios);\r\n                });\r\n\r\n                if (!gba.audio.context) {\r\n                    // Remove the sound box if sound isn't available\r\n                    var soundbox = document.getElementById('sound');\r\n                    soundbox.parentElement.removeChild(soundbox);\r\n                }\r\n\r\n            } else {\r\n                var dead = document.getElementById('controls');\r\n                dead.parentElement.removeChild(dead);\r\n            }\r\n        }\r\n        window.onload();\r\n\r\n        function fadeOut(id, nextId, kill) {\r\n            var e = document.getElementById(id);\r\n            var e2 = document.getElementById(nextId);\r\n            if (!e) {\r\n                return;\r\n            }\r\n\r\n            var removeSelf = function () {\r\n                if (kill) {\r\n                    e.parentElement.removeChild(e);\r\n                } else {\r\n                    e.setAttribute('class', classes.dead);\r\n                    e.removeEventListener('webkitTransitionEnd', removeSelf);\r\n                    e.removeEventListener('oTransitionEnd', removeSelf);\r\n                    e.removeEventListener('transitionend', removeSelf);\r\n                }\r\n                if (e2) {\r\n                    e2.setAttribute('class', classes.hidden);\r\n                    setTimeout(function () {\r\n                        e2.removeAttribute('class');\r\n                    }, 0);\r\n                }\r\n            }\r\n\r\n            e.addEventListener('webkitTransitionEnd', removeSelf, false);\r\n            e.addEventListener('oTransitionEnd', removeSelf, false);\r\n            e.addEventListener('transitionend', removeSelf, false);\r\n            e.setAttribute('class', classes.hidden);\r\n        }\r\n\r\n        /**\r\n         * Starts the emulator with the given ROM file\r\n         * \r\n         * @param file \r\n         */\r\n        function run(file) {\r\n            var dead = document.getElementById('loader');\r\n\r\n            dead.value = '';\r\n            \r\n            var load = document.getElementById('select');\r\n            load.textContent = 'Loading...';\r\n            load.removeAttribute('onclick');\r\n            \r\n            var pause = document.getElementById('pause');\r\n            pause.textContent = \"PAUSE\";\r\n            \r\n            gba.loadRomFromFile(file, function (result) {\r\n                if (result) {\r\n                    for (var i = 0; i < runCommands.length; ++i) {\r\n                        runCommands[i]();\r\n                    }\r\n\r\n                    runCommands = [];\r\n                    fadeOut('preload', 'ingame');\r\n                    fadeOut('instructions', null, true);\r\n                    gba.runStable();\r\n                } else {\r\n                    load.textContent = 'FAILED';\r\n\r\n                    setTimeout(function () {\r\n                        load.textContent = 'SELECT';\r\n                        \r\n                        load.onclick = function () {\r\n                            document.getElementById('loader').click();\r\n                        };\r\n\r\n                    }, 3000);\r\n                }\r\n            });\r\n        }\r\n\r\n        /**\r\n         * Resets the emulator\r\n         * \r\n         */\r\n        function reset() {\r\n            gba.pause();\r\n            gba.reset();\r\n\r\n            var load = document.getElementById('select');\r\n            \r\n            load.textContent = 'SELECT';\r\n\r\n            var crash = document.getElementById('crash');\r\n            const screenWidth = window.screen.width;\r\n            const width = screenWidth > 480 ? 480 : screenWidth;\r\n            const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n            if (crash) {\r\n                var context = gba.targetCanvas.getContext('2d');\r\n                context.clearRect(0, 0, width, height);\r\n                gba.video.drawCallback();\r\n                crash.parentElement.removeChild(crash);\r\n                var canvas = document.getElementById('screen');\r\n                canvas.removeAttribute('class');\r\n            } else {\r\n                lcdFade(gba.context, gba.targetCanvas.getContext('2d'), gba.video.drawCallback);\r\n            }\r\n\r\n            load.onclick = function () {\r\n                document.getElementById('loader').click();\r\n            };\r\n\r\n            fadeOut('ingame', 'preload');\r\n\r\n            // Clear the ROM\r\n            gba.rom = null;\r\n        }\r\n\r\n        /**\r\n         * Stores the savefile data in the emulator.\r\n         * \r\n         * @param file \r\n         */\r\n        function uploadSavedataPending() {\r\n            runCommands.push(function () { \r\n                gba.loadSavedataFromFile() \r\n            });\r\n        }\r\n\r\n        /**\r\n         * Toggles the state of the game\r\n         */\r\n        function togglePause() {\r\n            var e = document.getElementById('pause');\r\n\r\n            if (gba.paused) {\r\n                gba.runStable();\r\n                e.textContent = \"PAUSE\";\r\n            } else {\r\n                gba.pause();\r\n                e.textContent = \"UNPAUSE\";\r\n            }\r\n        }\r\n\r\n        /**\r\n         * From a canvas context, creates an LCD animation that fades the content away.\r\n         * \r\n         * @param context \r\n         * @param target \r\n         * @param callback \r\n         */\r\n        function lcdFade(context, target, callback) {\r\n            var i = 0;\r\n            const screenWidth = window.screen.width;\r\n            const width = screenWidth > 480 ? 480 : screenWidth;\r\n            const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n            var drawInterval = setInterval(function () {\r\n                i++;\r\n\r\n                var pixelData = context.getImageData(0, 0, width / 2, height / 2);\r\n\r\n                for (var y = 0; y < height / 2; ++y) {\r\n                    for (var x = 0; x < width / 2; ++x) {\r\n                        var xDiff = Math.abs(x - width / 4);\r\n                        var yDiff = Math.abs(y - height / 4) * 0.8;\r\n                        var xFactor = (width / 4 - i - xDiff) / (width / 4);\r\n                        var yFactor = (height / 4 - i - ((y & 1) * 10) - yDiff + Math.pow(xDiff, 1 / 2)) / (height / 4);\r\n                        pixelData.data[(x + y * width / 2) * 4 + 3] *= Math.pow(xFactor, 1 / 3) * Math.pow(yFactor, 1 / 2);\r\n                    }\r\n                }\r\n                \r\n                context.putImageData(pixelData, 0, 0);\r\n\r\n                target.clearRect(0, 0, width, height);\r\n\r\n                if (i > 40) {\r\n                    clearInterval(drawInterval);\r\n                } else {\r\n                    callback();\r\n                }\r\n            }, 50);\r\n        }\r\n\r\n        /**\r\n         * Set the volume of the emulator.\r\n         * \r\n         * @param value \r\n         */\r\n        function setVolume(value) {\r\n            gba.audio.masterVolume = Math.pow(2, value) - 1;\r\n        }\r\n\r\n        // If clicked, simulate click on the File Select input to load a ROM\r\n        document.getElementById(\"select\").addEventListener(\"click\", function(){\r\n            document.getElementById(\"loader\").click();\r\n        }, false);\r\n\r\n        // One-liner to resume playback when user interacted with the page.\r\n        document.querySelector('button').addEventListener('click', function() {\r\n            gba.audio.context.resume();\r\n        });\r\n\r\n        // Run the emulator with the loaded ROM\r\n        document.getElementById(\"loader\").addEventListener(\"change\", function(){\r\n            var ROM = this.files[0];\r\n            run(ROM);\r\n        }, false);\r\n\r\n        // If clicked, simulate click on the File Select Input to load the savegame file\r\n        /*document.getElementById(\"select-savegame-btn\").addEventListener(\"click\", function(){\r\n            document.getElementById('saveloader').click();\r\n        }, false);*/\r\n\r\n        // Load the savegame to the emulator\r\n        this.setState({\r\n            savedataFunction: () => {\r\n                // var SAVEGAME = this.files[0];\r\n                uploadSavedataPending();\r\n                alert(\"Choose the game: the saved game will be loaded.\");\r\n                this.setState({ dialogOpened: false });\r\n            }\r\n        });\r\n\r\n        // Pause/Resume game\r\n        document.getElementById(\"pause\").addEventListener(\"click\", function(){\r\n                togglePause();\r\n        }, false);\r\n\r\n        // Reset game\r\n        document.getElementById(\"reset-btn\").addEventListener(\"click\", function(){\r\n                reset();\r\n        }, false);\r\n\r\n        // Download the savegamefile\r\n        document.getElementById(\"download-savegame\").addEventListener(\"click\", function(){\r\n                gba.downloadSavedata();\r\n        }, false);\r\n\r\n        // Mute/Unmute emulator\r\n        document.getElementById(\"audio-enabled-checkbox\").addEventListener(\"change\", function(){\r\n            gba.audio.masterEnable = this.checked;\r\n        }, false);\r\n\r\n        commands.forEach((command) => {\r\n            if (document.getElementById(command)) {\r\n                document.getElementById(command).ontouchstart = e => {\r\n                    gba.keypad.clickHandlerStart({\r\n                        ...e,\r\n                        clickedButton: gba.keypad[command],\r\n                    });\r\n                };\r\n        \r\n                document.getElementById(command).ontouchend = e => {\r\n                    gba.keypad.clickHandlerEnd({\r\n                        ...e,\r\n                        clickedButton: gba.keypad[command],\r\n                    });\r\n                };\r\n            }\r\n        });\r\n\r\n        document.addEventListener(\"keydown\", event => {\r\n            if (event.isComposing || event.keyCode !== 107) return;\r\n\r\n            this.toogleSpeed();\r\n        });\r\n    }\r\n\r\n    render() {\r\n        const {\r\n            classes,\r\n        } = this.props; // Canvas 480 x 320 => 320 x 214\r\n        const screenWidth = window.screen.width;\r\n        const width = screenWidth > 480 ? 480 : screenWidth;\r\n        const height = screenWidth > 480 ? 320 : 320 * screenWidth / 480;\r\n\r\n        return (\r\n            <div className={classes.container}>\r\n                {this.state.installButton && <Button onClick={this.installApp}>Install as application</Button>}\r\n\r\n                <div className={classes.screen}>\r\n                    <div id=\"fullscreenable\">\r\n                        <canvas id=\"screen\" className={classes.canvas} width={`${width}`} height={`${height}`}></canvas>\r\n                        \r\n                        {screenWidth <= 480 ? <GBAMobileController goFull={this.goFull} throttle={this.state.throttle} toogleSpeed={this.toogleSpeed} /> : <GBAControlsHelper throttle={this.state.throttle} />}\r\n                    </div>\r\n\r\n                    <div id=\"controls\" className={classes.controls}>\r\n                        <div id=\"preload\">\r\n                            <h4 className={classes.noselect}>App Controls</h4>\r\n                            <button className={classes.button} id=\"select\"> Select ROM file</button>\r\n                            <input id=\"loader\" type=\"file\" accept=\".gba\" />\r\n                            <button className={classes.button} onClick={() => {this.setState({ dialogOpened: true })}}>Load Savegame</button>\r\n                            <Dialog open={this.state.dialogOpened} onClose={() => {this.setState({ dialogOpened: false })}} aria-labelledby=\"form-dialog-title\">\r\n                                <DialogTitle id=\"form-dialog-title\">Savegame</DialogTitle>\r\n                                <DialogContent>\r\n                                    <DialogContentText>\r\n                                        Choose a name for the saving. Choose carefully, because it can be\r\n                                        overrided by another player.\r\n                                    </DialogContentText>\r\n                                    <TextField\r\n                                        autoFocus\r\n                                        margin=\"dense\"\r\n                                        id=\"name\"\r\n                                        label=\"Saving Name\"\r\n                                        type=\"test\"\r\n                                        fullWidth\r\n                                    />\r\n                                </DialogContent>\r\n                                <DialogActions>\r\n                                    <Button onClick={() => {this.setState({ dialogOpened: false })}} color=\"primary\">\r\n                                        Cancel\r\n                                    </Button>\r\n                                    {this.state.savedataFunction && <Button onClick={this.state.savedataFunction} color=\"primary\">\r\n                                        Subscribe\r\n                                    </Button>}\r\n                                </DialogActions>\r\n                            </Dialog>\r\n                        </div>\r\n                        <div id=\"ingame\" className={classes.hidden}>\r\n                            <h4 className={classes.noselect}>In-game controls</h4>\r\n                            <button className={classes.button} id=\"pause\">Pause</button>\r\n                            <button className={classes.button} id=\"reset-btn\">Reset</button>\r\n                            <button className={classes.button} id=\"download-savegame\">Save Game</button>\r\n\r\n                            <div id=\"sound\">    \r\n                                <Grid container spacing={2}>\r\n                                    <Grid item xs>\r\n                                        <p>Audio enabled</p>\r\n                                        <WhiteCheckbox value={gba && gba.audio.masterEnable} id=\"audio-enabled-checkbox\" />\r\n                                    </Grid>\r\n                                    <Grid item xs>\r\n                                        <p>Change sound level</p>\r\n                                        <Grid container spacing={2}>\r\n                                            <Grid item>\r\n                                                <VolumeDown />\r\n                                            </Grid>\r\n                                            <Grid item xs>\r\n                                                <Slider\r\n                                                    style={{\r\n                                                        color: 'white',\r\n                                                    }}\r\n                                                    onChange={(e, newValue) => {\r\n                                                        console.log(newValue);\r\n                                                        gba.audio.masterVolume = Math.pow(2, newValue / 100) - 1;\r\n                                                    }}\r\n                                                    aria-labelledby=\"continuous-slider\"\r\n                                                    inputProps={{\r\n                                                        min: 0,\r\n                                                        max: 100,\r\n                                                        type: 'number',\r\n                                                    }}\r\n                                                />\r\n                                            </Grid>\r\n                                            <Grid item>\r\n                                                <VolumeUp />\r\n                                            </Grid>\r\n                                        </Grid>\r\n                                    </Grid>\r\n                                </Grid>\r\n                            </div>\r\n                        </div>\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        );\r\n    }\r\n}\r\n\r\nexport default withStyles(styles)(GBAScreen);","/*\n\tCopyright (c) 2012, Jeffrey Pfau\n\tAll rights reserved.\n\n\tAdapted code for React context by @mateuscoelho2009\n*/\n\nexport default function loadRom(url, callback) {\n\tvar xhr = new XMLHttpRequest();\n\txhr.open('GET', url);\n\txhr.responseType = 'arraybuffer';\n\n\txhr.onload = function() { callback(xhr.response) };\n\txhr.send();\n}\n","import React from 'react';\r\nimport ReactDOM from 'react-dom';\r\nimport './index.css';\r\n\r\n// Pages\r\nimport App from './App';\r\nimport Page404 from './pages/Page404';\r\n\r\nimport * as serviceWorker from './serviceWorker';\r\nimport { HashRouter, Switch, Route } from 'react-router-dom';\r\nimport { Provider } from 'react-redux';\r\nimport { Store } from './store';\r\nimport GBAScreen from './components/GBAScreen';\r\n\r\nReactDOM.render(\r\n    <HashRouter>\r\n        <Provider store={Store}>\r\n            <Switch>\r\n                <Route path=\"/\" exact={true} component={App} />\r\n\r\n                <Route path=\"/emulator\" component={GBAScreen} />\r\n\r\n                <Route path='*' component={Page404} />\r\n            </Switch>\r\n        </Provider>\r\n    </HashRouter>\r\n    , document.getElementById('root'));\r\n\r\n// If you want your app to work offline and load faster, you can change\r\n// unregister() to register() below. Note this comes with some pitfalls.\r\n// Learn more about service workers: https://bit.ly/CRA-PWA\r\nserviceWorker.register();\r\n","module.exports = __webpack_public_path__ + \"static/media/logo.25bf045c.svg\";","module.exports = \"data:image/png;base64,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\"","module.exports = __webpack_public_path__ + \"static/media/bg.d96f92c9.png\";","module.exports = __webpack_public_path__ + \"static/media/bios.3465b6bf.bin\";"],"sourceRoot":""}